{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\chart\\controller\\tooltip.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\chart\\controller\\tooltip.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var Util = require('../../util');\r\nvar Shape = require('../../geom/shape/shape');\r\nvar _require = require('@antv/component/lib'), Tooltip = _require.Tooltip;\r\nvar MatrixUtil = Util.MatrixUtil;\r\nvar Vector2 = MatrixUtil.vec2;\r\nvar TYPE_SHOW_MARKERS = ['line', 'area', 'path', 'areaStack'];\r\nvar TYPE_SHOW_CROSSHAIRS = ['line', 'area'];\r\nvar IGNORE_TOOLTIP_ITEM_PROPERTIES = ['marker', 'showMarker'];\r\nfunction _indexOfArray(items, item) {\r\n    var rst = -1;\r\n    Util.each(items, function (sub, index) {\r\n        var isEqual = true;\r\n        for (var key in item) {\r\n            if (item.hasOwnProperty(key) && IGNORE_TOOLTIP_ITEM_PROPERTIES.indexOf(key) === -1) {\r\n                if (!Util.isObject(item[key]) && item[key] !== sub[key]) {\r\n                    isEqual = false;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (isEqual) {\r\n            rst = index;\r\n            return false;\r\n        }\r\n    });\r\n    return rst;\r\n}\r\nfunction _hasClass(dom, className) {\r\n    if (!dom) {\r\n        return false;\r\n    }\r\n    var cls = '';\r\n    if (!dom.className)\r\n        return false;\r\n    if (!Util.isNil(dom.className.baseVal)) {\r\n        cls = dom.className.baseVal;\r\n    }\r\n    else {\r\n        cls = dom.className;\r\n    }\r\n    return cls.indexOf(className) !== -1;\r\n}\r\nfunction _isParent(dom, cls) {\r\n    var parent = dom.parentNode;\r\n    var rst = false;\r\n    while (parent && parent !== document.body) {\r\n        if (_hasClass(parent, cls)) {\r\n            rst = true;\r\n            break;\r\n        }\r\n        parent = parent.parentNode;\r\n    }\r\n    return rst;\r\n}\r\nfunction _uniqItems(items) {\r\n    var tmp = [];\r\n    Util.each(items, function (item) {\r\n        var index = _indexOfArray(tmp, item);\r\n        if (index === -1) {\r\n            tmp.push(item);\r\n        }\r\n        else {\r\n            tmp[index] = item;\r\n        }\r\n    });\r\n    return tmp;\r\n}\r\nvar TooltipController = function () {\r\n    function TooltipController(cfg) {\r\n        Util.assign(this, cfg);\r\n        this.timeStamp = 0;\r\n    }\r\n    var _proto = TooltipController.prototype;\r\n    _proto._normalizeEvent = function _normalizeEvent(event) {\r\n        var chart = this.chart;\r\n        var canvas = this._getCanvas();\r\n        var point = canvas.getPointByClient(event.clientX, event.clientY);\r\n        var pixelRatio = canvas.get('pixelRatio');\r\n        point.x = point.x / pixelRatio;\r\n        point.y = point.y / pixelRatio;\r\n        var views = chart.getViewsByPoint(point);\r\n        point.views = views;\r\n        return point;\r\n    };\r\n    _proto._getCanvas = function _getCanvas() {\r\n        return this.chart.get('canvas');\r\n    };\r\n    _proto._getTriggerEvent = function _getTriggerEvent() {\r\n        var options = this.options;\r\n        var triggerOn = options.triggerOn;\r\n        var eventName;\r\n        if (!triggerOn || triggerOn === 'mousemove') {\r\n            eventName = 'plotmove';\r\n        }\r\n        else if (triggerOn === 'click') {\r\n            eventName = 'plotclick';\r\n        }\r\n        else if (triggerOn === 'none') {\r\n            eventName = null;\r\n        }\r\n        return eventName;\r\n    };\r\n    _proto._getDefaultTooltipCfg = function _getDefaultTooltipCfg() {\r\n        var self = this;\r\n        var chart = self.chart;\r\n        var viewTheme = self.viewTheme;\r\n        var options = self.options;\r\n        var defaultCfg = Util.mix({}, viewTheme.tooltip);\r\n        var geoms = chart.getAllGeoms().filter(function (geom) {\r\n            return geom.get('visible');\r\n        });\r\n        var shapes = [];\r\n        Util.each(geoms, function (geom) {\r\n            var type = geom.get('type');\r\n            var adjusts = geom.get('adjusts');\r\n            var isSymmetric = false;\r\n            if (adjusts) {\r\n                Util.each(adjusts, function (adjust) {\r\n                    if (adjust.type === 'symmetric' || adjust.type === 'Symmetric') {\r\n                        isSymmetric = true;\r\n                        return false;\r\n                    }\r\n                });\r\n            }\r\n            if (Util.indexOf(shapes, type) === -1 && !isSymmetric) {\r\n                shapes.push(type);\r\n            }\r\n        });\r\n        var isTransposed = geoms.length && geoms[0].get('coord') ? geoms[0].get('coord').isTransposed : false;\r\n        var crosshairsCfg;\r\n        if (geoms.length && geoms[0].get('coord') && geoms[0].get('coord').type === 'cartesian' && shapes.length === 1) {\r\n            if (shapes[0] === 'interval' && options.shared !== false) {\r\n                var crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsRect);\r\n                crosshairs.isTransposed = isTransposed;\r\n                crosshairsCfg = {\r\n                    zIndex: 0,\r\n                    crosshairs: crosshairs\r\n                };\r\n            }\r\n            else if (Util.indexOf(TYPE_SHOW_CROSSHAIRS, shapes[0]) > -1) {\r\n                var _crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsLine);\r\n                _crosshairs.isTransposed = isTransposed;\r\n                crosshairsCfg = {\r\n                    crosshairs: _crosshairs\r\n                };\r\n            }\r\n        }\r\n        return Util.mix(defaultCfg, crosshairsCfg, {});\r\n    };\r\n    _proto._bindEvent = function _bindEvent() {\r\n        var chart = this.chart;\r\n        var triggerEvent = this._getTriggerEvent();\r\n        if (triggerEvent) {\r\n            chart.on(triggerEvent, Util.wrapBehavior(this, 'onMouseMove'));\r\n            chart.on('plotleave', Util.wrapBehavior(this, 'onMouseOut'));\r\n        }\r\n    };\r\n    _proto._offEvent = function _offEvent() {\r\n        var chart = this.chart;\r\n        var triggerEvent = this._getTriggerEvent();\r\n        if (triggerEvent) {\r\n            chart.off(triggerEvent, Util.getWrapBehavior(this, 'onMouseMove'));\r\n            chart.off('plotleave', Util.getWrapBehavior(this, 'onMouseOut'));\r\n        }\r\n    };\r\n    _proto._setTooltip = function _setTooltip(point, items, markersItems, target) {\r\n        var self = this;\r\n        var tooltip = self.tooltip;\r\n        var prePoint = self.prePoint;\r\n        if (!prePoint || prePoint.x !== point.x || prePoint.y !== point.y) {\r\n            items = _uniqItems(items);\r\n            self.prePoint = point;\r\n            var chart = self.chart;\r\n            var viewTheme = self.viewTheme;\r\n            var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\r\n            var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\r\n            if (!tooltip.get('visible')) {\r\n                chart.emit('tooltip:show', {\r\n                    x: x,\r\n                    y: y,\r\n                    tooltip: tooltip\r\n                });\r\n            }\r\n            var first = items[0];\r\n            var title = first.title || first.name;\r\n            if (tooltip.isContentChange(title, items)) {\r\n                chart.emit('tooltip:change', {\r\n                    tooltip: tooltip,\r\n                    x: x,\r\n                    y: y,\r\n                    items: items\r\n                });\r\n                title = items[0].title || items[0].name;\r\n                tooltip.setContent(title, items);\r\n                if (!Util.isEmpty(markersItems)) {\r\n                    if (self.options.hideMarkers === true) {\r\n                        tooltip.set('markerItems', markersItems);\r\n                    }\r\n                    else {\r\n                        tooltip.setMarkers(markersItems, viewTheme.tooltipMarker);\r\n                    }\r\n                }\r\n                else {\r\n                    tooltip.clearMarkers();\r\n                }\r\n            }\r\n            var canvas = this._getCanvas();\r\n            if (target === canvas && tooltip.get('type') === 'mini') {\r\n                tooltip.hide();\r\n            }\r\n            else {\r\n                tooltip.setPosition(x, y, target);\r\n                tooltip.show();\r\n            }\r\n        }\r\n    };\r\n    _proto.hideTooltip = function hideTooltip() {\r\n        var tooltip = this.tooltip;\r\n        var chart = this.chart;\r\n        var canvas = this._getCanvas();\r\n        this.prePoint = null;\r\n        tooltip.hide();\r\n        chart.emit('tooltip:hide', {\r\n            tooltip: tooltip\r\n        });\r\n        canvas.draw();\r\n    };\r\n    _proto.onMouseMove = function onMouseMove(ev) {\r\n        if (Util.isEmpty(ev.views)) {\r\n            return;\r\n        }\r\n        var lastTimeStamp = this.timeStamp;\r\n        var timeStamp = +new Date();\r\n        var point = {\r\n            x: ev.x,\r\n            y: ev.y\r\n        };\r\n        if (timeStamp - lastTimeStamp > 16 && !this.chart.get('stopTooltip')) {\r\n            this.showTooltip(point, ev.views, ev.shape);\r\n            this.timeStamp = timeStamp;\r\n        }\r\n    };\r\n    _proto.onMouseOut = function onMouseOut(ev) {\r\n        var tooltip = this.tooltip;\r\n        if (!tooltip.get('visible') || !tooltip.get('follow')) {\r\n            return;\r\n        }\r\n        if (ev && ev.toElement && (_hasClass(ev.toElement, 'g2-tooltip') || _isParent(ev.toElement, 'g2-tooltip'))) {\r\n            return;\r\n        }\r\n        this.hideTooltip();\r\n    };\r\n    _proto.renderTooltip = function renderTooltip() {\r\n        var self = this;\r\n        if (self.tooltip) {\r\n            return;\r\n        }\r\n        var chart = self.chart;\r\n        var viewTheme = self.viewTheme;\r\n        var canvas = self._getCanvas();\r\n        var defaultCfg = self._getDefaultTooltipCfg();\r\n        var options = self.options;\r\n        options = Util.deepMix({\r\n            plotRange: chart.get('plotRange'),\r\n            capture: false,\r\n            canvas: canvas,\r\n            frontPlot: chart.get('frontPlot'),\r\n            viewTheme: viewTheme.tooltip,\r\n            backPlot: chart.get('backPlot')\r\n        }, defaultCfg, options);\r\n        if (options.crosshairs && options.crosshairs.type === 'rect') {\r\n            options.zIndex = 0;\r\n        }\r\n        options.visible = false;\r\n        var tooltip;\r\n        if (options.type === 'mini') {\r\n            options.crosshairs = false;\r\n            options.position = 'top';\r\n            tooltip = new Tooltip.Mini(options);\r\n        }\r\n        else if (options.useHtml) {\r\n            tooltip = new Tooltip.Html(options);\r\n        }\r\n        else {\r\n            tooltip = new Tooltip.Canvas(options);\r\n        }\r\n        self.tooltip = tooltip;\r\n        var triggerEvent = self._getTriggerEvent();\r\n        if (!tooltip.get('enterable') && triggerEvent === 'plotmove') {\r\n            var tooltipContainer = tooltip.get('container');\r\n            if (tooltipContainer) {\r\n                tooltipContainer.onmousemove = function (e) {\r\n                    var eventObj = self._normalizeEvent(e);\r\n                    chart.emit(triggerEvent, eventObj);\r\n                };\r\n            }\r\n        }\r\n        self._bindEvent();\r\n    };\r\n    _proto.showTooltip = function showTooltip(point, views, target) {\r\n        var self = this;\r\n        if (Util.isEmpty(views) || !point) {\r\n            return;\r\n        }\r\n        if (!this.tooltip) {\r\n            this.renderTooltip();\r\n        }\r\n        var options = self.options;\r\n        var markersItems = [];\r\n        var items = [];\r\n        Util.each(views, function (view) {\r\n            if (!view.get('tooltipEnable')) {\r\n                return true;\r\n            }\r\n            var geoms = view.get('geoms');\r\n            var coord = view.get('coord');\r\n            Util.each(geoms, function (geom) {\r\n                var type = geom.get('type');\r\n                if (geom.get('visible') && geom.get('tooltipCfg') !== false) {\r\n                    var dataArray = geom.get('dataArray');\r\n                    if (geom.isShareTooltip() || options.shared === false && Util.inArray(['area', 'line', 'path'], type)) {\r\n                        Util.each(dataArray, function (obj) {\r\n                            var tmpPoint = geom.findPoint(point, obj);\r\n                            if (tmpPoint) {\r\n                                var subItems = geom.getTipItems(tmpPoint, options.title);\r\n                                Util.each(subItems, function (v) {\r\n                                    var point = v.point;\r\n                                    if (point && point.x && point.y) {\r\n                                        var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\r\n                                        var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\r\n                                        point = coord.applyMatrix(x, y, 1);\r\n                                        v.x = point[0];\r\n                                        v.y = point[1];\r\n                                        v.showMarker = true;\r\n                                        var itemMarker = self._getItemMarker(geom, v.color);\r\n                                        v.marker = itemMarker;\r\n                                        if (Util.indexOf(TYPE_SHOW_MARKERS, type) !== -1) {\r\n                                            markersItems.push(v);\r\n                                        }\r\n                                    }\r\n                                });\r\n                                items = items.concat(subItems);\r\n                            }\r\n                        });\r\n                    }\r\n                    else {\r\n                        var geomContainer = geom.get('shapeContainer');\r\n                        if (target && target.get('visible') && target.get('origin') && target.get('parent') === geomContainer) {\r\n                            items = geom.getTipItems(target.get('origin'), options.title);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            Util.each(items, function (item) {\r\n                var point = item.point;\r\n                var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\r\n                var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\r\n                point = coord.applyMatrix(x, y, 1);\r\n                item.x = point[0];\r\n                item.y = point[1];\r\n            });\r\n        });\r\n        if (items.length) {\r\n            var first = items[0];\r\n            if (!items.every(function (item) {\r\n                return item.title === first.title;\r\n            })) {\r\n                var nearestItem = first;\r\n                var nearestDistance = Infinity;\r\n                items.forEach(function (item) {\r\n                    var distance = Vector2.distance([point.x, point.y], [item.x, item.y]);\r\n                    if (distance < nearestDistance) {\r\n                        nearestDistance = distance;\r\n                        nearestItem = item;\r\n                    }\r\n                });\r\n                items = items.filter(function (item) {\r\n                    return item.title === nearestItem.title;\r\n                });\r\n                markersItems = markersItems.filter(function (item) {\r\n                    return item.title === nearestItem.title;\r\n                });\r\n            }\r\n            if (options.shared === false && items.length > 1) {\r\n                var snapItem = items[0];\r\n                var min = Math.abs(point.y - snapItem.y);\r\n                Util.each(items, function (aItem) {\r\n                    if (Math.abs(point.y - aItem.y) <= min) {\r\n                        snapItem = aItem;\r\n                        min = Math.abs(point.y - aItem.y);\r\n                    }\r\n                });\r\n                if (snapItem && snapItem.x && snapItem.y) {\r\n                    markersItems = [snapItem];\r\n                }\r\n                items = [snapItem];\r\n            }\r\n            self._setTooltip(point, items, markersItems, target);\r\n        }\r\n        else {\r\n            self.hideTooltip();\r\n        }\r\n    };\r\n    _proto.clear = function clear() {\r\n        var tooltip = this.tooltip;\r\n        tooltip && tooltip.destroy();\r\n        this.tooltip = null;\r\n        this.prePoint = null;\r\n        this._offEvent();\r\n    };\r\n    _proto._getItemMarker = function _getItemMarker(geom, color) {\r\n        var shapeType = geom.get('shapeType') || 'point';\r\n        var shape = geom.getDefaultValue('shape') || 'circle';\r\n        var shapeObject = Shape.getShapeFactory(shapeType);\r\n        var cfg = {\r\n            color: color\r\n        };\r\n        var marker = shapeObject.getMarkerCfg(shape, cfg);\r\n        return marker;\r\n    };\r\n    return TooltipController;\r\n}();\r\nmodule.exports = TooltipController;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\chart\\controller\\tooltip.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\chart\\controller\\tooltip.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * @fileOverview The controller of tooltip\n * @author sima.zhang\n */\nvar Util = require('../../util');\n\nvar Shape = require('../../geom/shape/shape');\n\nvar _require = require('@antv/component/lib'),\n    Tooltip = _require.Tooltip;\n\nvar MatrixUtil = Util.MatrixUtil;\nvar Vector2 = MatrixUtil.vec2;\nvar TYPE_SHOW_MARKERS = ['line', 'area', 'path', 'areaStack']; // 默认展示 tooltip marker 的几何图形\n\nvar TYPE_SHOW_CROSSHAIRS = ['line', 'area']; // 默认展示十字瞄准线的几何图形\n// TODO FIXME this is HARD CODING\n\nvar IGNORE_TOOLTIP_ITEM_PROPERTIES = ['marker', 'showMarker'];\n\nfunction _indexOfArray(items, item) {\n  var rst = -1;\n  Util.each(items, function (sub, index) {\n    var isEqual = true;\n\n    for (var key in item) {\n      if (item.hasOwnProperty(key) && IGNORE_TOOLTIP_ITEM_PROPERTIES.indexOf(key) === -1) {\n        if (!Util.isObject(item[key]) && item[key] !== sub[key]) {\n          isEqual = false;\n          break;\n        }\n      }\n    }\n\n    if (isEqual) {\n      rst = index;\n      return false;\n    }\n  });\n  return rst;\n} // 判断是否有样式\n\n\nfunction _hasClass(dom, className) {\n  if (!dom) {\n    return false;\n  }\n\n  var cls = '';\n  if (!dom.className) return false;\n\n  if (!Util.isNil(dom.className.baseVal)) {\n    cls = dom.className.baseVal;\n  } else {\n    cls = dom.className;\n  }\n\n  return cls.indexOf(className) !== -1;\n}\n\nfunction _isParent(dom, cls) {\n  var parent = dom.parentNode;\n  var rst = false;\n\n  while (parent && parent !== document.body) {\n    if (_hasClass(parent, cls)) {\n      rst = true;\n      break;\n    }\n\n    parent = parent.parentNode;\n  }\n\n  return rst;\n} // 去除重复的值, 去除不同图形相同数据，只展示一份即可\n\n\nfunction _uniqItems(items) {\n  var tmp = [];\n  Util.each(items, function (item) {\n    var index = _indexOfArray(tmp, item);\n\n    if (index === -1) {\n      tmp.push(item);\n    } else {\n      tmp[index] = item;\n    }\n  });\n  return tmp;\n}\n\nvar TooltipController =\n/*#__PURE__*/\nfunction () {\n  function TooltipController(cfg) {\n    Util.assign(this, cfg);\n    this.timeStamp = 0;\n  }\n\n  var _proto = TooltipController.prototype;\n\n  _proto._normalizeEvent = function _normalizeEvent(event) {\n    var chart = this.chart;\n\n    var canvas = this._getCanvas();\n\n    var point = canvas.getPointByClient(event.clientX, event.clientY);\n    var pixelRatio = canvas.get('pixelRatio');\n    point.x = point.x / pixelRatio;\n    point.y = point.y / pixelRatio;\n    var views = chart.getViewsByPoint(point);\n    point.views = views;\n    return point;\n  };\n\n  _proto._getCanvas = function _getCanvas() {\n    return this.chart.get('canvas');\n  };\n\n  _proto._getTriggerEvent = function _getTriggerEvent() {\n    var options = this.options;\n    var triggerOn = options.triggerOn;\n    var eventName;\n\n    if (!triggerOn || triggerOn === 'mousemove') {\n      eventName = 'plotmove';\n    } else if (triggerOn === 'click') {\n      eventName = 'plotclick';\n    } else if (triggerOn === 'none') {\n      eventName = null;\n    }\n\n    return eventName;\n  };\n\n  _proto._getDefaultTooltipCfg = function _getDefaultTooltipCfg() {\n    var self = this;\n    var chart = self.chart;\n    var viewTheme = self.viewTheme;\n    var options = self.options;\n    var defaultCfg = Util.mix({}, viewTheme.tooltip);\n    var geoms = chart.getAllGeoms().filter(function (geom) {\n      return geom.get('visible');\n    });\n    var shapes = [];\n    Util.each(geoms, function (geom) {\n      var type = geom.get('type');\n      var adjusts = geom.get('adjusts');\n      var isSymmetric = false;\n\n      if (adjusts) {\n        Util.each(adjusts, function (adjust) {\n          if (adjust.type === 'symmetric' || adjust.type === 'Symmetric') {\n            isSymmetric = true;\n            return false;\n          }\n        });\n      }\n\n      if (Util.indexOf(shapes, type) === -1 && !isSymmetric) {\n        shapes.push(type);\n      }\n    });\n    var isTransposed = geoms.length && geoms[0].get('coord') ? geoms[0].get('coord').isTransposed : false;\n    var crosshairsCfg;\n\n    if (geoms.length && geoms[0].get('coord') && geoms[0].get('coord').type === 'cartesian' && shapes.length === 1) {\n      if (shapes[0] === 'interval' && options.shared !== false) {\n        // 直角坐标系下 interval 的 crosshair 为矩形背景框\n        var crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsRect);\n        crosshairs.isTransposed = isTransposed;\n        crosshairsCfg = {\n          zIndex: 0,\n          // 矩形背景框不可覆盖 geom\n          crosshairs: crosshairs\n        };\n      } else if (Util.indexOf(TYPE_SHOW_CROSSHAIRS, shapes[0]) > -1) {\n        var _crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsLine);\n\n        _crosshairs.isTransposed = isTransposed;\n        crosshairsCfg = {\n          crosshairs: _crosshairs\n        };\n      }\n    }\n\n    return Util.mix(defaultCfg, crosshairsCfg, {});\n  };\n\n  _proto._bindEvent = function _bindEvent() {\n    var chart = this.chart;\n\n    var triggerEvent = this._getTriggerEvent();\n\n    if (triggerEvent) {\n      chart.on(triggerEvent, Util.wrapBehavior(this, 'onMouseMove'));\n      chart.on('plotleave', Util.wrapBehavior(this, 'onMouseOut'));\n    }\n  };\n\n  _proto._offEvent = function _offEvent() {\n    var chart = this.chart;\n\n    var triggerEvent = this._getTriggerEvent();\n\n    if (triggerEvent) {\n      chart.off(triggerEvent, Util.getWrapBehavior(this, 'onMouseMove'));\n      chart.off('plotleave', Util.getWrapBehavior(this, 'onMouseOut'));\n    }\n  };\n\n  _proto._setTooltip = function _setTooltip(point, items, markersItems, target) {\n    var self = this;\n    var tooltip = self.tooltip;\n    var prePoint = self.prePoint;\n\n    if (!prePoint || prePoint.x !== point.x || prePoint.y !== point.y) {\n      items = _uniqItems(items);\n      self.prePoint = point;\n      var chart = self.chart;\n      var viewTheme = self.viewTheme;\n      var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n      var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n\n      if (!tooltip.get('visible')) {\n        chart.emit('tooltip:show', {\n          x: x,\n          y: y,\n          tooltip: tooltip\n        });\n      }\n\n      var first = items[0];\n      var title = first.title || first.name;\n\n      if (tooltip.isContentChange(title, items)) {\n        chart.emit('tooltip:change', {\n          tooltip: tooltip,\n          x: x,\n          y: y,\n          items: items\n        }); // bugfix: when set the title in the tooltip:change event does not take effect.\n\n        title = items[0].title || items[0].name;\n        tooltip.setContent(title, items);\n\n        if (!Util.isEmpty(markersItems)) {\n          if (self.options.hideMarkers === true) {\n            // 不展示 tooltip marker\n            tooltip.set('markerItems', markersItems); // 用于 tooltip 辅助线的定位\n          } else {\n            tooltip.setMarkers(markersItems, viewTheme.tooltipMarker);\n          }\n        } else {\n          tooltip.clearMarkers();\n        }\n      }\n\n      var canvas = this._getCanvas();\n\n      if (target === canvas && tooltip.get('type') === 'mini') {\n        // filter mini tooltip\n        tooltip.hide();\n      } else {\n        tooltip.setPosition(x, y, target);\n        tooltip.show();\n      }\n    }\n  };\n\n  _proto.hideTooltip = function hideTooltip() {\n    var tooltip = this.tooltip;\n    var chart = this.chart;\n\n    var canvas = this._getCanvas();\n\n    this.prePoint = null;\n    tooltip.hide();\n    chart.emit('tooltip:hide', {\n      tooltip: tooltip\n    });\n    canvas.draw();\n  };\n\n  _proto.onMouseMove = function onMouseMove(ev) {\n    if (Util.isEmpty(ev.views)) {\n      return;\n    }\n\n    var lastTimeStamp = this.timeStamp;\n    var timeStamp = +new Date();\n    var point = {\n      x: ev.x,\n      y: ev.y\n    };\n\n    if (timeStamp - lastTimeStamp > 16 && !this.chart.get('stopTooltip')) {\n      this.showTooltip(point, ev.views, ev.shape);\n      this.timeStamp = timeStamp;\n    }\n  };\n\n  _proto.onMouseOut = function onMouseOut(ev) {\n    var tooltip = this.tooltip; // const canvas = this._getCanvas();\n\n    if (!tooltip.get('visible') || !tooltip.get('follow')) {\n      return;\n    } // 除非离开 plot 时鼠标依然在图形上，这段逻辑没有意义\n    // if (ev && ev.target !== canvas) {\n    //   return;\n    // }\n\n\n    if (ev && ev.toElement && (_hasClass(ev.toElement, 'g2-tooltip') || _isParent(ev.toElement, 'g2-tooltip'))) {\n      return;\n    }\n\n    this.hideTooltip();\n  };\n\n  _proto.renderTooltip = function renderTooltip() {\n    var self = this;\n\n    if (self.tooltip) {\n      // tooltip 对象已经创建\n      return;\n    }\n\n    var chart = self.chart;\n    var viewTheme = self.viewTheme;\n\n    var canvas = self._getCanvas();\n\n    var defaultCfg = self._getDefaultTooltipCfg();\n\n    var options = self.options;\n    options = Util.deepMix({\n      plotRange: chart.get('plotRange'),\n      capture: false,\n      canvas: canvas,\n      frontPlot: chart.get('frontPlot'),\n      viewTheme: viewTheme.tooltip,\n      backPlot: chart.get('backPlot')\n    }, defaultCfg, options);\n\n    if (options.crosshairs && options.crosshairs.type === 'rect') {\n      options.zIndex = 0; // toolip 背景框不可遮盖住 geom，防止用户配置了 crosshairs\n    }\n\n    options.visible = false; // @2018-09-13 by blue.lb 如果设置shared为false不需要指定position\n    // if (options.shared === false && Util.isNil(options.position)) {\n    //   options.position = 'top';\n    // }\n\n    var tooltip;\n\n    if (options.type === 'mini') {\n      options.crosshairs = false; // this.options.shared = false;\n\n      options.position = 'top';\n      tooltip = new Tooltip.Mini(options);\n    } else if (options.useHtml) {\n      tooltip = new Tooltip.Html(options);\n    } else {\n      tooltip = new Tooltip.Canvas(options);\n    }\n\n    self.tooltip = tooltip;\n\n    var triggerEvent = self._getTriggerEvent();\n\n    if (!tooltip.get('enterable') && triggerEvent === 'plotmove') {\n      // 鼠标不允许进入 tooltip 容器\n      var tooltipContainer = tooltip.get('container');\n\n      if (tooltipContainer) {\n        tooltipContainer.onmousemove = function (e) {\n          // 避免 tooltip 频繁闪烁\n          var eventObj = self._normalizeEvent(e);\n\n          chart.emit(triggerEvent, eventObj);\n        };\n      }\n    }\n\n    self._bindEvent();\n  };\n\n  _proto.showTooltip = function showTooltip(point, views, target) {\n    var self = this;\n\n    if (Util.isEmpty(views) || !point) {\n      return;\n    }\n\n    if (!this.tooltip) {\n      this.renderTooltip(); // 如果一开始 tooltip 关闭，用户重新调用的时候需要先生成 tooltip\n    }\n\n    var options = self.options;\n    var markersItems = [];\n    var items = [];\n    Util.each(views, function (view) {\n      if (!view.get('tooltipEnable')) {\n        // 如果不显示tooltip，则跳过\n        return true;\n      }\n\n      var geoms = view.get('geoms');\n      var coord = view.get('coord');\n      Util.each(geoms, function (geom) {\n        var type = geom.get('type');\n\n        if (geom.get('visible') && geom.get('tooltipCfg') !== false) {\n          var dataArray = geom.get('dataArray');\n\n          if (geom.isShareTooltip() || options.shared === false && Util.inArray(['area', 'line', 'path'], type)) {\n            Util.each(dataArray, function (obj) {\n              var tmpPoint = geom.findPoint(point, obj);\n\n              if (tmpPoint) {\n                var subItems = geom.getTipItems(tmpPoint, options.title);\n                Util.each(subItems, function (v) {\n                  var point = v.point;\n\n                  if (point && point.x && point.y) {\n                    // hotfix: make sure there is no null value\n                    var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n                    var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n                    point = coord.applyMatrix(x, y, 1);\n                    v.x = point[0];\n                    v.y = point[1];\n                    v.showMarker = true;\n\n                    var itemMarker = self._getItemMarker(geom, v.color);\n\n                    v.marker = itemMarker;\n\n                    if (Util.indexOf(TYPE_SHOW_MARKERS, type) !== -1) {\n                      markersItems.push(v);\n                    }\n                  }\n                });\n                items = items.concat(subItems);\n              }\n            });\n          } else {\n            var geomContainer = geom.get('shapeContainer');\n\n            if (target && target.get('visible') && target.get('origin') && target.get('parent') === geomContainer) {\n              items = geom.getTipItems(target.get('origin'), options.title);\n            }\n          }\n        }\n      });\n      Util.each(items, function (item) {\n        var point = item.point;\n        var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n        var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n        point = coord.applyMatrix(x, y, 1);\n        item.x = point[0];\n        item.y = point[1];\n      });\n    });\n\n    if (items.length) {\n      var first = items[0]; // bugfix: multiple tooltip items with different titles\n\n      if (!items.every(function (item) {\n        return item.title === first.title;\n      })) {\n        var nearestItem = first;\n        var nearestDistance = Infinity;\n        items.forEach(function (item) {\n          var distance = Vector2.distance([point.x, point.y], [item.x, item.y]);\n\n          if (distance < nearestDistance) {\n            nearestDistance = distance;\n            nearestItem = item;\n          }\n        });\n        items = items.filter(function (item) {\n          return item.title === nearestItem.title;\n        });\n        markersItems = markersItems.filter(function (item) {\n          return item.title === nearestItem.title;\n        });\n      }\n\n      if (options.shared === false && items.length > 1) {\n        var snapItem = items[0];\n        var min = Math.abs(point.y - snapItem.y);\n        Util.each(items, function (aItem) {\n          if (Math.abs(point.y - aItem.y) <= min) {\n            snapItem = aItem;\n            min = Math.abs(point.y - aItem.y);\n          }\n        });\n\n        if (snapItem && snapItem.x && snapItem.y) {\n          markersItems = [snapItem];\n        }\n\n        items = [snapItem];\n      } // 3.0 采用当前鼠标位置作为 tooltip 的参考点\n      // if (!Util.isEmpty(markersItems)) {\n      //   point = markersItems[0];\n      // }\n\n\n      self._setTooltip(point, items, markersItems, target);\n    } else {\n      self.hideTooltip();\n    }\n  };\n\n  _proto.clear = function clear() {\n    var tooltip = this.tooltip;\n    tooltip && tooltip.destroy();\n    this.tooltip = null;\n    this.prePoint = null;\n\n    this._offEvent();\n  };\n\n  _proto._getItemMarker = function _getItemMarker(geom, color) {\n    var shapeType = geom.get('shapeType') || 'point';\n    var shape = geom.getDefaultValue('shape') || 'circle';\n    var shapeObject = Shape.getShapeFactory(shapeType);\n    var cfg = {\n      color: color\n    };\n    var marker = shapeObject.getMarkerCfg(shape, cfg);\n    return marker;\n  };\n\n  return TooltipController;\n}();\n\nmodule.exports = TooltipController;"]}]}