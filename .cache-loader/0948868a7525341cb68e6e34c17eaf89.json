{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/component/legend/tail.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/component/legend/tail.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\nvar Util = require('../../util');\nvar Components = require('@antv/component/lib');\nvar Global = require('../../global');\nvar Legend = Components.Legend;\nvar Category = Legend.Category;\nvar Tail = function (_Category) {\n    _inheritsLoose(Tail, _Category);\n    function Tail() {\n        return _Category.apply(this, arguments) || this;\n    }\n    var _proto = Tail.prototype;\n    _proto.getDefaultCfg = function getDefaultCfg() {\n        var cfg = _Category.prototype.getDefaultCfg.call(this);\n        return Util.mix({}, cfg, {\n            type: 'tail-legend',\n            layout: 'vertical',\n            autoLayout: true\n        });\n    };\n    _proto._addItem = function _addItem(item) {\n        var itemsGroup = this.get('itemsGroup');\n        var x = this._getNextX();\n        var y = 0;\n        var unCheckColor = this.get('unCheckColor');\n        var itemGroup = itemsGroup.addGroup({\n            x: 0,\n            y: 0,\n            value: item.value,\n            scaleValue: item.scaleValue,\n            checked: item.checked\n        });\n        itemGroup.translate(x, y);\n        itemGroup.set('viewId', itemsGroup.get('viewId'));\n        var textStyle = this.get('textStyle');\n        var wordSpace = this.get('_wordSpaceing');\n        var startX = 0;\n        if (item.marker) {\n            var markerAttrs = Util.mix({}, item.marker, {\n                x: item.marker.radius,\n                y: 0\n            });\n            if (!item.checked) {\n                if (markerAttrs.fill) {\n                    markerAttrs.fill = unCheckColor;\n                }\n                if (markerAttrs.stroke) {\n                    markerAttrs.stroke = unCheckColor;\n                }\n            }\n            var markerShape = itemGroup.addShape('marker', {\n                type: 'marker',\n                attrs: markerAttrs\n            });\n            markerShape.attr('cursor', 'pointer');\n            markerShape.name = 'legend-marker';\n            startX += markerShape.getBBox().width + wordSpace;\n        }\n        var textAttrs = Util.mix({}, textStyle, {\n            x: startX,\n            y: 0,\n            text: this._formatItemValue(item.value)\n        });\n        if (!item.checked) {\n            Util.mix(textAttrs, {\n                fill: unCheckColor\n            });\n        }\n        var textShape = itemGroup.addShape('text', {\n            attrs: textAttrs\n        });\n        textShape.attr('cursor', 'pointer');\n        textShape.name = 'legend-text';\n        this.get('appendInfo') && textShape.setSilent('appendInfo', this.get('appendInfo'));\n        var bbox = itemGroup.getBBox();\n        var itemWidth = this.get('itemWidth');\n        var wrapperShape = itemGroup.addShape('rect', {\n            attrs: {\n                x: x,\n                y: y - bbox.height / 2,\n                fill: '#fff',\n                fillOpacity: 0,\n                width: itemWidth || bbox.width,\n                height: bbox.height\n            }\n        });\n        wrapperShape.attr('cursor', 'pointer');\n        wrapperShape.setSilent('origin', item);\n        wrapperShape.name = 'legend-item';\n        this.get('appendInfo') && wrapperShape.setSilent('appendInfo', this.get('appendInfo'));\n        itemGroup.name = 'legendGroup';\n        return itemGroup;\n    };\n    _proto._adjust = function _adjust() {\n        var self = this;\n        var geom = self.get('geom');\n        if (geom) {\n            var groupMatrix = self.get('group').attr('matrix');\n            groupMatrix[7] = 0;\n            var dataArray = self.get('geom').get('dataArray');\n            var groups = this.get('itemsGroup').get('children');\n            var index = 0;\n            Util.each(groups, function (groupItem) {\n                var dArray = dataArray[index];\n                var lastY = dArray[dArray.length - 1].y;\n                if (Util.isArray(lastY)) {\n                    lastY = lastY[1];\n                }\n                var groupHeight = groupItem.getBBox().height;\n                var x = groupItem.get('x');\n                var y = lastY - groupHeight / 2;\n                groupItem.translate(x, y);\n                index++;\n            });\n            if (self.get('autoLayout')) {\n                self._antiCollision(groups);\n            }\n        }\n    };\n    _proto.render = function render() {\n        var _this = this;\n        _Category.prototype.render.call(this);\n        var chart = this.get('chart');\n        chart.once('afterpaint', function () {\n            _this._adjust();\n        });\n    };\n    _proto._getPreviousY = function _getPreviousY(item) {\n        var y = item.attr('matrix')[7];\n        var height = item.getBBox().height;\n        return y + height;\n    };\n    _proto._adjustDenote = function _adjustDenote(group, start, end) {\n        var margin = Global.legend.legendMargin;\n        var x0 = -2;\n        var x2 = -margin * 2;\n        group.addShape('path', {\n            attrs: {\n                path: 'M' + x0 + ',' + start + 'L' + x2 + ',' + (end + 3),\n                lineWidth: 1,\n                lineDash: [2, 2],\n                stroke: '#999999'\n            }\n        });\n    };\n    _proto._antiCollision = function _antiCollision(items) {\n        if (items === void 0) {\n            items = [];\n        }\n        if (!items.length)\n            return;\n        var self = this;\n        items.sort(function (a, b) {\n            var ay = a.attr('matrix')[7];\n            var by = b.attr('matrix')[7];\n            return ay - by;\n        });\n        var overlapping = true;\n        var plotRange = self.get('chart').get('plotRange');\n        var startY = plotRange.tl.y;\n        var totalHeight = Math.abs(startY - plotRange.bl.y);\n        var elementHeight = items[0].getBBox().height;\n        var minY = Number.MIN_VALUE;\n        var maxY = 0;\n        var boxes = items.map(function (item) {\n            var y = item.attr('matrix')[7];\n            if (y > maxY) {\n                maxY = y;\n            }\n            if (y < minY) {\n                minY = y;\n            }\n            return {\n                size: item.getBBox().height,\n                targets: [y - startY]\n            };\n        });\n        minY -= startY;\n        var i = 0;\n        while (overlapping) {\n            for (var _i = 0; _i < boxes.length; _i++) {\n                var box = boxes[_i];\n                var target = (Math.min.apply(minY, box.targets) + Math.max.apply(minY, box.targets)) / 2;\n                box.pos = Math.min(Math.max(minY, target - box.size / 2), totalHeight - box.size);\n            }\n            overlapping = false;\n            i = boxes.length;\n            while (i--) {\n                if (i > 0) {\n                    var previous = boxes[i - 1];\n                    var current = boxes[i];\n                    if (previous.pos + previous.size > current.pos) {\n                        previous.size += current.size;\n                        previous.targets = previous.targets.concat(current.targets);\n                        boxes.splice(i, 1);\n                        overlapping = true;\n                    }\n                }\n            }\n        }\n        i = 0;\n        var group = this.get('itemsGroup').addGroup();\n        boxes.forEach(function (b) {\n            var posInCompositeBox = startY + elementHeight;\n            b.targets.forEach(function () {\n                var origin_y = items[i].attr('matrix')[7];\n                var y = b.pos + posInCompositeBox - elementHeight / 2;\n                var dist = Math.abs(origin_y - y);\n                if (dist > elementHeight / 2) {\n                    self._adjustDenote(group, y, origin_y - self.get('group').attr('matrix')[7] / 2);\n                }\n                items[i].translate(0, -origin_y);\n                items[i].translate(0, y);\n                posInCompositeBox += elementHeight;\n                i++;\n            });\n        });\n    };\n    return Tail;\n}(Category);\nmodule.exports = Tail;\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/component/legend/tail.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/component/legend/tail.js"],"names":[],"mappings":"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","sourcesContent":["function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\n/**\n * @fileOverview The class of tail legend\n * @author Ye Liu\n */\nvar Util = require('../../util'); // const Category = require('./category');\n\n\nvar Components = require('@antv/component/lib');\n\nvar Global = require('../../global');\n\nvar Legend = Components.Legend;\nvar Category = Legend.Category;\n\nvar Tail = /*#__PURE__*/function (_Category) {\n  _inheritsLoose(Tail, _Category);\n\n  function Tail() {\n    return _Category.apply(this, arguments) || this;\n  }\n\n  var _proto = Tail.prototype;\n\n  _proto.getDefaultCfg = function getDefaultCfg() {\n    var cfg = _Category.prototype.getDefaultCfg.call(this);\n\n    return Util.mix({}, cfg, {\n      /**\n       * type标识\n       * @type {String}\n       */\n      type: 'tail-legend',\n\n      /**\n       * 布局方式\n       * horizontal 水平\n       * vertical 垂直\n       * @type {String}\n       */\n      layout: 'vertical',\n      autoLayout: true\n    });\n  };\n\n  _proto._addItem = function _addItem(item) {\n    var itemsGroup = this.get('itemsGroup');\n\n    var x = this._getNextX();\n\n    var y = 0;\n    var unCheckColor = this.get('unCheckColor');\n    var itemGroup = itemsGroup.addGroup({\n      x: 0,\n      y: 0,\n      value: item.value,\n      scaleValue: item.scaleValue,\n      checked: item.checked\n    });\n    itemGroup.translate(x, y);\n    itemGroup.set('viewId', itemsGroup.get('viewId'));\n    var textStyle = this.get('textStyle');\n    var wordSpace = this.get('_wordSpaceing');\n    var startX = 0;\n\n    if (item.marker) {\n      // 如果有marker添加marker\n      var markerAttrs = Util.mix({}, item.marker, {\n        x: item.marker.radius,\n        y: 0\n      });\n\n      if (!item.checked) {\n        if (markerAttrs.fill) {\n          markerAttrs.fill = unCheckColor;\n        }\n\n        if (markerAttrs.stroke) {\n          markerAttrs.stroke = unCheckColor;\n        }\n      }\n\n      var markerShape = itemGroup.addShape('marker', {\n        type: 'marker',\n        attrs: markerAttrs\n      });\n      markerShape.attr('cursor', 'pointer');\n      markerShape.name = 'legend-marker';\n      startX += markerShape.getBBox().width + wordSpace;\n    }\n\n    var textAttrs = Util.mix({}, textStyle, {\n      x: startX,\n      y: 0,\n      text: this._formatItemValue(item.value)\n    });\n\n    if (!item.checked) {\n      Util.mix(textAttrs, {\n        fill: unCheckColor\n      });\n    }\n\n    var textShape = itemGroup.addShape('text', {\n      attrs: textAttrs\n    });\n    textShape.attr('cursor', 'pointer');\n    textShape.name = 'legend-text';\n    this.get('appendInfo') && textShape.setSilent('appendInfo', this.get('appendInfo')); // 添加一个包围矩形，用于事件支持\n\n    var bbox = itemGroup.getBBox();\n    var itemWidth = this.get('itemWidth');\n    var wrapperShape = itemGroup.addShape('rect', {\n      attrs: {\n        x: x,\n        y: y - bbox.height / 2,\n        fill: '#fff',\n        fillOpacity: 0,\n        width: itemWidth || bbox.width,\n        height: bbox.height\n      }\n    });\n    wrapperShape.attr('cursor', 'pointer');\n    wrapperShape.setSilent('origin', item); // 保存图例项相关的数据，便于事件操作\n\n    wrapperShape.name = 'legend-item';\n    this.get('appendInfo') && wrapperShape.setSilent('appendInfo', this.get('appendInfo'));\n    itemGroup.name = 'legendGroup';\n    return itemGroup;\n  };\n\n  _proto._adjust = function _adjust() {\n    var self = this;\n    var geom = self.get('geom');\n\n    if (geom) {\n      var groupMatrix = self.get('group').attr('matrix');\n      groupMatrix[7] = 0;\n      var dataArray = self.get('geom').get('dataArray');\n      var groups = this.get('itemsGroup').get('children');\n      var index = 0;\n      Util.each(groups, function (groupItem) {\n        var dArray = dataArray[index];\n        var lastY = dArray[dArray.length - 1].y;\n\n        if (Util.isArray(lastY)) {\n          lastY = lastY[1];\n        }\n\n        var groupHeight = groupItem.getBBox().height;\n        var x = groupItem.get('x');\n        var y = lastY - groupHeight / 2;\n        groupItem.translate(x, y);\n        index++;\n      });\n\n      if (self.get('autoLayout')) {\n        self._antiCollision(groups);\n      }\n    }\n  };\n\n  _proto.render = function render() {\n    var _this = this;\n\n    _Category.prototype.render.call(this);\n\n    var chart = this.get('chart');\n    chart.once('afterpaint', function () {\n      _this._adjust();\n    });\n  };\n\n  _proto._getPreviousY = function _getPreviousY(item) {\n    var y = item.attr('matrix')[7];\n    var height = item.getBBox().height;\n    return y + height;\n  };\n\n  _proto._adjustDenote = function _adjustDenote(group, start, end) {\n    var margin = Global.legend.legendMargin;\n    var x0 = -2;\n    var x2 = -margin * 2;\n    group.addShape('path', {\n      attrs: {\n        path: 'M' + x0 + ',' + start + 'L' + x2 + ',' + (end + 3),\n        lineWidth: 1,\n        lineDash: [2, 2],\n        stroke: '#999999'\n      }\n    });\n  };\n\n  _proto._antiCollision = function _antiCollision(items) {\n    if (items === void 0) {\n      items = [];\n    }\n\n    if (!items.length) return;\n    var self = this;\n    items.sort(function (a, b) {\n      var ay = a.attr('matrix')[7];\n      var by = b.attr('matrix')[7];\n      return ay - by;\n    });\n    var overlapping = true;\n    var plotRange = self.get('chart').get('plotRange');\n    var startY = plotRange.tl.y;\n    var totalHeight = Math.abs(startY - plotRange.bl.y);\n    var elementHeight = items[0].getBBox().height;\n    var minY = Number.MIN_VALUE;\n    var maxY = 0;\n    var boxes = items.map(function (item) {\n      var y = item.attr('matrix')[7];\n\n      if (y > maxY) {\n        maxY = y;\n      }\n\n      if (y < minY) {\n        minY = y;\n      }\n\n      return {\n        size: item.getBBox().height,\n        targets: [y - startY]\n      };\n    });\n    minY -= startY;\n    var i = 0;\n\n    while (overlapping) {\n      for (var _i = 0; _i < boxes.length; _i++) {\n        var box = boxes[_i];\n        var target = (Math.min.apply(minY, box.targets) + Math.max.apply(minY, box.targets)) / 2;\n        box.pos = Math.min(Math.max(minY, target - box.size / 2), totalHeight - box.size);\n      }\n\n      overlapping = false;\n      i = boxes.length;\n\n      while (i--) {\n        if (i > 0) {\n          var previous = boxes[i - 1];\n          var current = boxes[i];\n\n          if (previous.pos + previous.size > current.pos) {\n            // overlapping\n            previous.size += current.size;\n            previous.targets = previous.targets.concat(current.targets);\n            boxes.splice(i, 1);\n            overlapping = true;\n          }\n        }\n      } // end of while i\n\n    } // end of while\n    // adjust y\n\n\n    i = 0;\n    var group = this.get('itemsGroup').addGroup();\n    boxes.forEach(function (b) {\n      var posInCompositeBox = startY + elementHeight;\n      b.targets.forEach(function () {\n        var origin_y = items[i].attr('matrix')[7];\n        var y = b.pos + posInCompositeBox - elementHeight / 2;\n        var dist = Math.abs(origin_y - y);\n\n        if (dist > elementHeight / 2) {\n          self._adjustDenote(group, y, origin_y - self.get('group').attr('matrix')[7] / 2);\n        }\n\n        items[i].translate(0, -origin_y);\n        items[i].translate(0, y);\n        posInCompositeBox += elementHeight;\n        i++;\n      });\n    });\n  } // end of antiCollision\n  ;\n\n  return Tail;\n}(Category);\n\nmodule.exports = Tail;"]}]}