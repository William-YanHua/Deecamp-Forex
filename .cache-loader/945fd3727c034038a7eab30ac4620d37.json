{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/treemap/interaction/drillDown.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/treemap/interaction/drillDown.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { __assign, __extends } from \"tslib\";\nimport Breadcrumb from '../../../components/breadcrumb';\nimport BaseInteraction from '../../../interaction/base';\nimport BBox from '../../../util/bbox';\nimport { each, hasKey, isFunction, clone } from '@antv/util';\nimport { drillingDown, rollingUp } from './animation';\nvar DEFAULT_ITEM_WIDTH = 100;\nvar DEFAULT_ITEM_HEIGHT = 30;\nvar PADDING_TOP = 10;\nvar getValidBreadcrumbConfig = function (cfg) {\n    if (cfg === void 0) {\n        cfg = {};\n    }\n    var _cfg = __assign({ x: 0, y: 0, startNode: { name: 'root' }, itemWidth: DEFAULT_ITEM_WIDTH, itemHeight: DEFAULT_ITEM_HEIGHT, padding: [0, 0, 0, 0] }, cfg);\n    return _cfg;\n};\nvar DrillDownInteraction = (function (_super) {\n    __extends(DrillDownInteraction, _super);\n    function DrillDownInteraction() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DrillDownInteraction.getInteractionRange = function (layerRange, interaction) {\n        var config = getValidBreadcrumbConfig(interaction);\n        var _a = config.padding, paddingTop = _a[0], paddingBottom = _a[1];\n        if (layerRange) {\n            return new BBox(layerRange.minX, layerRange.maxY - config.itemHeight - paddingTop - paddingBottom, layerRange.width, config.itemHeight + paddingTop + paddingBottom);\n        }\n    };\n    DrillDownInteraction.prototype.start = function (ev) {\n        var _this = this;\n        var data = ev.data.data;\n        if (data.children) {\n            this.parentNode = {\n                color: ev.target.attr('fill'),\n                shape: ev.target,\n                data: {\n                    name: clone(this.currentNode.name),\n                    value: clone(this.currentNode.value),\n                },\n                depth: clone(this.currentDepth),\n            };\n            this.currentDepth++;\n            drillingDown(ev.target, this.view, function () {\n                _this.update(data);\n            });\n        }\n    };\n    DrillDownInteraction.prototype.update = function (data) {\n        if (!hasKey(this.cache, data.name)) {\n            this.cache[data.name] = data;\n        }\n        var tempoData = this.plot.getTreemapData(data, data.depth);\n        this.view.changeData(tempoData);\n        this.adjustScale(this.currentDepth);\n        this.currentNode = data;\n        this.render();\n    };\n    DrillDownInteraction.prototype.render = function () {\n        if (this.breadcrumb) {\n            var items = this.getItems();\n            this.breadcrumb.update({\n                items: items,\n            });\n            this.breadcrumb.render();\n            this.layout();\n        }\n        else {\n            this.initGeometry();\n            this.cache = {};\n            this.saveOriginMapping();\n            this.container = this.plot.canvas.addGroup();\n            if (!this.startNode) {\n                this.startNode = {\n                    name: 'root',\n                };\n            }\n            if (this.startNode.name === 'root') {\n                this.startNodeName = hasKey(this.plot.options.data, 'name') ? this.plot.options.data.name : 'root';\n                this.currentNode = this.plot.options.data;\n                this.currentDepth = 1;\n            }\n            else {\n                this.startNodeName = this.startNode.name;\n                this.currentNode = this.startNode;\n            }\n            this.y = this.view.coordinateBBox.maxY + PADDING_TOP;\n            this.breadcrumb = new Breadcrumb({\n                container: this.container,\n                x: 0,\n                y: this.y,\n                items: this.getItems(),\n            });\n            this.breadcrumb.init();\n            this.breadcrumb.render();\n            this.plot.canvas.draw();\n            this.layout();\n        }\n        this.onInteraction();\n    };\n    DrillDownInteraction.prototype.clear = function () {\n        return;\n    };\n    DrillDownInteraction.prototype.layout = function () {\n        var currentWidth = this.container.getBBox().width;\n        var x = (this.plot.width - currentWidth) / 2;\n        this.breadcrumb.update({\n            x: x,\n            y: this.y,\n        });\n        this.breadcrumb.render();\n    };\n    DrillDownInteraction.prototype.getItems = function () {\n        var items = [];\n        if (this.currentNode.name && this.currentNode.name === this.startNodeName) {\n            var rootItem = this.getRootItem();\n            items.push(rootItem);\n        }\n        else {\n            items = [];\n            var parents = [];\n            this.findParent(this.currentNode, parents);\n            items.push(this.getRootItem());\n            each(parents, function (p, index) {\n                items.push({ key: String(index + 2), text: p.name, data: p });\n            });\n            items.push({ key: String(parents.length + 2), text: this.currentNode.name, data: this.currentNode });\n        }\n        return items;\n    };\n    DrillDownInteraction.prototype.findParent = function (data, parents) {\n        if (data.parent) {\n            if (hasKey(this.cache, data.parent.name)) {\n                parents.push(this.cache[data.parent.name]);\n            }\n            else {\n                parents.push(data.parent);\n            }\n            this.findParent(data.parent, parents);\n        }\n        else {\n            return;\n        }\n    };\n    DrillDownInteraction.prototype.onInteraction = function () {\n        var _this = this;\n        this.container.on('click', function (ev) {\n            var targetParent = ev.target.get('parent');\n            if (targetParent && targetParent.get('class') === 'item-group') {\n                var data_1 = targetParent.get('data');\n                if (data_1.data) {\n                    if (data_1.text === _this.startNodeName) {\n                        var targetDepth = 1;\n                        if (_this.currentDepth - 1 === targetDepth) {\n                            rollingUp(_this.currentNode.name, _this.view, function () {\n                                _this.updateRoot(data_1);\n                            });\n                        }\n                        else {\n                            _this.updateRoot(data_1);\n                        }\n                        _this.currentDepth = 1;\n                    }\n                    else if (_this.currentNode === data_1.data) {\n                        return;\n                    }\n                    else {\n                        var previousDepth = clone(_this.currentDepth);\n                        _this.currentDepth = parseInt(data_1.key);\n                        if (previousDepth - 1 === _this.currentDepth) {\n                            rollingUp(_this.currentNode.name, _this.view, function () {\n                                _this.update(data_1.data);\n                            });\n                        }\n                        else {\n                            _this.update(data_1.data);\n                        }\n                    }\n                }\n            }\n        });\n    };\n    DrillDownInteraction.prototype.getRootItem = function () {\n        var rootData = this.plot.options.data;\n        var rootName = hasKey(rootData, 'name') ? rootData.name : 'root';\n        return { key: '1', text: rootName, data: this.plot.rootData };\n    };\n    DrillDownInteraction.prototype.saveOriginMapping = function () {\n        var _a = this.plot.options, colorField = _a.colorField, colors = _a.colors;\n        var mappingInfo = { field: colorField, values: colors };\n        this.originMapping = mappingInfo;\n    };\n    DrillDownInteraction.prototype.adjustScale = function (index) {\n        var view = this.view;\n        if (this.mapping && hasKey(this.mapping, String(index))) {\n            var mappingCfg = clone(this.mapping[index]);\n            if (mappingCfg.values && isFunction(mappingCfg.values)) {\n                var values = mappingCfg.values(this.parentNode, this.currentNode);\n                mappingCfg.values = values;\n            }\n            this.view.geometries[0].color(mappingCfg.field, mappingCfg.values);\n        }\n        else {\n            var mappingCfg = clone(this.originMapping);\n            this.view.geometries[0].color(mappingCfg.field, mappingCfg.values);\n        }\n        view.render();\n    };\n    DrillDownInteraction.prototype.initGeometry = function () {\n        this.geometry = this.view.geometries[0];\n        var viewRange = this.view.viewBBox;\n        var container = this.geometry.container;\n        container.setClip({\n            type: 'rect',\n            attrs: {\n                x: viewRange.minX,\n                y: viewRange.minY,\n                width: viewRange.width,\n                height: viewRange.height,\n            },\n        });\n    };\n    DrillDownInteraction.prototype.updateRoot = function (data) {\n        this.view.changeData(data.data);\n        this.adjustScale(1);\n        this.currentNode = this.plot.options.data;\n        this.render();\n    };\n    return DrillDownInteraction;\n}(BaseInteraction));\nexport default DrillDownInteraction;\nBaseInteraction.registerInteraction('drilldown', DrillDownInteraction);\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/treemap/interaction/drillDown.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/treemap/interaction/drillDown.js"],"names":[],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport Breadcrumb from '../../../components/breadcrumb';\nimport BaseInteraction from '../../../interaction/base';\nimport BBox from '../../../util/bbox';\nimport { each, hasKey, isFunction, clone } from '@antv/util';\nimport { drillingDown, rollingUp } from './animation';\nvar DEFAULT_ITEM_WIDTH = 100;\nvar DEFAULT_ITEM_HEIGHT = 30;\nvar PADDING_TOP = 10;\nvar getValidBreadcrumbConfig = function (cfg) {\n    if (cfg === void 0) { cfg = {}; }\n    var _cfg = __assign({ x: 0, y: 0, startNode: { name: 'root' }, itemWidth: DEFAULT_ITEM_WIDTH, itemHeight: DEFAULT_ITEM_HEIGHT, padding: [0, 0, 0, 0] }, cfg);\n    return _cfg;\n};\nvar DrillDownInteraction = /** @class */ (function (_super) {\n    __extends(DrillDownInteraction, _super);\n    function DrillDownInteraction() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DrillDownInteraction.getInteractionRange = function (layerRange, interaction) {\n        var config = getValidBreadcrumbConfig(interaction);\n        var _a = config.padding, paddingTop = _a[0], paddingBottom = _a[1];\n        if (layerRange) {\n            return new BBox(layerRange.minX, layerRange.maxY - config.itemHeight - paddingTop - paddingBottom, layerRange.width, config.itemHeight + paddingTop + paddingBottom);\n        }\n    };\n    DrillDownInteraction.prototype.start = function (ev) {\n        var _this = this;\n        var data = ev.data.data;\n        if (data.children) {\n            this.parentNode = {\n                color: ev.target.attr('fill'),\n                shape: ev.target,\n                data: {\n                    name: clone(this.currentNode.name),\n                    value: clone(this.currentNode.value),\n                },\n                depth: clone(this.currentDepth),\n            };\n            this.currentDepth++;\n            drillingDown(ev.target, this.view, function () {\n                _this.update(data);\n            });\n        }\n    };\n    DrillDownInteraction.prototype.update = function (data) {\n        if (!hasKey(this.cache, data.name)) {\n            this.cache[data.name] = data;\n        }\n        var tempoData = this.plot.getTreemapData(data, data.depth);\n        this.view.changeData(tempoData);\n        this.adjustScale(this.currentDepth);\n        this.currentNode = data;\n        this.render();\n    };\n    DrillDownInteraction.prototype.render = function () {\n        if (this.breadcrumb) {\n            var items = this.getItems();\n            this.breadcrumb.update({\n                items: items,\n            });\n            this.breadcrumb.render();\n            this.layout();\n        }\n        else {\n            this.initGeometry();\n            this.cache = {};\n            this.saveOriginMapping();\n            this.container = this.plot.canvas.addGroup();\n            if (!this.startNode) {\n                this.startNode = {\n                    name: 'root',\n                };\n            }\n            if (this.startNode.name === 'root') {\n                this.startNodeName = hasKey(this.plot.options.data, 'name') ? this.plot.options.data.name : 'root';\n                this.currentNode = this.plot.options.data;\n                this.currentDepth = 1;\n            }\n            else {\n                this.startNodeName = this.startNode.name;\n                this.currentNode = this.startNode;\n            }\n            this.y = this.view.coordinateBBox.maxY + PADDING_TOP;\n            this.breadcrumb = new Breadcrumb({\n                container: this.container,\n                x: 0,\n                y: this.y,\n                items: this.getItems(),\n            });\n            this.breadcrumb.init();\n            this.breadcrumb.render();\n            this.plot.canvas.draw();\n            this.layout();\n        }\n        this.onInteraction();\n    };\n    DrillDownInteraction.prototype.clear = function () {\n        return;\n    };\n    DrillDownInteraction.prototype.layout = function () {\n        var currentWidth = this.container.getBBox().width;\n        var x = (this.plot.width - currentWidth) / 2;\n        this.breadcrumb.update({\n            x: x,\n            y: this.y,\n        });\n        this.breadcrumb.render();\n    };\n    DrillDownInteraction.prototype.getItems = function () {\n        var items = [];\n        if (this.currentNode.name && this.currentNode.name === this.startNodeName) {\n            var rootItem = this.getRootItem();\n            items.push(rootItem);\n        }\n        else {\n            items = [];\n            var parents = [];\n            this.findParent(this.currentNode, parents);\n            items.push(this.getRootItem());\n            each(parents, function (p, index) {\n                items.push({ key: String(index + 2), text: p.name, data: p });\n            });\n            items.push({ key: String(parents.length + 2), text: this.currentNode.name, data: this.currentNode });\n        }\n        return items;\n    };\n    DrillDownInteraction.prototype.findParent = function (data, parents) {\n        if (data.parent) {\n            if (hasKey(this.cache, data.parent.name)) {\n                parents.push(this.cache[data.parent.name]);\n            }\n            else {\n                parents.push(data.parent);\n            }\n            this.findParent(data.parent, parents);\n        }\n        else {\n            return;\n        }\n    };\n    DrillDownInteraction.prototype.onInteraction = function () {\n        var _this = this;\n        this.container.on('click', function (ev) {\n            var targetParent = ev.target.get('parent');\n            if (targetParent && targetParent.get('class') === 'item-group') {\n                var data_1 = targetParent.get('data');\n                if (data_1.data) {\n                    if (data_1.text === _this.startNodeName) {\n                        var targetDepth = 1;\n                        //只有前后depth相邻才执行上卷动画，否则直接更新\n                        if (_this.currentDepth - 1 === targetDepth) {\n                            rollingUp(_this.currentNode.name, _this.view, function () {\n                                _this.updateRoot(data_1);\n                            });\n                        }\n                        else {\n                            _this.updateRoot(data_1);\n                        }\n                        _this.currentDepth = 1;\n                    }\n                    else if (_this.currentNode === data_1.data) {\n                        return;\n                    }\n                    else {\n                        var previousDepth = clone(_this.currentDepth);\n                        _this.currentDepth = parseInt(data_1.key);\n                        if (previousDepth - 1 === _this.currentDepth) {\n                            rollingUp(_this.currentNode.name, _this.view, function () {\n                                _this.update(data_1.data);\n                            });\n                        }\n                        else {\n                            _this.update(data_1.data);\n                        }\n                    }\n                }\n            }\n        });\n    };\n    DrillDownInteraction.prototype.getRootItem = function () {\n        var rootData = this.plot.options.data;\n        var rootName = hasKey(rootData, 'name') ? rootData.name : 'root';\n        return { key: '1', text: rootName, data: this.plot.rootData };\n    };\n    DrillDownInteraction.prototype.saveOriginMapping = function () {\n        var _a = this.plot.options, colorField = _a.colorField, colors = _a.colors;\n        var mappingInfo = { field: colorField, values: colors };\n        this.originMapping = mappingInfo;\n    };\n    DrillDownInteraction.prototype.adjustScale = function (index) {\n        var view = this.view;\n        // 根据当前层级确定mapping配置项\n        if (this.mapping && hasKey(this.mapping, String(index))) {\n            var mappingCfg = clone(this.mapping[index]);\n            if (mappingCfg.values && isFunction(mappingCfg.values)) {\n                var values = mappingCfg.values(this.parentNode, this.currentNode);\n                mappingCfg.values = values;\n            }\n            this.view.geometries[0].color(mappingCfg.field, mappingCfg.values);\n        }\n        else {\n            var mappingCfg = clone(this.originMapping);\n            this.view.geometries[0].color(mappingCfg.field, mappingCfg.values);\n        }\n        view.render();\n    };\n    DrillDownInteraction.prototype.initGeometry = function () {\n        this.geometry = this.view.geometries[0];\n        var viewRange = this.view.viewBBox;\n        var container = this.geometry.container;\n        container.setClip({\n            type: 'rect',\n            attrs: {\n                x: viewRange.minX,\n                y: viewRange.minY,\n                width: viewRange.width,\n                height: viewRange.height,\n            },\n        });\n    };\n    DrillDownInteraction.prototype.updateRoot = function (data) {\n        this.view.changeData(data.data);\n        this.adjustScale(1);\n        this.currentNode = this.plot.options.data;\n        this.render();\n    };\n    return DrillDownInteraction;\n}(BaseInteraction));\nexport default DrillDownInteraction;\nBaseInteraction.registerInteraction('drilldown', DrillDownInteraction);\n//# sourceMappingURL=drillDown.js.map"]}]}