{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/src/app/pages/QuotationPage/Overview/MarketOverview.tsx","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/src/app/pages/QuotationPage/Overview/MarketOverview.tsx","mtime":1596379644591},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport React from \"react\";\nimport { Line } from '@antv/g2plot';\nimport moment from 'moment';\nimport { Inject } from \"react.di\";\nimport Slider from \"antd/lib/slider\";\nimport \"antd/lib/slider/style/index.js\";\nimport message from \"antd/lib/message\";\nimport \"antd/lib/message/style/index.js\";\nimport { QuotationService } from '../../../api/QuotationService';\nimport DatePicker from \"antd/lib/date-picker\";\nimport \"antd/lib/date-picker/style/index.js\";\nvar RangePicker = DatePicker.RangePicker;\nvar dateFormat = 'YYYY-MM-DD';\nvar MarketOverview = (function (_super) {\n    __extends(MarketOverview, _super);\n    function MarketOverview(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            data: null,\n            lookingYear: 2001,\n            lookingTime: [moment('2001-01-01', dateFormat), moment('2001-03-01', dateFormat)],\n            linePlot: null,\n        };\n        _this.filterData = function (data) {\n            var temp_data = [];\n            var lookingTime = _this.state.lookingTime;\n            if (!lookingTime) {\n                return data;\n            }\n            var startTime = lookingTime[0];\n            var endTime = lookingTime[1];\n            var max_value = -10, min_value = 100;\n            data.forEach(function (item) {\n                if (startTime <= moment(item.time) && moment(item.time) <= endTime) {\n                    temp_data.push(item);\n                    if (item.bid > max_value) {\n                        max_value = item.bid;\n                    }\n                    if (item.bid < min_value) {\n                        min_value = item.bid;\n                    }\n                }\n            });\n            return [temp_data, max_value, min_value];\n        };\n        _this.showLine = function () {\n            var data = _this.state.data;\n            var filterResult = _this.filterData(data);\n            var temp_data = filterResult[0];\n            var max_value = filterResult[1];\n            var min_value = filterResult[2];\n            var config = {\n                title: {\n                    visible: true,\n                    text: '预测与实际趋势图'\n                },\n                padding: 'auto',\n                forceFit: true,\n                data: temp_data,\n                xField: 'time',\n                yField: 'bid',\n                yAxis: {\n                    min: min_value,\n                    max: max_value\n                },\n                legend: {\n                    position: 'right-top',\n                },\n                seriesField: 'type',\n                responsive: true,\n                animation: {\n                    appear: {\n                        animation: 'clipingWithData',\n                    },\n                },\n                smooth: true,\n            };\n            var linePlot = new Line(document.getElementById('graph-container'), config);\n            _this.setState({ linePlot: linePlot });\n            linePlot.render();\n        };\n        _this.getData = function (year) { return __awaiter(_this, void 0, void 0, function () {\n            var responce;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(year !== this.state.lookingYear)) return [3, 3];\n                        return [4, this.quotationService.getData(year, year + 1)];\n                    case 1:\n                        responce = _a.sent();\n                        return [4, this.setState({ data: responce.data, lookingYear: year })];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [2, this.state.data];\n                }\n            });\n        }); };\n        _this.onRangeChange = function (v) { return __awaiter(_this, void 0, void 0, function () {\n            var data, responce, linePlot, filterResult, temp_data, max_value, min_value;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, this.setState({ lookingTime: [v[0], v[1]] })];\n                    case 1:\n                        _a.sent();\n                        data = null;\n                        if (!(v[1].year() - v[0].year() > 1)) return [3, 2];\n                        return [2, (message.warning('对不起，您选择的时间范围过长！请选择较短的预测时间查看。', 5))];\n                    case 2:\n                        if (!(v[1].year() === v[0].year())) return [3, 4];\n                        return [4, this.getData(v[1].year())];\n                    case 3:\n                        data = _a.sent();\n                        return [3, 7];\n                    case 4:\n                        if (!(v[1].year() - v[0].year() === 1)) return [3, 7];\n                        return [4, this.quotationService.getData(v[0].year(), v[1].year() + 1)];\n                    case 5:\n                        responce = _a.sent();\n                        return [4, this.setState({ data: responce.data })];\n                    case 6:\n                        _a.sent();\n                        data = this.state.data;\n                        _a.label = 7;\n                    case 7:\n                        linePlot = this.state.linePlot;\n                        filterResult = this.filterData(data);\n                        temp_data = filterResult[0];\n                        max_value = filterResult[1];\n                        min_value = filterResult[2];\n                        linePlot.updateConfig({\n                            data: temp_data,\n                            yAxis: {\n                                min: min_value,\n                                max: max_value\n                            }\n                        });\n                        linePlot.render();\n                        return [2];\n                }\n            });\n        }); };\n        return _this;\n    }\n    MarketOverview.prototype.componentWillMount = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2];\n            });\n        });\n    };\n    MarketOverview.prototype.componentDidMount = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, length, endTime, startTime;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        console.log(this.state.data === null ? 1 : this.state.data);\n                        if (!!this.state.data) return [3, 2];\n                        return [4, this.quotationService.getData(2001, null)];\n                    case 1:\n                        data = _a.sent();\n                        data = data.data;\n                        length = data.length;\n                        endTime = moment(data[length - 1]['time']).format('YYYY-MM-DD');\n                        startTime = moment(endTime).subtract(100, 'days').format('YYYY-MM-DD');\n                        console.log(endTime, startTime);\n                        this.setState({ data: data, startTime: startTime, endTime: endTime });\n                        _a.label = 2;\n                    case 2:\n                        this.showLine();\n                        return [2];\n                }\n            });\n        });\n    };\n    MarketOverview.prototype.onAfterChange = function (value) {\n        var startPoint = value[0];\n        var endPoint = value[1];\n        this.setState({ startPoint: startPoint, endPoint: endPoint });\n        var _a = this.state, data = _a.data, linePlot = _a.linePlot;\n        var temp_data = this.filterData(data);\n        linePlot.changeData(temp_data);\n    };\n    MarketOverview.prototype.sliderChange = function (value, quotationService) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, lookingTime, filterResult, temp_data, max_value, min_value, linePlot;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        value = 2001 + value * 19 / 100;\n                        return [4, quotationService.getData(value)];\n                    case 1:\n                        data = _a.sent();\n                        lookingTime = [moment(value + \"-01-01\", dateFormat), moment(value + \"-03-01\", dateFormat)];\n                        return [4, this.setState({ data: data.data, lookingTime: lookingTime })];\n                    case 2:\n                        _a.sent();\n                        filterResult = this.filterData(data.data);\n                        temp_data = filterResult[0];\n                        max_value = filterResult[1];\n                        min_value = filterResult[2];\n                        linePlot = this.state.linePlot;\n                        linePlot.updateConfig({\n                            data: temp_data,\n                            yAxis: {\n                                min: min_value,\n                                max: max_value\n                            }\n                        });\n                        linePlot.render();\n                        return [2];\n                }\n            });\n        });\n    };\n    MarketOverview.prototype.render = function () {\n        var marks = {\n            0: 2001,\n            100: 2020\n        };\n        return (React.createElement(\"div\", null,\n            React.createElement(\"div\", null,\n                React.createElement(\"strong\", null, \"\\u9009\\u62E9\\u67E5\\u770B\\u7684\\u65F6\\u95F4\\u6BB5\")),\n            React.createElement(RangePicker, { defaultValue: this.state.lookingTime, onChange: this.onRangeChange, renderExtraFooter: function () { return '请选择最长半年的时间查看！'; } }),\n            React.createElement(\"div\", { id: 'graph-container' })));\n    };\n    var _a;\n    __decorate([\n        Inject,\n        __metadata(\"design:type\", typeof (_a = typeof QuotationService !== \"undefined\" && QuotationService) === \"function\" ? _a : Object)\n    ], MarketOverview.prototype, \"quotationService\", void 0);\n    return MarketOverview;\n}(React.Component));\nexport default MarketOverview;\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/src/app/pages/QuotationPage/Overview/MarketOverview.tsx","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/src/app/pages/QuotationPage/Overview/MarketOverview.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { Line } from '@antv/g2plot';\r\nimport moment from 'moment';\r\nimport { Inject, Injectable } from \"react.di\";\r\nimport { Slider, message } from \"antd\";\r\nimport {QuotationService} from '../../../api/QuotationService';\r\nimport _ from 'lodash';\r\nimport {DatePicker} from 'antd';\r\nconst {RangePicker} = DatePicker; \r\nconst dateFormat = 'YYYY-MM-DD';\r\nexport default class MarketOverview extends React.Component {\r\n  @Inject quotationService: QuotationService;\r\n\r\n  state = {\r\n    data: null,\r\n    lookingYear: 2001,\r\n    lookingTime: [moment('2001-01-01', dateFormat), moment('2001-03-01', dateFormat)],\r\n    linePlot: null,\r\n  }\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  async componentWillMount() {\r\n  }\r\n  filterData = (data) => {\r\n    const temp_data = [];\r\n    const {lookingTime} = this.state;\r\n    if (!lookingTime) {\r\n      return data;\r\n    }\r\n    // console.log(lookingTime);\r\n    // const {startTime, endTime} = lookingTime;\r\n    const startTime = lookingTime[0];\r\n    const endTime = lookingTime[1];\r\n    let max_value = -10, min_value = 100;\r\n    data.forEach(item => {\r\n      if (startTime <= moment(item.time) && moment(item.time) <= endTime) {\r\n        temp_data.push(item);\r\n        if (item.bid > max_value) {\r\n          max_value = item.bid;\r\n        }\r\n        if (item.bid < min_value) {\r\n          min_value = item.bid;\r\n        }\r\n      }\r\n    });\r\n    return [temp_data, max_value, min_value];\r\n  }\r\n  showLine = () => {\r\n    const {data} = this.state;\r\n    const filterResult = this.filterData(data);\r\n    const temp_data = filterResult[0];\r\n    const max_value = filterResult[1];\r\n    const min_value = filterResult[2];\r\n    \r\n    const config = {\r\n      title: {\r\n        visible: true,\r\n        text:'预测与实际趋势图'\r\n      },\r\n      padding: 'auto',\r\n      forceFit: true,\r\n      data: temp_data,\r\n      xField: 'time',\r\n      yField: 'bid',\r\n      yAxis: {\r\n        min: min_value,\r\n        max: max_value\r\n      },\r\n      legend: {\r\n        position: 'right-top',\r\n      },\r\n      seriesField: 'type',\r\n      responsive: true,\r\n      animation: {\r\n        appear: {\r\n          animation: 'clipingWithData',\r\n        },\r\n      },\r\n      smooth: true,\r\n    };\r\n    const linePlot = new Line(document.getElementById('graph-container'), config);\r\n    this.setState({linePlot});\r\n    linePlot.render();\r\n  }\r\n  async componentDidMount() {\r\n    console.log(this.state.data === null ? 1 : this.state.data)\r\n    if (!this.state.data) {\r\n      let data = await this.quotationService.getData(2001, null);\r\n      data = data.data;\r\n      const length = data.length;\r\n      let endTime = moment(data[length - 1]['time']).format('YYYY-MM-DD');\r\n      let startTime = moment(endTime).subtract(100, 'days').format('YYYY-MM-DD');\r\n      console.log(endTime, startTime);\r\n      this.setState({data: data, startTime: startTime, endTime: endTime});\r\n    }\r\n    this.showLine()\r\n  }\r\n\r\n  onAfterChange (value) {\r\n    const startPoint = value[0];\r\n    const endPoint = value[1];\r\n    this.setState({startPoint, endPoint});\r\n    const {data, linePlot} = this.state;\r\n    const temp_data = this.filterData(data);\r\n    linePlot.changeData(temp_data);\r\n  }\r\n  async sliderChange(value, quotationService) {\r\n    value = 2001 + value * 19 /100;\r\n    let data = await quotationService.getData(value);\r\n    const lookingTime = [moment(`${value}-01-01`, dateFormat), moment(`${value}-03-01`, dateFormat)]\r\n    await this.setState({data: data.data, lookingTime});\r\n    const filterResult = this.filterData(data.data);\r\n    const temp_data = filterResult[0];\r\n    const max_value = filterResult[1];\r\n    const min_value = filterResult[2];\r\n    const {linePlot} = this.state;\r\n    linePlot.updateConfig({\r\n      data: temp_data,\r\n      yAxis: {\r\n        min: min_value,\r\n        max: max_value\r\n      }\r\n    });\r\n    linePlot.render();\r\n  }\r\n  getData = async (year) => {\r\n    if (year !== this.state.lookingYear) {\r\n      const responce = await this.quotationService.getData(year, year+1);\r\n      await this.setState({data: responce.data, lookingYear: year});\r\n    } \r\n    return this.state.data;\r\n  }\r\n  onRangeChange = async (v) => {\r\n    await this.setState({lookingTime: [v[0], v[1]]})\r\n    let data = null;\r\n    if (v[1].year() - v[0].year() > 1) {\r\n      return (message.warning('对不起，您选择的时间范围过长！请选择较短的预测时间查看。', 5));\r\n    } else if (v[1].year() === v[0].year() ) {\r\n      data = await this.getData(v[1].year());\r\n    } \r\n    else if (v[1].year() - v[0].year() === 1) {\r\n      const responce = await this.quotationService.getData(v[0].year(), v[1].year() + 1);\r\n      await this.setState({data: responce.data});\r\n      data = this.state.data;\r\n    }\r\n    const {linePlot} = this.state;\r\n    const filterResult = this.filterData(data)\r\n    const temp_data = filterResult[0];\r\n    const max_value = filterResult[1];\r\n    const min_value = filterResult[2];\r\n    linePlot.updateConfig({\r\n      data: temp_data,\r\n      yAxis: {\r\n        min: min_value,\r\n        max: max_value\r\n      }});\r\n    linePlot.render();\r\n    return;\r\n  }\r\n\r\n  render() {\r\n    const marks = {\r\n      0: 2001,\r\n      100: 2020\r\n    };\r\n    return (\r\n    <div>\r\n    {/* <div><strong>选择查看的年份</strong></div>\r\n    <Slider\r\n      defaultValue={0}\r\n      marks={marks} \r\n      step={100/19} \r\n      tipFormatter= {(v) => `${2001 + v * 19 / 100}`} \r\n      onAfterChange={(v) => this.sliderChange(v, this.quotationService)}\r\n    /> */}\r\n    <div><strong>选择查看的时间段</strong></div>\r\n    <RangePicker \r\n      defaultValue={this.state.lookingTime}\r\n      onChange={this.onRangeChange}\r\n      renderExtraFooter={() => '请选择最长半年的时间查看！'}\r\n    />\r\n    <div id='graph-container' />\r\n    </div>\r\n  ); \r\n  }\r\n}\r\n\r\n"]}]}