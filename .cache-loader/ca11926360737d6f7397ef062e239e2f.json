{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\marker-point.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\marker-point.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { __assign } from \"tslib\";\r\nimport { MarkerSymbols } from '../dependents';\r\nimport { deepMix, isMatch, isString, isArray, each, find } from '@antv/util';\r\nimport { DEFAULT_ANIMATE_CFG } from '@antv/g2/lib/animate';\r\nvar DEFAULT_STYLE = {\r\n    stroke: 'transparent',\r\n    fill: '#FCC509',\r\n    lineWidth: 0,\r\n};\r\nvar ACTIVE_STYLE = {\r\n    stroke: '#FFF',\r\n    fill: '#FCC509',\r\n    lineWidth: 1,\r\n};\r\nvar SELECTED_STYLE = {\r\n    stroke: 'rgba(0,0,0,0.85)',\r\n    fill: '#FCC509',\r\n    lineWidth: 1,\r\n};\r\nvar MarkerPoint = (function () {\r\n    function MarkerPoint(cfg) {\r\n        this.points = [];\r\n        this.labels = [];\r\n        this.name = 'markerPoints';\r\n        this.defaultCfg = {\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n            style: { normal: DEFAULT_STYLE, selected: SELECTED_STYLE, active: ACTIVE_STYLE },\r\n            label: {\r\n                visible: false,\r\n                offsetY: -8,\r\n                position: 'top',\r\n                style: {\r\n                    fill: 'rgba(0, 0, 0, 0.85)',\r\n                },\r\n            },\r\n            animation: false,\r\n        };\r\n        this.view = cfg.view;\r\n        this.size = cfg.size || 6;\r\n        this.config = deepMix({}, this.defaultCfg, cfg);\r\n        this._init();\r\n    }\r\n    MarkerPoint.prototype.render = function () {\r\n        var dataArray = this.getDataArray();\r\n        this._renderPoints(dataArray);\r\n        this.view.canvas.draw();\r\n        this._addInteraction();\r\n    };\r\n    MarkerPoint.prototype.clear = function () {\r\n        if (this.container) {\r\n            this.container.clear();\r\n        }\r\n    };\r\n    MarkerPoint.prototype.destroy = function () {\r\n        if (this.container) {\r\n            this.container.remove();\r\n        }\r\n        this.points = [];\r\n        this.labels = [];\r\n    };\r\n    MarkerPoint.prototype.getDataArray = function () {\r\n        var geometry = this.view.geometries[0];\r\n        return geometry.dataArray;\r\n    };\r\n    MarkerPoint.prototype._init = function () {\r\n        var _this = this;\r\n        var layer = this.view.foregroundGroup;\r\n        this.container = layer.addGroup();\r\n        this.render();\r\n        this.view.on('beforerender', function () {\r\n            _this.clear();\r\n        });\r\n    };\r\n    MarkerPoint.prototype._renderPoints = function (dataArray) {\r\n        var _this = this;\r\n        each(this.config.data, function (dataItem, dataItemIdx) {\r\n            var origin = find(dataArray[0], function (d) { return isMatch(d._origin, dataItem); });\r\n            if (origin) {\r\n                var pointAttrs = _this.config.style.normal;\r\n                var group = _this.container.addGroup({ name: _this.name });\r\n                var x = origin.x, y = origin.y;\r\n                if (isArray(x)) {\r\n                    x = x[0];\r\n                }\r\n                if (isArray(y)) {\r\n                    y = y[0];\r\n                }\r\n                var symbol = _this.config.symbol;\r\n                var _a = _this.config, offsetX = _a.offsetX, offsetY = _a.offsetY;\r\n                var point = void 0;\r\n                if (isString(symbol) && symbol.startsWith('image://')) {\r\n                    var imageUrl = symbol.substr(8);\r\n                    point = group.addShape('image', {\r\n                        attrs: {\r\n                            x: x - _this.size / 2 + offsetX,\r\n                            y: y - _this.size / 2 + offsetY,\r\n                            img: imageUrl,\r\n                            width: _this.size,\r\n                            height: _this.size,\r\n                        },\r\n                    });\r\n                }\r\n                else {\r\n                    symbol = isString(symbol) ? MarkerSymbols[symbol] : symbol;\r\n                    point = group.addShape({\r\n                        type: 'marker',\r\n                        name: 'marker-point',\r\n                        id: \"point-\" + dataItemIdx,\r\n                        attrs: __assign(__assign({ x: x + offsetX, y: y + offsetY, r: _this.size / 2 }, pointAttrs), { symbol: symbol }),\r\n                    });\r\n                }\r\n                _this.points.push(point);\r\n                _this._animatePoint(point);\r\n                _this._renderLabel(group, origin, dataItemIdx);\r\n                group.set('data', dataItem);\r\n                group.set('origin', origin);\r\n            }\r\n        });\r\n    };\r\n    MarkerPoint.prototype._renderLabel = function (container, origin, index) {\r\n        var labelCfg = this.config.label;\r\n        if (labelCfg && labelCfg.visible) {\r\n            var _a = labelCfg.offsetX, offsetX = _a === void 0 ? 0 : _a, _b = labelCfg.offsetY, offsetY = _b === void 0 ? 0 : _b, formatter = labelCfg.formatter, position = labelCfg.position, field = labelCfg.field;\r\n            var text = origin._origin[field];\r\n            if (formatter) {\r\n                text = formatter(text, { _origin: origin._origin }, index);\r\n            }\r\n            var x = isArray(origin.x) ? origin.x[0] : origin.x;\r\n            var y = isArray(origin.y) ? origin.y[0] : origin.y;\r\n            var label = container.addShape('text', {\r\n                name: 'marker-label',\r\n                id: \"label-\" + index,\r\n                attrs: __assign(__assign({ x: x + offsetX, y: y + offsetY, text: text || '' }, labelCfg.style), { textAlign: 'center', textBaseline: position === 'top' ? 'bottom' : 'top' }),\r\n            });\r\n            this.labels.push(label);\r\n        }\r\n    };\r\n    MarkerPoint.prototype._addInteraction = function () {\r\n        var _this = this;\r\n        var events = this.config.events;\r\n        each(events, function (cb, eventName) {\r\n            _this.container.on(_this.name + \":\" + eventName, function (e) {\r\n                cb(e);\r\n                var target = e.target.get('parent');\r\n                var pointShape = target.get('children')[0];\r\n                if (pointShape) {\r\n                    var data = pointShape.get('data');\r\n                    var id = pointShape.get('id');\r\n                    var condition = { id: id, data: data };\r\n                    if (eventName === 'click') {\r\n                        if (_this.selectedPoint && _this.selectedPoint.get('id') === id) {\r\n                            _this.selectedPoint = null;\r\n                            _this.setState('inactive', condition);\r\n                        }\r\n                        else {\r\n                            _this.selectedPoint = pointShape;\r\n                            _this.setState('selected', condition);\r\n                        }\r\n                    }\r\n                    else if (eventName === 'mouseenter') {\r\n                        _this.setState('active', condition);\r\n                    }\r\n                    else if (eventName === 'mouseleave') {\r\n                        _this.setState('inactive', condition);\r\n                    }\r\n                }\r\n                _this.view.canvas.draw();\r\n            });\r\n            _this.view.on('click', function (e) {\r\n                var target = e.target.get('parent');\r\n                if (!target || (target.get('name') !== _this.name && _this.selectedPoint)) {\r\n                    _this.selectedPoint = null;\r\n                    _this.setState('inactive');\r\n                }\r\n            });\r\n        });\r\n    };\r\n    MarkerPoint.prototype.setState = function (state, condition) {\r\n        var _this = this;\r\n        if (state === 'active') {\r\n            if (!this.selectedPoint || condition.id !== this.selectedPoint.get('id')) {\r\n                this._onActive(condition);\r\n            }\r\n        }\r\n        else if (state === 'inactive') {\r\n            this.points.forEach(function (p) { return _this._onInactive(p); });\r\n        }\r\n        else if (state === 'selected') {\r\n            this._onSelected(condition);\r\n        }\r\n    };\r\n    MarkerPoint.prototype._onActive = function (condition) {\r\n        var _this = this;\r\n        var active = this.config.style.active;\r\n        each(this.points, function (point) {\r\n            if (point.get('id') === condition.id) {\r\n                each(active, function (v, k) {\r\n                    point.attr(k, v);\r\n                });\r\n            }\r\n            else {\r\n                _this._onInactive(point);\r\n            }\r\n        });\r\n    };\r\n    MarkerPoint.prototype._onInactive = function (point) {\r\n        var normal = this.config.style.normal;\r\n        if (!this.selectedPoint || point.get('id') !== this.selectedPoint.get('id')) {\r\n            each(normal, function (v, k) {\r\n                point.attr(k, v);\r\n            });\r\n        }\r\n    };\r\n    MarkerPoint.prototype._onSelected = function (condition) {\r\n        var _this = this;\r\n        var selected = this.config.style.selected;\r\n        each(this.points, function (point) {\r\n            if (point.get('id') === condition.id) {\r\n                each(selected, function (v, k) {\r\n                    point.attr(k, v);\r\n                });\r\n            }\r\n            else {\r\n                _this._onInactive(point);\r\n            }\r\n        });\r\n    };\r\n    MarkerPoint.prototype._animatePoint = function (shape) {\r\n        var _a = this.config, animation = _a.animation, size = _a.size;\r\n        if (animation !== false) {\r\n            var _b = animation, _c = _b.endState, endState = _c === void 0 ? {} : _c, _d = _b.animateCfg, animateCfg = _d === void 0 ? DEFAULT_ANIMATE_CFG.appear : _d;\r\n            shape.animate(__assign({ r: Number.isNaN(endState.size / 2) ? size / 2 : endState.size / 2 }, endState), animateCfg);\r\n        }\r\n    };\r\n    return MarkerPoint;\r\n}());\r\nexport default MarkerPoint;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\marker-point.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\marker-point.js"],"names":[],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\nimport { MarkerSymbols } from '../dependents';\nimport { deepMix, isMatch, isString, isArray, each, find } from '@antv/util';\nimport { DEFAULT_ANIMATE_CFG } from '@antv/g2/lib/animate';\nvar DEFAULT_STYLE = {\n    stroke: 'transparent',\n    fill: '#FCC509',\n    lineWidth: 0,\n};\nvar ACTIVE_STYLE = {\n    stroke: '#FFF',\n    fill: '#FCC509',\n    lineWidth: 1,\n};\nvar SELECTED_STYLE = {\n    stroke: 'rgba(0,0,0,0.85)',\n    fill: '#FCC509',\n    lineWidth: 1,\n};\n/**\n * 标注点 绘制在最顶层\n */\nvar MarkerPoint = /** @class */ (function () {\n    function MarkerPoint(cfg) {\n        this.points = [];\n        this.labels = [];\n        this.name = 'markerPoints';\n        this.defaultCfg = {\n            offsetX: 0,\n            offsetY: 0,\n            style: { normal: DEFAULT_STYLE, selected: SELECTED_STYLE, active: ACTIVE_STYLE },\n            label: {\n                visible: false,\n                offsetY: -8,\n                position: 'top',\n                style: {\n                    fill: 'rgba(0, 0, 0, 0.85)',\n                },\n            },\n            animation: false,\n        };\n        this.view = cfg.view;\n        this.size = cfg.size || 6;\n        this.config = deepMix({}, this.defaultCfg, cfg);\n        this._init();\n    }\n    MarkerPoint.prototype.render = function () {\n        var dataArray = this.getDataArray();\n        this._renderPoints(dataArray);\n        this.view.canvas.draw();\n        this._addInteraction();\n    };\n    MarkerPoint.prototype.clear = function () {\n        if (this.container) {\n            this.container.clear();\n        }\n    };\n    MarkerPoint.prototype.destroy = function () {\n        if (this.container) {\n            this.container.remove();\n        }\n        this.points = [];\n        this.labels = [];\n    };\n    MarkerPoint.prototype.getDataArray = function () {\n        var geometry = this.view.geometries[0];\n        return geometry.dataArray;\n    };\n    MarkerPoint.prototype._init = function () {\n        var _this = this;\n        var layer = this.view.foregroundGroup;\n        this.container = layer.addGroup();\n        this.render();\n        this.view.on('beforerender', function () {\n            _this.clear();\n        });\n    };\n    MarkerPoint.prototype._renderPoints = function (dataArray) {\n        var _this = this;\n        each(this.config.data, function (dataItem, dataItemIdx) {\n            var origin = find(dataArray[0], function (d) { return isMatch(d._origin, dataItem); });\n            if (origin) {\n                var pointAttrs = _this.config.style.normal;\n                var group = _this.container.addGroup({ name: _this.name });\n                var x = origin.x, y = origin.y;\n                if (isArray(x)) {\n                    x = x[0];\n                }\n                if (isArray(y)) {\n                    y = y[0];\n                }\n                var symbol = _this.config.symbol;\n                var _a = _this.config, offsetX = _a.offsetX, offsetY = _a.offsetY;\n                var point = void 0;\n                if (isString(symbol) && symbol.startsWith('image://')) {\n                    var imageUrl = symbol.substr(8);\n                    point = group.addShape('image', {\n                        attrs: {\n                            x: x - _this.size / 2 + offsetX,\n                            y: y - _this.size / 2 + offsetY,\n                            img: imageUrl,\n                            width: _this.size,\n                            height: _this.size,\n                        },\n                    });\n                }\n                else {\n                    symbol = isString(symbol) ? MarkerSymbols[symbol] : symbol;\n                    point = group.addShape({\n                        type: 'marker',\n                        name: 'marker-point',\n                        id: \"point-\" + dataItemIdx,\n                        attrs: __assign(__assign({ x: x + offsetX, y: y + offsetY, r: _this.size / 2 }, pointAttrs), { symbol: symbol }),\n                    });\n                }\n                _this.points.push(point);\n                _this._animatePoint(point);\n                _this._renderLabel(group, origin, dataItemIdx);\n                group.set('data', dataItem);\n                group.set('origin', origin);\n            }\n        });\n    };\n    MarkerPoint.prototype._renderLabel = function (container, origin, index) {\n        var labelCfg = this.config.label;\n        if (labelCfg && labelCfg.visible) {\n            var _a = labelCfg.offsetX, offsetX = _a === void 0 ? 0 : _a, _b = labelCfg.offsetY, offsetY = _b === void 0 ? 0 : _b, formatter = labelCfg.formatter, position = labelCfg.position, field = labelCfg.field;\n            var text = origin._origin[field];\n            if (formatter) {\n                text = formatter(text, { _origin: origin._origin }, index);\n            }\n            var x = isArray(origin.x) ? origin.x[0] : origin.x;\n            var y = isArray(origin.y) ? origin.y[0] : origin.y;\n            var label = container.addShape('text', {\n                name: 'marker-label',\n                id: \"label-\" + index,\n                attrs: __assign(__assign({ x: x + offsetX, y: y + offsetY, text: text || '' }, labelCfg.style), { textAlign: 'center', textBaseline: position === 'top' ? 'bottom' : 'top' }),\n            });\n            this.labels.push(label);\n        }\n    };\n    MarkerPoint.prototype._addInteraction = function () {\n        var _this = this;\n        var events = this.config.events;\n        each(events, function (cb, eventName) {\n            _this.container.on(_this.name + \":\" + eventName, function (e) {\n                cb(e);\n                var target = e.target.get('parent');\n                var pointShape = target.get('children')[0];\n                if (pointShape) {\n                    var data = pointShape.get('data');\n                    var id = pointShape.get('id');\n                    var condition = { id: id, data: data };\n                    if (eventName === 'click') {\n                        if (_this.selectedPoint && _this.selectedPoint.get('id') === id) {\n                            _this.selectedPoint = null;\n                            _this.setState('inactive', condition);\n                        }\n                        else {\n                            _this.selectedPoint = pointShape;\n                            _this.setState('selected', condition);\n                        }\n                    }\n                    else if (eventName === 'mouseenter') {\n                        _this.setState('active', condition);\n                    }\n                    else if (eventName === 'mouseleave') {\n                        _this.setState('inactive', condition);\n                    }\n                }\n                _this.view.canvas.draw();\n            });\n            _this.view.on('click', function (e) {\n                var target = e.target.get('parent');\n                if (!target || (target.get('name') !== _this.name && _this.selectedPoint)) {\n                    _this.selectedPoint = null;\n                    _this.setState('inactive');\n                }\n            });\n        });\n    };\n    MarkerPoint.prototype.setState = function (state, condition) {\n        var _this = this;\n        if (state === 'active') {\n            if (!this.selectedPoint || condition.id !== this.selectedPoint.get('id')) {\n                this._onActive(condition);\n            }\n        }\n        else if (state === 'inactive') {\n            this.points.forEach(function (p) { return _this._onInactive(p); });\n        }\n        else if (state === 'selected') {\n            this._onSelected(condition);\n        }\n    };\n    MarkerPoint.prototype._onActive = function (condition) {\n        var _this = this;\n        var active = this.config.style.active;\n        each(this.points, function (point) {\n            if (point.get('id') === condition.id) {\n                each(active, function (v, k) {\n                    point.attr(k, v);\n                });\n            }\n            else {\n                _this._onInactive(point);\n            }\n        });\n    };\n    MarkerPoint.prototype._onInactive = function (point) {\n        var normal = this.config.style.normal;\n        if (!this.selectedPoint || point.get('id') !== this.selectedPoint.get('id')) {\n            each(normal, function (v, k) {\n                point.attr(k, v);\n            });\n        }\n    };\n    MarkerPoint.prototype._onSelected = function (condition) {\n        var _this = this;\n        var selected = this.config.style.selected;\n        each(this.points, function (point) {\n            if (point.get('id') === condition.id) {\n                each(selected, function (v, k) {\n                    point.attr(k, v);\n                });\n            }\n            else {\n                _this._onInactive(point);\n            }\n        });\n    };\n    /** point animation, not for label */\n    MarkerPoint.prototype._animatePoint = function (shape) {\n        var _a = this.config, animation = _a.animation, size = _a.size;\n        if (animation !== false) {\n            var _b = animation, _c = _b.endState, endState = _c === void 0 ? {} : _c, _d = _b.animateCfg, animateCfg = _d === void 0 ? DEFAULT_ANIMATE_CFG.appear : _d;\n            shape.animate(__assign({ r: Number.isNaN(endState.size / 2) ? size / 2 : endState.size / 2 }, endState), animateCfg);\n        }\n    };\n    return MarkerPoint;\n}());\nexport default MarkerPoint;\n//# sourceMappingURL=marker-point.js.map"]}]}