{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\RegisterPage\\RegisterForm.tsx","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\RegisterPage\\RegisterForm.tsx","mtime":1596379644599},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport React from \"react\";\r\nimport Button from \"antd/lib/button\";\r\nimport \"antd/lib/button/style/index.js\";\r\nimport Checkbox from \"antd/lib/checkbox\";\r\nimport \"antd/lib/checkbox/style/index.js\";\r\nimport Form from \"antd/lib/form\";\r\nimport \"antd/lib/form/style/index.js\";\r\nimport Input from \"antd/lib/input\";\r\nimport \"antd/lib/input/style/index.js\";\r\nimport message from \"antd/lib/message\";\r\nimport \"antd/lib/message/style/index.js\";\r\nimport { observer } from \"mobx-react\";\r\nimport { LocaleStore } from \"../../internationalization\";\r\nimport lang from \"../../internationalization/LocaleStore/lang\";\r\nimport { Inject } from \"react.di\";\r\nimport EmailValidationModal from \"../../components/EmailValidationModal\";\r\nimport { UserRole } from \"../../models/user/User\";\r\nimport { UserService } from \"../../api/UserService\";\r\nimport { RouterStore } from \"../../routing/RouterStore\";\r\nimport { UserStore } from \"../../stores/UserStore\";\r\nimport { Link } from \"react-router-dom\";\r\nvar RegisterFormDetail = (function (_super) {\r\n    __extends(RegisterFormDetail, _super);\r\n    function RegisterFormDetail() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            role: UserRole.USER,\r\n            username: \"\",\r\n            email: \"\",\r\n            password: \"\",\r\n            submitting: false,\r\n            validationModalVisible: false,\r\n            token: \"\",\r\n        };\r\n        _this.handleUsernameInput = function (e) {\r\n            _this.setState({\r\n                username: e.target.value,\r\n            });\r\n        };\r\n        _this.handlePasswordInput = function (e) {\r\n            _this.setState({\r\n                password: e.target.value,\r\n            });\r\n        };\r\n        _this.handleEmailInput = function (e) {\r\n            _this.setState({\r\n                email: e.target.value,\r\n            });\r\n        };\r\n        _this.handleSubmit = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var data, res, e_1, e1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        data = {\r\n                            username: this.state.username,\r\n                            email: this.state.email,\r\n                            password: this.state.password,\r\n                            role: this.state.role,\r\n                        };\r\n                        this.setState({ submitting: true });\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4, this.userService.register(data)];\r\n                    case 2:\r\n                        res = _a.sent();\r\n                        this.setState({\r\n                            submitting: false,\r\n                            token: res.token,\r\n                            validationModalVisible: true,\r\n                        });\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        console.log(e_1);\r\n                        e1 = e_1;\r\n                        switch (e1.statusCode) {\r\n                            case 409:\r\n                                message.error(this.localeStore.get(lang().signIn.error.exists[e1.info.field]));\r\n                                break;\r\n                        }\r\n                        return [3, 4];\r\n                    case 4:\r\n                        this.setState({ submitting: false });\r\n                        return [2];\r\n                }\r\n            });\r\n        }); };\r\n        _this.validateInput = function (e) {\r\n            e.preventDefault();\r\n            _this.props.form.validateFieldsAndScroll(function (err, values) {\r\n                if (!err) {\r\n                    if (!values.agreement) {\r\n                        message.error(_this.localeStore.get(lang().signIn.error.check));\r\n                    }\r\n                    else {\r\n                        _this.handleSubmit();\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        _this.closeModal = function (validated, remember) { return __awaiter(_this, void 0, void 0, function () {\r\n            var user, e_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.setState({ validationModalVisible: false });\r\n                        if (!validated) return [3, 4];\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4, this.userStore.requestLogin(this.state.username, this.state.password)];\r\n                    case 2:\r\n                        user = _a.sent();\r\n                        this.userStore.login(user, remember);\r\n                        this.routerStore.push(\"/user\");\r\n                        return [3, 4];\r\n                    case 3:\r\n                        e_2 = _a.sent();\r\n                        console.log(e_2);\r\n                        return [3, 4];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        }); };\r\n        return _this;\r\n    }\r\n    RegisterFormDetail.prototype.render = function () {\r\n        var _this = this;\r\n        var getFieldDecorator = this.props.form.getFieldDecorator;\r\n        var formItemLayout = {\r\n            labelCol: {\r\n                xs: { span: 24 },\r\n                sm: { span: 6 },\r\n            },\r\n            wrapperCol: {\r\n                xs: { span: 24 },\r\n                sm: { span: 14 },\r\n            },\r\n        };\r\n        var tailFormItemLayout = {\r\n            wrapperCol: {\r\n                xs: {\r\n                    span: 24,\r\n                    offset: 0,\r\n                },\r\n                sm: {\r\n                    span: 20,\r\n                    offset: 4,\r\n                },\r\n            },\r\n        };\r\n        var buttonFormItemLayout = {\r\n            wrapperCol: {\r\n                xs: {\r\n                    span: 24,\r\n                    offset: 0,\r\n                },\r\n                sm: {\r\n                    span: 16,\r\n                    offset: 4,\r\n                },\r\n            },\r\n        };\r\n        return (React.createElement(Form, { onSubmit: this.handleSubmit },\r\n            React.createElement(Form.Item, __assign({ label: this.localeStore.get(lang().signIn.username) }, formItemLayout), getFieldDecorator(\"username\", {\r\n                rules: [{\r\n                        required: true, message: \"用户名不能为空\",\r\n                    }],\r\n            })(React.createElement(Input, { onChange: this.handleUsernameInput }))),\r\n            React.createElement(Form.Item, __assign({}, formItemLayout, { label: this.localeStore.get(lang().signIn.email) }), getFieldDecorator(\"email\", {\r\n                rules: [{\r\n                        type: \"email\", message: \"您输入的邮箱格式不正确\",\r\n                    }, {\r\n                        required: true, message: \"邮箱不能为空\",\r\n                    }],\r\n            })(React.createElement(Input, { onChange: this.handleEmailInput }))),\r\n            React.createElement(Form.Item, __assign({ label: this.localeStore.get(lang().signIn.password) }, formItemLayout), getFieldDecorator(\"password\", {\r\n                rules: [{\r\n                        required: true, message: \"密码不能为空\",\r\n                    }],\r\n            })(React.createElement(Input, { type: \"password\", onChange: this.handlePasswordInput }))),\r\n            React.createElement(Form.Item, __assign({ label: this.localeStore.get(lang().signIn.confirmPassword) }, formItemLayout), getFieldDecorator(\"passwordConfirm\", {\r\n                rules: [{\r\n                        required: true, message: \"密码不能为空\",\r\n                    }, {\r\n                        validator: function (rule, value, callback) {\r\n                            var form = _this.props.form;\r\n                            if (value && value !== form.getFieldValue(\"password\")) {\r\n                                callback(\"输入的密码不一致\");\r\n                            }\r\n                            else {\r\n                                callback();\r\n                            }\r\n                        },\r\n                    }],\r\n            })(React.createElement(Input, { type: \"password\" }))),\r\n            React.createElement(Form.Item, __assign({}, tailFormItemLayout), getFieldDecorator(\"agreement\", {\r\n                valuePropName: \"checked\",\r\n            })(React.createElement(Checkbox, null,\r\n                this.localeStore.get(lang().signIn.protocolPrompt),\r\n                React.createElement(Link, { to: \"/help/tos\" }, this.localeStore.get(lang().signIn.protocol))))),\r\n            React.createElement(Form.Item, __assign({}, buttonFormItemLayout),\r\n                React.createElement(Button, { loading: this.state.submitting, type: \"primary\", block: true, onClick: this.validateInput }, this.localeStore.get(lang().signIn.register))),\r\n            this.state.validationModalVisible\r\n                ? React.createElement(EmailValidationModal, { userToken: this.state.token, visible: this.state.validationModalVisible, onClose: this.closeModal, sendEmailDirectly: true, showRememberCheck: true })\r\n                : null));\r\n    };\r\n    var _a, _b, _c, _d;\r\n    __decorate([\r\n        Inject,\r\n        __metadata(\"design:type\", typeof (_a = typeof LocaleStore !== \"undefined\" && LocaleStore) === \"function\" ? _a : Object)\r\n    ], RegisterFormDetail.prototype, \"localeStore\", void 0);\r\n    __decorate([\r\n        Inject,\r\n        __metadata(\"design:type\", typeof (_b = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _b : Object)\r\n    ], RegisterFormDetail.prototype, \"userService\", void 0);\r\n    __decorate([\r\n        Inject,\r\n        __metadata(\"design:type\", typeof (_c = typeof RouterStore !== \"undefined\" && RouterStore) === \"function\" ? _c : Object)\r\n    ], RegisterFormDetail.prototype, \"routerStore\", void 0);\r\n    __decorate([\r\n        Inject,\r\n        __metadata(\"design:type\", typeof (_d = typeof UserStore !== \"undefined\" && UserStore) === \"function\" ? _d : Object)\r\n    ], RegisterFormDetail.prototype, \"userStore\", void 0);\r\n    RegisterFormDetail = __decorate([\r\n        observer\r\n    ], RegisterFormDetail);\r\n    return RegisterFormDetail;\r\n}(React.Component));\r\nexport var RegisterForm = Form.create({})(RegisterFormDetail);\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\RegisterPage\\RegisterForm.tsx","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\RegisterPage\\RegisterForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { Button, Checkbox, Form, Input, message } from \"antd\";\r\nimport { FormComponentProps } from \"antd/lib/form\";\r\nimport { observer } from \"mobx-react\";\r\nimport { LocaleStore } from \"../../internationalization\";\r\nimport lang from \"../../internationalization/LocaleStore/lang\";\r\nimport { Inject } from \"react.di\";\r\nimport EmailValidationModal from \"../../components/EmailValidationModal\";\r\nimport { UserRole } from \"../../models/user/User\";\r\nimport { UserService } from \"../../api/UserService\";\r\nimport { NetworkError } from \"../../api/NetworkResponse\";\r\nimport { RouterStore } from \"../../routing/RouterStore\";\r\nimport { UserStore } from \"../../stores/UserStore\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\ninterface RegisterFormProps extends FormComponentProps {\r\n}\r\n\r\ninterface State {\r\n  username: string;\r\n  password: string;\r\n  email: string;\r\n  role: UserRole;\r\n  submitting: boolean;\r\n  validationModalVisible: boolean;\r\n  token: string;\r\n}\r\n\r\n/**\r\n * SignIn Form\r\n */\r\n@observer\r\nclass RegisterFormDetail extends React.Component<RegisterFormProps, State> {\r\n  @Inject localeStore: LocaleStore;\r\n  @Inject userService: UserService;\r\n  @Inject routerStore: RouterStore;\r\n  @Inject userStore: UserStore;\r\n\r\n  state = {\r\n    role: UserRole.USER,\r\n    username: \"\",\r\n    email: \"\",\r\n    password: \"\",\r\n    submitting: false,\r\n    validationModalVisible: false,\r\n    token: \"\",\r\n  };\r\n\r\n  handleUsernameInput = (e) => {\r\n    this.setState({\r\n      username: e.target.value,\r\n    });\r\n  }\r\n\r\n  handlePasswordInput = (e) => {\r\n    this.setState({\r\n      password: e.target.value,\r\n    });\r\n  }\r\n\r\n  handleEmailInput = (e) => {\r\n    this.setState({\r\n      email: e.target.value,\r\n    });\r\n  }\r\n\r\n  handleSubmit = async () => {\r\n\r\n    const data = {\r\n      username: this.state.username,\r\n      email: this.state.email,\r\n      password: this.state.password,\r\n      role: this.state.role,\r\n    };\r\n\r\n    this.setState({submitting: true});\r\n    try {\r\n      const res = await this.userService.register(data);\r\n      this.setState({\r\n        submitting: false,\r\n        token: res.token,\r\n        validationModalVisible: true,\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n      const e1 = e as NetworkError;\r\n      switch (e1.statusCode) {\r\n        case 409:\r\n          message.error(this.localeStore.get(lang().signIn.error.exists[e1.info.field]));\r\n          break;\r\n      }\r\n\r\n    }\r\n    this.setState({ submitting: false });\r\n  }\r\n\r\n  /**\r\n   * 验证输入\r\n   * @param e\r\n   */\r\n  validateInput = (e) => {\r\n    // 是否正确格式\r\n    e.preventDefault();\r\n    this.props.form.validateFieldsAndScroll((err, values) => {\r\n      if (!err) {\r\n        if (!values.agreement) {\r\n          message.error(this.localeStore.get(lang().signIn.error.check));\r\n        } else {\r\n          this.handleSubmit();\r\n        }\r\n\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 关闭弹出框调用的方法\r\n   */\r\n  closeModal = async (validated: boolean, remember: boolean) => {\r\n    this.setState({validationModalVisible: false});\r\n\r\n    if (validated) {\r\n      try {\r\n        const user = await this.userStore.requestLogin(this.state.username, this.state.password);\r\n        this.userStore.login(user, remember);\r\n        this.routerStore.push(\"/user\");\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    const {getFieldDecorator} = this.props.form;\r\n\r\n    const formItemLayout = {\r\n      labelCol: {\r\n        xs: {span: 24},\r\n        sm: {span: 6},\r\n      },\r\n      wrapperCol: {\r\n        xs: {span: 24},\r\n        sm: {span: 14},\r\n      },\r\n    };\r\n\r\n    const tailFormItemLayout = {\r\n      wrapperCol: {\r\n        xs: {\r\n          span: 24,\r\n          offset: 0,\r\n        },\r\n        sm: {\r\n          span: 20,\r\n          offset: 4,\r\n        },\r\n      },\r\n    };\r\n\r\n    const buttonFormItemLayout = {\r\n      wrapperCol: {\r\n        xs: {\r\n          span: 24,\r\n          offset: 0,\r\n        },\r\n        sm: {\r\n          span: 16,\r\n          offset: 4,\r\n        },\r\n      },\r\n    };\r\n\r\n    return (\r\n\r\n      <Form onSubmit={this.handleSubmit}>\r\n\r\n        <Form.Item\r\n          label={this.localeStore.get(lang().signIn.username)}\r\n          {...formItemLayout}\r\n        >\r\n          {getFieldDecorator(\"username\", {\r\n            rules: [{\r\n              // TODO 这边this好像拿不到localeStore\r\n              required: true, message: \"用户名不能为空\",\r\n            }],\r\n          })(\r\n            <Input onChange={this.handleUsernameInput}/>,\r\n          )}\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          {...formItemLayout}\r\n          label={this.localeStore.get(lang().signIn.email)}\r\n        >\r\n          {getFieldDecorator(\"email\", {\r\n            rules: [{\r\n              type: \"email\", message: \"您输入的邮箱格式不正确\",\r\n            }, {\r\n              required: true, message: \"邮箱不能为空\",\r\n            }],\r\n          })(\r\n            <Input onChange={this.handleEmailInput}/>,\r\n          )}\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          label={this.localeStore.get(lang().signIn.password)}\r\n          {...formItemLayout}\r\n        >\r\n          {getFieldDecorator(\"password\", {\r\n            rules: [{\r\n              required: true, message: \"密码不能为空\",\r\n            }],\r\n          })(\r\n            <Input type=\"password\" onChange={this.handlePasswordInput}/>,\r\n          )}\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          label={this.localeStore.get(lang().signIn.confirmPassword)}\r\n          {...formItemLayout}\r\n        >\r\n          {getFieldDecorator(\"passwordConfirm\", {\r\n            rules: [{\r\n              required: true, message: \"密码不能为空\",\r\n            }, {\r\n              validator: (rule, value, callback) => {\r\n                const form = this.props.form;\r\n                if (value && value !== form.getFieldValue(\"password\")) {\r\n                  callback(\"输入的密码不一致\");\r\n                } else {\r\n                  callback();\r\n                }\r\n              },\r\n            }],\r\n          })(\r\n            <Input type=\"password\"/>,\r\n          )}\r\n        </Form.Item>\r\n\r\n        <Form.Item {...tailFormItemLayout}>\r\n          {getFieldDecorator(\"agreement\", {\r\n            valuePropName: \"checked\",\r\n          })(\r\n            <Checkbox>{this.localeStore.get(lang().signIn.protocolPrompt)}\r\n              <Link to={\"/help/tos\"}>{this.localeStore.get(lang().signIn.protocol)}</Link></Checkbox>,\r\n          )}\r\n        </Form.Item>\r\n\r\n        <Form.Item {...buttonFormItemLayout}>\r\n          <Button loading={this.state.submitting} type=\"primary\" block={true}\r\n                  onClick={this.validateInput}>{this.localeStore.get(lang().signIn.register)}</Button>\r\n        </Form.Item>\r\n        {\r\n          this.state.validationModalVisible\r\n            ?  <EmailValidationModal userToken={this.state.token}\r\n                                     visible={this.state.validationModalVisible}\r\n                                     onClose={this.closeModal}\r\n                                     sendEmailDirectly={true}\r\n                                     showRememberCheck={true}\r\n            />\r\n            : null\r\n        }\r\n\r\n      </Form>\r\n\r\n    );\r\n  }\r\n}\r\n\r\nexport const RegisterForm = Form.create({})(RegisterFormDetail);\r\n"]}]}