{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\line\\animation\\clipIn-with-data.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\line\\animation\\clipIn-with-data.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { registerAnimation } from '../../../dependents';\r\nimport { clone, isFunction, isNil, deepMix } from '@antv/util';\r\nvar plotInfo;\r\nfunction clipingWithData(shape, animateCfg) {\r\n    var defaultCfg = {\r\n        easing: 'easeLinear',\r\n        duration: 10000,\r\n    };\r\n    var animationConfig = deepMix({}, animateCfg, defaultCfg);\r\n    var geometry = shape.get('element').geometry;\r\n    geometry.labelsContainer.set('visible', false);\r\n    var index = shape.get('index');\r\n    var coord = geometry.coordinate;\r\n    var scales = geometry.scales;\r\n    var yScale = scales[plotInfo.options.yField];\r\n    var shapeData = clone(shape.get('origin'));\r\n    setClip(shape, coord);\r\n    var clip = shape.get('clipShape');\r\n    var parent = shape.get('parent');\r\n    var offsetX = 12;\r\n    var title = null;\r\n    var seriesField = plotInfo.options.seriesField;\r\n    if (seriesField) {\r\n        title = parent.addShape('text', {\r\n            attrs: {\r\n                x: coord.start.x + offsetX,\r\n                y: 0,\r\n                text: shapeData.data[0][seriesField],\r\n                fill: shape.attr('stroke'),\r\n                fontSize: 12,\r\n                textAlign: 'start',\r\n                textBaseline: 'middle',\r\n            },\r\n        });\r\n    }\r\n    var offsetY = title ? 16 : 0;\r\n    var marker = parent.addShape('text', {\r\n        attrs: {\r\n            x: coord.start.x + offsetX,\r\n            y: offsetY,\r\n            text: \"test\" + index,\r\n            fill: shape.attr('stroke'),\r\n            fontSize: 12,\r\n            textAlign: 'start',\r\n            textBaseline: 'middle',\r\n        },\r\n    });\r\n    animationConfig.callback = function () {\r\n        if (shape && !shape.get('destroyed')) {\r\n            shape.setClip(null);\r\n            clip.remove();\r\n            marker.animate({\r\n                opacity: 0,\r\n            }, 300, function () {\r\n                marker.remove();\r\n                if (!isNil(title)) {\r\n                    title.remove();\r\n                }\r\n                var labelsContainer = geometry.labelsContainer;\r\n                if (!labelsContainer.get('visible')) {\r\n                    labelsContainer.set('visible', true);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    var delay = animationConfig.delay;\r\n    if (isFunction(delay)) {\r\n        delay = animationConfig.delay(index);\r\n    }\r\n    var easing = animationConfig.easing;\r\n    if (isFunction(easing)) {\r\n        easing = animationConfig.easing(index);\r\n    }\r\n    clip.animate({\r\n        width: coord.getWidth(),\r\n    }, animationConfig.duration, easing, animationConfig.callback, delay);\r\n    (animationConfig.onFrame = function (ratio) {\r\n        var position = getPositionByRatio(ratio, shapeData, coord);\r\n        if (!position)\r\n            return;\r\n        marker.attr('x', position[0] + offsetX);\r\n        marker.attr('y', position[1] + offsetY);\r\n        var yText = getDataByPosition(yScale, position[1], coord);\r\n        if (yScale.formatter) {\r\n            yText = yScale.formatter(yText);\r\n        }\r\n        marker.attr('text', yText);\r\n    }),\r\n        marker.animate(animationConfig.onFrame, {\r\n            duration: animationConfig.duration,\r\n            easing: easing,\r\n            callback: animationConfig.callback,\r\n            delay: delay,\r\n        });\r\n    if (title) {\r\n        title.animate({\r\n            onFrame: function (ratio) {\r\n                var position = getPositionByRatio(ratio, shapeData, coord);\r\n                if (!position)\r\n                    return;\r\n                title.attr('x', position[0] + offsetX);\r\n                title.attr('y', position[1]);\r\n            },\r\n        }, animationConfig.duration, easing, animationConfig.callback, delay);\r\n    }\r\n}\r\nfunction setClip(shape, coord) {\r\n    var start = coord.start, end = coord.end, height = coord.height;\r\n    shape.setClip({\r\n        type: 'rect',\r\n        attrs: {\r\n            x: start.x,\r\n            y: end.y,\r\n            width: 0,\r\n            height: height,\r\n        },\r\n    });\r\n}\r\nfunction getPositionByRatio(ratio, dataPoints, coord) {\r\n    var points = dataPoints.points;\r\n    var currentX = coord.start.x + coord.getWidth() * ratio;\r\n    for (var i = 0; i < points.length - 1; i++) {\r\n        var current = points[i];\r\n        var next = points[i + 1];\r\n        if (currentX >= current.x && currentX <= next.x) {\r\n            var m = (next.y - current.y) / (next.x - current.x);\r\n            var y = current.y + m * (currentX - current.x);\r\n            return [currentX, y];\r\n        }\r\n    }\r\n}\r\nfunction getDataByPosition(scale, y, coord) {\r\n    var yRatio = (y - coord.start.y) / (coord.end.y - coord.start.y);\r\n    return scale.invert(yRatio).toFixed(2);\r\n}\r\nexport function getPlotOption(option) {\r\n    plotInfo = option;\r\n}\r\nregisterAnimation('clipingWithData', clipingWithData);\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\line\\animation\\clipIn-with-data.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\line\\animation\\clipIn-with-data.js"],"names":[],"mappings":"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","sourcesContent":["import { registerAnimation } from '../../../dependents';\nimport { clone, isFunction, isNil, deepMix } from '@antv/util';\nvar plotInfo;\nfunction clipingWithData(shape, animateCfg) {\n    var defaultCfg = {\n        easing: 'easeLinear',\n        duration: 10000,\n    };\n    var animationConfig = deepMix({}, animateCfg, defaultCfg);\n    var geometry = shape.get('element').geometry;\n    geometry.labelsContainer.set('visible', false);\n    /** 动画初始状态 */\n    var index = shape.get('index');\n    var coord = geometry.coordinate;\n    var scales = geometry.scales;\n    var yScale = scales[plotInfo.options.yField];\n    var shapeData = clone(shape.get('origin'));\n    setClip(shape, coord);\n    var clip = shape.get('clipShape');\n    var parent = shape.get('parent');\n    var offsetX = 12;\n    var title = null;\n    var seriesField = plotInfo.options.seriesField;\n    if (seriesField) {\n        title = parent.addShape('text', {\n            attrs: {\n                x: coord.start.x + offsetX,\n                y: 0,\n                text: shapeData.data[0][seriesField],\n                fill: shape.attr('stroke'),\n                fontSize: 12,\n                textAlign: 'start',\n                textBaseline: 'middle',\n            },\n        });\n    }\n    var offsetY = title ? 16 : 0;\n    var marker = parent.addShape('text', {\n        attrs: {\n            x: coord.start.x + offsetX,\n            y: offsetY,\n            text: \"test\" + index,\n            fill: shape.attr('stroke'),\n            fontSize: 12,\n            textAlign: 'start',\n            textBaseline: 'middle',\n        },\n    });\n    /** 动画执行之后 */\n    animationConfig.callback = function () {\n        if (shape && !shape.get('destroyed')) {\n            shape.setClip(null);\n            clip.remove();\n            marker.animate({\n                opacity: 0,\n            }, 300, function () {\n                marker.remove();\n                if (!isNil(title)) {\n                    title.remove();\n                }\n                var labelsContainer = geometry.labelsContainer;\n                if (!labelsContainer.get('visible')) {\n                    labelsContainer.set('visible', true);\n                }\n            });\n        }\n    };\n    /** 执行动画 */\n    /** 准备动画参数 */\n    var delay = animationConfig.delay;\n    if (isFunction(delay)) {\n        delay = animationConfig.delay(index);\n    }\n    var easing = animationConfig.easing;\n    if (isFunction(easing)) {\n        easing = animationConfig.easing(index);\n    }\n    /** 动起来 */\n    clip.animate({\n        width: coord.getWidth(),\n    }, animationConfig.duration, easing, animationConfig.callback, delay);\n    (animationConfig.onFrame = function (ratio) {\n        var position = getPositionByRatio(ratio, shapeData, coord);\n        if (!position)\n            return;\n        marker.attr('x', position[0] + offsetX);\n        marker.attr('y', position[1] + offsetY);\n        var yText = getDataByPosition(yScale, position[1], coord);\n        // use formatter\n        if (yScale.formatter) {\n            yText = yScale.formatter(yText);\n        }\n        marker.attr('text', yText);\n    }),\n        marker.animate(animationConfig.onFrame, {\n            duration: animationConfig.duration,\n            easing: easing,\n            callback: animationConfig.callback,\n            delay: delay,\n        });\n    if (title) {\n        title.animate({\n            onFrame: function (ratio) {\n                var position = getPositionByRatio(ratio, shapeData, coord);\n                if (!position)\n                    return;\n                title.attr('x', position[0] + offsetX);\n                title.attr('y', position[1]);\n            },\n        }, animationConfig.duration, easing, animationConfig.callback, delay);\n    }\n}\nfunction setClip(shape, coord) {\n    var start = coord.start, end = coord.end, height = coord.height;\n    shape.setClip({\n        type: 'rect',\n        attrs: {\n            x: start.x,\n            y: end.y,\n            width: 0,\n            height: height,\n        },\n    });\n}\nfunction getPositionByRatio(ratio, dataPoints, coord) {\n    var points = dataPoints.points;\n    var currentX = coord.start.x + coord.getWidth() * ratio;\n    for (var i = 0; i < points.length - 1; i++) {\n        var current = points[i];\n        var next = points[i + 1];\n        if (currentX >= current.x && currentX <= next.x) {\n            var m = (next.y - current.y) / (next.x - current.x); // 斜率\n            var y = current.y + m * (currentX - current.x);\n            return [currentX, y];\n        }\n    }\n}\nfunction getDataByPosition(scale, y, coord) {\n    var yRatio = (y - coord.start.y) / (coord.end.y - coord.start.y);\n    return scale.invert(yRatio).toFixed(2);\n}\nexport function getPlotOption(option) {\n    plotInfo = option;\n}\nregisterAnimation('clipingWithData', clipingWithData);\n//# sourceMappingURL=clipIn-with-data.js.map"]}]}