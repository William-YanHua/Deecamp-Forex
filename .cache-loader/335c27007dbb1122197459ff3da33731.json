{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\data-set\\src\\transform\\proportion.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\data-set\\src\\transform\\proportion.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var assign = require('@antv/util/lib/mix');\r\nvar forIn = require('@antv/util/lib/each');\r\nvar isArray = require('@antv/util/lib/type/is-array');\r\nvar isString = require('@antv/util/lib/type/is-string');\r\nvar partition = require('../util/partition');\r\nvar registerTransform = require('../data-set').registerTransform;\r\nvar getField = require('../util/option-parser').getField;\r\nvar DEFAULT_OPTIONS = {\r\n    groupBy: [],\r\n    as: '_proportion'\r\n};\r\nfunction transform(dataView, options) {\r\n    if (options === void 0) { options = {}; }\r\n    options = assign({}, DEFAULT_OPTIONS, options);\r\n    var field = getField(options);\r\n    var dimension = options.dimension;\r\n    var groupBy = options.groupBy;\r\n    var as = options.as;\r\n    if (!isString(dimension)) {\r\n        throw new TypeError('Invalid dimension: must be a string!');\r\n    }\r\n    if (isArray(as)) {\r\n        console.warn('Invalid as: must be a string, will use the first element of the array specified.');\r\n        as = as[0];\r\n    }\r\n    if (!isString(as)) {\r\n        throw new TypeError('Invalid as: must be a string!');\r\n    }\r\n    var rows = dataView.rows;\r\n    var result = [];\r\n    var groups = partition(rows, groupBy);\r\n    forIn(groups, function (group) {\r\n        var totalCount = group.length;\r\n        var innerGroups = partition(group, [dimension]);\r\n        forIn(innerGroups, function (innerGroup) {\r\n            var innerCount = innerGroup.length;\r\n            var resultRow = innerGroup[0];\r\n            var dimensionValue = resultRow[dimension];\r\n            resultRow[field] = innerCount;\r\n            resultRow[dimension] = dimensionValue;\r\n            resultRow[as] = innerCount / totalCount;\r\n            result.push(resultRow);\r\n        });\r\n    });\r\n    dataView.rows = result;\r\n}\r\nregisterTransform('proportion', transform);\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\data-set\\src\\transform\\proportion.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\data-set\\src\\transform\\proportion.js"],"names":[],"mappings":"AAAA,IAAM,MAAM,GAAG,OAAO,CAAC,oBAAoB,CAAC,CAAC;AAC7C,IAAM,KAAK,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAC7C,IAAM,OAAO,GAAG,OAAO,CAAC,8BAA8B,CAAC,CAAC;AACxD,IAAM,QAAQ,GAAG,OAAO,CAAC,+BAA+B,CAAC,CAAC;AAC1D,IAAM,SAAS,GAAG,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAE7C,IAAA,4DAAiB,CACQ;AAEzB,IAAA,oDAAQ,CAC2B;AAErC,IAAM,eAAe,GAAG;IAGtB,OAAO,EAAE,EAAE;IACX,EAAE,EAAE,aAAa;CAClB,CAAC;AAEF,SAAS,SAAS,CAAC,QAAQ,EAAE,OAAY;IAAZ,wBAAA,EAAA,YAAY;IACvC,OAAO,GAAG,MAAM,CAAC,EAAE,EAAE,eAAe,EAAE,OAAO,CAAC,CAAC;IAC/C,IAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC;IAChC,IAAM,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;IACpC,IAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;IAChC,IAAI,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;IACpB,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE;QACxB,MAAM,IAAI,SAAS,CAAC,sCAAsC,CAAC,CAAC;KAC7D;IACD,IAAI,OAAO,CAAC,EAAE,CAAC,EAAE;QACf,OAAO,CAAC,IAAI,CAAC,kFAAkF,CAAC,CAAC;QACjG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;KACZ;IACD,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE;QACjB,MAAM,IAAI,SAAS,CAAC,+BAA+B,CAAC,CAAC;KACtD;IACD,IAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;IAC3B,IAAM,MAAM,GAAG,EAAE,CAAC;IAClB,IAAM,MAAM,GAAG,SAAS,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACxC,KAAK,CAAC,MAAM,EAAE,UAAA,KAAK;QACjB,IAAM,UAAU,GAAG,KAAK,CAAC,MAAM,CAAC;QAChC,IAAM,WAAW,GAAG,SAAS,CAAC,KAAK,EAAE,CAAE,SAAS,CAAE,CAAC,CAAC;QACpD,KAAK,CAAC,WAAW,EAAE,UAAA,UAAU;YAC3B,IAAM,UAAU,GAAG,UAAU,CAAC,MAAM,CAAC;YAErC,IAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;YAEhC,IAAM,cAAc,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;YAC5C,SAAS,CAAC,KAAK,CAAC,GAAG,UAAU,CAAC;YAC9B,SAAS,CAAC,SAAS,CAAC,GAAG,cAAc,CAAC;YACtC,SAAS,CAAC,EAAE,CAAC,GAAG,UAAU,GAAG,UAAU,CAAC;YACxC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACzB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IACH,QAAQ,CAAC,IAAI,GAAG,MAAM,CAAC;AACzB,CAAC;AAED,iBAAiB,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC","sourcesContent":["const assign = require('@antv/util/lib/mix');\nconst forIn = require('@antv/util/lib/each');\nconst isArray = require('@antv/util/lib/type/is-array');\nconst isString = require('@antv/util/lib/type/is-string');\nconst partition = require('../util/partition');\nconst {\n  registerTransform\n} = require('../data-set');\nconst {\n  getField\n} = require('../util/option-parser');\n\nconst DEFAULT_OPTIONS = {\n  // field: 'y', // required\n  // dimension: 'x', // required\n  groupBy: [], // optional\n  as: '_proportion'\n};\n\nfunction transform(dataView, options = {}) {\n  options = assign({}, DEFAULT_OPTIONS, options);\n  const field = getField(options);\n  const dimension = options.dimension;\n  const groupBy = options.groupBy;\n  let as = options.as;\n  if (!isString(dimension)) {\n    throw new TypeError('Invalid dimension: must be a string!');\n  }\n  if (isArray(as)) {\n    console.warn('Invalid as: must be a string, will use the first element of the array specified.');\n    as = as[0];\n  }\n  if (!isString(as)) {\n    throw new TypeError('Invalid as: must be a string!');\n  }\n  const rows = dataView.rows;\n  const result = [];\n  const groups = partition(rows, groupBy);\n  forIn(groups, group => {\n    const totalCount = group.length;\n    const innerGroups = partition(group, [ dimension ]);\n    forIn(innerGroups, innerGroup => {\n      const innerCount = innerGroup.length;\n      // const resultRow = pick(innerGroup[0], union(groupBy, [ dimension ]));\n      const resultRow = innerGroup[0];\n      // FIXME in case dimension and field is the same\n      const dimensionValue = resultRow[dimension];\n      resultRow[field] = innerCount;\n      resultRow[dimension] = dimensionValue;\n      resultRow[as] = innerCount / totalCount;\n      result.push(resultRow);\n    });\n  });\n  dataView.rows = result;\n}\n\nregisterTransform('proportion', transform);\n"]}]}