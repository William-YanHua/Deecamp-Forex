{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/fill-rows.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/fill-rows.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var assign = require('@antv/util/lib/mix');\nvar forIn = require('@antv/util/lib/each');\nvar partition = require('../util/partition');\nvar registerTransform = require('../data-set').registerTransform;\nvar DEFAULT_OPTIONS = {\n    fillBy: 'group',\n    groupBy: [],\n    orderBy: []\n};\nfunction arrayDifference(arr1, arr2) {\n    var shadow = arr1.map(function (item) { return item; });\n    arr2.forEach(function (item) {\n        var index = shadow.indexOf(item);\n        if (index > -1) {\n            shadow.splice(index, 1);\n        }\n    });\n    return shadow;\n}\nfunction transform(dataView, options) {\n    if (options === void 0) { options = {}; }\n    options = assign({}, DEFAULT_OPTIONS, options);\n    var rows = dataView.rows;\n    var groupBy = options.groupBy;\n    var orderBy = options.orderBy;\n    var groups = partition(rows, groupBy, orderBy);\n    var maxLength = 0;\n    var referenceGroup = [];\n    forIn(groups, function (group) {\n        if (group.length > maxLength) {\n            maxLength = group.length;\n            referenceGroup = group;\n        }\n    });\n    var referenceOrderByKeys = [];\n    var referenceRowByOrderByKey = {};\n    referenceGroup.forEach(function (row) {\n        var key = orderBy.map(function (col) { return row[col]; }).join('-');\n        referenceOrderByKeys.push(key);\n        referenceRowByOrderByKey[key] = row;\n    });\n    if (options.fillBy === 'order') {\n        var first_1 = referenceGroup[0];\n        var allOrderByKeys_1 = [];\n        var rowByOrderByKey_1 = {};\n        rows.forEach(function (row) {\n            var key = orderBy.map(function (col) { return row[col]; }).join('-');\n            if (allOrderByKeys_1.indexOf(key) === -1) {\n                allOrderByKeys_1.push(key);\n                rowByOrderByKey_1[key] = row;\n            }\n        });\n        var _missingOrderByKeys = arrayDifference(allOrderByKeys_1, referenceOrderByKeys);\n        _missingOrderByKeys.forEach(function (key) {\n            var row = {};\n            groupBy.forEach(function (col) {\n                row[col] = first_1[col];\n            });\n            orderBy.forEach(function (col) {\n                row[col] = rowByOrderByKey_1[key][col];\n            });\n            rows.push(row);\n            referenceGroup.push(row);\n            referenceOrderByKeys.push(key);\n            referenceRowByOrderByKey[key] = row;\n        });\n        maxLength = referenceGroup.length;\n    }\n    forIn(groups, function (group) {\n        if (group !== referenceGroup && group.length < maxLength) {\n            var first_2 = group[0];\n            var orderByKeys_1 = [];\n            group.forEach(function (row) {\n                orderByKeys_1.push(orderBy.map(function (col) { return row[col]; }).join('-'));\n            });\n            var missingOrderByKeys = arrayDifference(referenceOrderByKeys, orderByKeys_1);\n            missingOrderByKeys.some(function (key, i) {\n                if (i >= (maxLength - group.length)) {\n                    return true;\n                }\n                var referenceRow = referenceRowByOrderByKey[key];\n                var row = {};\n                groupBy.forEach(function (col) {\n                    row[col] = first_2[col];\n                });\n                orderBy.forEach(function (col) {\n                    row[col] = referenceRow[col];\n                });\n                rows.push(row);\n                return false;\n            });\n        }\n    });\n}\nregisterTransform('fill-rows', transform);\nregisterTransform('fillRows', transform);\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/fill-rows.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/fill-rows.js"],"names":[],"mappings":"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","sourcesContent":["const assign = require('@antv/util/lib/mix');\nconst forIn = require('@antv/util/lib/each');\nconst partition = require('../util/partition');\nconst {\n  registerTransform\n} = require('../data-set');\n\nconst DEFAULT_OPTIONS = {\n  fillBy: 'group', // group | order\n  groupBy: [],\n  orderBy: []\n};\n\nfunction arrayDifference(arr1, arr2) {\n  // arrayDifference([1, 1, 1, 2], [1, 2]) => [1, 1]\n  const shadow = arr1.map(item => item); // shadow copy\n  arr2.forEach(item => {\n    const index = shadow.indexOf(item);\n    if (index > -1) {\n      shadow.splice(index, 1);\n    }\n  });\n  return shadow;\n}\n\nfunction transform(dataView, options = {}) {\n  options = assign({}, DEFAULT_OPTIONS, options);\n  const rows = dataView.rows;\n  const groupBy = options.groupBy;\n  const orderBy = options.orderBy;\n  const groups = partition(rows, groupBy, orderBy);\n  let maxLength = 0;\n  let referenceGroup = [];\n  forIn(groups, group => {\n    if (group.length > maxLength) {\n      maxLength = group.length;\n      referenceGroup = group;\n    }\n  });\n  const referenceOrderByKeys = [];\n  const referenceRowByOrderByKey = {};\n  referenceGroup.forEach(row => {\n    const key = orderBy.map(col => row[col]).join('-');\n    referenceOrderByKeys.push(key);\n    referenceRowByOrderByKey[key] = row;\n  });\n  if (options.fillBy === 'order') {\n    const first = referenceGroup[0];\n    const allOrderByKeys = [];\n    const rowByOrderByKey = {};\n    rows.forEach(row => {\n      const key = orderBy.map(col => row[col]).join('-');\n      if (allOrderByKeys.indexOf(key) === -1) {\n        allOrderByKeys.push(key);\n        rowByOrderByKey[key] = row;\n      }\n    });\n    const _missingOrderByKeys = arrayDifference(allOrderByKeys, referenceOrderByKeys);\n    _missingOrderByKeys.forEach(key => {\n      const row = {};\n      groupBy.forEach(col => {\n        row[col] = first[col];\n      });\n      orderBy.forEach(col => {\n        row[col] = rowByOrderByKey[key][col];\n      });\n      rows.push(row);\n      referenceGroup.push(row);\n      referenceOrderByKeys.push(key);\n      referenceRowByOrderByKey[key] = row;\n    });\n    maxLength = referenceGroup.length;\n  }\n  forIn(groups, group => {\n    if (group !== referenceGroup && group.length < maxLength) {\n      const first = group[0];\n      // missing orderBy keys\n      const orderByKeys = [];\n      group.forEach(row => {\n        orderByKeys.push(orderBy.map(col => row[col]).join('-'));\n      });\n      const missingOrderByKeys = arrayDifference(referenceOrderByKeys, orderByKeys);\n      missingOrderByKeys.some((key, i) => {\n        if (i >= (maxLength - group.length)) { // group length overflow\n          return true;\n        }\n        const referenceRow = referenceRowByOrderByKey[key];\n        const row = {};\n        groupBy.forEach(col => {\n          row[col] = first[col];\n        });\n        orderBy.forEach(col => {\n          row[col] = referenceRow[col];\n        });\n        rows.push(row);\n        return false;\n      });\n    }\n  });\n}\n\nregisterTransform('fill-rows', transform);\nregisterTransform('fillRows', transform);\n"]}]}