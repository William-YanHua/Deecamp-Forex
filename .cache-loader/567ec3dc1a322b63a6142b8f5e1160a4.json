{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\dagre\\lib\\layout.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\dagre\\lib\\layout.js","mtime":1517934108000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["\"use strict\";\r\nvar _ = require(\"./lodash\"), acyclic = require(\"./acyclic\"), normalize = require(\"./normalize\"), rank = require(\"./rank\"), normalizeRanks = require(\"./util\").normalizeRanks, parentDummyChains = require(\"./parent-dummy-chains\"), removeEmptyRanks = require(\"./util\").removeEmptyRanks, nestingGraph = require(\"./nesting-graph\"), addBorderSegments = require(\"./add-border-segments\"), coordinateSystem = require(\"./coordinate-system\"), order = require(\"./order\"), position = require(\"./position\"), util = require(\"./util\"), Graph = require(\"./graphlib\").Graph;\r\nmodule.exports = layout;\r\nfunction layout(g, opts) {\r\n    var time = opts && opts.debugTiming ? util.time : util.notime;\r\n    time(\"layout\", function () {\r\n        var layoutGraph = time(\"  buildLayoutGraph\", function () { return buildLayoutGraph(g); });\r\n        time(\"  runLayout\", function () { runLayout(layoutGraph, time); });\r\n        time(\"  updateInputGraph\", function () { updateInputGraph(g, layoutGraph); });\r\n    });\r\n}\r\nfunction runLayout(g, time) {\r\n    time(\"    makeSpaceForEdgeLabels\", function () { makeSpaceForEdgeLabels(g); });\r\n    time(\"    removeSelfEdges\", function () { removeSelfEdges(g); });\r\n    time(\"    acyclic\", function () { acyclic.run(g); });\r\n    time(\"    nestingGraph.run\", function () { nestingGraph.run(g); });\r\n    time(\"    rank\", function () { rank(util.asNonCompoundGraph(g)); });\r\n    time(\"    injectEdgeLabelProxies\", function () { injectEdgeLabelProxies(g); });\r\n    time(\"    removeEmptyRanks\", function () { removeEmptyRanks(g); });\r\n    time(\"    nestingGraph.cleanup\", function () { nestingGraph.cleanup(g); });\r\n    time(\"    normalizeRanks\", function () { normalizeRanks(g); });\r\n    time(\"    assignRankMinMax\", function () { assignRankMinMax(g); });\r\n    time(\"    removeEdgeLabelProxies\", function () { removeEdgeLabelProxies(g); });\r\n    time(\"    normalize.run\", function () { normalize.run(g); });\r\n    time(\"    parentDummyChains\", function () { parentDummyChains(g); });\r\n    time(\"    addBorderSegments\", function () { addBorderSegments(g); });\r\n    time(\"    order\", function () { order(g); });\r\n    time(\"    insertSelfEdges\", function () { insertSelfEdges(g); });\r\n    time(\"    adjustCoordinateSystem\", function () { coordinateSystem.adjust(g); });\r\n    time(\"    position\", function () { position(g); });\r\n    time(\"    positionSelfEdges\", function () { positionSelfEdges(g); });\r\n    time(\"    removeBorderNodes\", function () { removeBorderNodes(g); });\r\n    time(\"    normalize.undo\", function () { normalize.undo(g); });\r\n    time(\"    fixupEdgeLabelCoords\", function () { fixupEdgeLabelCoords(g); });\r\n    time(\"    undoCoordinateSystem\", function () { coordinateSystem.undo(g); });\r\n    time(\"    translateGraph\", function () { translateGraph(g); });\r\n    time(\"    assignNodeIntersects\", function () { assignNodeIntersects(g); });\r\n    time(\"    reversePoints\", function () { reversePointsForReversedEdges(g); });\r\n    time(\"    acyclic.undo\", function () { acyclic.undo(g); });\r\n}\r\nfunction updateInputGraph(inputGraph, layoutGraph) {\r\n    _.forEach(inputGraph.nodes(), function (v) {\r\n        var inputLabel = inputGraph.node(v), layoutLabel = layoutGraph.node(v);\r\n        if (inputLabel) {\r\n            inputLabel.x = layoutLabel.x;\r\n            inputLabel.y = layoutLabel.y;\r\n            if (layoutGraph.children(v).length) {\r\n                inputLabel.width = layoutLabel.width;\r\n                inputLabel.height = layoutLabel.height;\r\n            }\r\n        }\r\n    });\r\n    _.forEach(inputGraph.edges(), function (e) {\r\n        var inputLabel = inputGraph.edge(e), layoutLabel = layoutGraph.edge(e);\r\n        inputLabel.points = layoutLabel.points;\r\n        if (_.has(layoutLabel, \"x\")) {\r\n            inputLabel.x = layoutLabel.x;\r\n            inputLabel.y = layoutLabel.y;\r\n        }\r\n    });\r\n    inputGraph.graph().width = layoutGraph.graph().width;\r\n    inputGraph.graph().height = layoutGraph.graph().height;\r\n}\r\nvar graphNumAttrs = [\"nodesep\", \"edgesep\", \"ranksep\", \"marginx\", \"marginy\"], graphDefaults = { ranksep: 50, edgesep: 20, nodesep: 50, rankdir: \"tb\" }, graphAttrs = [\"acyclicer\", \"ranker\", \"rankdir\", \"align\"], nodeNumAttrs = [\"width\", \"height\"], nodeDefaults = { width: 0, height: 0 }, edgeNumAttrs = [\"minlen\", \"weight\", \"width\", \"height\", \"labeloffset\"], edgeDefaults = {\r\n    minlen: 1, weight: 1, width: 0, height: 0,\r\n    labeloffset: 10, labelpos: \"r\"\r\n}, edgeAttrs = [\"labelpos\"];\r\nfunction buildLayoutGraph(inputGraph) {\r\n    var g = new Graph({ multigraph: true, compound: true }), graph = canonicalize(inputGraph.graph());\r\n    g.setGraph(_.merge({}, graphDefaults, selectNumberAttrs(graph, graphNumAttrs), _.pick(graph, graphAttrs)));\r\n    _.forEach(inputGraph.nodes(), function (v) {\r\n        var node = canonicalize(inputGraph.node(v));\r\n        g.setNode(v, _.defaults(selectNumberAttrs(node, nodeNumAttrs), nodeDefaults));\r\n        g.setParent(v, inputGraph.parent(v));\r\n    });\r\n    _.forEach(inputGraph.edges(), function (e) {\r\n        var edge = canonicalize(inputGraph.edge(e));\r\n        g.setEdge(e, _.merge({}, edgeDefaults, selectNumberAttrs(edge, edgeNumAttrs), _.pick(edge, edgeAttrs)));\r\n    });\r\n    return g;\r\n}\r\nfunction makeSpaceForEdgeLabels(g) {\r\n    var graph = g.graph();\r\n    graph.ranksep /= 2;\r\n    _.forEach(g.edges(), function (e) {\r\n        var edge = g.edge(e);\r\n        edge.minlen *= 2;\r\n        if (edge.labelpos.toLowerCase() !== \"c\") {\r\n            if (graph.rankdir === \"TB\" || graph.rankdir === \"BT\") {\r\n                edge.width += edge.labeloffset;\r\n            }\r\n            else {\r\n                edge.height += edge.labeloffset;\r\n            }\r\n        }\r\n    });\r\n}\r\nfunction injectEdgeLabelProxies(g) {\r\n    _.forEach(g.edges(), function (e) {\r\n        var edge = g.edge(e);\r\n        if (edge.width && edge.height) {\r\n            var v = g.node(e.v), w = g.node(e.w), label = { rank: (w.rank - v.rank) / 2 + v.rank, e: e };\r\n            util.addDummyNode(g, \"edge-proxy\", label, \"_ep\");\r\n        }\r\n    });\r\n}\r\nfunction assignRankMinMax(g) {\r\n    var maxRank = 0;\r\n    _.forEach(g.nodes(), function (v) {\r\n        var node = g.node(v);\r\n        if (node.borderTop) {\r\n            node.minRank = g.node(node.borderTop).rank;\r\n            node.maxRank = g.node(node.borderBottom).rank;\r\n            maxRank = _.max(maxRank, node.maxRank);\r\n        }\r\n    });\r\n    g.graph().maxRank = maxRank;\r\n}\r\nfunction removeEdgeLabelProxies(g) {\r\n    _.forEach(g.nodes(), function (v) {\r\n        var node = g.node(v);\r\n        if (node.dummy === \"edge-proxy\") {\r\n            g.edge(node.e).labelRank = node.rank;\r\n            g.removeNode(v);\r\n        }\r\n    });\r\n}\r\nfunction translateGraph(g) {\r\n    var minX = Number.POSITIVE_INFINITY, maxX = 0, minY = Number.POSITIVE_INFINITY, maxY = 0, graphLabel = g.graph(), marginX = graphLabel.marginx || 0, marginY = graphLabel.marginy || 0;\r\n    function getExtremes(attrs) {\r\n        var x = attrs.x, y = attrs.y, w = attrs.width, h = attrs.height;\r\n        minX = Math.min(minX, x - w / 2);\r\n        maxX = Math.max(maxX, x + w / 2);\r\n        minY = Math.min(minY, y - h / 2);\r\n        maxY = Math.max(maxY, y + h / 2);\r\n    }\r\n    _.forEach(g.nodes(), function (v) { getExtremes(g.node(v)); });\r\n    _.forEach(g.edges(), function (e) {\r\n        var edge = g.edge(e);\r\n        if (_.has(edge, \"x\")) {\r\n            getExtremes(edge);\r\n        }\r\n    });\r\n    minX -= marginX;\r\n    minY -= marginY;\r\n    _.forEach(g.nodes(), function (v) {\r\n        var node = g.node(v);\r\n        node.x -= minX;\r\n        node.y -= minY;\r\n    });\r\n    _.forEach(g.edges(), function (e) {\r\n        var edge = g.edge(e);\r\n        _.forEach(edge.points, function (p) {\r\n            p.x -= minX;\r\n            p.y -= minY;\r\n        });\r\n        if (_.has(edge, \"x\")) {\r\n            edge.x -= minX;\r\n        }\r\n        if (_.has(edge, \"y\")) {\r\n            edge.y -= minY;\r\n        }\r\n    });\r\n    graphLabel.width = maxX - minX + marginX;\r\n    graphLabel.height = maxY - minY + marginY;\r\n}\r\nfunction assignNodeIntersects(g) {\r\n    _.forEach(g.edges(), function (e) {\r\n        var edge = g.edge(e), nodeV = g.node(e.v), nodeW = g.node(e.w), p1, p2;\r\n        if (!edge.points) {\r\n            edge.points = [];\r\n            p1 = nodeW;\r\n            p2 = nodeV;\r\n        }\r\n        else {\r\n            p1 = edge.points[0];\r\n            p2 = edge.points[edge.points.length - 1];\r\n        }\r\n        edge.points.unshift(util.intersectRect(nodeV, p1));\r\n        edge.points.push(util.intersectRect(nodeW, p2));\r\n    });\r\n}\r\nfunction fixupEdgeLabelCoords(g) {\r\n    _.forEach(g.edges(), function (e) {\r\n        var edge = g.edge(e);\r\n        if (_.has(edge, \"x\")) {\r\n            if (edge.labelpos === \"l\" || edge.labelpos === \"r\") {\r\n                edge.width -= edge.labeloffset;\r\n            }\r\n            switch (edge.labelpos) {\r\n                case \"l\":\r\n                    edge.x -= edge.width / 2 + edge.labeloffset;\r\n                    break;\r\n                case \"r\":\r\n                    edge.x += edge.width / 2 + edge.labeloffset;\r\n                    break;\r\n            }\r\n        }\r\n    });\r\n}\r\nfunction reversePointsForReversedEdges(g) {\r\n    _.forEach(g.edges(), function (e) {\r\n        var edge = g.edge(e);\r\n        if (edge.reversed) {\r\n            edge.points.reverse();\r\n        }\r\n    });\r\n}\r\nfunction removeBorderNodes(g) {\r\n    _.forEach(g.nodes(), function (v) {\r\n        if (g.children(v).length) {\r\n            var node = g.node(v), t = g.node(node.borderTop), b = g.node(node.borderBottom), l = g.node(_.last(node.borderLeft)), r = g.node(_.last(node.borderRight));\r\n            node.width = Math.abs(r.x - l.x);\r\n            node.height = Math.abs(b.y - t.y);\r\n            node.x = l.x + node.width / 2;\r\n            node.y = t.y + node.height / 2;\r\n        }\r\n    });\r\n    _.forEach(g.nodes(), function (v) {\r\n        if (g.node(v).dummy === \"border\") {\r\n            g.removeNode(v);\r\n        }\r\n    });\r\n}\r\nfunction removeSelfEdges(g) {\r\n    _.forEach(g.edges(), function (e) {\r\n        if (e.v === e.w) {\r\n            var node = g.node(e.v);\r\n            if (!node.selfEdges) {\r\n                node.selfEdges = [];\r\n            }\r\n            node.selfEdges.push({ e: e, label: g.edge(e) });\r\n            g.removeEdge(e);\r\n        }\r\n    });\r\n}\r\nfunction insertSelfEdges(g) {\r\n    var layers = util.buildLayerMatrix(g);\r\n    _.forEach(layers, function (layer) {\r\n        var orderShift = 0;\r\n        _.forEach(layer, function (v, i) {\r\n            var node = g.node(v);\r\n            node.order = i + orderShift;\r\n            _.forEach(node.selfEdges, function (selfEdge) {\r\n                util.addDummyNode(g, \"selfedge\", {\r\n                    width: selfEdge.label.width,\r\n                    height: selfEdge.label.height,\r\n                    rank: node.rank,\r\n                    order: i + (++orderShift),\r\n                    e: selfEdge.e,\r\n                    label: selfEdge.label\r\n                }, \"_se\");\r\n            });\r\n            delete node.selfEdges;\r\n        });\r\n    });\r\n}\r\nfunction positionSelfEdges(g) {\r\n    _.forEach(g.nodes(), function (v) {\r\n        var node = g.node(v);\r\n        if (node.dummy === \"selfedge\") {\r\n            var selfNode = g.node(node.e.v), x = selfNode.x + selfNode.width / 2, y = selfNode.y, dx = node.x - x, dy = selfNode.height / 2;\r\n            g.setEdge(node.e, node.label);\r\n            g.removeNode(v);\r\n            node.label.points = [\r\n                { x: x + 2 * dx / 3, y: y - dy },\r\n                { x: x + 5 * dx / 6, y: y - dy },\r\n                { x: x + dx, y: y },\r\n                { x: x + 5 * dx / 6, y: y + dy },\r\n                { x: x + 2 * dx / 3, y: y + dy }\r\n            ];\r\n            node.label.x = node.x;\r\n            node.label.y = node.y;\r\n        }\r\n    });\r\n}\r\nfunction selectNumberAttrs(obj, attrs) {\r\n    return _.mapValues(_.pick(obj, attrs), Number);\r\n}\r\nfunction canonicalize(attrs) {\r\n    var newAttrs = {};\r\n    _.forEach(attrs, function (v, k) {\r\n        newAttrs[k.toLowerCase()] = v;\r\n    });\r\n    return newAttrs;\r\n}\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\dagre\\lib\\layout.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\dagre\\lib\\layout.js"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _ = require(\"./lodash\"),\n    acyclic = require(\"./acyclic\"),\n    normalize = require(\"./normalize\"),\n    rank = require(\"./rank\"),\n    normalizeRanks = require(\"./util\").normalizeRanks,\n    parentDummyChains = require(\"./parent-dummy-chains\"),\n    removeEmptyRanks = require(\"./util\").removeEmptyRanks,\n    nestingGraph = require(\"./nesting-graph\"),\n    addBorderSegments = require(\"./add-border-segments\"),\n    coordinateSystem = require(\"./coordinate-system\"),\n    order = require(\"./order\"),\n    position = require(\"./position\"),\n    util = require(\"./util\"),\n    Graph = require(\"./graphlib\").Graph;\n\nmodule.exports = layout;\n\nfunction layout(g, opts) {\n  var time = opts && opts.debugTiming ? util.time : util.notime;\n  time(\"layout\", function() {\n    var layoutGraph = time(\"  buildLayoutGraph\",\n                               function() { return buildLayoutGraph(g); });\n    time(\"  runLayout\",        function() { runLayout(layoutGraph, time); });\n    time(\"  updateInputGraph\", function() { updateInputGraph(g, layoutGraph); });\n  });\n}\n\nfunction runLayout(g, time) {\n  time(\"    makeSpaceForEdgeLabels\", function() { makeSpaceForEdgeLabels(g); });\n  time(\"    removeSelfEdges\",        function() { removeSelfEdges(g); });\n  time(\"    acyclic\",                function() { acyclic.run(g); });\n  time(\"    nestingGraph.run\",       function() { nestingGraph.run(g); });\n  time(\"    rank\",                   function() { rank(util.asNonCompoundGraph(g)); });\n  time(\"    injectEdgeLabelProxies\", function() { injectEdgeLabelProxies(g); });\n  time(\"    removeEmptyRanks\",       function() { removeEmptyRanks(g); });\n  time(\"    nestingGraph.cleanup\",   function() { nestingGraph.cleanup(g); });\n  time(\"    normalizeRanks\",         function() { normalizeRanks(g); });\n  time(\"    assignRankMinMax\",       function() { assignRankMinMax(g); });\n  time(\"    removeEdgeLabelProxies\", function() { removeEdgeLabelProxies(g); });\n  time(\"    normalize.run\",          function() { normalize.run(g); });\n  time(\"    parentDummyChains\",      function() { parentDummyChains(g); });\n  time(\"    addBorderSegments\",      function() { addBorderSegments(g); });\n  time(\"    order\",                  function() { order(g); });\n  time(\"    insertSelfEdges\",        function() { insertSelfEdges(g); });\n  time(\"    adjustCoordinateSystem\", function() { coordinateSystem.adjust(g); });\n  time(\"    position\",               function() { position(g); });\n  time(\"    positionSelfEdges\",      function() { positionSelfEdges(g); });\n  time(\"    removeBorderNodes\",      function() { removeBorderNodes(g); });\n  time(\"    normalize.undo\",         function() { normalize.undo(g); });\n  time(\"    fixupEdgeLabelCoords\",   function() { fixupEdgeLabelCoords(g); });\n  time(\"    undoCoordinateSystem\",   function() { coordinateSystem.undo(g); });\n  time(\"    translateGraph\",         function() { translateGraph(g); });\n  time(\"    assignNodeIntersects\",   function() { assignNodeIntersects(g); });\n  time(\"    reversePoints\",          function() { reversePointsForReversedEdges(g); });\n  time(\"    acyclic.undo\",           function() { acyclic.undo(g); });\n}\n\n/*\n * Copies final layout information from the layout graph back to the input\n * graph. This process only copies whitelisted attributes from the layout graph\n * to the input graph, so it serves as a good place to determine what\n * attributes can influence layout.\n */\nfunction updateInputGraph(inputGraph, layoutGraph) {\n  _.forEach(inputGraph.nodes(), function(v) {\n    var inputLabel = inputGraph.node(v),\n        layoutLabel = layoutGraph.node(v);\n\n    if (inputLabel) {\n      inputLabel.x = layoutLabel.x;\n      inputLabel.y = layoutLabel.y;\n\n      if (layoutGraph.children(v).length) {\n        inputLabel.width = layoutLabel.width;\n        inputLabel.height = layoutLabel.height;\n      }\n    }\n  });\n\n  _.forEach(inputGraph.edges(), function(e) {\n    var inputLabel = inputGraph.edge(e),\n        layoutLabel = layoutGraph.edge(e);\n\n    inputLabel.points = layoutLabel.points;\n    if (_.has(layoutLabel, \"x\")) {\n      inputLabel.x = layoutLabel.x;\n      inputLabel.y = layoutLabel.y;\n    }\n  });\n\n  inputGraph.graph().width = layoutGraph.graph().width;\n  inputGraph.graph().height = layoutGraph.graph().height;\n}\n\nvar graphNumAttrs = [\"nodesep\", \"edgesep\", \"ranksep\", \"marginx\", \"marginy\"],\n    graphDefaults = { ranksep: 50, edgesep: 20, nodesep: 50, rankdir: \"tb\" },\n    graphAttrs = [\"acyclicer\", \"ranker\", \"rankdir\", \"align\"],\n    nodeNumAttrs = [\"width\", \"height\"],\n    nodeDefaults = { width: 0, height: 0 },\n    edgeNumAttrs = [\"minlen\", \"weight\", \"width\", \"height\", \"labeloffset\"],\n    edgeDefaults = {\n      minlen: 1, weight: 1, width: 0, height: 0,\n      labeloffset: 10, labelpos: \"r\"\n    },\n    edgeAttrs = [\"labelpos\"];\n\n/*\n * Constructs a new graph from the input graph, which can be used for layout.\n * This process copies only whitelisted attributes from the input graph to the\n * layout graph. Thus this function serves as a good place to determine what\n * attributes can influence layout.\n */\nfunction buildLayoutGraph(inputGraph) {\n  var g = new Graph({ multigraph: true, compound: true }),\n      graph = canonicalize(inputGraph.graph());\n\n  g.setGraph(_.merge({},\n    graphDefaults,\n    selectNumberAttrs(graph, graphNumAttrs),\n    _.pick(graph, graphAttrs)));\n\n  _.forEach(inputGraph.nodes(), function(v) {\n    var node = canonicalize(inputGraph.node(v));\n    g.setNode(v, _.defaults(selectNumberAttrs(node, nodeNumAttrs), nodeDefaults));\n    g.setParent(v, inputGraph.parent(v));\n  });\n\n  _.forEach(inputGraph.edges(), function(e) {\n    var edge = canonicalize(inputGraph.edge(e));\n    g.setEdge(e, _.merge({},\n      edgeDefaults,\n      selectNumberAttrs(edge, edgeNumAttrs),\n      _.pick(edge, edgeAttrs)));\n  });\n\n  return g;\n}\n\n/*\n * This idea comes from the Gansner paper: to account for edge labels in our\n * layout we split each rank in half by doubling minlen and halving ranksep.\n * Then we can place labels at these mid-points between nodes.\n *\n * We also add some minimal padding to the width to push the label for the edge\n * away from the edge itself a bit.\n */\nfunction makeSpaceForEdgeLabels(g) {\n  var graph = g.graph();\n  graph.ranksep /= 2;\n  _.forEach(g.edges(), function(e) {\n    var edge = g.edge(e);\n    edge.minlen *= 2;\n    if (edge.labelpos.toLowerCase() !== \"c\") {\n      if (graph.rankdir === \"TB\" || graph.rankdir === \"BT\") {\n        edge.width += edge.labeloffset;\n      } else {\n        edge.height += edge.labeloffset;\n      }\n    }\n  });\n}\n\n/*\n * Creates temporary dummy nodes that capture the rank in which each edge's\n * label is going to, if it has one of non-zero width and height. We do this\n * so that we can safely remove empty ranks while preserving balance for the\n * label's position.\n */\nfunction injectEdgeLabelProxies(g) {\n  _.forEach(g.edges(), function(e) {\n    var edge = g.edge(e);\n    if (edge.width && edge.height) {\n      var v = g.node(e.v),\n          w = g.node(e.w),\n          label = { rank: (w.rank - v.rank) / 2 + v.rank, e: e };\n      util.addDummyNode(g, \"edge-proxy\", label, \"_ep\");\n    }\n  });\n}\n\nfunction assignRankMinMax(g) {\n  var maxRank = 0;\n  _.forEach(g.nodes(), function(v) {\n    var node = g.node(v);\n    if (node.borderTop) {\n      node.minRank = g.node(node.borderTop).rank;\n      node.maxRank = g.node(node.borderBottom).rank;\n      maxRank = _.max(maxRank, node.maxRank);\n    }\n  });\n  g.graph().maxRank = maxRank;\n}\n\nfunction removeEdgeLabelProxies(g) {\n  _.forEach(g.nodes(), function(v) {\n    var node = g.node(v);\n    if (node.dummy === \"edge-proxy\") {\n      g.edge(node.e).labelRank = node.rank;\n      g.removeNode(v);\n    }\n  });\n}\n\nfunction translateGraph(g) {\n  var minX = Number.POSITIVE_INFINITY,\n      maxX = 0,\n      minY = Number.POSITIVE_INFINITY,\n      maxY = 0,\n      graphLabel = g.graph(),\n      marginX = graphLabel.marginx || 0,\n      marginY = graphLabel.marginy || 0;\n\n  function getExtremes(attrs) {\n    var x = attrs.x,\n        y = attrs.y,\n        w = attrs.width,\n        h = attrs.height;\n    minX = Math.min(minX, x - w / 2);\n    maxX = Math.max(maxX, x + w / 2);\n    minY = Math.min(minY, y - h / 2);\n    maxY = Math.max(maxY, y + h / 2);\n  }\n\n  _.forEach(g.nodes(), function(v) { getExtremes(g.node(v)); });\n  _.forEach(g.edges(), function(e) {\n    var edge = g.edge(e);\n    if (_.has(edge, \"x\")) {\n      getExtremes(edge);\n    }\n  });\n\n  minX -= marginX;\n  minY -= marginY;\n\n  _.forEach(g.nodes(), function(v) {\n    var node = g.node(v);\n    node.x -= minX;\n    node.y -= minY;\n  });\n\n  _.forEach(g.edges(), function(e) {\n    var edge = g.edge(e);\n    _.forEach(edge.points, function(p) {\n      p.x -= minX;\n      p.y -= minY;\n    });\n    if (_.has(edge, \"x\")) { edge.x -= minX; }\n    if (_.has(edge, \"y\")) { edge.y -= minY; }\n  });\n\n  graphLabel.width = maxX - minX + marginX;\n  graphLabel.height = maxY - minY + marginY;\n}\n\nfunction assignNodeIntersects(g) {\n  _.forEach(g.edges(), function(e) {\n    var edge = g.edge(e),\n        nodeV = g.node(e.v),\n        nodeW = g.node(e.w),\n        p1, p2;\n    if (!edge.points) {\n      edge.points = [];\n      p1 = nodeW;\n      p2 = nodeV;\n    } else {\n      p1 = edge.points[0];\n      p2 = edge.points[edge.points.length - 1];\n    }\n    edge.points.unshift(util.intersectRect(nodeV, p1));\n    edge.points.push(util.intersectRect(nodeW, p2));\n  });\n}\n\nfunction fixupEdgeLabelCoords(g) {\n  _.forEach(g.edges(), function(e) {\n    var edge = g.edge(e);\n    if (_.has(edge, \"x\")) {\n      if (edge.labelpos === \"l\" || edge.labelpos === \"r\") {\n        edge.width -= edge.labeloffset;\n      }\n      switch (edge.labelpos) {\n        case \"l\": edge.x -= edge.width / 2 + edge.labeloffset; break;\n        case \"r\": edge.x += edge.width / 2 + edge.labeloffset; break;\n      }\n    }\n  });\n}\n\nfunction reversePointsForReversedEdges(g) {\n  _.forEach(g.edges(), function(e) {\n    var edge = g.edge(e);\n    if (edge.reversed) {\n      edge.points.reverse();\n    }\n  });\n}\n\nfunction removeBorderNodes(g) {\n  _.forEach(g.nodes(), function(v) {\n    if (g.children(v).length) {\n      var node = g.node(v),\n          t = g.node(node.borderTop),\n          b = g.node(node.borderBottom),\n          l = g.node(_.last(node.borderLeft)),\n          r = g.node(_.last(node.borderRight));\n\n      node.width = Math.abs(r.x - l.x);\n      node.height = Math.abs(b.y - t.y);\n      node.x = l.x + node.width / 2;\n      node.y = t.y + node.height / 2;\n    }\n  });\n\n  _.forEach(g.nodes(), function(v) {\n    if (g.node(v).dummy === \"border\") {\n      g.removeNode(v);\n    }\n  });\n}\n\nfunction removeSelfEdges(g) {\n  _.forEach(g.edges(), function(e) {\n    if (e.v === e.w) {\n      var node = g.node(e.v);\n      if (!node.selfEdges) {\n        node.selfEdges = [];\n      }\n      node.selfEdges.push({ e: e, label: g.edge(e) });\n      g.removeEdge(e);\n    }\n  });\n}\n\nfunction insertSelfEdges(g) {\n  var layers = util.buildLayerMatrix(g);\n  _.forEach(layers, function(layer) {\n    var orderShift = 0;\n    _.forEach(layer, function(v, i) {\n      var node = g.node(v);\n      node.order = i + orderShift;\n      _.forEach(node.selfEdges, function(selfEdge) {\n        util.addDummyNode(g, \"selfedge\", {\n          width: selfEdge.label.width,\n          height: selfEdge.label.height,\n          rank: node.rank,\n          order: i + (++orderShift),\n          e: selfEdge.e,\n          label: selfEdge.label\n        }, \"_se\");\n      });\n      delete node.selfEdges;\n    });\n  });\n}\n\nfunction positionSelfEdges(g) {\n  _.forEach(g.nodes(), function(v) {\n    var node = g.node(v);\n    if (node.dummy === \"selfedge\") {\n      var selfNode = g.node(node.e.v),\n          x = selfNode.x + selfNode.width / 2,\n          y = selfNode.y,\n          dx = node.x - x,\n          dy = selfNode.height / 2;\n      g.setEdge(node.e, node.label);\n      g.removeNode(v);\n      node.label.points = [\n        { x: x + 2 * dx / 3, y: y - dy },\n        { x: x + 5 * dx / 6, y: y - dy },\n        { x: x +     dx    , y: y },\n        { x: x + 5 * dx / 6, y: y + dy },\n        { x: x + 2 * dx / 3, y: y + dy }\n      ];\n      node.label.x = node.x;\n      node.label.y = node.y;\n    }\n  });\n}\n\nfunction selectNumberAttrs(obj, attrs) {\n  return _.mapValues(_.pick(obj, attrs), Number);\n}\n\nfunction canonicalize(attrs) {\n  var newAttrs = {};\n  _.forEach(attrs, function(v, k) {\n    newAttrs[k.toLowerCase()] = v;\n  });\n  return newAttrs;\n}\n"]}]}