{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\label\\base.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\label\\base.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { __assign, __extends } from \"tslib\";\r\nimport { deepMix, each, map, isArray, get, clone, isNumber } from '@antv/util';\r\nimport BaseComponent from '../base';\r\nimport { VIEW_LIFE_CIRCLE, getDefaultAnimateCfg, doAnimate, ORIGIN, } from '../../dependents';\r\nimport BBox from '../../util/bbox';\r\nvar LabelComponent = (function (_super) {\r\n    __extends(LabelComponent, _super);\r\n    function LabelComponent() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.labelsCfgMap = {};\r\n        _this.lastLabelsCfgMap = {};\r\n        return _this;\r\n    }\r\n    LabelComponent.prototype.getGeometry = function () {\r\n        return this.geometry;\r\n    };\r\n    LabelComponent.prototype.getLabels = function () {\r\n        return this.labels;\r\n    };\r\n    LabelComponent.prototype.show = function () {\r\n        this.container.show();\r\n    };\r\n    LabelComponent.prototype.hide = function () {\r\n        this.container.hide();\r\n    };\r\n    LabelComponent.prototype.initConfig = function (config) {\r\n        var _this = this;\r\n        this.layer = config.layer;\r\n        var view = this.layer.view;\r\n        this.view = view;\r\n        this.geometry = config.geometry;\r\n        this.coord = view.getCoordinate();\r\n        this.options = deepMix(this.getDefaultOptions(), config.label);\r\n        var callback = function () {\r\n            _this.clear();\r\n            _this.labelsCfgMap = {};\r\n            _this.lastLabelsCfgMap = {};\r\n            _this.render();\r\n        };\r\n        view.on(VIEW_LIFE_CIRCLE.AFTER_PAINT, callback);\r\n        this.addDisposable(function () {\r\n            view.off(VIEW_LIFE_CIRCLE.AFTER_PAINT, callback);\r\n        });\r\n    };\r\n    LabelComponent.prototype.renderInner = function (group) {\r\n        var _this = this;\r\n        this.labels = [];\r\n        this.labelsCfgMap = {};\r\n        each(this.geometry.elements, function (element, elementIdx) {\r\n            var labels = [].concat(_this.drawLabelItem(group, element, elementIdx));\r\n            each(labels, function (label, idx) {\r\n                _this.adjustLabel(label, element, idx);\r\n                if (!label.destroyed) {\r\n                    _this.labels.push(label);\r\n                    _this.labelsCfgMap[label.get('id')] = clone(label.attrs);\r\n                }\r\n            });\r\n        });\r\n        this.layoutLabels(this.geometry, this.labels);\r\n        var lastLabelsCfgMap = this.lastLabelsCfgMap;\r\n        var labelsCfgMap = this.labelsCfgMap;\r\n        var animateCfg = this.geometry.animateOption ? getDefaultAnimateCfg('label', this.coord) : false;\r\n        each(labelsCfgMap, function (attrs, id) {\r\n            var shape = group.findById(id);\r\n            if (shape) {\r\n                if (lastLabelsCfgMap[id]) {\r\n                    var oldAttrs = lastLabelsCfgMap[id];\r\n                    var updateAnimateCfg = get(animateCfg, 'update');\r\n                    if (updateAnimateCfg) {\r\n                        shape.stopAnimate();\r\n                        shape.attr(oldAttrs);\r\n                        doAnimate(shape, updateAnimateCfg, {\r\n                            toAttrs: __assign({}, attrs),\r\n                            coordinate: _this.coord,\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    var appearAnimateCfg = get(animateCfg, 'appear');\r\n                    if (appearAnimateCfg) {\r\n                        shape.stopAnimate();\r\n                        doAnimate(shape, appearAnimateCfg, {\r\n                            toAttrs: __assign({}, shape.attr()),\r\n                            coordinate: _this.coord,\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            delete lastLabelsCfgMap[id];\r\n        });\r\n        each(lastLabelsCfgMap, function (attrs, id) {\r\n            var leaveAnimateCfg = get(animateCfg, 'leave');\r\n            if (leaveAnimateCfg) {\r\n                var tempShape = group.addShape('text', {\r\n                    attrs: attrs,\r\n                    id: id,\r\n                    name: 'label',\r\n                });\r\n                tempShape.stopAnimate();\r\n                doAnimate(tempShape, leaveAnimateCfg, {\r\n                    toAttrs: null,\r\n                    coordinate: _this.coord,\r\n                });\r\n            }\r\n        });\r\n        this.lastLabelsCfgMap = this.labelsCfgMap;\r\n    };\r\n    LabelComponent.prototype.drawLabelText = function (group, attrs, extraCfgs) {\r\n        if (extraCfgs === void 0) {\r\n            extraCfgs = {};\r\n        }\r\n        return group.addShape('text', __assign({ attrs: attrs }, extraCfgs));\r\n    };\r\n    LabelComponent.prototype.drawLabelItem = function (group, element, elementIndex) {\r\n        var _this = this;\r\n        var model = element.getModel();\r\n        var items = [].concat(this.getLabelItemAttrs(element, elementIndex));\r\n        var offset = this.getDefaultOffset();\r\n        var offsetPoint = this.getLabelOffset();\r\n        return map(items, function (attrs, index) {\r\n            var _a;\r\n            var position = {\r\n                x: attrs.x + offsetPoint.x,\r\n                y: attrs.y + offsetPoint.y,\r\n            };\r\n            var dataItem = isArray(model.mappingData) ? model.mappingData[index] : model.mappingData;\r\n            var id = _this.getLabelId(dataItem);\r\n            return _this.drawLabelText(group, __assign(__assign({}, attrs), position), (_a = {\r\n                id: id,\r\n                name: 'label',\r\n                offset: offset,\r\n                element: element\r\n            },\r\n                _a[ORIGIN] = dataItem,\r\n                _a));\r\n        });\r\n    };\r\n    LabelComponent.prototype.getDefaultOffset = function () {\r\n        return Number(this.options.offset);\r\n    };\r\n    LabelComponent.prototype.getLabelOffset = function () {\r\n        var _a = this.options, offsetX = _a.offsetX, offsetY = _a.offsetY;\r\n        return {\r\n            x: isNumber(offsetX) ? offsetX : 0,\r\n            y: isNumber(offsetY) ? offsetY : 0,\r\n        };\r\n    };\r\n    LabelComponent.prototype.getLabelOffsetByDimAndFactor = function (dim, factor) {\r\n        var _a = this.options, offsetX = _a.offsetX, offsetY = _a.offsetY;\r\n        var offset = this.getDefaultOffset();\r\n        var offsetPoint = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        offsetPoint[dim] = offset * factor;\r\n        if (isNumber(offsetX)) {\r\n            offsetPoint.x += offsetX;\r\n        }\r\n        if (isNumber(offsetY)) {\r\n            offsetPoint.y += offsetY;\r\n        }\r\n        return offsetPoint;\r\n    };\r\n    LabelComponent.prototype.getDefaultOptions = function () {\r\n        return {};\r\n    };\r\n    LabelComponent.prototype.layoutLabels = function (geometry, labels) {\r\n    };\r\n    LabelComponent.prototype.getLabelId = function (data) {\r\n        var origin = data._origin;\r\n        var type = this.geometry.type;\r\n        var xScale = this.geometry.getXScale();\r\n        var yScale = this.geometry.getYScale();\r\n        var labelId = this.geometry.getElementId(data);\r\n        if (type === 'line' || type === 'area') {\r\n            labelId += \" \" + origin[xScale.field];\r\n        }\r\n        else if (type === 'path') {\r\n            labelId += \" \" + origin[xScale.field] + \"-\" + origin[yScale.field];\r\n        }\r\n        return labelId;\r\n    };\r\n    LabelComponent.prototype.getCoordinateBBox = function () {\r\n        var coord = this.coord;\r\n        var start = coord.start, end = coord.end;\r\n        return new BBox(Math.min(start.x, end.x), Math.min(start.y, end.y), coord.getWidth(), coord.getHeight());\r\n    };\r\n    return LabelComponent;\r\n}(BaseComponent));\r\nexport default LabelComponent;\r\nvar LABEL_CONFIG_MAP = {};\r\nexport function registerLabelComponent(type, component) {\r\n    LABEL_CONFIG_MAP[type] = component;\r\n}\r\nexport function getLabelComponent(type) {\r\n    return LABEL_CONFIG_MAP[type];\r\n}\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\label\\base.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\components\\label\\base.js"],"names":[],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport { deepMix, each, map, isArray, get, clone, isNumber } from '@antv/util';\nimport BaseComponent from '../base';\nimport { VIEW_LIFE_CIRCLE, getDefaultAnimateCfg, doAnimate, ORIGIN, } from '../../dependents';\nimport BBox from '../../util/bbox';\nvar LabelComponent = /** @class */ (function (_super) {\n    __extends(LabelComponent, _super);\n    function LabelComponent() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.labelsCfgMap = {};\n        _this.lastLabelsCfgMap = {};\n        return _this;\n    }\n    LabelComponent.prototype.getGeometry = function () {\n        return this.geometry;\n    };\n    LabelComponent.prototype.getLabels = function () {\n        return this.labels;\n    };\n    LabelComponent.prototype.show = function () {\n        this.container.show();\n    };\n    LabelComponent.prototype.hide = function () {\n        this.container.hide();\n    };\n    LabelComponent.prototype.initConfig = function (config) {\n        var _this = this;\n        this.layer = config.layer;\n        var view = this.layer.view;\n        this.view = view;\n        this.geometry = config.geometry;\n        this.coord = view.getCoordinate();\n        this.options = deepMix(this.getDefaultOptions(), config.label);\n        var callback = function () {\n            _this.clear();\n            _this.labelsCfgMap = {};\n            _this.lastLabelsCfgMap = {};\n            _this.render();\n        };\n        view.on(VIEW_LIFE_CIRCLE.AFTER_PAINT, callback);\n        this.addDisposable(function () {\n            view.off(VIEW_LIFE_CIRCLE.AFTER_PAINT, callback);\n        });\n    };\n    LabelComponent.prototype.renderInner = function (group) {\n        var _this = this;\n        this.labels = [];\n        this.labelsCfgMap = {};\n        // 绘制 Label 图形\n        each(this.geometry.elements, function (element, elementIdx) {\n            var labels = [].concat(_this.drawLabelItem(group, element, elementIdx));\n            each(labels, function (label, idx) {\n                _this.adjustLabel(label, element, idx);\n                if (!label.destroyed) {\n                    _this.labels.push(label);\n                    _this.labelsCfgMap[label.get('id')] = clone(label.attrs);\n                }\n            });\n        });\n        // 执行布局\n        this.layoutLabels(this.geometry, this.labels);\n        // 执行动画：参照 G2 Label 动画\n        var lastLabelsCfgMap = this.lastLabelsCfgMap;\n        var labelsCfgMap = this.labelsCfgMap;\n        var animateCfg = this.geometry.animateOption ? getDefaultAnimateCfg('label', this.coord) : false;\n        each(labelsCfgMap, function (attrs, id) {\n            var shape = group.findById(id);\n            if (shape) {\n                if (lastLabelsCfgMap[id]) {\n                    var oldAttrs = lastLabelsCfgMap[id];\n                    // 图形发生更新\n                    var updateAnimateCfg = get(animateCfg, 'update');\n                    if (updateAnimateCfg) {\n                        shape.stopAnimate();\n                        shape.attr(oldAttrs);\n                        doAnimate(shape, updateAnimateCfg, {\n                            toAttrs: __assign({}, attrs),\n                            coordinate: _this.coord,\n                        });\n                    }\n                }\n                else {\n                    // 新生成的 shape\n                    var appearAnimateCfg = get(animateCfg, 'appear');\n                    if (appearAnimateCfg) {\n                        shape.stopAnimate();\n                        doAnimate(shape, appearAnimateCfg, {\n                            toAttrs: __assign({}, shape.attr()),\n                            coordinate: _this.coord,\n                        });\n                    }\n                }\n            }\n            delete lastLabelsCfgMap[id];\n        });\n        each(lastLabelsCfgMap, function (attrs, id) {\n            // 移除\n            var leaveAnimateCfg = get(animateCfg, 'leave');\n            if (leaveAnimateCfg) {\n                var tempShape = group.addShape('text', {\n                    attrs: attrs,\n                    id: id,\n                    name: 'label',\n                });\n                tempShape.stopAnimate();\n                doAnimate(tempShape, leaveAnimateCfg, {\n                    toAttrs: null,\n                    coordinate: _this.coord,\n                });\n            }\n        });\n        this.lastLabelsCfgMap = this.labelsCfgMap;\n    };\n    LabelComponent.prototype.drawLabelText = function (group, attrs, extraCfgs) {\n        if (extraCfgs === void 0) { extraCfgs = {}; }\n        return group.addShape('text', __assign({ attrs: attrs }, extraCfgs));\n    };\n    LabelComponent.prototype.drawLabelItem = function (group, element, elementIndex) {\n        var _this = this;\n        var model = element.getModel();\n        var items = [].concat(this.getLabelItemAttrs(element, elementIndex));\n        var offset = this.getDefaultOffset();\n        var offsetPoint = this.getLabelOffset();\n        return map(items, function (attrs, index) {\n            var _a;\n            var position = {\n                x: attrs.x + offsetPoint.x,\n                y: attrs.y + offsetPoint.y,\n            };\n            var dataItem = isArray(model.mappingData) ? model.mappingData[index] : model.mappingData;\n            var id = _this.getLabelId(dataItem);\n            return _this.drawLabelText(group, __assign(__assign({}, attrs), position), (_a = {\n                    id: id,\n                    name: 'label',\n                    offset: offset,\n                    element: element\n                },\n                _a[ORIGIN] = dataItem,\n                _a));\n        });\n    };\n    /** 获取当前 Label 的 offset */\n    LabelComponent.prototype.getDefaultOffset = function () {\n        return Number(this.options.offset);\n    };\n    /** 默认实现：获取当前 Label 的 offset 点：包括 offset、offsetX、offsetY */\n    LabelComponent.prototype.getLabelOffset = function () {\n        var _a = this.options, offsetX = _a.offsetX, offsetY = _a.offsetY;\n        return {\n            x: isNumber(offsetX) ? offsetX : 0,\n            y: isNumber(offsetY) ? offsetY : 0,\n        };\n    };\n    /** 通过指定方向和系数获取整体 offset 点 */\n    LabelComponent.prototype.getLabelOffsetByDimAndFactor = function (dim, factor) {\n        var _a = this.options, offsetX = _a.offsetX, offsetY = _a.offsetY;\n        var offset = this.getDefaultOffset();\n        var offsetPoint = {\n            x: 0,\n            y: 0,\n        };\n        offsetPoint[dim] = offset * factor;\n        if (isNumber(offsetX)) {\n            offsetPoint.x += offsetX;\n        }\n        if (isNumber(offsetY)) {\n            offsetPoint.y += offsetY;\n        }\n        return offsetPoint;\n    };\n    /** 初始化默认全局配置 */\n    LabelComponent.prototype.getDefaultOptions = function () {\n        return {};\n    };\n    /** 整理对所有 Labels 的布局调整 */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    LabelComponent.prototype.layoutLabels = function (geometry, labels) {\n        // empty\n    };\n    LabelComponent.prototype.getLabelId = function (data) {\n        var origin = data._origin;\n        var type = this.geometry.type;\n        var xScale = this.geometry.getXScale();\n        var yScale = this.geometry.getYScale();\n        var labelId = this.geometry.getElementId(data);\n        if (type === 'line' || type === 'area') {\n            // 折线图以及区域图，一条线会对应一组数据，即多个 labels，为了区分这些 labels，需要在 line id 的前提下加上 x 字段值\n            labelId += \" \" + origin[xScale.field];\n        }\n        else if (type === 'path') {\n            // path 路径图，无序，有可能存在相同 x 不同 y 的情况，需要通过 x y 来确定唯一 id\n            labelId += \" \" + origin[xScale.field] + \"-\" + origin[yScale.field];\n        }\n        return labelId;\n    };\n    LabelComponent.prototype.getCoordinateBBox = function () {\n        var coord = this.coord;\n        var start = coord.start, end = coord.end;\n        return new BBox(Math.min(start.x, end.x), Math.min(start.y, end.y), coord.getWidth(), coord.getHeight());\n    };\n    return LabelComponent;\n}(BaseComponent));\nexport default LabelComponent;\n// Label 组件注册\nvar LABEL_CONFIG_MAP = {};\nexport function registerLabelComponent(type, component) {\n    LABEL_CONFIG_MAP[type] = component;\n}\nexport function getLabelComponent(type) {\n    return LABEL_CONFIG_MAP[type];\n}\n//# sourceMappingURL=base.js.map"]}]}