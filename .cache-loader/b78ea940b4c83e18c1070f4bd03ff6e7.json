{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/label/geom-labels.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/label/geom-labels.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var _require = require('../../renderer'), Group = _require.Group;\nvar _require2 = require('@antv/component/lib'), Label = _require2.Label;\nvar Global = require('../../global');\nvar Util = require('../../util');\nvar IGNORE_ARR = ['line', 'point', 'path'];\nvar ORIGIN = '_origin';\nfunction avg(arr) {\n    var sum = 0;\n    Util.each(arr, function (value) {\n        sum += value;\n    });\n    return sum / arr.length;\n}\nfunction getCentroid(xs, ys) {\n    if (Util.isNumber(xs) && Util.isNumber(ys)) {\n        return [xs, ys];\n    }\n    var i = -1, x = 0, y = 0;\n    var former, current = xs.length - 1;\n    var diff, k = 0;\n    while (++i < xs.length) {\n        former = current;\n        current = i;\n        k += diff = xs[former] * ys[current] - xs[current] * ys[former];\n        x += (xs[former] + xs[current]) * diff;\n        y += (ys[former] + ys[current]) * diff;\n    }\n    k *= 3;\n    return [x / k, y / k];\n}\nvar GeomLabels = function GeomLabels(cfg) {\n    GeomLabels.superclass.constructor.call(this, cfg);\n};\nUtil.extend(GeomLabels, Group);\nUtil.augment(GeomLabels, {\n    getDefaultCfg: function getDefaultCfg() {\n        return {\n            label: Global.label,\n            labelCfg: null,\n            coord: null,\n            geomType: null,\n            zIndex: 6\n        };\n    },\n    _renderUI: function _renderUI() {\n        GeomLabels.superclass._renderUI.call(this);\n        this.initLabelsCfg();\n        var labelsGroup = this.addGroup();\n        var lineGroup = this.addGroup({\n            elCls: 'x-line-group'\n        });\n        var labelRenderer = this.get('labelRenderer');\n        this.set('labelsGroup', labelsGroup);\n        this.set('lineGroup', lineGroup);\n        this.get('labelRenderer').set('group', labelsGroup);\n        labelRenderer.set('group', labelsGroup);\n        labelRenderer.set('lineGroup', lineGroup);\n    },\n    initLabelsCfg: function initLabelsCfg() {\n        var self = this;\n        var labelRenderer = new Label();\n        var labels = self.getDefaultLabelCfg();\n        var labelCfg = self.get('labelCfg');\n        Util.deepMix(labels, labelCfg.globalCfg || labelCfg.cfg);\n        labelRenderer.set('config', false);\n        if (labels.labelLine) {\n            labelRenderer.set('labelLine', labels.labelLine);\n        }\n        labelRenderer.set('coord', self.get('coord'));\n        this.set('labelRenderer', labelRenderer);\n        self.set('label', labels);\n    },\n    getDefaultLabelCfg: function getDefaultLabelCfg() {\n        var self = this;\n        var labelCfg = self.get('labelCfg').cfg || self.get('labelCfg').globalCfg;\n        var geomType = self.get('geomType');\n        var viewTheme = self.get('viewTheme') || Global;\n        if (geomType === 'polygon' || labelCfg && labelCfg.offset < 0 && Util.indexOf(IGNORE_ARR, geomType) === -1) {\n            return Util.deepMix({}, self.get('label'), viewTheme.innerLabels, labelCfg);\n        }\n        return Util.deepMix({}, self.get('label'), viewTheme.label, labelCfg);\n    },\n    getLabelsItems: function getLabelsItems(points, shapes) {\n        var self = this;\n        var items = [];\n        var geom = self.get('geom');\n        var coord = self.get('coord');\n        self._getLabelCfgs(points, shapes);\n        var labelCfg = self.get('labelItemCfgs');\n        Util.each(points, function (point, i) {\n            var origin = point[ORIGIN];\n            var label = labelCfg[i];\n            if (!label) {\n                items.push(null);\n                return;\n            }\n            if (!Util.isArray(label.text)) {\n                label.text = [label.text];\n            }\n            var total = label.text.length;\n            Util.each(label.text, function (sub, subIndex) {\n                if (Util.isNil(sub) || sub === '') {\n                    items.push(null);\n                    return;\n                }\n                var obj = self.getLabelPoint(label, point, subIndex);\n                obj = Util.mix({}, label, obj);\n                if (!obj.textAlign) {\n                    obj.textAlign = self.getLabelAlign(obj, subIndex, total);\n                }\n                if (geom) {\n                    obj._id = geom._getShapeId(origin) + '-glabel-' + subIndex + '-' + obj.text;\n                }\n                obj.coord = coord;\n                items.push(obj);\n            });\n        });\n        return items;\n    },\n    adjustItems: function adjustItems(items) {\n        Util.each(items, function (item) {\n            if (!item) {\n                return;\n            }\n            if (item.offsetX) {\n                item.x += item.offsetX;\n            }\n            if (item.offsetY) {\n                item.y += item.offsetY;\n            }\n        });\n        return items;\n    },\n    drawLines: function drawLines(items) {\n        var self = this;\n        Util.each(items, function (point) {\n            if (!point) {\n                return;\n            }\n            if (point.offset > 0) {\n                self.lineToLabel(point);\n            }\n        });\n    },\n    lineToLabel: function lineToLabel() { },\n    getLabelPoint: function getLabelPoint(labelCfg, point, index) {\n        var self = this;\n        var coord = self.get('coord');\n        var total = labelCfg.text.length;\n        function getDimValue(value, idx) {\n            if (Util.isArray(value)) {\n                if (labelCfg.text.length === 1) {\n                    if (value.length <= 2) {\n                        value = value[value.length - 1];\n                    }\n                    else {\n                        value = avg(value);\n                    }\n                }\n                else {\n                    value = value[idx];\n                }\n            }\n            return value;\n        }\n        var label = {\n            text: labelCfg.text[index]\n        };\n        if (point && this.get('geomType') === 'polygon') {\n            var centroid = getCentroid(point.x, point.y);\n            label.x = centroid[0];\n            label.y = centroid[1];\n        }\n        else {\n            label.x = getDimValue(point.x, index);\n            label.y = getDimValue(point.y, index);\n        }\n        if (point && point.nextPoints && (point.shape === 'funnel' || point.shape === 'pyramid')) {\n            var maxX = -Infinity;\n            point.nextPoints.forEach(function (p) {\n                p = coord.convert(p);\n                if (p.x > maxX) {\n                    maxX = p.x;\n                }\n            });\n            label.x = (label.x + maxX) / 2;\n        }\n        if (point.shape === 'pyramid' && !point.nextPoints && point.points) {\n            point.points.forEach(function (p) {\n                p = coord.convert(p);\n                if (Util.isArray(p.x) && !point.x.includes(p.x) || Util.isNumber(p.x) && point.x !== p.x) {\n                    label.x = (label.x + p.x) / 2;\n                }\n            });\n        }\n        if (labelCfg.position) {\n            self.setLabelPosition(label, point, index, labelCfg.position);\n        }\n        var offsetPoint = self.getLabelOffset(labelCfg, index, total);\n        if (labelCfg.offsetX) {\n            offsetPoint.x += labelCfg.offsetX;\n        }\n        if (labelCfg.offsetY) {\n            offsetPoint.y += labelCfg.offsetY;\n        }\n        self.transLabelPoint(label);\n        label.start = {\n            x: label.x,\n            y: label.y\n        };\n        label.x += offsetPoint.x;\n        label.y += offsetPoint.y;\n        label.color = point.color;\n        return label;\n    },\n    setLabelPosition: function setLabelPosition() { },\n    transLabelPoint: function transLabelPoint(point) {\n        var self = this;\n        var coord = self.get('coord');\n        var tmpPoint = coord.applyMatrix(point.x, point.y, 1);\n        point.x = tmpPoint[0];\n        point.y = tmpPoint[1];\n    },\n    getOffsetVector: function getOffsetVector(point) {\n        var self = this;\n        var offset = point.offset || 0;\n        var coord = self.get('coord');\n        var vector;\n        if (coord.isTransposed) {\n            vector = coord.applyMatrix(offset, 0);\n        }\n        else {\n            vector = coord.applyMatrix(0, offset);\n        }\n        return vector;\n    },\n    getDefaultOffset: function getDefaultOffset(point) {\n        var self = this;\n        var offset = 0;\n        var coord = self.get('coord');\n        var vector = self.getOffsetVector(point);\n        if (coord.isTransposed) {\n            offset = vector[0];\n        }\n        else {\n            offset = vector[1];\n        }\n        var yScale = this.get('yScale');\n        if (yScale && point.point) {\n            var yValue = point.point[yScale.field];\n            if (yValue < 0) {\n                offset = offset * -1;\n            }\n        }\n        return offset;\n    },\n    getLabelOffset: function getLabelOffset(point, index, total) {\n        var self = this;\n        var offset = self.getDefaultOffset(point);\n        var coord = self.get('coord');\n        var transposed = coord.isTransposed;\n        var yField = transposed ? 'x' : 'y';\n        var factor = transposed ? 1 : -1;\n        var offsetPoint = {\n            x: 0,\n            y: 0\n        };\n        if (index > 0 || total === 1) {\n            offsetPoint[yField] = offset * factor;\n        }\n        else {\n            offsetPoint[yField] = offset * factor * -1;\n        }\n        return offsetPoint;\n    },\n    getLabelAlign: function getLabelAlign(point, index, total) {\n        var self = this;\n        var align = 'center';\n        var coord = self.get('coord');\n        if (coord.isTransposed) {\n            var offset = self.getDefaultOffset(point);\n            if (offset < 0) {\n                align = 'right';\n            }\n            else if (offset === 0) {\n                align = 'center';\n            }\n            else {\n                align = 'left';\n            }\n            if (total > 1 && index === 0) {\n                if (align === 'right') {\n                    align = 'left';\n                }\n                else if (align === 'left') {\n                    align = 'right';\n                }\n            }\n        }\n        return align;\n    },\n    _getLabelValue: function _getLabelValue(origin, scales) {\n        if (!Util.isArray(scales)) {\n            scales = [scales];\n        }\n        var text = [];\n        Util.each(scales, function (scale) {\n            var value = origin[scale.field];\n            if (Util.isArray(value)) {\n                var tmp = [];\n                Util.each(value, function (subVal) {\n                    tmp.push(scale.getText(subVal));\n                });\n                value = tmp;\n            }\n            else {\n                value = scale.getText(value);\n            }\n            if (Util.isNil(value) || value === '') {\n                text.push(null);\n            }\n            text.push(value);\n        });\n        return text;\n    },\n    _getLabelCfgs: function _getLabelCfgs(points) {\n        var self = this;\n        var labelCfg = this.get('labelCfg');\n        var scales = labelCfg.scales;\n        var defaultCfg = this.get('label');\n        var viewTheme = self.get('viewTheme') || Global;\n        var cfgs = [];\n        if (labelCfg.globalCfg && labelCfg.globalCfg.type) {\n            self.set('type', labelCfg.globalCfg.type);\n        }\n        Util.each(points, function (point, i) {\n            var cfg = {};\n            var origin = point[ORIGIN];\n            var originText = self._getLabelValue(origin, scales);\n            if (labelCfg.callback) {\n                var originValues = scales.map(function (scale) {\n                    return origin[scale.field];\n                });\n                cfg = labelCfg.callback.apply(null, [].concat(originValues, [point, i]));\n            }\n            if (!cfg && cfg !== 0) {\n                cfgs.push(null);\n                return;\n            }\n            if (Util.isString(cfg) || Util.isNumber(cfg)) {\n                cfg = {\n                    text: cfg\n                };\n            }\n            else {\n                cfg.text = cfg.content || originText[0];\n                delete cfg.content;\n            }\n            cfg = Util.mix({}, defaultCfg, labelCfg.globalCfg || {}, cfg);\n            point.point = origin;\n            cfg.point = origin;\n            if (cfg.htmlTemplate) {\n                cfg.useHtml = true;\n                cfg.text = cfg.htmlTemplate.call(null, cfg.text, point, i);\n                delete cfg.htmlTemplate;\n            }\n            if (cfg.formatter) {\n                cfg.text = cfg.formatter.call(null, cfg.text, point, i);\n                delete cfg.formatter;\n            }\n            if (cfg.label) {\n                var label = cfg.label;\n                delete cfg.label;\n                cfg = Util.mix(cfg, label);\n            }\n            if (cfg.textStyle) {\n                delete cfg.textStyle.offset;\n                var textStyle = cfg.textStyle;\n                if (Util.isFunction(textStyle)) {\n                    cfg.textStyle = textStyle.call(null, cfg.text, point, i);\n                }\n            }\n            if (cfg.labelLine) {\n                cfg.labelLine = Util.mix({}, defaultCfg.labelLine, cfg.labelLine);\n            }\n            cfg.textStyle = Util.mix({}, defaultCfg.textStyle, viewTheme.label.textStyle, cfg.textStyle);\n            delete cfg.items;\n            cfgs.push(cfg);\n        });\n        this.set('labelItemCfgs', cfgs);\n    },\n    showLabels: function showLabels(points, shapes) {\n        var self = this;\n        var labelRenderer = self.get('labelRenderer');\n        var items = self.getLabelsItems(points, shapes);\n        shapes = [].concat(shapes);\n        var type = self.get('type');\n        items = self.adjustItems(items, shapes);\n        self.drawLines(items);\n        labelRenderer.set('items', items.filter(function (item, i) {\n            if (!item) {\n                shapes.splice(i, 1);\n                return false;\n            }\n            return true;\n        }));\n        if (type) {\n            labelRenderer.set('shapes', shapes);\n            labelRenderer.set('type', type);\n            labelRenderer.set('points', points);\n        }\n        labelRenderer.set('canvas', this.get('canvas'));\n        labelRenderer.draw();\n    },\n    destroy: function destroy() {\n        this.get('labelRenderer').destroy();\n        GeomLabels.superclass.destroy.call(this);\n    }\n});\nmodule.exports = GeomLabels;\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/label/geom-labels.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/label/geom-labels.js"],"names":[],"mappings":"AAAA,IAAI,QAAQ,GAAG,OAAO,CAAC,gBAAgB,CAAC,EACpC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;AAE3B,IAAI,SAAS,GAAG,OAAO,CAAC,qBAAqB,CAAC,EAC1C,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;AAG5B,IAAI,MAAM,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AAErC,IAAI,IAAI,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEjC,IAAI,UAAU,GAAG,CAAC,MAAM,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;AAC3C,IAAI,MAAM,GAAG,SAAS,CAAC;AAEvB,SAAS,GAAG,CAAC,GAAG;IACd,IAAI,GAAG,GAAG,CAAC,CAAC;IACZ,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,UAAU,KAAK;QAC5B,GAAG,IAAI,KAAK,CAAC;IACf,CAAC,CAAC,CAAC;IACH,OAAO,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC;AAC1B,CAAC;AAGD,SAAS,WAAW,CAAC,EAAE,EAAE,EAAE;IACzB,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE;QAC1C,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;KACjB;IAED,IAAI,CAAC,GAAG,CAAC,CAAC,EACN,CAAC,GAAG,CAAC,EACL,CAAC,GAAG,CAAC,CAAC;IACV,IAAI,MAAM,EACN,OAAO,GAAG,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC;IAC5B,IAAI,IAAI,EACJ,CAAC,GAAG,CAAC,CAAC;IAEV,OAAO,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE;QACtB,MAAM,GAAG,OAAO,CAAC;QACjB,OAAO,GAAG,CAAC,CAAC;QACZ,CAAC,IAAI,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC;QAChE,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,CAAC,GAAG,IAAI,CAAC;QACvC,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,CAAC,GAAG,IAAI,CAAC;KACxC;IAED,CAAC,IAAI,CAAC,CAAC;IACP,OAAO,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;AACxB,CAAC;AAED,IAAI,UAAU,GAAG,SAAS,UAAU,CAAC,GAAG;IACtC,UAAU,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;AACpD,CAAC,CAAC;AAEF,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;AAC/B,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE;IACvB,aAAa,EAAE,SAAS,aAAa;QACnC,OAAO;YACL,KAAK,EAAE,MAAM,CAAC,KAAK;YAMnB,QAAQ,EAAE,IAAI;YAMd,KAAK,EAAE,IAAI;YAMX,QAAQ,EAAE,IAAI;YACd,MAAM,EAAE,CAAC;SACV,CAAC;IACJ,CAAC;IACD,SAAS,EAAE,SAAS,SAAS;QAC3B,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAE3C,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,WAAW,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAClC,IAAI,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC;YAC5B,KAAK,EAAE,cAAc;SACtB,CAAC,CAAC;QACH,IAAI,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;QACrC,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;QACjC,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;QACpD,aAAa,CAAC,GAAG,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;QACxC,aAAa,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAC5C,CAAC;IAED,aAAa,EAAE,SAAS,aAAa;QACnC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,aAAa,GAAG,IAAI,KAAK,EAAE,CAAC;QAChC,IAAI,MAAM,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAC;QACvC,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAEpC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,QAAQ,CAAC,SAAS,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC;QACzD,aAAa,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QAEnC,IAAI,MAAM,CAAC,SAAS,EAAE;YACpB,aAAa,CAAC,GAAG,CAAC,WAAW,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;SAClD;QAED,aAAa,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC;QACzC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAC5B,CAAC;IAOD,kBAAkB,EAAE,SAAS,kBAAkB;QAC7C,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,SAAS,CAAC;QAC1E,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACpC,IAAI,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC;QAEhD,IAAI,QAAQ,KAAK,SAAS,IAAI,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE;YAC1G,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,SAAS,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;SAC7E;QAED,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,SAAS,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;IACxE,CAAC;IASD,cAAc,EAAE,SAAS,cAAc,CAAC,MAAM,EAAE,MAAM;QACpD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,IAAI,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC5B,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAE9B,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAEnC,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAEzC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,KAAK,EAAE,CAAC;YAClC,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC;YAC3B,IAAI,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;YAExB,IAAI,CAAC,KAAK,EAAE;gBACV,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACjB,OAAO;aACR;YAED,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;gBAC7B,KAAK,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;aAC3B;YAED,IAAI,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC;YAC9B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,UAAU,GAAG,EAAE,QAAQ;gBAC3C,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,GAAG,KAAK,EAAE,EAAE;oBACjC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBACjB,OAAO;iBACR;gBAED,IAAI,GAAG,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;gBACrD,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;gBAE/B,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE;oBAClB,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;iBAC1D;gBAED,IAAI,IAAI,EAAE;oBACR,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,GAAG,UAAU,GAAG,QAAQ,GAAG,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC;iBAC7E;gBAED,GAAG,CAAC,KAAK,GAAG,KAAK,CAAC;gBAClB,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAClB,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QACH,OAAO,KAAK,CAAC;IACf,CAAC;IAwCD,WAAW,EAAE,SAAS,WAAW,CAAC,KAAK;QACrC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,UAAU,IAAI;YAC7B,IAAI,CAAC,IAAI,EAAE;gBACT,OAAO;aACR;YAED,IAAI,IAAI,CAAC,OAAO,EAAE;gBAChB,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC;aACxB;YAED,IAAI,IAAI,CAAC,OAAO,EAAE;gBAChB,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC;aACxB;QACH,CAAC,CAAC,CAAC;QACH,OAAO,KAAK,CAAC;IACf,CAAC;IAOD,SAAS,EAAE,SAAS,SAAS,CAAC,KAAK;QACjC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,UAAU,KAAK;YAC9B,IAAI,CAAC,KAAK,EAAE;gBACV,OAAO;aACR;YAED,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;gBACpB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;aACzB;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,WAAW,EAAE,SAAS,WAAW,KAAI,CAAC;IAUtC,aAAa,EAAE,SAAS,aAAa,CAAC,QAAQ,EAAE,KAAK,EAAE,KAAK;QAC1D,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;QAEjC,SAAS,WAAW,CAAC,KAAK,EAAE,GAAG;YAC7B,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACvB,IAAI,QAAQ,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;oBAE9B,IAAI,KAAK,CAAC,MAAM,IAAI,CAAC,EAAE;wBACrB,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;qBACjC;yBAAM;wBACL,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC;qBACpB;iBACF;qBAAM;oBACL,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;iBACpB;aACF;YAED,OAAO,KAAK,CAAC;QACf,CAAC;QAED,IAAI,KAAK,GAAG;YACV,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC;SAC3B,CAAC;QAEF,IAAI,KAAK,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,SAAS,EAAE;YAC/C,IAAI,QAAQ,GAAG,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;YAE7C,KAAK,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;YACtB,KAAK,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;SACvB;aAAM;YACL,KAAK,CAAC,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;YACtC,KAAK,CAAC,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;SACvC;QAGD,IAAI,KAAK,IAAI,KAAK,CAAC,UAAU,IAAI,CAAC,KAAK,CAAC,KAAK,KAAK,QAAQ,IAAI,KAAK,CAAC,KAAK,KAAK,SAAS,CAAC,EAAE;YACxF,IAAI,IAAI,GAAG,CAAC,QAAQ,CAAC;YACrB,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC;gBAClC,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBAErB,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,EAAE;oBACd,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC;iBACZ;YACH,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;SAChC;QAGD,IAAI,KAAK,CAAC,KAAK,KAAK,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,IAAI,KAAK,CAAC,MAAM,EAAE;YAClE,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;gBAC9B,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBAErB,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;oBACxF,KAAK,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;iBAC/B;YACH,CAAC,CAAC,CAAC;SACJ;QAED,IAAI,QAAQ,CAAC,QAAQ,EAAE;YACrB,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC;SAC/D;QAED,IAAI,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;QAE9D,IAAI,QAAQ,CAAC,OAAO,EAAE;YACpB,WAAW,CAAC,CAAC,IAAI,QAAQ,CAAC,OAAO,CAAC;SACnC;QAED,IAAI,QAAQ,CAAC,OAAO,EAAE;YACpB,WAAW,CAAC,CAAC,IAAI,QAAQ,CAAC,OAAO,CAAC;SACnC;QAED,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QAC5B,KAAK,CAAC,KAAK,GAAG;YACZ,CAAC,EAAE,KAAK,CAAC,CAAC;YACV,CAAC,EAAE,KAAK,CAAC,CAAC;SACX,CAAC;QACF,KAAK,CAAC,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC;QACzB,KAAK,CAAC,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC;QACzB,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;QAC1B,OAAO,KAAK,CAAC;IACf,CAAC;IACD,gBAAgB,EAAE,SAAS,gBAAgB,KAAI,CAAC;IAChD,eAAe,EAAE,SAAS,eAAe,CAAC,KAAK;QAC7C,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,QAAQ,GAAG,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACtD,KAAK,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QACtB,KAAK,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IACxB,CAAC;IACD,eAAe,EAAE,SAAS,eAAe,CAAC,KAAK;QAC7C,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,IAAI,CAAC,CAAC;QAC/B,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,MAAM,CAAC;QAEX,IAAI,KAAK,CAAC,YAAY,EAAE;YAEtB,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;SACvC;aAAM;YAEL,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;SACvC;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,gBAAgB,EAAE,SAAS,gBAAgB,CAAC,KAAK;QAC/C,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,MAAM,GAAG,CAAC,CAAC;QACf,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QAEzC,IAAI,KAAK,CAAC,YAAY,EAAE;YAEtB,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;SACpB;aAAM;YAEL,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;SACpB;QAED,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAEhC,IAAI,MAAM,IAAI,KAAK,CAAC,KAAK,EAAE;YAEzB,IAAI,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAEvC,IAAI,MAAM,GAAG,CAAC,EAAE;gBACd,MAAM,GAAG,MAAM,GAAG,CAAC,CAAC,CAAC;aACtB;SACF;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,cAAc,EAAE,SAAS,cAAc,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK;QACzD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;QAC1C,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9B,IAAI,UAAU,GAAG,KAAK,CAAC,YAAY,CAAC;QACpC,IAAI,MAAM,GAAG,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC;QACpC,IAAI,MAAM,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEjC,IAAI,WAAW,GAAG;YAChB,CAAC,EAAE,CAAC;YACJ,CAAC,EAAE,CAAC;SACL,CAAC;QAEF,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,EAAE;YAE5B,WAAW,CAAC,MAAM,CAAC,GAAG,MAAM,GAAG,MAAM,CAAC;SACvC;aAAM;YACL,WAAW,CAAC,MAAM,CAAC,GAAG,MAAM,GAAG,MAAM,GAAG,CAAC,CAAC,CAAC;SAC5C;QAED,OAAO,WAAW,CAAC;IACrB,CAAC;IACD,aAAa,EAAE,SAAS,aAAa,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK;QACvD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,KAAK,GAAG,QAAQ,CAAC;QACrB,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAE9B,IAAI,KAAK,CAAC,YAAY,EAAE;YACtB,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;YAE1C,IAAI,MAAM,GAAG,CAAC,EAAE;gBACd,KAAK,GAAG,OAAO,CAAC;aACjB;iBAAM,IAAI,MAAM,KAAK,CAAC,EAAE;gBACvB,KAAK,GAAG,QAAQ,CAAC;aAClB;iBAAM;gBACL,KAAK,GAAG,MAAM,CAAC;aAChB;YAED,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,EAAE;gBAC5B,IAAI,KAAK,KAAK,OAAO,EAAE;oBACrB,KAAK,GAAG,MAAM,CAAC;iBAChB;qBAAM,IAAI,KAAK,KAAK,MAAM,EAAE;oBAC3B,KAAK,GAAG,OAAO,CAAC;iBACjB;aACF;SACF;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IACD,cAAc,EAAE,SAAS,cAAc,CAAC,MAAM,EAAE,MAAM;QACpD,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;YACzB,MAAM,GAAG,CAAC,MAAM,CAAC,CAAC;SACnB;QAED,IAAI,IAAI,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,KAAK;YAC/B,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAEhC,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACvB,IAAI,GAAG,GAAG,EAAE,CAAC;gBACb,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,UAAU,MAAM;oBAC/B,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;gBAClC,CAAC,CAAC,CAAC;gBACH,KAAK,GAAG,GAAG,CAAC;aACb;iBAAM;gBACL,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;aAC9B;YAED,IAAI,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,KAAK,KAAK,EAAE,EAAE;gBACrC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACjB;YAED,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnB,CAAC,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;IACd,CAAC;IAED,aAAa,EAAE,SAAS,aAAa,CAAC,MAAM;QAC1C,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACpC,IAAI,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;QAC7B,IAAI,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACnC,IAAI,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC;QAChD,IAAI,IAAI,GAAG,EAAE,CAAC;QAEd,IAAI,QAAQ,CAAC,SAAS,IAAI,QAAQ,CAAC,SAAS,CAAC,IAAI,EAAE;YACjD,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;SAC3C;QAED,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,KAAK,EAAE,CAAC;YAClC,IAAI,GAAG,GAAG,EAAE,CAAC;YACb,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC;YAE3B,IAAI,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAErD,IAAI,QAAQ,CAAC,QAAQ,EAAE;gBAErB,IAAI,YAAY,GAAG,MAAM,CAAC,GAAG,CAAC,UAAU,KAAK;oBAC3C,OAAO,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAC7B,CAAC,CAAC,CAAC;gBAEH,GAAG,GAAG,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;aAC1E;YAED,IAAI,CAAC,GAAG,IAAI,GAAG,KAAK,CAAC,EAAE;gBACrB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAChB,OAAO;aACR;YAED,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;gBAC5C,GAAG,GAAG;oBACJ,IAAI,EAAE,GAAG;iBACV,CAAC;aACH;iBAAM;gBACL,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,OAAO,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC;gBACxC,OAAO,GAAG,CAAC,OAAO,CAAC;aACpB;YAED,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,UAAU,EAAE,QAAQ,CAAC,SAAS,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC;YAE9D,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;YACrB,GAAG,CAAC,KAAK,GAAG,MAAM,CAAC;YAEnB,IAAI,GAAG,CAAC,YAAY,EAAE;gBACpB,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC;gBACnB,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC3D,OAAO,GAAG,CAAC,YAAY,CAAC;aACzB;YAED,IAAI,GAAG,CAAC,SAAS,EAAE;gBACjB,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;gBACxD,OAAO,GAAG,CAAC,SAAS,CAAC;aACtB;YAED,IAAI,GAAG,CAAC,KAAK,EAAE;gBAEb,IAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;gBACtB,OAAO,GAAG,CAAC,KAAK,CAAC;gBACjB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;aAC5B;YAED,IAAI,GAAG,CAAC,SAAS,EAAE;gBAEjB,OAAO,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC;gBAC5B,IAAI,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;gBAE9B,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;oBAC9B,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;iBAC1D;aACF;YAED,IAAI,GAAG,CAAC,SAAS,EAAE;gBACjB,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,UAAU,CAAC,SAAS,EAAE,GAAG,CAAC,SAAS,CAAC,CAAC;aACnE;YAGD,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,UAAU,CAAC,SAAS,EAAE,SAAS,CAAC,KAAK,CAAC,SAAS,EAAE,GAAG,CAAC,SAAS,CAAC,CAAC;YAC7F,OAAO,GAAG,CAAC,KAAK,CAAC;YACjB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACjB,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;IAClC,CAAC;IACD,UAAU,EAAE,SAAS,UAAU,CAAC,MAAM,EAAE,MAAM;QAC5C,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAC9C,IAAI,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAChD,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAC3B,IAAI,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC5B,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QACxC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACtB,aAAa,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,MAAM,CAAC,UAAU,IAAI,EAAE,CAAC;YACvD,IAAI,CAAC,IAAI,EAAE;gBACT,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACpB,OAAO,KAAK,CAAC;aACd;YAED,OAAO,IAAI,CAAC;QACd,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,IAAI,EAAE;YACR,aAAa,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;YACpC,aAAa,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAChC,aAAa,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SACrC;QAED,aAAa,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;QAChD,aAAa,CAAC,IAAI,EAAE,CAAC;IACvB,CAAC;IACD,OAAO,EAAE,SAAS,OAAO;QACvB,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,OAAO,EAAE,CAAC;QAEpC,UAAU,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC3C,CAAC;CACF,CAAC,CAAC;AAEH,MAAM,CAAC,OAAO,GAAG,UAAU,CAAC","sourcesContent":["var _require = require('../../renderer'),\n    Group = _require.Group;\n\nvar _require2 = require('@antv/component/lib'),\n    Label = _require2.Label; // const visualCenter = require('@antv/component/lib/label/utils/visual-center');\n\n\nvar Global = require('../../global');\n\nvar Util = require('../../util');\n\nvar IGNORE_ARR = ['line', 'point', 'path'];\nvar ORIGIN = '_origin';\n\nfunction avg(arr) {\n  var sum = 0;\n  Util.each(arr, function (value) {\n    sum += value;\n  });\n  return sum / arr.length;\n} // 计算多边形重心: https://en.wikipedia.org/wiki/Centroid#Of_a_polygon\n\n\nfunction getCentroid(xs, ys) {\n  if (Util.isNumber(xs) && Util.isNumber(ys)) {\n    return [xs, ys];\n  }\n\n  var i = -1,\n      x = 0,\n      y = 0;\n  var former,\n      current = xs.length - 1;\n  var diff,\n      k = 0;\n\n  while (++i < xs.length) {\n    former = current;\n    current = i;\n    k += diff = xs[former] * ys[current] - xs[current] * ys[former];\n    x += (xs[former] + xs[current]) * diff;\n    y += (ys[former] + ys[current]) * diff;\n  }\n\n  k *= 3;\n  return [x / k, y / k];\n}\n\nvar GeomLabels = function GeomLabels(cfg) {\n  GeomLabels.superclass.constructor.call(this, cfg);\n};\n\nUtil.extend(GeomLabels, Group);\nUtil.augment(GeomLabels, {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      label: Global.label,\n\n      /**\n       * 用户传入的文本配置信息\n       * @type {Object}\n       */\n      labelCfg: null,\n\n      /**\n       * 所在的坐标系\n       * @type {Object}\n       */\n      coord: null,\n\n      /**\n       * 图表的类型\n       * @type {String}\n       */\n      geomType: null,\n      zIndex: 6\n    };\n  },\n  _renderUI: function _renderUI() {\n    GeomLabels.superclass._renderUI.call(this);\n\n    this.initLabelsCfg();\n    var labelsGroup = this.addGroup();\n    var lineGroup = this.addGroup({\n      elCls: 'x-line-group'\n    });\n    var labelRenderer = this.get('labelRenderer');\n    this.set('labelsGroup', labelsGroup);\n    this.set('lineGroup', lineGroup);\n    this.get('labelRenderer').set('group', labelsGroup);\n    labelRenderer.set('group', labelsGroup);\n    labelRenderer.set('lineGroup', lineGroup);\n  },\n  // 初始化labels的配置项\n  initLabelsCfg: function initLabelsCfg() {\n    var self = this;\n    var labelRenderer = new Label();\n    var labels = self.getDefaultLabelCfg();\n    var labelCfg = self.get('labelCfg'); // Util.merge(labels, labelCfg.cfg);\n\n    Util.deepMix(labels, labelCfg.globalCfg || labelCfg.cfg);\n    labelRenderer.set('config', false);\n\n    if (labels.labelLine) {\n      labelRenderer.set('labelLine', labels.labelLine);\n    }\n\n    labelRenderer.set('coord', self.get('coord'));\n    this.set('labelRenderer', labelRenderer);\n    self.set('label', labels);\n  },\n\n  /**\n   * @protected\n   * 默认的文本样式\n   * @return {Object} default label config\n   */\n  getDefaultLabelCfg: function getDefaultLabelCfg() {\n    var self = this;\n    var labelCfg = self.get('labelCfg').cfg || self.get('labelCfg').globalCfg;\n    var geomType = self.get('geomType');\n    var viewTheme = self.get('viewTheme') || Global;\n\n    if (geomType === 'polygon' || labelCfg && labelCfg.offset < 0 && Util.indexOf(IGNORE_ARR, geomType) === -1) {\n      return Util.deepMix({}, self.get('label'), viewTheme.innerLabels, labelCfg);\n    }\n\n    return Util.deepMix({}, self.get('label'), viewTheme.label, labelCfg);\n  },\n\n  /**\n   * @protected\n   * 获取labels\n   * @param {Array} points points\n   * @param {Array} shapes shapes\n   * @return {Array} label items\n   */\n  getLabelsItems: function getLabelsItems(points, shapes) {\n    var self = this;\n    var items = [];\n    var geom = self.get('geom');\n    var coord = self.get('coord');\n\n    self._getLabelCfgs(points, shapes);\n\n    var labelCfg = self.get('labelItemCfgs'); // 获取label相关的x，y的值，获取具体的x,y,防止存在数组\n\n    Util.each(points, function (point, i) {\n      var origin = point[ORIGIN];\n      var label = labelCfg[i];\n\n      if (!label) {\n        items.push(null);\n        return;\n      }\n\n      if (!Util.isArray(label.text)) {\n        label.text = [label.text];\n      }\n\n      var total = label.text.length;\n      Util.each(label.text, function (sub, subIndex) {\n        if (Util.isNil(sub) || sub === '') {\n          items.push(null);\n          return;\n        }\n\n        var obj = self.getLabelPoint(label, point, subIndex);\n        obj = Util.mix({}, label, obj);\n\n        if (!obj.textAlign) {\n          obj.textAlign = self.getLabelAlign(obj, subIndex, total);\n        }\n\n        if (geom) {\n          obj._id = geom._getShapeId(origin) + '-glabel-' + subIndex + '-' + obj.text;\n        }\n\n        obj.coord = coord;\n        items.push(obj);\n      });\n    });\n    return items;\n  },\n\n  /* /!*\n   * @protected\n   * 如果发生冲突则会调整文本的位置\n   * @param {Array} items 文本的集合\n   * @param {Array} shapes 关联形状\n   * @return {Array} adjusted items\n   *!/\n  adjustItems(items, shapes) {\n    // 多边形shape的label位于其可视中心\n    if (this.get('geomType') === 'polygon') {\n      let index,\n        shape,\n        path,\n        center,\n        points;\n      Util.each(items, (item, i) => {\n        if (!item) return;\n        shape = shapes[ i ];\n        path = shape.attr('path');\n        points = [[]];\n        index = 0;\n        path.forEach((segment, i) => {\n          if (segment[ 0 ] === 'z' || segment[ 0 ] === 'Z' && i !== path.length - 1) {\n            points.push([]);\n            index += 1;\n          }\n          if (segment.length === 3) {\n            points[ index ].push([ segment[ 1 ], segment[ 2 ] ]);\n          }\n        });\n        center = visualCenter(points);\n        item.x = center.x;\n        item.y = center.y;\n      });\n    }\n    return items;\n  }\n  */\n  adjustItems: function adjustItems(items) {\n    Util.each(items, function (item) {\n      if (!item) {\n        return;\n      }\n\n      if (item.offsetX) {\n        item.x += item.offsetX;\n      }\n\n      if (item.offsetY) {\n        item.y += item.offsetY;\n      }\n    });\n    return items;\n  },\n\n  /**\n   * drawing lines to labels\n   * @param  {Array} items labels\n   * @param  {Object} labelLine configuration for label lines\n   */\n  drawLines: function drawLines(items) {\n    var self = this;\n    Util.each(items, function (point) {\n      if (!point) {\n        return;\n      }\n\n      if (point.offset > 0) {\n        self.lineToLabel(point);\n      }\n    });\n  },\n  // 定义连接线\n  lineToLabel: function lineToLabel() {},\n\n  /**\n   * @protected\n   * 获取文本的位置信息\n   * @param {Array} labelCfg labels\n   * @param {Object} point point\n   * @param {Number} index index\n   * @return {Object} point\n   */\n  getLabelPoint: function getLabelPoint(labelCfg, point, index) {\n    var self = this;\n    var coord = self.get('coord');\n    var total = labelCfg.text.length;\n\n    function getDimValue(value, idx) {\n      if (Util.isArray(value)) {\n        if (labelCfg.text.length === 1) {\n          // 如果仅一个label,多个y,取最后一个y\n          if (value.length <= 2) {\n            value = value[value.length - 1]; // value = value[0];\n          } else {\n            value = avg(value);\n          }\n        } else {\n          value = value[idx];\n        }\n      }\n\n      return value;\n    }\n\n    var label = {\n      text: labelCfg.text[index]\n    }; // 多边形场景,多用于地图\n\n    if (point && this.get('geomType') === 'polygon') {\n      var centroid = getCentroid(point.x, point.y); // 多边形的场景也有 x 和 y 只是数字的情况，譬如当 x 和 y 都是分类字段的时候 @see #1184\n\n      label.x = centroid[0];\n      label.y = centroid[1];\n    } else {\n      label.x = getDimValue(point.x, index);\n      label.y = getDimValue(point.y, index);\n    } // get nearest point of the shape as the label line start point\n\n\n    if (point && point.nextPoints && (point.shape === 'funnel' || point.shape === 'pyramid')) {\n      var maxX = -Infinity;\n      point.nextPoints.forEach(function (p) {\n        p = coord.convert(p);\n\n        if (p.x > maxX) {\n          maxX = p.x;\n        }\n      });\n      label.x = (label.x + maxX) / 2;\n    } // sharp edge of the pyramid\n\n\n    if (point.shape === 'pyramid' && !point.nextPoints && point.points) {\n      point.points.forEach(function (p) {\n        p = coord.convert(p);\n\n        if (Util.isArray(p.x) && !point.x.includes(p.x) || Util.isNumber(p.x) && point.x !== p.x) {\n          label.x = (label.x + p.x) / 2;\n        }\n      });\n    }\n\n    if (labelCfg.position) {\n      self.setLabelPosition(label, point, index, labelCfg.position);\n    }\n\n    var offsetPoint = self.getLabelOffset(labelCfg, index, total);\n\n    if (labelCfg.offsetX) {\n      offsetPoint.x += labelCfg.offsetX;\n    }\n\n    if (labelCfg.offsetY) {\n      offsetPoint.y += labelCfg.offsetY;\n    }\n\n    self.transLabelPoint(label);\n    label.start = {\n      x: label.x,\n      y: label.y\n    };\n    label.x += offsetPoint.x;\n    label.y += offsetPoint.y;\n    label.color = point.color;\n    return label;\n  },\n  setLabelPosition: function setLabelPosition() {},\n  transLabelPoint: function transLabelPoint(point) {\n    var self = this;\n    var coord = self.get('coord');\n    var tmpPoint = coord.applyMatrix(point.x, point.y, 1);\n    point.x = tmpPoint[0];\n    point.y = tmpPoint[1];\n  },\n  getOffsetVector: function getOffsetVector(point) {\n    var self = this;\n    var offset = point.offset || 0;\n    var coord = self.get('coord');\n    var vector;\n\n    if (coord.isTransposed) {\n      // 如果x,y翻转，则偏移x\n      vector = coord.applyMatrix(offset, 0);\n    } else {\n      // 否则，偏转y\n      vector = coord.applyMatrix(0, offset);\n    }\n\n    return vector;\n  },\n  // 获取默认的偏移量\n  getDefaultOffset: function getDefaultOffset(point) {\n    var self = this;\n    var offset = 0;\n    var coord = self.get('coord');\n    var vector = self.getOffsetVector(point);\n\n    if (coord.isTransposed) {\n      // 如果x,y翻转，则偏移x\n      offset = vector[0];\n    } else {\n      // 否则，偏转y\n      offset = vector[1];\n    }\n\n    var yScale = this.get('yScale');\n\n    if (yScale && point.point) {\n      // 仅考虑 y 单值的情况，多值的情况在这里不考虑\n      var yValue = point.point[yScale.field];\n\n      if (yValue < 0) {\n        offset = offset * -1; // 如果 y 值是负值，则反向\n      }\n    }\n\n    return offset;\n  },\n  // 获取文本的偏移位置，x,y\n  getLabelOffset: function getLabelOffset(point, index, total) {\n    var self = this;\n    var offset = self.getDefaultOffset(point);\n    var coord = self.get('coord');\n    var transposed = coord.isTransposed;\n    var yField = transposed ? 'x' : 'y';\n    var factor = transposed ? 1 : -1; // y 方向上越大，像素的坐标越小，所以transposed时将系数变成\n\n    var offsetPoint = {\n      x: 0,\n      y: 0\n    };\n\n    if (index > 0 || total === 1) {\n      // 判断是否小于0\n      offsetPoint[yField] = offset * factor;\n    } else {\n      offsetPoint[yField] = offset * factor * -1;\n    }\n\n    return offsetPoint;\n  },\n  getLabelAlign: function getLabelAlign(point, index, total) {\n    var self = this;\n    var align = 'center';\n    var coord = self.get('coord');\n\n    if (coord.isTransposed) {\n      var offset = self.getDefaultOffset(point); // var vector = coord.applyMatrix(offset,0);\n\n      if (offset < 0) {\n        align = 'right';\n      } else if (offset === 0) {\n        align = 'center';\n      } else {\n        align = 'left';\n      }\n\n      if (total > 1 && index === 0) {\n        if (align === 'right') {\n          align = 'left';\n        } else if (align === 'left') {\n          align = 'right';\n        }\n      }\n    }\n\n    return align;\n  },\n  _getLabelValue: function _getLabelValue(origin, scales) {\n    if (!Util.isArray(scales)) {\n      scales = [scales];\n    }\n\n    var text = [];\n    Util.each(scales, function (scale) {\n      var value = origin[scale.field];\n\n      if (Util.isArray(value)) {\n        var tmp = [];\n        Util.each(value, function (subVal) {\n          tmp.push(scale.getText(subVal));\n        });\n        value = tmp;\n      } else {\n        value = scale.getText(value);\n      }\n\n      if (Util.isNil(value) || value === '') {\n        text.push(null);\n      }\n\n      text.push(value);\n    });\n    return text;\n  },\n  // 获取每个label的配置\n  _getLabelCfgs: function _getLabelCfgs(points) {\n    var self = this;\n    var labelCfg = this.get('labelCfg');\n    var scales = labelCfg.scales;\n    var defaultCfg = this.get('label');\n    var viewTheme = self.get('viewTheme') || Global;\n    var cfgs = [];\n\n    if (labelCfg.globalCfg && labelCfg.globalCfg.type) {\n      self.set('type', labelCfg.globalCfg.type);\n    }\n\n    Util.each(points, function (point, i) {\n      var cfg = {};\n      var origin = point[ORIGIN];\n\n      var originText = self._getLabelValue(origin, scales);\n\n      if (labelCfg.callback) {\n        // callback中应使用原始数据，而不是数据字符串\n        var originValues = scales.map(function (scale) {\n          return origin[scale.field];\n        }); // 将point信息以及index信息也返回，方便能够根据point以及index，返回不同的配置\n\n        cfg = labelCfg.callback.apply(null, [].concat(originValues, [point, i]));\n      }\n\n      if (!cfg && cfg !== 0) {\n        cfgs.push(null);\n        return;\n      }\n\n      if (Util.isString(cfg) || Util.isNumber(cfg)) {\n        cfg = {\n          text: cfg\n        };\n      } else {\n        cfg.text = cfg.content || originText[0];\n        delete cfg.content;\n      }\n\n      cfg = Util.mix({}, defaultCfg, labelCfg.globalCfg || {}, cfg); // 兼容旧的源数据写在item.point中\n\n      point.point = origin;\n      cfg.point = origin;\n\n      if (cfg.htmlTemplate) {\n        cfg.useHtml = true;\n        cfg.text = cfg.htmlTemplate.call(null, cfg.text, point, i);\n        delete cfg.htmlTemplate;\n      }\n\n      if (cfg.formatter) {\n        cfg.text = cfg.formatter.call(null, cfg.text, point, i);\n        delete cfg.formatter;\n      }\n\n      if (cfg.label) {\n        // 兼容有些直接写在labelCfg.label的配置\n        var label = cfg.label;\n        delete cfg.label;\n        cfg = Util.mix(cfg, label);\n      }\n\n      if (cfg.textStyle) {\n        // 兼容旧写法，globalCfg的offset优先级高\n        delete cfg.textStyle.offset;\n        var textStyle = cfg.textStyle;\n\n        if (Util.isFunction(textStyle)) {\n          cfg.textStyle = textStyle.call(null, cfg.text, point, i);\n        }\n      }\n\n      if (cfg.labelLine) {\n        cfg.labelLine = Util.mix({}, defaultCfg.labelLine, cfg.labelLine);\n      } // 因为 defaultCfg.textStyle 有可能是函数，所以这里可能没有把主题的 label 样式合进来\n\n\n      cfg.textStyle = Util.mix({}, defaultCfg.textStyle, viewTheme.label.textStyle, cfg.textStyle);\n      delete cfg.items;\n      cfgs.push(cfg);\n    });\n    this.set('labelItemCfgs', cfgs);\n  },\n  showLabels: function showLabels(points, shapes) {\n    var self = this;\n    var labelRenderer = self.get('labelRenderer');\n    var items = self.getLabelsItems(points, shapes);\n    shapes = [].concat(shapes);\n    var type = self.get('type');\n    items = self.adjustItems(items, shapes);\n    self.drawLines(items);\n    labelRenderer.set('items', items.filter(function (item, i) {\n      if (!item) {\n        shapes.splice(i, 1);\n        return false;\n      }\n\n      return true;\n    }));\n\n    if (type) {\n      labelRenderer.set('shapes', shapes);\n      labelRenderer.set('type', type);\n      labelRenderer.set('points', points);\n    }\n\n    labelRenderer.set('canvas', this.get('canvas'));\n    labelRenderer.draw();\n  },\n  destroy: function destroy() {\n    this.get('labelRenderer').destroy(); // 清理文本\n\n    GeomLabels.superclass.destroy.call(this);\n  }\n}); // Util.assign(GeomLabels.prototype, Labels.LabelslabelRenderer);\n\nmodule.exports = GeomLabels;"]}]}