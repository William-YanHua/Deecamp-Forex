{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\util\\draw.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\util\\draw.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { each, isArray } from '@antv/util';\r\nimport { parseStyle } from './parse';\r\nimport getArcParams from './arc-params';\r\nimport { mergeRegion, intersectRect } from './util';\r\nimport * as ArrowUtil from '../util/arrow';\r\nvar SHAPE_ATTRS_MAP = {\r\n    fill: 'fillStyle',\r\n    stroke: 'strokeStyle',\r\n    opacity: 'globalAlpha',\r\n};\r\nexport function applyAttrsToContext(context, element) {\r\n    var attrs = element.attr();\r\n    for (var k in attrs) {\r\n        var v = attrs[k];\r\n        var name_1 = SHAPE_ATTRS_MAP[k] ? SHAPE_ATTRS_MAP[k] : k;\r\n        if (name_1 === 'matrix' && v) {\r\n            context.transform(v[0], v[1], v[3], v[4], v[6], v[7]);\r\n        }\r\n        else if (name_1 === 'lineDash' && context.setLineDash) {\r\n            isArray(v) && context.setLineDash(v);\r\n        }\r\n        else {\r\n            if (name_1 === 'strokeStyle' || name_1 === 'fillStyle') {\r\n                v = parseStyle(context, element, v);\r\n            }\r\n            else if (name_1 === 'globalAlpha') {\r\n                v = v * context.globalAlpha;\r\n            }\r\n            context[name_1] = v;\r\n        }\r\n    }\r\n}\r\nexport function drawChildren(context, children, region) {\r\n    for (var i = 0; i < children.length; i++) {\r\n        var child = children[i];\r\n        if (child.get('visible')) {\r\n            child.draw(context, region);\r\n        }\r\n        else {\r\n            child.skipDraw();\r\n        }\r\n    }\r\n}\r\nexport function drawPath(shape, context, attrs, arcParamsCache) {\r\n    var path = attrs.path, startArrow = attrs.startArrow, endArrow = attrs.endArrow;\r\n    var currentPoint = [0, 0];\r\n    var startMovePoint = [0, 0];\r\n    var distance = {\r\n        dx: 0,\r\n        dy: 0,\r\n    };\r\n    context.beginPath();\r\n    for (var i = 0; i < path.length; i++) {\r\n        var params = path[i];\r\n        var command = params[0];\r\n        if (i === 0 && startArrow && startArrow.d) {\r\n            var tangent = shape.getStartTangent();\r\n            distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], startArrow.d);\r\n        }\r\n        else if (i === path.length - 2 && path[i + 1][0] === 'Z' && endArrow && endArrow.d) {\r\n            var lastPath = path[i + 1];\r\n            if (lastPath[0] === 'Z') {\r\n                var tangent = shape.getEndTangent();\r\n                distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], endArrow.d);\r\n            }\r\n        }\r\n        else if (i === path.length - 1 && endArrow && endArrow.d) {\r\n            if (path[0] !== 'Z') {\r\n                var tangent = shape.getEndTangent();\r\n                distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], endArrow.d);\r\n            }\r\n        }\r\n        var dx = distance.dx, dy = distance.dy;\r\n        switch (command) {\r\n            case 'M':\r\n                context.moveTo(params[1] - dx, params[2] - dy);\r\n                startMovePoint = [params[1], params[2]];\r\n                break;\r\n            case 'L':\r\n                context.lineTo(params[1] - dx, params[2] - dy);\r\n                break;\r\n            case 'Q':\r\n                context.quadraticCurveTo(params[1], params[2], params[3] - dx, params[4] - dy);\r\n                break;\r\n            case 'C':\r\n                context.bezierCurveTo(params[1], params[2], params[3], params[4], params[5] - dx, params[6] - dy);\r\n                break;\r\n            case 'A': {\r\n                var arcParams = void 0;\r\n                if (arcParamsCache) {\r\n                    arcParams = arcParamsCache[i];\r\n                    if (!arcParams) {\r\n                        arcParams = getArcParams(currentPoint, params);\r\n                        arcParamsCache[i] = arcParams;\r\n                    }\r\n                }\r\n                else {\r\n                    arcParams = getArcParams(currentPoint, params);\r\n                }\r\n                var cx = arcParams.cx, cy = arcParams.cy, rx = arcParams.rx, ry = arcParams.ry, startAngle = arcParams.startAngle, endAngle = arcParams.endAngle, xRotation = arcParams.xRotation, sweepFlag = arcParams.sweepFlag;\r\n                if (context.ellipse) {\r\n                    context.ellipse(cx, cy, rx, ry, xRotation, startAngle, endAngle, 1 - sweepFlag);\r\n                }\r\n                else {\r\n                    var r = rx > ry ? rx : ry;\r\n                    var scaleX = rx > ry ? 1 : rx / ry;\r\n                    var scaleY = rx > ry ? ry / rx : 1;\r\n                    context.translate(cx, cy);\r\n                    context.rotate(xRotation);\r\n                    context.scale(scaleX, scaleY);\r\n                    context.arc(0, 0, r, startAngle, endAngle, 1 - sweepFlag);\r\n                    context.scale(1 / scaleX, 1 / scaleY);\r\n                    context.rotate(-xRotation);\r\n                    context.translate(-cx, -cy);\r\n                }\r\n                break;\r\n            }\r\n            case 'Z':\r\n                context.closePath();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (command === 'Z') {\r\n            currentPoint = startMovePoint;\r\n        }\r\n        else {\r\n            var len = params.length;\r\n            currentPoint = [params[len - 2], params[len - 1]];\r\n        }\r\n    }\r\n}\r\nexport function refreshElement(element, changeType) {\r\n    var canvas = element.get('canvas');\r\n    if (canvas) {\r\n        if (changeType === 'remove') {\r\n            element._cacheCanvasBBox = element.get('cacheCanvasBBox');\r\n        }\r\n        if (!element.get('hasChanged')) {\r\n            canvas.refreshElement(element, changeType, canvas);\r\n            if (canvas.get('autoDraw')) {\r\n                canvas.draw();\r\n            }\r\n            element.set('hasChanged', true);\r\n        }\r\n    }\r\n}\r\nexport function getRefreshRegion(element) {\r\n    var region;\r\n    if (!element.destroyed) {\r\n        var cacheBox = element.get('cacheCanvasBBox');\r\n        var validCache = cacheBox && !!(cacheBox.width && cacheBox.height);\r\n        var bbox = element.getCanvasBBox();\r\n        var validBBox = bbox && !!(bbox.width && bbox.height);\r\n        if (validCache && validBBox) {\r\n            region = mergeRegion(cacheBox, bbox);\r\n        }\r\n        else if (validCache) {\r\n            region = cacheBox;\r\n        }\r\n        else if (validBBox) {\r\n            region = bbox;\r\n        }\r\n    }\r\n    else {\r\n        region = element['_cacheCanvasBBox'];\r\n    }\r\n    return region;\r\n}\r\nexport function getMergedRegion(elements) {\r\n    if (!elements.length) {\r\n        return null;\r\n    }\r\n    var minXArr = [];\r\n    var minYArr = [];\r\n    var maxXArr = [];\r\n    var maxYArr = [];\r\n    each(elements, function (el) {\r\n        var region = getRefreshRegion(el);\r\n        if (region) {\r\n            minXArr.push(region.minX);\r\n            minYArr.push(region.minY);\r\n            maxXArr.push(region.maxX);\r\n            maxYArr.push(region.maxY);\r\n        }\r\n    });\r\n    return {\r\n        minX: Math.min.apply(null, minXArr),\r\n        minY: Math.min.apply(null, minYArr),\r\n        maxX: Math.max.apply(null, maxXArr),\r\n        maxY: Math.max.apply(null, maxYArr),\r\n    };\r\n}\r\nexport function mergeView(region, viewRegion) {\r\n    if (!region || !viewRegion) {\r\n        return null;\r\n    }\r\n    if (!intersectRect(region, viewRegion)) {\r\n        return null;\r\n    }\r\n    return {\r\n        minX: Math.max(region.minX, viewRegion.minX),\r\n        minY: Math.max(region.minY, viewRegion.minY),\r\n        maxX: Math.min(region.maxX, viewRegion.maxX),\r\n        maxY: Math.min(region.maxY, viewRegion.maxY),\r\n    };\r\n}\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\util\\draw.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\util\\draw.js"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,YAAY,CAAC;AAC3C,OAAO,EAAE,UAAU,EAAE,MAAM,SAAS,CAAC;AACrC,OAAO,YAAY,MAAM,cAAc,CAAC;AACxC,OAAO,EAAE,WAAW,EAAE,aAAa,EAAE,MAAM,QAAQ,CAAC;AACpD,OAAO,KAAK,SAAS,MAAM,eAAe,CAAC;AAC3C,IAAI,eAAe,GAAG;IAClB,IAAI,EAAE,WAAW;IACjB,MAAM,EAAE,aAAa;IACrB,OAAO,EAAE,aAAa;CACzB,CAAC;AACF,MAAM,UAAU,mBAAmB,CAAC,OAAO,EAAE,OAAO;IAChD,IAAI,KAAK,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC;IAC3B,KAAK,IAAI,CAAC,IAAI,KAAK,EAAE;QACjB,IAAI,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;QAEjB,IAAI,MAAM,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACzD,IAAI,MAAM,KAAK,QAAQ,IAAI,CAAC,EAAE;YAE1B,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SACzD;aACI,IAAI,MAAM,KAAK,UAAU,IAAI,OAAO,CAAC,WAAW,EAAE;YAEnD,OAAO,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;SACxC;aACI;YACD,IAAI,MAAM,KAAK,aAAa,IAAI,MAAM,KAAK,WAAW,EAAE;gBAGpD,CAAC,GAAG,UAAU,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;aACvC;iBACI,IAAI,MAAM,KAAK,aAAa,EAAE;gBAE/B,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,WAAW,CAAC;aAC/B;YACD,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACvB;KACJ;AACL,CAAC;AACD,MAAM,UAAU,YAAY,CAAC,OAAO,EAAE,QAAQ,EAAE,MAAM;IAClD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACtC,IAAI,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QACxB,IAAI,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;YACtB,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;SAC/B;aACI;YACD,KAAK,CAAC,QAAQ,EAAE,CAAC;SACpB;KACJ;AACL,CAAC;AAED,MAAM,UAAU,QAAQ,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,cAAc;IAC1D,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,UAAU,GAAG,KAAK,CAAC,UAAU,EAAE,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;IAChF,IAAI,YAAY,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC1B,IAAI,cAAc,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC5B,IAAI,QAAQ,GAAG;QACX,EAAE,EAAE,CAAC;QACL,EAAE,EAAE,CAAC;KACR,CAAC;IACF,OAAO,CAAC,SAAS,EAAE,CAAC;IACpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAClC,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACrB,IAAI,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;QACxB,IAAI,CAAC,KAAK,CAAC,IAAI,UAAU,IAAI,UAAU,CAAC,CAAC,EAAE;YACvC,IAAI,OAAO,GAAG,KAAK,CAAC,eAAe,EAAE,CAAC;YACtC,QAAQ,GAAG,SAAS,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC;SACnH;aACI,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,IAAI,QAAQ,IAAI,QAAQ,CAAC,CAAC,EAAE;YAEhF,IAAI,QAAQ,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YAC3B,IAAI,QAAQ,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;gBACrB,IAAI,OAAO,GAAG,KAAK,CAAC,aAAa,EAAE,CAAC;gBACpC,QAAQ,GAAG,SAAS,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;aACjH;SACJ;aACI,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,QAAQ,IAAI,QAAQ,CAAC,CAAC,EAAE;YACtD,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;gBACjB,IAAI,OAAO,GAAG,KAAK,CAAC,aAAa,EAAE,CAAC;gBACpC,QAAQ,GAAG,SAAS,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;aACjH;SACJ;QACD,IAAI,EAAE,GAAG,QAAQ,CAAC,EAAE,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE,CAAC;QAEvC,QAAQ,OAAO,EAAE;YACb,KAAK,GAAG;gBACJ,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC/C,cAAc,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBACxC,MAAM;YACV,KAAK,GAAG;gBACJ,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC/C,MAAM;YACV,KAAK,GAAG;gBACJ,OAAO,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC/E,MAAM;YACV,KAAK,GAAG;gBACJ,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBAClG,MAAM;YACV,KAAK,GAAG,CAAC,CAAC;gBACN,IAAI,SAAS,GAAG,KAAK,CAAC,CAAC;gBAEvB,IAAI,cAAc,EAAE;oBAChB,SAAS,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC;oBAC9B,IAAI,CAAC,SAAS,EAAE;wBACZ,SAAS,GAAG,YAAY,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;wBAC/C,cAAc,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC;qBACjC;iBACJ;qBACI;oBACD,SAAS,GAAG,YAAY,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;iBAClD;gBACD,IAAI,EAAE,GAAG,SAAS,CAAC,EAAE,EAAE,EAAE,GAAG,SAAS,CAAC,EAAE,EAAE,EAAE,GAAG,SAAS,CAAC,EAAE,EAAE,EAAE,GAAG,SAAS,CAAC,EAAE,EAAE,UAAU,GAAG,SAAS,CAAC,UAAU,EAAE,QAAQ,GAAG,SAAS,CAAC,QAAQ,EAAE,SAAS,GAAG,SAAS,CAAC,SAAS,EAAE,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC;gBAEnN,IAAI,OAAO,CAAC,OAAO,EAAE;oBACjB,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,SAAS,EAAE,UAAU,EAAE,QAAQ,EAAE,CAAC,GAAG,SAAS,CAAC,CAAC;iBACnF;qBACI;oBACD,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;oBAC1B,IAAI,MAAM,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC;oBACnC,IAAI,MAAM,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;oBACnC,OAAO,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBAC1B,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;oBAC1B,OAAO,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;oBAC9B,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,UAAU,EAAE,QAAQ,EAAE,CAAC,GAAG,SAAS,CAAC,CAAC;oBAC1D,OAAO,CAAC,KAAK,CAAC,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;oBACtC,OAAO,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,CAAC;oBAC3B,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC;iBAC/B;gBACD,MAAM;aACT;YACD,KAAK,GAAG;gBACJ,OAAO,CAAC,SAAS,EAAE,CAAC;gBACpB,MAAM;YACV;gBACI,MAAM;SACb;QAED,IAAI,OAAO,KAAK,GAAG,EAAE;YACjB,YAAY,GAAG,cAAc,CAAC;SACjC;aACI;YACD,IAAI,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC;YACxB,YAAY,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;SACrD;KACJ;AACL,CAAC;AAED,MAAM,UAAU,cAAc,CAAC,OAAO,EAAE,UAAU;IAC9C,IAAI,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAEnC,IAAI,MAAM,EAAE;QACR,IAAI,UAAU,KAAK,QAAQ,EAAE;YAIzB,OAAO,CAAC,gBAAgB,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;SAC7D;QAED,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE;YAM5B,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,UAAU,EAAE,MAAM,CAAC,CAAC;YACnD,IAAI,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;gBACxB,MAAM,CAAC,IAAI,EAAE,CAAC;aACjB;YACD,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;SACnC;KACJ;AACL,CAAC;AACD,MAAM,UAAU,gBAAgB,CAAC,OAAO;IACpC,IAAI,MAAM,CAAC;IACX,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;QACpB,IAAI,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QAC9C,IAAI,UAAU,GAAG,QAAQ,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,IAAI,QAAQ,CAAC,MAAM,CAAC,CAAC;QACnE,IAAI,IAAI,GAAG,OAAO,CAAC,aAAa,EAAE,CAAC;QACnC,IAAI,SAAS,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC;QAEtD,IAAI,UAAU,IAAI,SAAS,EAAE;YACzB,MAAM,GAAG,WAAW,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;SACxC;aACI,IAAI,UAAU,EAAE;YACjB,MAAM,GAAG,QAAQ,CAAC;SACrB;aACI,IAAI,SAAS,EAAE;YAChB,MAAM,GAAG,IAAI,CAAC;SACjB;KACJ;SACI;QAED,MAAM,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC;KACxC;IACD,OAAO,MAAM,CAAC;AAClB,CAAC;AACD,MAAM,UAAU,eAAe,CAAC,QAAQ;IACpC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;QAClB,OAAO,IAAI,CAAC;KACf;IACD,IAAI,OAAO,GAAG,EAAE,CAAC;IACjB,IAAI,OAAO,GAAG,EAAE,CAAC;IACjB,IAAI,OAAO,GAAG,EAAE,CAAC;IACjB,IAAI,OAAO,GAAG,EAAE,CAAC;IACjB,IAAI,CAAC,QAAQ,EAAE,UAAU,EAAE;QACvB,IAAI,MAAM,GAAG,gBAAgB,CAAC,EAAE,CAAC,CAAC;QAClC,IAAI,MAAM,EAAE;YACR,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAC1B,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAC1B,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAC1B,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SAC7B;IACL,CAAC,CAAC,CAAC;IACH,OAAO;QACH,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC;QACnC,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC;QACnC,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC;QACnC,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC;KACtC,CAAC;AACN,CAAC;AACD,MAAM,UAAU,SAAS,CAAC,MAAM,EAAE,UAAU;IACxC,IAAI,CAAC,MAAM,IAAI,CAAC,UAAU,EAAE;QACxB,OAAO,IAAI,CAAC;KACf;IAED,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,UAAU,CAAC,EAAE;QACpC,OAAO,IAAI,CAAC;KACf;IACD,OAAO;QACH,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC;QAC5C,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC;QAC5C,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC;QAC5C,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC;KAC/C,CAAC;AACN,CAAC","sourcesContent":["import { each, isArray } from '@antv/util';\nimport { parseStyle } from './parse';\nimport getArcParams from './arc-params';\nimport { mergeRegion, intersectRect } from './util';\nimport * as ArrowUtil from '../util/arrow';\nvar SHAPE_ATTRS_MAP = {\n    fill: 'fillStyle',\n    stroke: 'strokeStyle',\n    opacity: 'globalAlpha',\n};\nexport function applyAttrsToContext(context, element) {\n    var attrs = element.attr();\n    for (var k in attrs) {\n        var v = attrs[k];\n        // 转换一下不与 canvas 兼容的属性名\n        var name_1 = SHAPE_ATTRS_MAP[k] ? SHAPE_ATTRS_MAP[k] : k;\n        if (name_1 === 'matrix' && v) {\n            // 设置矩阵\n            context.transform(v[0], v[1], v[3], v[4], v[6], v[7]);\n        }\n        else if (name_1 === 'lineDash' && context.setLineDash) {\n            // 设置虚线，只支持数组形式，非数组形式不做任何操作\n            isArray(v) && context.setLineDash(v);\n        }\n        else {\n            if (name_1 === 'strokeStyle' || name_1 === 'fillStyle') {\n                // 如果存在渐变、pattern 这个开销有些大\n                // 可以考虑缓存机制，通过 hasUpdate 来避免一些运算\n                v = parseStyle(context, element, v);\n            }\n            else if (name_1 === 'globalAlpha') {\n                // opacity 效果可以叠加，子元素的 opacity 需要与父元素 opacity 相乘\n                v = v * context.globalAlpha;\n            }\n            context[name_1] = v;\n        }\n    }\n}\nexport function drawChildren(context, children, region) {\n    for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n        if (child.get('visible')) {\n            child.draw(context, region);\n        }\n        else {\n            child.skipDraw();\n        }\n    }\n}\n// 绘制 path\nexport function drawPath(shape, context, attrs, arcParamsCache) {\n    var path = attrs.path, startArrow = attrs.startArrow, endArrow = attrs.endArrow;\n    var currentPoint = [0, 0]; // 当前图形\n    var startMovePoint = [0, 0]; // 开始 M 的点，可能会有多个\n    var distance = {\n        dx: 0,\n        dy: 0,\n    };\n    context.beginPath();\n    for (var i = 0; i < path.length; i++) {\n        var params = path[i];\n        var command = params[0];\n        if (i === 0 && startArrow && startArrow.d) {\n            var tangent = shape.getStartTangent();\n            distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], startArrow.d);\n        }\n        else if (i === path.length - 2 && path[i + 1][0] === 'Z' && endArrow && endArrow.d) {\n            // 为了防止结尾为 Z 的 segment 缩短不起效，需要取最后两个 segment 特殊处理\n            var lastPath = path[i + 1];\n            if (lastPath[0] === 'Z') {\n                var tangent = shape.getEndTangent();\n                distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], endArrow.d);\n            }\n        }\n        else if (i === path.length - 1 && endArrow && endArrow.d) {\n            if (path[0] !== 'Z') {\n                var tangent = shape.getEndTangent();\n                distance = ArrowUtil.getShortenOffset(tangent[0][0], tangent[0][1], tangent[1][0], tangent[1][1], endArrow.d);\n            }\n        }\n        var dx = distance.dx, dy = distance.dy;\n        // V,H,S,T 都在前面被转换成标准形式\n        switch (command) {\n            case 'M':\n                context.moveTo(params[1] - dx, params[2] - dy);\n                startMovePoint = [params[1], params[2]];\n                break;\n            case 'L':\n                context.lineTo(params[1] - dx, params[2] - dy);\n                break;\n            case 'Q':\n                context.quadraticCurveTo(params[1], params[2], params[3] - dx, params[4] - dy);\n                break;\n            case 'C':\n                context.bezierCurveTo(params[1], params[2], params[3], params[4], params[5] - dx, params[6] - dy);\n                break;\n            case 'A': {\n                var arcParams = void 0;\n                // 为了加速绘制，可以提供参数的缓存，各个图形自己缓存\n                if (arcParamsCache) {\n                    arcParams = arcParamsCache[i];\n                    if (!arcParams) {\n                        arcParams = getArcParams(currentPoint, params);\n                        arcParamsCache[i] = arcParams;\n                    }\n                }\n                else {\n                    arcParams = getArcParams(currentPoint, params);\n                }\n                var cx = arcParams.cx, cy = arcParams.cy, rx = arcParams.rx, ry = arcParams.ry, startAngle = arcParams.startAngle, endAngle = arcParams.endAngle, xRotation = arcParams.xRotation, sweepFlag = arcParams.sweepFlag;\n                // 直接使用椭圆的 api\n                if (context.ellipse) {\n                    context.ellipse(cx, cy, rx, ry, xRotation, startAngle, endAngle, 1 - sweepFlag);\n                }\n                else {\n                    var r = rx > ry ? rx : ry;\n                    var scaleX = rx > ry ? 1 : rx / ry;\n                    var scaleY = rx > ry ? ry / rx : 1;\n                    context.translate(cx, cy);\n                    context.rotate(xRotation);\n                    context.scale(scaleX, scaleY);\n                    context.arc(0, 0, r, startAngle, endAngle, 1 - sweepFlag);\n                    context.scale(1 / scaleX, 1 / scaleY);\n                    context.rotate(-xRotation);\n                    context.translate(-cx, -cy);\n                }\n                break;\n            }\n            case 'Z':\n                context.closePath();\n                break;\n            default:\n                break;\n        }\n        // 有了 Z 后，当前节点从开始 M 的点开始\n        if (command === 'Z') {\n            currentPoint = startMovePoint;\n        }\n        else {\n            var len = params.length;\n            currentPoint = [params[len - 2], params[len - 1]];\n        }\n    }\n}\n// 刷新图形元素(Shape 或者 Group)\nexport function refreshElement(element, changeType) {\n    var canvas = element.get('canvas');\n    // 只有存在于 canvas 上时生效\n    if (canvas) {\n        if (changeType === 'remove') {\n            // 一旦 remove，则无法在 element 上拿到包围盒\n            // destroy 后所有属性都拿不到，所以需要暂存一下\n            // 这是一段 hack 的代码\n            element._cacheCanvasBBox = element.get('cacheCanvasBBox');\n        }\n        // 防止反复刷新\n        if (!element.get('hasChanged')) {\n            // 本来只有局部渲染模式下，才需要记录更新的元素队列\n            // if (canvas.get('localRefresh')) {\n            //   canvas.refreshElement(element, changeType, canvas);\n            // }\n            // 但对于 https://github.com/antvis/g/issues/422 的场景，全局渲染的模式下也需要记录更新的元素队列\n            canvas.refreshElement(element, changeType, canvas);\n            if (canvas.get('autoDraw')) {\n                canvas.draw();\n            }\n            element.set('hasChanged', true);\n        }\n    }\n}\nexport function getRefreshRegion(element) {\n    var region;\n    if (!element.destroyed) {\n        var cacheBox = element.get('cacheCanvasBBox');\n        var validCache = cacheBox && !!(cacheBox.width && cacheBox.height);\n        var bbox = element.getCanvasBBox();\n        var validBBox = bbox && !!(bbox.width && bbox.height);\n        // 是否是有效 bbox 判定，一些 NaN 或者 宽高为 0 的情况过滤掉\n        if (validCache && validBBox) {\n            region = mergeRegion(cacheBox, bbox);\n        }\n        else if (validCache) {\n            region = cacheBox;\n        }\n        else if (validBBox) {\n            region = bbox;\n        }\n    }\n    else {\n        // 因为元素已经销毁所以无法获取到缓存的包围盒\n        region = element['_cacheCanvasBBox'];\n    }\n    return region;\n}\nexport function getMergedRegion(elements) {\n    if (!elements.length) {\n        return null;\n    }\n    var minXArr = [];\n    var minYArr = [];\n    var maxXArr = [];\n    var maxYArr = [];\n    each(elements, function (el) {\n        var region = getRefreshRegion(el);\n        if (region) {\n            minXArr.push(region.minX);\n            minYArr.push(region.minY);\n            maxXArr.push(region.maxX);\n            maxYArr.push(region.maxY);\n        }\n    });\n    return {\n        minX: Math.min.apply(null, minXArr),\n        minY: Math.min.apply(null, minYArr),\n        maxX: Math.max.apply(null, maxXArr),\n        maxY: Math.max.apply(null, maxYArr),\n    };\n}\nexport function mergeView(region, viewRegion) {\n    if (!region || !viewRegion) {\n        return null;\n    }\n    // 不相交，则直接返回 null\n    if (!intersectRect(region, viewRegion)) {\n        return null;\n    }\n    return {\n        minX: Math.max(region.minX, viewRegion.minX),\n        minY: Math.max(region.minY, viewRegion.minY),\n        maxX: Math.min(region.maxX, viewRegion.maxX),\n        maxY: Math.min(region.maxY, viewRegion.maxY),\n    };\n}\n//# sourceMappingURL=draw.js.map"]}]}