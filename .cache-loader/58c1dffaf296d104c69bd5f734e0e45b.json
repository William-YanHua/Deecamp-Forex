{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\util\\data.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\util\\data.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { __assign } from \"tslib\";\r\nimport { groupBy, mapValues, map, flatten, isNumber, reduce, each } from '@antv/util';\r\nexport var transformDataPercentage = function (data, groupField, measures) {\r\n    var chain = groupBy(data, groupField);\r\n    chain = mapValues(chain, function (items) { return map(items, function (item) { return map(measures, function (field) { return item[field]; }); }); });\r\n    chain = mapValues(chain, flatten);\r\n    chain = mapValues(chain, function (vals) {\r\n        return map(vals, function (val) {\r\n            var v = Number.parseFloat(val);\r\n            if (!isNumber(v) || isNaN(v)) {\r\n                return 0;\r\n            }\r\n            return v;\r\n        });\r\n    });\r\n    var groupTotals = mapValues(chain, function (vals) { return reduce(vals, function (sum, val) { return sum + val; }, 0); });\r\n    var newData = map(data, function (item) {\r\n        var rst = __assign(__assign({}, item), { _origin: item, total: groupTotals[item[groupField]] });\r\n        each(measures, function (field) {\r\n            rst[field] = item[field] / (groupTotals[item[groupField]] || 1);\r\n        });\r\n        return rst;\r\n    });\r\n    each(groupBy(newData, groupField), function (items) {\r\n        var sum = 0;\r\n        each(items, function (item, itemIdx) {\r\n            each(measures, function (field, fieldIdx) {\r\n                if (sum + item[field] >= 1 || (itemIdx === items.length - 1 && fieldIdx === measures.length - 1 && sum > 0)) {\r\n                    item[field] = 1 - sum;\r\n                }\r\n                sum += item[field];\r\n            });\r\n        });\r\n    });\r\n    return newData;\r\n};\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\util\\data.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\util\\data.js"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AACjC,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,EAAE,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,YAAY,CAAC;AACtF,MAAM,CAAC,IAAI,uBAAuB,GAAG,UAAU,IAAI,EAAE,UAAU,EAAE,QAAQ;IAErE,IAAI,KAAK,GAAG,OAAO,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;IACtC,KAAK,GAAG,SAAS,CAAC,KAAK,EAAE,UAAU,KAAK,IAAI,OAAO,GAAG,CAAC,KAAK,EAAE,UAAU,IAAI,IAAI,OAAO,GAAG,CAAC,QAAQ,EAAE,UAAU,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACvJ,KAAK,GAAG,SAAS,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;IAClC,KAAK,GAAG,SAAS,CAAC,KAAK,EAAE,UAAU,IAAI;QACnC,OAAO,GAAG,CAAC,IAAI,EAAE,UAAU,GAAG;YAE1B,IAAI,CAAC,GAAG,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAC/B,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,EAAE;gBAC1B,OAAO,CAAC,CAAC;aACZ;YACD,OAAO,CAAC,CAAC;QACb,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAI,WAAW,GAAG,SAAS,CAAC,KAAK,EAAE,UAAU,IAAI,IAAI,OAAO,MAAM,CAAC,IAAI,EAAE,UAAU,GAAG,EAAE,GAAG,IAAI,OAAO,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAE3H,IAAI,OAAO,GAAG,GAAG,CAAC,IAAI,EAAE,UAAU,IAAI;QAElC,IAAI,GAAG,GAAG,QAAQ,CAAC,QAAQ,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC;QAChG,IAAI,CAAC,QAAQ,EAAE,UAAU,KAAK;YAE1B,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QACH,OAAO,GAAG,CAAC;IACf,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,UAAU,CAAC,EAAE,UAAU,KAAK;QAC9C,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,IAAI,CAAC,KAAK,EAAE,UAAU,IAAI,EAAE,OAAO;YAC/B,IAAI,CAAC,QAAQ,EAAE,UAAU,KAAK,EAAE,QAAQ;gBAEpC,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,KAAK,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,QAAQ,KAAK,QAAQ,CAAC,MAAM,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,CAAC,EAAE;oBACzG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;iBACzB;gBAED,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;YACvB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,OAAO,OAAO,CAAC;AACnB,CAAC,CAAC","sourcesContent":["import { __assign } from \"tslib\";\nimport { groupBy, mapValues, map, flatten, isNumber, reduce, each } from '@antv/util';\nexport var transformDataPercentage = function (data, groupField, measures) {\n    // 按照groupBy字段计算各个group的总和\n    var chain = groupBy(data, groupField);\n    chain = mapValues(chain, function (items) { return map(items, function (item) { return map(measures, function (field) { return item[field]; }); }); });\n    chain = mapValues(chain, flatten);\n    chain = mapValues(chain, function (vals) {\n        return map(vals, function (val) {\n            // @ts-ignore\n            var v = Number.parseFloat(val);\n            if (!isNumber(v) || isNaN(v)) {\n                return 0;\n            }\n            return v;\n        });\n    });\n    // @ts-ignore\n    var groupTotals = mapValues(chain, function (vals) { return reduce(vals, function (sum, val) { return sum + val; }, 0); });\n    // 覆盖measures字段的值为对于的百分比\n    var newData = map(data, function (item) {\n        // @ts-ignore\n        var rst = __assign(__assign({}, item), { _origin: item, total: groupTotals[item[groupField]] });\n        each(measures, function (field) {\n            // @ts-ignore\n            rst[field] = item[field] / (groupTotals[item[groupField]] || 1);\n        });\n        return rst;\n    });\n    // 检查精度，确保总和为1\n    each(groupBy(newData, groupField), function (items) {\n        var sum = 0;\n        each(items, function (item, itemIdx) {\n            each(measures, function (field, fieldIdx) {\n                // @ts-ignore\n                if (sum + item[field] >= 1 || (itemIdx === items.length - 1 && fieldIdx === measures.length - 1 && sum > 0)) {\n                    item[field] = 1 - sum;\n                }\n                // @ts-ignore\n                sum += item[field];\n            });\n        });\n    });\n    // @ts-ignore\n    return newData;\n};\n//# sourceMappingURL=data.js.map"]}]}