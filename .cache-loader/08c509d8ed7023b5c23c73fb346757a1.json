{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\range-bar\\component\\label.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\range-bar\\component\\label.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { each, deepMix, clone, find } from '@antv/util';\r\nimport { rgb2arr } from '../../../util/color';\r\nimport BBox from '../../../util/bbox';\r\nvar DEFAULT_OFFSET = 8;\r\nfunction mappingColor(band, gray) {\r\n    var reflect;\r\n    each(band, function (b) {\r\n        var map = b;\r\n        if (gray >= map.from && gray < map.to) {\r\n            reflect = map.color;\r\n        }\r\n    });\r\n    return reflect;\r\n}\r\nvar RangeBarLabel = (function () {\r\n    function RangeBarLabel(cfg) {\r\n        this.destroyed = false;\r\n        this.view = cfg.view;\r\n        this.plot = cfg.plot;\r\n        var defaultOptions = this.getDefaultOptions();\r\n        this.options = deepMix(defaultOptions, cfg, {});\r\n        if (!this.options.leftStyle) {\r\n            this.options.leftStyle = this.options.style;\r\n        }\r\n        if (!this.options.rightStyle) {\r\n            this.options.rightStyle = this.options.style;\r\n        }\r\n        this.init();\r\n    }\r\n    RangeBarLabel.prototype.init = function () {\r\n        var _this = this;\r\n        this.container = this.getGeometry().labelsContainer;\r\n        this.view.on('beforerender', function () {\r\n            _this.clear();\r\n            _this.plot.canvas.draw();\r\n        });\r\n    };\r\n    RangeBarLabel.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.getGeometry(), elements = _a.elements, coordinate = _a.coordinate;\r\n        this.coord = coordinate;\r\n        each(elements, function (ele) {\r\n            var shape = ele.shape;\r\n            var positions = _this.getPosition(shape);\r\n            var values = _this.getValue(shape);\r\n            var textAlign = _this.getTextAlign();\r\n            var labels = [];\r\n            each(positions, function (pos, i) {\r\n                var style = i === 0 ? _this.options.leftStyle : _this.options.rightStyle;\r\n                var color = _this.getTextColor(shape, i);\r\n                if (_this.options.position === 'inner' && _this.options.adjustColor && color !== 'black') {\r\n                    style.stroke = null;\r\n                }\r\n                var formatter = _this.options.formatter;\r\n                var content = formatter ? formatter(values[i]) : values[i];\r\n                var label = _this.container.addShape('text', {\r\n                    attrs: deepMix({}, style, {\r\n                        x: pos.x,\r\n                        y: pos.y,\r\n                        text: content,\r\n                        fill: color,\r\n                        textAlign: textAlign[i],\r\n                        textBaseline: 'middle',\r\n                    }),\r\n                    name: 'label',\r\n                });\r\n                labels.push(label);\r\n                _this.doAnimation(label);\r\n            });\r\n            shape.set('labelShapes', labels);\r\n            _this.adjustPosition(labels[0], labels[1], shape);\r\n        });\r\n        this.plot.canvas.draw();\r\n    };\r\n    RangeBarLabel.prototype.hide = function () {\r\n        this.container.set('visible', false);\r\n        this.plot.canvas.draw();\r\n    };\r\n    RangeBarLabel.prototype.show = function () {\r\n        this.container.set('visible', true);\r\n        this.plot.canvas.draw();\r\n    };\r\n    RangeBarLabel.prototype.clear = function () {\r\n        if (this.container) {\r\n            this.container.clear();\r\n        }\r\n    };\r\n    RangeBarLabel.prototype.destroy = function () {\r\n        if (this.container) {\r\n            this.container.remove();\r\n        }\r\n        this.destroyed = true;\r\n    };\r\n    RangeBarLabel.prototype.getBBox = function () {\r\n        return this.container.getBBox();\r\n    };\r\n    RangeBarLabel.prototype.getShapeBbox = function (shape) {\r\n        var _this = this;\r\n        var points = [];\r\n        each(shape.get('origin').points, function (p) {\r\n            points.push(_this.coord.convertPoint(p));\r\n        });\r\n        var bbox = new BBox(points[0].x, points[1].y, Math.abs(points[2].x - points[0].x), Math.abs(points[0].y - points[1].y));\r\n        return bbox;\r\n    };\r\n    RangeBarLabel.prototype.getDefaultOptions = function () {\r\n        var theme = this.plot.theme;\r\n        var labelStyle = theme.label.style;\r\n        return {\r\n            position: 'outer',\r\n            offsetX: DEFAULT_OFFSET,\r\n            offsetY: 0,\r\n            style: clone(labelStyle),\r\n            adjustColor: true,\r\n            adjustPosition: true,\r\n        };\r\n    };\r\n    RangeBarLabel.prototype.getPosition = function (shape) {\r\n        var bbox = this.getShapeBbox(shape);\r\n        var minX = bbox.minX, maxX = bbox.maxX, minY = bbox.minY, height = bbox.height;\r\n        var _a = this.options, offsetX = _a.offsetX, offsetY = _a.offsetY;\r\n        var y = minY + height / 2 + offsetY;\r\n        var x1, x2;\r\n        if (this.options.position === 'outer') {\r\n            x1 = minX - offsetX;\r\n            x2 = maxX + offsetX;\r\n        }\r\n        else {\r\n            x1 = minX + offsetX;\r\n            x2 = maxX - offsetX;\r\n        }\r\n        return [\r\n            { x: x1, y: y },\r\n            { x: x2, y: y },\r\n        ];\r\n    };\r\n    RangeBarLabel.prototype.getValue = function (shape) {\r\n        var xField = this.plot.options.xField;\r\n        return shape.get('origin').data[xField];\r\n    };\r\n    RangeBarLabel.prototype.getTextAlign = function () {\r\n        if (this.options.position === 'outer') {\r\n            return ['right', 'left'];\r\n        }\r\n        else {\r\n            return ['left', 'right'];\r\n        }\r\n    };\r\n    RangeBarLabel.prototype.getTextColor = function (shape, index) {\r\n        if (this.options.adjustColor && this.options.position === 'inner') {\r\n            var shapeColor = shape.attr('fill');\r\n            var shapeOpacity = shape.attr('opacity') ? shape.attr('opacity') : 1;\r\n            var rgb = rgb2arr(shapeColor);\r\n            var gray = Math.round(rgb[0] * 0.299 + rgb[1] * 0.587 + rgb[2] * 0.114) / shapeOpacity;\r\n            var colorBand = [\r\n                { from: 0, to: 85, color: 'white' },\r\n                { from: 85, to: 170, color: '#F6F6F6' },\r\n                { from: 170, to: 255, color: 'black' },\r\n            ];\r\n            var reflect = mappingColor(colorBand, gray);\r\n            return reflect;\r\n        }\r\n        var defaultColor = index === 0 ? this.options.leftStyle.fill : this.options.rightStyle.fill;\r\n        return defaultColor;\r\n    };\r\n    RangeBarLabel.prototype.doAnimation = function (label) {\r\n        if (this.plot.animation && this.plot.animation === false) {\r\n            return;\r\n        }\r\n        label.attr('fillOpacity', 0);\r\n        label.attr('strokeOpacity', 0);\r\n        label.stopAnimate();\r\n        label.animate({\r\n            fillOpacity: 1,\r\n            strokeOpacity: 1,\r\n        }, 800, 'easeLinear', 500);\r\n    };\r\n    RangeBarLabel.prototype.adjustPosition = function (la, lb, shape) {\r\n        var origin = shape.get('origin');\r\n        var shapeMinX = origin.x[0];\r\n        var shapeMaxX = origin.x[1];\r\n        var shapeWidth = Math.abs(shapeMaxX - shapeMinX);\r\n        var panelRange = this.view.coordinateBBox;\r\n        var boxes = [la.getBBox(), lb.getBBox()];\r\n        var ax = la.attr('x');\r\n        var bx = lb.attr('x');\r\n        if (this.options.adjustPosition && this.options.position === 'inner') {\r\n            var totalLength = boxes[0].width + boxes[1].width;\r\n            var isOverlap = boxes[0].maxX - boxes[1].minX > 2;\r\n            var isTooShort = totalLength > shapeWidth;\r\n            if (isOverlap || isTooShort) {\r\n                ax = shapeMinX - this.options.offsetX;\r\n                la.attr('fill', this.options.leftStyle.fill);\r\n                la.attr('textAlign', 'right');\r\n                boxes[0] = la.getBBox();\r\n                bx = shapeMaxX + this.options.offsetX;\r\n                lb.attr('fill', this.options.rightStyle.fill);\r\n                lb.attr('textAlign', 'left');\r\n                boxes[1] = lb.getBBox();\r\n            }\r\n        }\r\n        if (boxes[0].minX < panelRange.minX) {\r\n            ax = panelRange.minX + DEFAULT_OFFSET;\r\n            la.attr('textAlign', 'left');\r\n        }\r\n        la.attr('x', ax);\r\n        lb.attr('x', bx);\r\n        this.plot.canvas.draw();\r\n    };\r\n    RangeBarLabel.prototype.getGeometry = function () {\r\n        return find(this.view.geometries, function (geom) { return geom.type === 'interval'; });\r\n    };\r\n    return RangeBarLabel;\r\n}());\r\nexport default RangeBarLabel;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\range-bar\\component\\label.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\range-bar\\component\\label.js"],"names":[],"mappings":"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","sourcesContent":["import { each, deepMix, clone, find } from '@antv/util';\nimport { rgb2arr } from '../../../util/color';\nimport BBox from '../../../util/bbox';\nvar DEFAULT_OFFSET = 8;\nfunction mappingColor(band, gray) {\n    var reflect;\n    each(band, function (b) {\n        var map = b;\n        if (gray >= map.from && gray < map.to) {\n            reflect = map.color;\n        }\n    });\n    return reflect;\n}\nvar RangeBarLabel = /** @class */ (function () {\n    function RangeBarLabel(cfg) {\n        this.destroyed = false;\n        this.view = cfg.view;\n        this.plot = cfg.plot;\n        var defaultOptions = this.getDefaultOptions();\n        this.options = deepMix(defaultOptions, cfg, {});\n        if (!this.options.leftStyle) {\n            this.options.leftStyle = this.options.style;\n        }\n        if (!this.options.rightStyle) {\n            this.options.rightStyle = this.options.style;\n        }\n        this.init();\n    }\n    RangeBarLabel.prototype.init = function () {\n        var _this = this;\n        this.container = this.getGeometry().labelsContainer;\n        this.view.on('beforerender', function () {\n            _this.clear();\n            _this.plot.canvas.draw();\n        });\n    };\n    RangeBarLabel.prototype.render = function () {\n        var _this = this;\n        var _a = this.getGeometry(), elements = _a.elements, coordinate = _a.coordinate;\n        this.coord = coordinate;\n        each(elements, function (ele) {\n            var shape = ele.shape;\n            var positions = _this.getPosition(shape);\n            var values = _this.getValue(shape);\n            var textAlign = _this.getTextAlign();\n            var labels = [];\n            each(positions, function (pos, i) {\n                var style = i === 0 ? _this.options.leftStyle : _this.options.rightStyle;\n                var color = _this.getTextColor(shape, i);\n                if (_this.options.position === 'inner' && _this.options.adjustColor && color !== 'black') {\n                    style.stroke = null;\n                }\n                var formatter = _this.options.formatter;\n                var content = formatter ? formatter(values[i]) : values[i];\n                var label = _this.container.addShape('text', {\n                    attrs: deepMix({}, style, {\n                        x: pos.x,\n                        y: pos.y,\n                        text: content,\n                        fill: color,\n                        textAlign: textAlign[i],\n                        textBaseline: 'middle',\n                    }),\n                    name: 'label',\n                });\n                labels.push(label);\n                _this.doAnimation(label);\n            });\n            shape.set('labelShapes', labels);\n            _this.adjustPosition(labels[0], labels[1], shape);\n        });\n        this.plot.canvas.draw();\n    };\n    RangeBarLabel.prototype.hide = function () {\n        this.container.set('visible', false);\n        this.plot.canvas.draw();\n    };\n    RangeBarLabel.prototype.show = function () {\n        this.container.set('visible', true);\n        this.plot.canvas.draw();\n    };\n    RangeBarLabel.prototype.clear = function () {\n        if (this.container) {\n            this.container.clear();\n        }\n    };\n    RangeBarLabel.prototype.destroy = function () {\n        if (this.container) {\n            this.container.remove();\n        }\n        this.destroyed = true;\n    };\n    RangeBarLabel.prototype.getBBox = function () {\n        return this.container.getBBox();\n    };\n    RangeBarLabel.prototype.getShapeBbox = function (shape) {\n        var _this = this;\n        var points = [];\n        each(shape.get('origin').points, function (p) {\n            points.push(_this.coord.convertPoint(p));\n        });\n        var bbox = new BBox(points[0].x, points[1].y, Math.abs(points[2].x - points[0].x), Math.abs(points[0].y - points[1].y));\n        return bbox;\n    };\n    RangeBarLabel.prototype.getDefaultOptions = function () {\n        var theme = this.plot.theme;\n        var labelStyle = theme.label.style;\n        return {\n            position: 'outer',\n            offsetX: DEFAULT_OFFSET,\n            offsetY: 0,\n            style: clone(labelStyle),\n            adjustColor: true,\n            adjustPosition: true,\n        };\n    };\n    RangeBarLabel.prototype.getPosition = function (shape) {\n        var bbox = this.getShapeBbox(shape);\n        var minX = bbox.minX, maxX = bbox.maxX, minY = bbox.minY, height = bbox.height;\n        var _a = this.options, offsetX = _a.offsetX, offsetY = _a.offsetY;\n        var y = minY + height / 2 + offsetY;\n        var x1, x2;\n        if (this.options.position === 'outer') {\n            x1 = minX - offsetX;\n            x2 = maxX + offsetX;\n        }\n        else {\n            x1 = minX + offsetX;\n            x2 = maxX - offsetX;\n        }\n        return [\n            { x: x1, y: y },\n            { x: x2, y: y },\n        ];\n    };\n    RangeBarLabel.prototype.getValue = function (shape) {\n        var xField = this.plot.options.xField;\n        return shape.get('origin').data[xField];\n    };\n    RangeBarLabel.prototype.getTextAlign = function () {\n        if (this.options.position === 'outer') {\n            return ['right', 'left'];\n        }\n        else {\n            return ['left', 'right'];\n        }\n    };\n    RangeBarLabel.prototype.getTextColor = function (shape, index) {\n        if (this.options.adjustColor && this.options.position === 'inner') {\n            var shapeColor = shape.attr('fill');\n            var shapeOpacity = shape.attr('opacity') ? shape.attr('opacity') : 1;\n            var rgb = rgb2arr(shapeColor);\n            var gray = Math.round(rgb[0] * 0.299 + rgb[1] * 0.587 + rgb[2] * 0.114) / shapeOpacity;\n            var colorBand = [\n                { from: 0, to: 85, color: 'white' },\n                { from: 85, to: 170, color: '#F6F6F6' },\n                { from: 170, to: 255, color: 'black' },\n            ];\n            var reflect = mappingColor(colorBand, gray);\n            return reflect;\n        }\n        var defaultColor = index === 0 ? this.options.leftStyle.fill : this.options.rightStyle.fill;\n        return defaultColor;\n    };\n    RangeBarLabel.prototype.doAnimation = function (label) {\n        if (this.plot.animation && this.plot.animation === false) {\n            return;\n        }\n        label.attr('fillOpacity', 0);\n        label.attr('strokeOpacity', 0);\n        label.stopAnimate();\n        label.animate({\n            fillOpacity: 1,\n            strokeOpacity: 1,\n        }, 800, 'easeLinear', 500);\n    };\n    RangeBarLabel.prototype.adjustPosition = function (la, lb, shape) {\n        var origin = shape.get('origin');\n        var shapeMinX = origin.x[0];\n        var shapeMaxX = origin.x[1];\n        var shapeWidth = Math.abs(shapeMaxX - shapeMinX);\n        var panelRange = this.view.coordinateBBox;\n        var boxes = [la.getBBox(), lb.getBBox()];\n        var ax = la.attr('x');\n        var bx = lb.attr('x');\n        if (this.options.adjustPosition && this.options.position === 'inner') {\n            var totalLength = boxes[0].width + boxes[1].width;\n            var isOverlap = boxes[0].maxX - boxes[1].minX > 2;\n            var isTooShort = totalLength > shapeWidth;\n            if (isOverlap || isTooShort) {\n                ax = shapeMinX - this.options.offsetX;\n                la.attr('fill', this.options.leftStyle.fill);\n                la.attr('textAlign', 'right');\n                boxes[0] = la.getBBox();\n                bx = shapeMaxX + this.options.offsetX;\n                lb.attr('fill', this.options.rightStyle.fill);\n                lb.attr('textAlign', 'left');\n                boxes[1] = lb.getBBox();\n            }\n        }\n        if (boxes[0].minX < panelRange.minX) {\n            ax = panelRange.minX + DEFAULT_OFFSET;\n            la.attr('textAlign', 'left');\n        }\n        la.attr('x', ax);\n        lb.attr('x', bx);\n        this.plot.canvas.draw();\n    };\n    RangeBarLabel.prototype.getGeometry = function () {\n        return find(this.view.geometries, function (geom) { return geom.type === 'interval'; });\n    };\n    return RangeBarLabel;\n}());\nexport default RangeBarLabel;\n//# sourceMappingURL=label.js.map"]}]}