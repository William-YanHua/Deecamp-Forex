{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\facet\\base.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\facet\\base.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var Global = require('../global');\r\nvar Util = require('../util');\r\nvar assign = Util.assign;\r\nvar isNil = Util.isNil;\r\nvar isArray = Util.isArray;\r\nvar cloneDeep = Util.cloneDeep;\r\nvar wrapBehavior = Util.wrapBehavior;\r\nvar getWrapBehavior = Util.getWrapBehavior;\r\nvar Base = function () {\r\n    var _proto = Base.prototype;\r\n    _proto.getDefaultCfg = function getDefaultCfg() {\r\n        return {\r\n            chart: null,\r\n            group: null,\r\n            showTitle: true,\r\n            autoSetAxis: true,\r\n            padding: 10,\r\n            eachView: null,\r\n            fields: [],\r\n            colTitle: {\r\n                offsetY: -15,\r\n                style: {\r\n                    fontSize: 14,\r\n                    textAlign: 'center',\r\n                    fill: '#666',\r\n                    fontFamily: Global.fontFamily\r\n                }\r\n            },\r\n            rowTitle: {\r\n                offsetX: 15,\r\n                style: {\r\n                    fontSize: 14,\r\n                    textAlign: 'center',\r\n                    rotate: 90,\r\n                    fill: '#666',\r\n                    fontFamily: Global.fontFamily\r\n                }\r\n            }\r\n        };\r\n    };\r\n    function Base(cfg) {\r\n        var defaultCfg = this.getDefaultCfg();\r\n        assign(this, defaultCfg, cfg);\r\n        this.init();\r\n    }\r\n    _proto.init = function init() {\r\n        if (!this.chart) {\r\n            throw new Error('Facets Error: please specify the chart!');\r\n        }\r\n        this._bindEvent();\r\n        this.initContainer();\r\n        if (this.chart.get('data')) {\r\n            this.initViews();\r\n        }\r\n    };\r\n    _proto.initContainer = function initContainer() {\r\n        var chart = this.chart;\r\n        var frontPlot = chart.get('frontPlot');\r\n        var group = frontPlot.addGroup();\r\n        this.group = group;\r\n    };\r\n    _proto.initViews = function initViews() {\r\n        var chart = this.chart;\r\n        var data = chart.get('data');\r\n        var eachView = this.eachView;\r\n        var facets = this.generateFacets(data);\r\n        for (var i = 0; i < facets.length; i++) {\r\n            var facet = facets[i];\r\n            var region = facet.region;\r\n            var view = chart.view({\r\n                start: region.start,\r\n                end: region.end,\r\n                padding: this.padding\r\n            });\r\n            view.source(facet.data);\r\n            this.beforeProcessView(view, facet);\r\n            if (eachView) {\r\n                eachView(view, facet);\r\n            }\r\n            this.afterProcessView(view, facet);\r\n            facet.view = view;\r\n        }\r\n        this.facets = facets;\r\n    };\r\n    _proto.beforeProcessView = function beforeProcessView() { };\r\n    _proto.afterProcessView = function afterProcessView(view, facet) {\r\n        if (this.autoSetAxis) {\r\n            this.processAxis(view, facet);\r\n        }\r\n    };\r\n    _proto.processAxis = function processAxis(view, facet) {\r\n        var viewOptions = view.get('options');\r\n        var geoms = view.get('geoms');\r\n        if ((!viewOptions.coord.type || viewOptions.coord.type === 'rect') && geoms.length) {\r\n            var field = geoms[0].get('attrOptions').position.field;\r\n            var fields = isArray(field) ? field : field.split('*').map(function (str) {\r\n                return str.trim();\r\n            });\r\n            var xField = fields[0];\r\n            var yField = fields[1];\r\n            if (isNil(viewOptions.axes)) {\r\n                viewOptions.axes = {};\r\n            }\r\n            var axes = viewOptions.axes;\r\n            if (axes !== false) {\r\n                if (xField && axes[xField] !== false) {\r\n                    axes[xField] = axes[xField] || {};\r\n                    this.setXAxis(xField, axes, facet);\r\n                }\r\n                if (yField && axes[yField] !== false) {\r\n                    axes[yField] = axes[yField] || {};\r\n                    this.setYAxis(yField, axes, facet);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    _proto.setXAxis = function setXAxis() { };\r\n    _proto.setYAxis = function setYAxis() { };\r\n    _proto.renderTitle = function renderTitle(view, facet) {\r\n        this.drawColTitle(view, facet);\r\n    };\r\n    _proto.getScaleText = function getScaleText(field, value, view) {\r\n        var rst;\r\n        if (field) {\r\n            var scales = view.get('scales');\r\n            var scale = scales[field];\r\n            if (!scale) {\r\n                scale = view.createScale(field);\r\n            }\r\n            rst = scale.getText(value);\r\n        }\r\n        else {\r\n            rst = value;\r\n        }\r\n        return rst;\r\n    };\r\n    _proto.drawColTitle = function drawColTitle(view, facet) {\r\n        var text = this.getScaleText(facet.colField, facet.colValue, view);\r\n        var colTextCfg = assign({\r\n            position: ['50%', '0%'],\r\n            content: text\r\n        }, this.colTitle);\r\n        view.guide().text(colTextCfg);\r\n    };\r\n    _proto.drawRowTitle = function drawRowTitle(view, facet) {\r\n        var text = this.getScaleText(facet.rowField, facet.rowValue, view);\r\n        var rowTextCfg = assign({\r\n            position: ['100%', '50%'],\r\n            content: text\r\n        }, cloneDeep(this.rowTitle));\r\n        view.guide().text(rowTextCfg);\r\n    };\r\n    _proto.getFilter = function getFilter(conditions) {\r\n        var filter = function filter(obj) {\r\n            var filtered = true;\r\n            conditions.forEach(function (cond) {\r\n                var field = cond.field;\r\n                var value = cond.value;\r\n                var tmp = true;\r\n                if (!isNil(value) && field) {\r\n                    tmp = obj[field] === value;\r\n                }\r\n                filtered = filtered && tmp;\r\n            });\r\n            return filtered;\r\n        };\r\n        return filter;\r\n    };\r\n    _proto.getFieldValues = function getFieldValues(field, data) {\r\n        var rst = [];\r\n        var tmpMap = {};\r\n        for (var i = 0; i < data.length; i++) {\r\n            var obj = data[i];\r\n            var value = obj[field];\r\n            if (!isNil(value) && !tmpMap[value]) {\r\n                rst.push(value);\r\n                tmpMap[value] = true;\r\n            }\r\n        }\r\n        return rst;\r\n    };\r\n    _proto.getRegion = function getRegion(rows, cols, xIndex, yIndex) {\r\n        var xWidth = 1 / cols;\r\n        var yWidth = 1 / rows;\r\n        var start = {\r\n            x: xWidth * xIndex,\r\n            y: yWidth * yIndex\r\n        };\r\n        var end = {\r\n            x: start.x + xWidth,\r\n            y: start.y + yWidth\r\n        };\r\n        return {\r\n            start: start,\r\n            end: end\r\n        };\r\n    };\r\n    _proto.generateFacets = function generateFacets() {\r\n        return [];\r\n    };\r\n    _proto._bindEvent = function _bindEvent() {\r\n        var chart = this.chart;\r\n        chart.on('afterchangedata', wrapBehavior(this, 'onDataChange'));\r\n        chart.on('beforeclear', wrapBehavior(this, 'onClear'));\r\n        chart.on('beforedestroy', wrapBehavior(this, 'destroy'));\r\n        chart.on('beforepaint', wrapBehavior(this, 'onPaint'));\r\n        chart.on('setdata', wrapBehavior(this, 'onDataChange'));\r\n    };\r\n    _proto._clearEvent = function _clearEvent() {\r\n        var chart = this.chart;\r\n        if (chart) {\r\n            chart.off('afterchangedata', getWrapBehavior(this, 'onDataChange'));\r\n            chart.off('beforeclear', getWrapBehavior(this, 'onClear'));\r\n            chart.off('beforedestroy', getWrapBehavior(this, 'destroy'));\r\n            chart.off('beforepaint', getWrapBehavior(this, 'onPaint'));\r\n            chart.off('setdata', getWrapBehavior(this, 'onDataChange'));\r\n        }\r\n    };\r\n    _proto._clearFacets = function _clearFacets() {\r\n        var facets = this.facets;\r\n        var chart = this.chart;\r\n        if (facets) {\r\n            for (var i = 0; i < facets.length; i++) {\r\n                var facet = facets[i];\r\n                chart.removeView(facet.view);\r\n            }\r\n        }\r\n        this.facets = null;\r\n    };\r\n    _proto.onClear = function onClear() {\r\n        this.onRemove();\r\n    };\r\n    _proto.onPaint = function onPaint() {\r\n        if (this.showTitle) {\r\n            var facets = this.facets;\r\n            for (var i = 0; i < facets.length; i++) {\r\n                var facet = facets[i];\r\n                var view = facet.view;\r\n                this.renderTitle(view, facet);\r\n            }\r\n        }\r\n    };\r\n    _proto.onDataChange = function onDataChange() {\r\n        this._clearFacets();\r\n        this.initViews();\r\n    };\r\n    _proto.onRemove = function onRemove() {\r\n        this._clearFacets();\r\n        this._clearEvent();\r\n        this.group && this.group.remove();\r\n        this.chart = null;\r\n        this.facets = null;\r\n        this.group = null;\r\n    };\r\n    _proto.destroy = function destroy() {\r\n        this.onRemove();\r\n        this.destroyed = true;\r\n    };\r\n    return Base;\r\n}();\r\nmodule.exports = Base;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\facet\\base.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\facet\\base.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * @fileOverview facets of chart\n * @author dxq613@gmail.com\n */\nvar Global = require('../global');\n\nvar Util = require('../util');\n\nvar assign = Util.assign;\nvar isNil = Util.isNil;\nvar isArray = Util.isArray;\nvar cloneDeep = Util.cloneDeep; // 绑定事件\n\nvar wrapBehavior = Util.wrapBehavior; // 获取绑定的事件\n\nvar getWrapBehavior = Util.getWrapBehavior;\n\nvar Base =\n/*#__PURE__*/\nfunction () {\n  var _proto = Base.prototype;\n\n  _proto.getDefaultCfg = function getDefaultCfg() {\n    return {\n      chart: null,\n      group: null,\n\n      /**\n       * 是否默认显示每个分面的title\n       * @type {Boolean}\n       */\n      showTitle: true,\n\n      /**\n       * 是否自动修改坐标轴的信息\n       * @type {Boolean}\n       */\n      autoSetAxis: true,\n\n      /**\n       * View 的内边框\n       * @type {Number|Array}\n       */\n      padding: 10,\n\n      /**\n       * 遍历每个view 的回调函数\n       * @type {Function}\n       */\n      eachView: null,\n\n      /**\n       * 分面的字段名列表\n       * @type {Array}\n       */\n      fields: [],\n\n      /**\n       * 列值的的标题\n       * @type {Object}\n       */\n      colTitle: {\n        offsetY: -15,\n        style: {\n          fontSize: 14,\n          textAlign: 'center',\n          fill: '#666',\n          fontFamily: Global.fontFamily\n        }\n      },\n      rowTitle: {\n        offsetX: 15,\n        style: {\n          fontSize: 14,\n          textAlign: 'center',\n          rotate: 90,\n          fill: '#666',\n          fontFamily: Global.fontFamily\n        }\n      }\n    };\n  };\n\n  function Base(cfg) {\n    var defaultCfg = this.getDefaultCfg();\n    assign(this, defaultCfg, cfg);\n    this.init();\n  }\n\n  _proto.init = function init() {\n    if (!this.chart) {\n      throw new Error('Facets Error: please specify the chart!');\n    }\n\n    this._bindEvent();\n\n    this.initContainer();\n\n    if (this.chart.get('data')) {\n      this.initViews();\n    }\n  };\n\n  _proto.initContainer = function initContainer() {\n    var chart = this.chart;\n    var frontPlot = chart.get('frontPlot');\n    var group = frontPlot.addGroup();\n    this.group = group;\n  };\n\n  _proto.initViews = function initViews() {\n    var chart = this.chart;\n    var data = chart.get('data');\n    var eachView = this.eachView;\n    var facets = this.generateFacets(data);\n\n    for (var i = 0; i < facets.length; i++) {\n      var facet = facets[i];\n      var region = facet.region;\n      var view = chart.view({\n        start: region.start,\n        end: region.end,\n        padding: this.padding\n      });\n      view.source(facet.data);\n      this.beforeProcessView(view, facet);\n\n      if (eachView) {\n        eachView(view, facet);\n      }\n\n      this.afterProcessView(view, facet);\n      facet.view = view;\n    }\n\n    this.facets = facets;\n  };\n  /**\n   * 处理 view 前\n   * @protected\n   */\n\n\n  _proto.beforeProcessView = function beforeProcessView()\n  /* view, facet */\n  {};\n  /**\n   * 处理view\n   * @param {Object} view 视图\n   * @param {Object} facet 分面信息\n   * @protected\n   */\n\n\n  _proto.afterProcessView = function afterProcessView(view, facet) {\n    if (this.autoSetAxis) {\n      this.processAxis(view, facet);\n    }\n  };\n\n  _proto.processAxis = function processAxis(view, facet) {\n    var viewOptions = view.get('options');\n    var geoms = view.get('geoms');\n\n    if ((!viewOptions.coord.type || viewOptions.coord.type === 'rect') && geoms.length) {\n      var field = geoms[0].get('attrOptions').position.field;\n      var fields = isArray(field) ? field : field.split('*').map(function (str) {\n        return str.trim();\n      });\n      var xField = fields[0];\n      var yField = fields[1];\n\n      if (isNil(viewOptions.axes)) {\n        viewOptions.axes = {};\n      }\n\n      var axes = viewOptions.axes;\n\n      if (axes !== false) {\n        if (xField && axes[xField] !== false) {\n          axes[xField] = axes[xField] || {};\n          this.setXAxis(xField, axes, facet);\n        }\n\n        if (yField && axes[yField] !== false) {\n          axes[yField] = axes[yField] || {};\n          this.setYAxis(yField, axes, facet);\n        }\n      }\n    }\n  };\n\n  _proto.setXAxis = function setXAxis()\n  /* xField, axes, facet */\n  {};\n\n  _proto.setYAxis = function setYAxis()\n  /* yField, axes, facet */\n  {}; // 默认显示各列的标题\n\n\n  _proto.renderTitle = function renderTitle(view, facet) {\n    this.drawColTitle(view, facet);\n  };\n\n  _proto.getScaleText = function getScaleText(field, value, view) {\n    var rst;\n\n    if (field) {\n      var scales = view.get('scales');\n      var scale = scales[field];\n\n      if (!scale) {\n        scale = view.createScale(field);\n      }\n\n      rst = scale.getText(value);\n    } else {\n      rst = value;\n    }\n\n    return rst;\n  };\n\n  _proto.drawColTitle = function drawColTitle(view, facet) {\n    var text = this.getScaleText(facet.colField, facet.colValue, view);\n    var colTextCfg = assign({\n      position: ['50%', '0%'],\n      content: text\n    }, this.colTitle);\n    view.guide().text(colTextCfg);\n  };\n\n  _proto.drawRowTitle = function drawRowTitle(view, facet) {\n    var text = this.getScaleText(facet.rowField, facet.rowValue, view);\n    var rowTextCfg = assign({\n      position: ['100%', '50%'],\n      content: text\n    }, cloneDeep(this.rowTitle));\n    view.guide().text(rowTextCfg);\n  };\n  /**\n   * 数据过滤器\n   * @protected\n   * @param {Array} conditions 过滤条件\n   * @return {Function} 过滤函数\n   */\n\n\n  _proto.getFilter = function getFilter(conditions) {\n    var filter = function filter(obj) {\n      var filtered = true;\n      conditions.forEach(function (cond) {\n        var field = cond.field;\n        var value = cond.value; // const values = cond.values;\n\n        var tmp = true;\n\n        if (!isNil(value) && field) {\n          tmp = obj[field] === value;\n        }\n\n        filtered = filtered && tmp;\n      });\n      return filtered;\n    };\n\n    return filter;\n  };\n  /**\n   * 获取字段对应的值\n   * @protected\n   * @param  {String} field 字段名\n   * @param  {Array} data 数据\n   * @return {Array} 字段对应的值\n   */\n\n\n  _proto.getFieldValues = function getFieldValues(field, data) {\n    var rst = [];\n    var tmpMap = {};\n\n    for (var i = 0; i < data.length; i++) {\n      var obj = data[i];\n      var value = obj[field];\n\n      if (!isNil(value) && !tmpMap[value]) {\n        rst.push(value);\n        tmpMap[value] = true;\n      }\n    }\n\n    return rst;\n  };\n\n  _proto.getRegion = function getRegion(rows, cols, xIndex, yIndex) {\n    var xWidth = 1 / cols; // x轴方向的每个分面的偏移\n\n    var yWidth = 1 / rows; // y轴方向的每个分面的偏移\n\n    var start = {\n      x: xWidth * xIndex,\n      y: yWidth * yIndex\n    };\n    var end = {\n      x: start.x + xWidth,\n      y: start.y + yWidth\n    };\n    return {\n      start: start,\n      end: end\n    };\n  };\n  /**\n   * 生成分面\n   * @protected\n   * @return {Array} 多个分面集合\n   */\n\n\n  _proto.generateFacets = function generateFacets()\n  /* data */\n  {\n    return [];\n  };\n\n  _proto._bindEvent = function _bindEvent() {\n    var chart = this.chart;\n    chart.on('afterchangedata', wrapBehavior(this, 'onDataChange'));\n    chart.on('beforeclear', wrapBehavior(this, 'onClear'));\n    chart.on('beforedestroy', wrapBehavior(this, 'destroy'));\n    chart.on('beforepaint', wrapBehavior(this, 'onPaint'));\n    chart.on('setdata', wrapBehavior(this, 'onDataChange'));\n  };\n\n  _proto._clearEvent = function _clearEvent() {\n    var chart = this.chart;\n\n    if (chart) {\n      chart.off('afterchangedata', getWrapBehavior(this, 'onDataChange'));\n      chart.off('beforeclear', getWrapBehavior(this, 'onClear'));\n      chart.off('beforedestroy', getWrapBehavior(this, 'destroy'));\n      chart.off('beforepaint', getWrapBehavior(this, 'onPaint'));\n      chart.off('setdata', getWrapBehavior(this, 'onDataChange'));\n    }\n  };\n\n  _proto._clearFacets = function _clearFacets() {\n    var facets = this.facets;\n    var chart = this.chart;\n\n    if (facets) {\n      for (var i = 0; i < facets.length; i++) {\n        var facet = facets[i];\n        chart.removeView(facet.view);\n      }\n    }\n\n    this.facets = null;\n  };\n\n  _proto.onClear = function onClear() {\n    this.onRemove();\n  };\n\n  _proto.onPaint = function onPaint() {\n    if (this.showTitle) {\n      var facets = this.facets;\n\n      for (var i = 0; i < facets.length; i++) {\n        var facet = facets[i];\n        var view = facet.view;\n        this.renderTitle(view, facet);\n      }\n    }\n  };\n\n  _proto.onDataChange = function onDataChange() {\n    this._clearFacets();\n\n    this.initViews();\n  };\n\n  _proto.onRemove = function onRemove() {\n    this._clearFacets();\n\n    this._clearEvent();\n\n    this.group && this.group.remove();\n    this.chart = null;\n    this.facets = null;\n    this.group = null;\n  };\n\n  _proto.destroy = function destroy() {\n    this.onRemove();\n    this.destroyed = true;\n  };\n\n  return Base;\n}();\n\nmodule.exports = Base;"]}]}