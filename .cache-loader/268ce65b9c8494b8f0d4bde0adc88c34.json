{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\pie\\component\\label\\base-label.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\pie\\component\\label\\base-label.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { __assign } from \"tslib\";\r\nimport { ext } from '@antv/matrix-util';\r\nimport { deepMix, isString } from '@antv/util';\r\nimport { getEndPoint, getLabelRotate, getAngleByPoint, getOverlapArea, near } from './utils';\r\nimport { getEllipsisText } from '../../../../util/text';\r\nexport var CROOK_DISTANCE = 4;\r\nexport function percent2Number(value) {\r\n    var percentage = Number(value.endsWith('%') ? value.slice(0, -1) : value);\r\n    return percentage / 100;\r\n}\r\nfunction checkInPanel(label, panel) {\r\n    var box = label.getBBox();\r\n    if (!(panel.y <= box.y && panel.y + panel.height >= box.y + box.height)) {\r\n        label.get('parent').set('visible', false);\r\n    }\r\n}\r\nvar PieBaseLabel = (function () {\r\n    function PieBaseLabel(plot, cfg) {\r\n        this.destroyed = false;\r\n        this.plot = plot;\r\n        this.coordinateBBox = this.plot.view.coordinateBBox;\r\n        var options = deepMix(this.getDefaultOptions(), cfg, {});\r\n        this.adjustOption(options);\r\n        this.options = options;\r\n        this.init();\r\n    }\r\n    PieBaseLabel.prototype.adjustOverlap = function (labels, panel) {\r\n        for (var i = 1; i < labels.length; i++) {\r\n            var label = labels[i];\r\n            var overlapArea = 0;\r\n            for (var j = i - 1; j >= 0; j--) {\r\n                var prev = labels[j];\r\n                var prevBox = prev.getBBox();\r\n                var currBox = label.getBBox();\r\n                if (prev.get('parent').get('visible')) {\r\n                    overlapArea = getOverlapArea(prevBox, currBox);\r\n                    if (!near(overlapArea, 0)) {\r\n                        label.get('parent').set('visible', false);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        labels.forEach(function (label) { return checkInPanel(label, panel); });\r\n    };\r\n    PieBaseLabel.prototype.adjustItem = function (item) {\r\n        return;\r\n    };\r\n    PieBaseLabel.prototype.init = function () {\r\n        var _this = this;\r\n        this.container = this.getGeometry().labelsContainer;\r\n        this.plot.view.on('beforerender', function () {\r\n            _this.clear();\r\n            _this.plot.canvas.draw();\r\n        });\r\n    };\r\n    PieBaseLabel.prototype.render = function () {\r\n        this.clear();\r\n        this.initArcPoints();\r\n        this.drawTexts();\r\n        this.drawLines();\r\n    };\r\n    PieBaseLabel.prototype.clear = function () {\r\n        if (this.container) {\r\n            this.container.clear();\r\n        }\r\n    };\r\n    PieBaseLabel.prototype.hide = function () {\r\n        this.container.set('visible', false);\r\n        this.plot.canvas.draw();\r\n    };\r\n    PieBaseLabel.prototype.show = function () {\r\n        this.container.set('visible', true);\r\n        this.plot.canvas.draw();\r\n    };\r\n    PieBaseLabel.prototype.destroy = function () {\r\n        if (this.container) {\r\n            this.container.remove();\r\n        }\r\n        this.destroyed = true;\r\n    };\r\n    PieBaseLabel.prototype.getFilteredSum = function () {\r\n        var angleField = this.plot.options.angleField;\r\n        var filteredData = this.plot.view.filteredData || [];\r\n        return filteredData.reduce(function (pre, filteredDataItem) {\r\n            return pre + filteredDataItem[angleField];\r\n        }, 0);\r\n    };\r\n    PieBaseLabel.prototype.drawTexts = function () {\r\n        var _this = this;\r\n        var _a = this.options, style = _a.style, formatter = _a.formatter, autoRotate = _a.autoRotate, offsetX = _a.offsetX, offsetY = _a.offsetY, adjustPosition = _a.adjustPosition, allowOverlap = _a.allowOverlap;\r\n        var shapeInfos = this.getItems();\r\n        var shapes = [];\r\n        shapeInfos.map(function (shapeInfo, idx) {\r\n            var attrs = deepMix({}, shapeInfo, style);\r\n            var filteredSum = _this.getFilteredSum();\r\n            var angleField = _this.plot.options.angleField;\r\n            var percent = shapeInfo.origin[angleField] / filteredSum;\r\n            var content = formatter\r\n                ? formatter(shapeInfo.name, {\r\n                    _origin: shapeInfo.origin,\r\n                    percent: percent,\r\n                }, idx)\r\n                : shapeInfo.name;\r\n            var itemGroup = _this.container.addGroup({\r\n                name: 'itemGroup',\r\n                index: idx,\r\n                capture: false,\r\n            });\r\n            var textShape = itemGroup.addShape('text', {\r\n                attrs: deepMix({}, attrs, {\r\n                    x: shapeInfo.x + offsetX,\r\n                    y: shapeInfo.y + offsetY,\r\n                    text: content,\r\n                }),\r\n            });\r\n            textShape.set('id', \"text-\" + shapeInfo.name + \"-\" + idx);\r\n            shapes.push(textShape);\r\n        });\r\n        shapes.forEach(function (shape) {\r\n            var panelBox = _this.coordinateBBox;\r\n            _this.adjustText(shape, panelBox);\r\n        });\r\n        if (adjustPosition) {\r\n            this.layout(shapes, shapeInfos, this.coordinateBBox);\r\n        }\r\n        if (!allowOverlap) {\r\n            this.adjustOverlap(shapes, this.coordinateBBox);\r\n        }\r\n        shapes.forEach(function (label, idx) {\r\n            if (autoRotate) {\r\n                _this.rotateLabel(label, getLabelRotate(shapeInfos[idx].angle));\r\n            }\r\n        });\r\n    };\r\n    PieBaseLabel.prototype.adjustText = function (label, panelBox) {\r\n        var box = label.getBBox();\r\n        var width = box.width;\r\n        var deltaWidth = 0;\r\n        if (box.maxX > panelBox.maxX) {\r\n            width = panelBox.maxX - box.minX;\r\n        }\r\n        else if (box.minX < panelBox.minX) {\r\n            width = box.maxX - panelBox.minX;\r\n        }\r\n        if (label.attr('textAlign') === 'left') {\r\n            label.attr('x', Math.max(box.x - deltaWidth, 0));\r\n        }\r\n        else if (label.attr('textAlign') === 'right') {\r\n            label.attr('x', Math.max(box.maxX - deltaWidth, 0));\r\n        }\r\n        if (width !== box.width) {\r\n            var font_1 = {};\r\n            ['fontSize', 'fontFamily', 'fontWeight'].forEach(function (k) {\r\n                font_1[k] = label.attr(k);\r\n            });\r\n            var ellipsisTexts = label\r\n                .attr('text')\r\n                .split('\\n')\r\n                .map(function (t) { return getEllipsisText(t, width, font_1); });\r\n            label.attr('text', ellipsisTexts.join('\\n'));\r\n        }\r\n    };\r\n    PieBaseLabel.prototype.drawLines = function () {\r\n        var _this = this;\r\n        if (this.options.line.visible) {\r\n            var itemGroups = this.container.get('children');\r\n            var center_1 = this.getCoordinate().center;\r\n            itemGroups.forEach(function (labelGroup, idx) {\r\n                var label = labelGroup.get('children')[0];\r\n                var anchor = _this.arcPoints[idx];\r\n                var inLeft = anchor.x < center_1.x;\r\n                var distance = _this.options.offset > 4 ? 4 : 0;\r\n                var path = _this.getLinePath(label, anchor, distance);\r\n                var style = _this.options.line;\r\n                labelGroup.addShape('path', {\r\n                    attrs: __assign({ path: path, stroke: anchor.color }, style),\r\n                });\r\n                label.attr('x', label.attr('x') + (inLeft ? -distance : distance));\r\n            });\r\n        }\r\n    };\r\n    PieBaseLabel.prototype.getLinePath = function (label, anchor, distance) {\r\n        var smooth = this.options.line ? this.options.line.smooth : false;\r\n        var angle = anchor.angle;\r\n        var _a = this.getCoordinate(), center = _a.center, radius = _a.radius;\r\n        var breakAt = getEndPoint(center, angle, radius + distance);\r\n        if (distance < 4) {\r\n            breakAt = anchor;\r\n        }\r\n        var inLeft = anchor.x < center.x;\r\n        var box = label.getBBox();\r\n        var labelPosition = { x: inLeft ? box.maxX : box.minX, y: box.y + box.height / 2 };\r\n        var smoothPath = [\r\n            'C',\r\n            labelPosition.x +\r\n                (inLeft ? 1 : -1) * (distance < 4 ? distance / 2 : 4),\r\n            labelPosition.y,\r\n            2 * breakAt.x - anchor.x,\r\n            2 * breakAt.y - anchor.y,\r\n            breakAt.x,\r\n            breakAt.y,\r\n        ];\r\n        var straightPath = ['L', breakAt.x, breakAt.y];\r\n        var linePath = smooth ? smoothPath : straightPath;\r\n        var path = ['M', labelPosition.x, labelPosition.y].concat(linePath).concat('L', anchor.x, anchor.y);\r\n        return path.join(',');\r\n    };\r\n    PieBaseLabel.prototype.getGeometry = function () {\r\n        return this.plot.view.geometries[0];\r\n    };\r\n    PieBaseLabel.prototype.getCoordinate = function () {\r\n        var coordinate = this.getGeometry().coordinate;\r\n        var center = coordinate.getCenter();\r\n        var radius = coordinate.getRadius();\r\n        var startAngle = coordinate.startAngle;\r\n        return { center: center, radius: radius, startAngle: startAngle };\r\n    };\r\n    PieBaseLabel.prototype.adjustOption = function (options) {\r\n        var offset = options.offset;\r\n        var radius = this.getCoordinate().radius;\r\n        if (isString(offset)) {\r\n            offset = radius * percent2Number(offset);\r\n        }\r\n        options.offset = offset;\r\n    };\r\n    PieBaseLabel.prototype.rotateLabel = function (label, angle) {\r\n        var x = label.attr('x');\r\n        var y = label.attr('y');\r\n        var matrix = ext.transform(label.getMatrix(), [\r\n            ['t', -x, -y],\r\n            ['r', angle],\r\n            ['t', x, y],\r\n        ]);\r\n        label.setMatrix(matrix);\r\n    };\r\n    PieBaseLabel.prototype.getItems = function () {\r\n        var _this = this;\r\n        var offset = this.options.offset;\r\n        var _a = this.getCoordinate(), center = _a.center, radius = _a.radius;\r\n        var items = this.arcPoints.map(function (anchor) {\r\n            var point = getEndPoint(center, anchor.angle, radius + offset);\r\n            var item = __assign(__assign({}, anchor), point);\r\n            _this.adjustItem(item);\r\n            return item;\r\n        });\r\n        return items;\r\n    };\r\n    PieBaseLabel.prototype.initArcPoints = function () {\r\n        var _this = this;\r\n        var angleField = this.plot.options.angleField;\r\n        var elements = this.getGeometry().elements;\r\n        var coord = this.getCoordinate();\r\n        var center = coord.center, radius = coord.radius;\r\n        var startAngle = this.getCoordinate().startAngle;\r\n        var scale = this.getGeometry().scales[angleField];\r\n        var anchors = elements.map(function (ele) {\r\n            var origin = ele.shape.get('origin');\r\n            var color = origin.color;\r\n            var originData = origin.data[0] || origin.data;\r\n            var endAngle = startAngle + Math.PI * 2 * scale.scale(originData[angleField]);\r\n            var angle = (startAngle + endAngle) / 2;\r\n            var point = getEndPoint(center, angle, radius);\r\n            startAngle = endAngle;\r\n            var name = scale.getText(originData[angleField]);\r\n            var textAlign = point.x > center.x ? 'left' : 'right';\r\n            return {\r\n                x: point.x,\r\n                y: point.y,\r\n                color: color,\r\n                name: name,\r\n                origin: originData,\r\n                angle: getAngleByPoint(_this.getGeometry().coordinate, point),\r\n                textAlign: textAlign,\r\n            };\r\n        });\r\n        this.arcPoints = anchors;\r\n    };\r\n    return PieBaseLabel;\r\n}());\r\nexport default PieBaseLabel;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\pie\\component\\label\\base-label.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2plot\\esm\\plots\\pie\\component\\label\\base-label.js"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AACjC,OAAO,EAAE,GAAG,EAAE,MAAM,mBAAmB,CAAC;AACxC,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC;AAC/C,OAAO,EAAE,WAAW,EAAE,cAAc,EAAE,eAAe,EAAE,cAAc,EAAE,IAAI,EAAE,MAAM,SAAS,CAAC;AAC7F,OAAO,EAAE,eAAe,EAAE,MAAM,uBAAuB,CAAC;AAExD,MAAM,CAAC,IAAI,cAAc,GAAG,CAAC,CAAC;AAC9B,MAAM,UAAU,cAAc,CAAC,KAAK;IAChC,IAAI,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;IAC1E,OAAO,UAAU,GAAG,GAAG,CAAC;AAC5B,CAAC;AAID,SAAS,YAAY,CAAC,KAAK,EAAE,KAAK;IAC9B,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;IAE1B,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,GAAG,KAAK,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,EAAE;QACrE,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;KAC7C;AACL,CAAC;AACD,IAAI,YAAY,GAAiB,CAAC;IAC9B,SAAS,YAAY,CAAC,IAAI,EAAE,GAAG;QAC3B,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC;QACpD,IAAI,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,iBAAiB,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;QACzD,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;QAC3B,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAED,YAAY,CAAC,SAAS,CAAC,aAAa,GAAG,UAAU,MAAM,EAAE,KAAK;QAE1D,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpC,IAAI,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACtB,IAAI,WAAW,GAAG,CAAC,CAAC;YACpB,KAAK,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC7B,IAAI,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;gBAErB,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;gBAC7B,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;gBAE9B,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;oBACnC,WAAW,GAAG,cAAc,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;oBAC/C,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE;wBACvB,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;wBAC1C,MAAM;qBACT;iBACJ;aACJ;SACJ;QACD,MAAM,CAAC,OAAO,CAAC,UAAU,KAAK,IAAI,OAAO,YAAY,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC5E,CAAC,CAAC;IAEF,YAAY,CAAC,SAAS,CAAC,UAAU,GAAG,UAAU,IAAI;QAC9C,OAAO;IACX,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,IAAI,GAAG;QAC1B,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,eAAe,CAAC;QACpD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE;YAC9B,KAAK,CAAC,KAAK,EAAE,CAAC;YACd,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;QAC7B,CAAC,CAAC,CAAC;IACP,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,MAAM,GAAG;QAE5B,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,SAAS,EAAE,CAAC;IACrB,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,KAAK,GAAG;QAC3B,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;SAC1B;IACL,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,IAAI,GAAG;QAC1B,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;QACrC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;IAC5B,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,IAAI,GAAG;QAC1B,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QACpC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;IAC5B,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,OAAO,GAAG;QAC7B,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;SAC3B;QACD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;IAC1B,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,cAAc,GAAG;QACpC,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,IAAI,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,EAAE,CAAC;QACrD,OAAO,YAAY,CAAC,MAAM,CAAC,UAAU,GAAG,EAAE,gBAAgB;YACtD,OAAO,GAAG,GAAG,gBAAgB,CAAC,UAAU,CAAC,CAAC;QAC9C,CAAC,EAAE,CAAC,CAAC,CAAC;IACV,CAAC,CAAC;IAEF,YAAY,CAAC,SAAS,CAAC,SAAS,GAAG;QAC/B,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,EAAE,KAAK,GAAG,EAAE,CAAC,KAAK,EAAE,SAAS,GAAG,EAAE,CAAC,SAAS,EAAE,UAAU,GAAG,EAAE,CAAC,UAAU,EAAE,OAAO,GAAG,EAAE,CAAC,OAAO,EAAE,OAAO,GAAG,EAAE,CAAC,OAAO,EAAE,cAAc,GAAG,EAAE,CAAC,cAAc,EAAE,YAAY,GAAG,EAAE,CAAC,YAAY,CAAC;QAC9M,IAAI,UAAU,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QACjC,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,UAAU,CAAC,GAAG,CAAC,UAAU,SAAS,EAAE,GAAG;YACnC,IAAI,KAAK,GAAG,OAAO,CAAC,EAAE,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC;YAC1C,IAAI,WAAW,GAAG,KAAK,CAAC,cAAc,EAAE,CAAC;YACzC,IAAI,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;YAC/C,IAAI,OAAO,GAAG,SAAS,CAAC,MAAM,CAAC,UAAU,CAAC,GAAG,WAAW,CAAC;YACzD,IAAI,OAAO,GAAG,SAAS;gBACnB,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,EAAE;oBACxB,OAAO,EAAE,SAAS,CAAC,MAAM;oBACzB,OAAO,EAAE,OAAO;iBACnB,EAAE,GAAG,CAAC;gBACP,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC;YACrB,IAAI,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC;gBACrC,IAAI,EAAE,WAAW;gBACjB,KAAK,EAAE,GAAG;gBACV,OAAO,EAAE,KAAK;aACjB,CAAC,CAAC;YACH,IAAI,SAAS,GAAG,SAAS,CAAC,QAAQ,CAAC,MAAM,EAAE;gBACvC,KAAK,EAAE,OAAO,CAAC,EAAE,EAAE,KAAK,EAAE;oBACtB,CAAC,EAAE,SAAS,CAAC,CAAC,GAAG,OAAO;oBACxB,CAAC,EAAE,SAAS,CAAC,CAAC,GAAG,OAAO;oBACxB,IAAI,EAAE,OAAO;iBAChB,CAAC;aACL,CAAC,CAAC;YACH,SAAS,CAAC,GAAG,CAAC,IAAI,EAAE,OAAO,GAAG,SAAS,CAAC,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;YAC1D,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC3B,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,OAAO,CAAC,UAAU,KAAK;YAC1B,IAAI,QAAQ,GAAG,KAAK,CAAC,cAAc,CAAC;YACpC,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QACH,IAAI,cAAc,EAAE;YAChB,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,UAAU,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;SACxD;QACD,IAAI,CAAC,YAAY,EAAE;YACf,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;SACnD;QACD,MAAM,CAAC,OAAO,CAAC,UAAU,KAAK,EAAE,GAAG;YAC/B,IAAI,UAAU,EAAE;gBACZ,KAAK,CAAC,WAAW,CAAC,KAAK,EAAE,cAAc,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;aACnE;QACL,CAAC,CAAC,CAAC;IACP,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,UAAU,GAAG,UAAU,KAAK,EAAE,QAAQ;QACzD,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;QAC1B,IAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;QACtB,IAAI,UAAU,GAAG,CAAC,CAAC;QACnB,IAAI,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE;YAC1B,KAAK,GAAG,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;SACpC;aACI,IAAI,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE;YAC/B,KAAK,GAAG,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;SACpC;QACD,IAAI,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,MAAM,EAAE;YACpC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,UAAU,EAAE,CAAC,CAAC,CAAC,CAAC;SACpD;aACI,IAAI,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,OAAO,EAAE;YAC1C,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,GAAG,UAAU,EAAE,CAAC,CAAC,CAAC,CAAC;SACvD;QACD,IAAI,KAAK,KAAK,GAAG,CAAC,KAAK,EAAE;YACrB,IAAI,MAAM,GAAG,EAAE,CAAC;YAChB,CAAC,UAAU,EAAE,YAAY,EAAE,YAAY,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC;gBACxD,MAAM,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC9B,CAAC,CAAC,CAAC;YACH,IAAI,aAAa,GAAG,KAAK;iBACpB,IAAI,CAAC,MAAM,CAAC;iBACZ,KAAK,CAAC,IAAI,CAAC;iBACX,GAAG,CAAC,UAAU,CAAC,IAAI,OAAO,eAAe,CAAC,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACrE,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAChD;IACL,CAAC,CAAC;IAEF,YAAY,CAAC,SAAS,CAAC,SAAS,GAAG;QAC/B,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE;YAC3B,IAAI,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAChD,IAAI,QAAQ,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,MAAM,CAAC;YAC3C,UAAU,CAAC,OAAO,CAAC,UAAU,UAAU,EAAE,GAAG;gBACxC,IAAI,KAAK,GAAG,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1C,IAAI,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;gBAClC,IAAI,MAAM,GAAG,MAAM,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC;gBAEnC,IAAI,QAAQ,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAChD,IAAI,IAAI,GAAG,KAAK,CAAC,WAAW,CAAC,KAAK,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;gBACtD,IAAI,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC;gBAC/B,UAAU,CAAC,QAAQ,CAAC,MAAM,EAAE;oBACxB,KAAK,EAAE,QAAQ,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC,KAAK,EAAE,EAAE,KAAK,CAAC;iBAC/D,CAAC,CAAC;gBAEH,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACvE,CAAC,CAAC,CAAC;SACN;IACL,CAAC,CAAC;IAEF,YAAY,CAAC,SAAS,CAAC,WAAW,GAAG,UAAU,KAAK,EAAE,MAAM,EAAE,QAAQ;QAClE,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC;QAClE,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;QACzB,IAAI,EAAE,GAAG,IAAI,CAAC,aAAa,EAAE,EAAE,MAAM,GAAG,EAAE,CAAC,MAAM,EAAE,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC;QACtE,IAAI,OAAO,GAAG,WAAW,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,GAAG,QAAQ,CAAC,CAAC;QAC5D,IAAI,QAAQ,GAAG,CAAC,EAAE;YACd,OAAO,GAAG,MAAM,CAAC;SACpB;QACD,IAAI,MAAM,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;QACjC,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;QAC1B,IAAI,aAAa,GAAG,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACnF,IAAI,UAAU,GAAG;YACb,GAAG;YAEH,aAAa,CAAC,CAAC;gBAEX,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACzD,aAAa,CAAC,CAAC;YACf,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC;YACxB,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC;YACxB,OAAO,CAAC,CAAC;YACT,OAAO,CAAC,CAAC;SACZ,CAAC;QACF,IAAI,YAAY,GAAG,CAAC,GAAG,EAAsB,OAAO,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;QACnE,IAAI,QAAQ,GAAG,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,YAAY,CAAC;QAClD,IAAI,IAAI,GAAG,CAAC,GAAG,EAAE,aAAa,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;QACpG,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC1B,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,WAAW,GAAG;QACjC,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IACxC,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,aAAa,GAAG;QACnC,IAAI,UAAU,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,UAAU,CAAC;QAC/C,IAAI,MAAM,GAAG,UAAU,CAAC,SAAS,EAAE,CAAC;QAEpC,IAAI,MAAM,GAAG,UAAU,CAAC,SAAS,EAAE,CAAC;QACpC,IAAI,UAAU,GAAG,UAAU,CAAC,UAAU,CAAC;QACvC,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,CAAC;IACtE,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,YAAY,GAAG,UAAU,OAAO;QACnD,IAAI,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;QAC5B,IAAI,MAAM,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,MAAM,CAAC;QACzC,IAAI,QAAQ,CAAC,MAAM,CAAC,EAAE;YAClB,MAAM,GAAG,MAAM,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC;SAC5C;QACD,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;IAC5B,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,WAAW,GAAG,UAAU,KAAK,EAAE,KAAK;QACvD,IAAI,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACxB,IAAI,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACxB,IAAI,MAAM,GAAG,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE;YAC1C,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACb,CAAC,GAAG,EAAE,KAAK,CAAC;YACZ,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;SACd,CAAC,CAAC;QACH,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAC5B,CAAC,CAAC;IACF,YAAY,CAAC,SAAS,CAAC,QAAQ,GAAG;QAC9B,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;QACjC,IAAI,EAAE,GAAG,IAAI,CAAC,aAAa,EAAE,EAAE,MAAM,GAAG,EAAE,CAAC,MAAM,EAAE,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC;QACtE,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,MAAM;YAC3C,IAAI,KAAK,GAAG,WAAW,CAAC,MAAM,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,GAAG,MAAM,CAAC,CAAC;YAC/D,IAAI,IAAI,GAAG,QAAQ,CAAC,QAAQ,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,KAAK,CAAC,CAAC;YACjD,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YACvB,OAAO,IAAI,CAAC;QAChB,CAAC,CAAC,CAAC;QACH,OAAO,KAAK,CAAC;IACjB,CAAC,CAAC;IAEF,YAAY,CAAC,SAAS,CAAC,aAAa,GAAG;QACnC,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,IAAI,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC;QAC3C,IAAI,KAAK,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;QACjC,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,EAAE,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;QACjD,IAAI,UAAU,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,UAAU,CAAC;QACjD,IAAI,KAAK,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAClD,IAAI,OAAO,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,GAAG;YACpC,IAAI,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACrC,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;YACzB,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC;YAC/C,IAAI,QAAQ,GAAG,UAAU,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC;YAC9E,IAAI,KAAK,GAAG,CAAC,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;YACxC,IAAI,KAAK,GAAG,WAAW,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;YAC/C,UAAU,GAAG,QAAQ,CAAC;YACtB,IAAI,IAAI,GAAG,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC;YACjD,IAAI,SAAS,GAAG,KAAK,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC;YACtD,OAAO;gBACH,CAAC,EAAE,KAAK,CAAC,CAAC;gBACV,CAAC,EAAE,KAAK,CAAC,CAAC;gBACV,KAAK,EAAE,KAAK;gBACZ,IAAI,EAAE,IAAI;gBACV,MAAM,EAAE,UAAU;gBAElB,KAAK,EAAE,eAAe,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,UAAU,EAAE,KAAK,CAAC;gBAC7D,SAAS,EAAE,SAAS;aACvB,CAAC;QACN,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC;IAC7B,CAAC,CAAC;IACF,OAAO,YAAY,CAAC;AACxB,CAAC,EAAE,CAAC,CAAC;AACL,eAAe,YAAY,CAAC","sourcesContent":["import { __assign } from \"tslib\";\nimport { ext } from '@antv/matrix-util';\nimport { deepMix, isString } from '@antv/util';\nimport { getEndPoint, getLabelRotate, getAngleByPoint, getOverlapArea, near } from './utils';\nimport { getEllipsisText } from '../../../../util/text';\n/** label text和line距离 4px */\nexport var CROOK_DISTANCE = 4;\nexport function percent2Number(value) {\n    var percentage = Number(value.endsWith('%') ? value.slice(0, -1) : value);\n    return percentage / 100;\n}\n/**\n * 超出panel边界的标签默认隐藏\n */\nfunction checkInPanel(label, panel) {\n    var box = label.getBBox();\n    //  横向溢出 暂不隐藏\n    if (!(panel.y <= box.y && panel.y + panel.height >= box.y + box.height)) {\n        label.get('parent').set('visible', false);\n    }\n}\nvar PieBaseLabel = /** @class */ (function () {\n    function PieBaseLabel(plot, cfg) {\n        this.destroyed = false;\n        this.plot = plot;\n        this.coordinateBBox = this.plot.view.coordinateBBox;\n        var options = deepMix(this.getDefaultOptions(), cfg, {});\n        this.adjustOption(options);\n        this.options = options;\n        this.init();\n    }\n    /** 处理标签遮挡问题 */\n    PieBaseLabel.prototype.adjustOverlap = function (labels, panel) {\n        // clearOverlap;\n        for (var i = 1; i < labels.length; i++) {\n            var label = labels[i];\n            var overlapArea = 0;\n            for (var j = i - 1; j >= 0; j--) {\n                var prev = labels[j];\n                // fix: start draw point.x is error when textAlign is right\n                var prevBox = prev.getBBox();\n                var currBox = label.getBBox();\n                // if the previous one is invisible, skip\n                if (prev.get('parent').get('visible')) {\n                    overlapArea = getOverlapArea(prevBox, currBox);\n                    if (!near(overlapArea, 0)) {\n                        label.get('parent').set('visible', false);\n                        break;\n                    }\n                }\n            }\n        }\n        labels.forEach(function (label) { return checkInPanel(label, panel); });\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    PieBaseLabel.prototype.adjustItem = function (item) {\n        return;\n    };\n    PieBaseLabel.prototype.init = function () {\n        var _this = this;\n        this.container = this.getGeometry().labelsContainer;\n        this.plot.view.on('beforerender', function () {\n            _this.clear();\n            _this.plot.canvas.draw();\n        });\n    };\n    PieBaseLabel.prototype.render = function () {\n        // 先清空 再重新渲染（避免双次绘制）\n        this.clear();\n        this.initArcPoints();\n        this.drawTexts();\n        this.drawLines();\n    };\n    PieBaseLabel.prototype.clear = function () {\n        if (this.container) {\n            this.container.clear();\n        }\n    };\n    PieBaseLabel.prototype.hide = function () {\n        this.container.set('visible', false);\n        this.plot.canvas.draw();\n    };\n    PieBaseLabel.prototype.show = function () {\n        this.container.set('visible', true);\n        this.plot.canvas.draw();\n    };\n    PieBaseLabel.prototype.destroy = function () {\n        if (this.container) {\n            this.container.remove();\n        }\n        this.destroyed = true;\n    };\n    PieBaseLabel.prototype.getFilteredSum = function () {\n        var angleField = this.plot.options.angleField;\n        var filteredData = this.plot.view.filteredData || [];\n        return filteredData.reduce(function (pre, filteredDataItem) {\n            return pre + filteredDataItem[angleField];\n        }, 0);\n    };\n    /** 绘制文本 */\n    PieBaseLabel.prototype.drawTexts = function () {\n        var _this = this;\n        var _a = this.options, style = _a.style, formatter = _a.formatter, autoRotate = _a.autoRotate, offsetX = _a.offsetX, offsetY = _a.offsetY, adjustPosition = _a.adjustPosition, allowOverlap = _a.allowOverlap;\n        var shapeInfos = this.getItems();\n        var shapes = [];\n        shapeInfos.map(function (shapeInfo, idx) {\n            var attrs = deepMix({}, shapeInfo, style);\n            var filteredSum = _this.getFilteredSum();\n            var angleField = _this.plot.options.angleField;\n            var percent = shapeInfo.origin[angleField] / filteredSum;\n            var content = formatter\n                ? formatter(shapeInfo.name, {\n                    _origin: shapeInfo.origin,\n                    percent: percent,\n                }, idx)\n                : shapeInfo.name;\n            var itemGroup = _this.container.addGroup({\n                name: 'itemGroup',\n                index: idx,\n                capture: false,\n            });\n            var textShape = itemGroup.addShape('text', {\n                attrs: deepMix({}, attrs, {\n                    x: shapeInfo.x + offsetX,\n                    y: shapeInfo.y + offsetY,\n                    text: content,\n                }),\n            });\n            textShape.set('id', \"text-\" + shapeInfo.name + \"-\" + idx);\n            shapes.push(textShape);\n        });\n        shapes.forEach(function (shape) {\n            var panelBox = _this.coordinateBBox;\n            _this.adjustText(shape, panelBox);\n        });\n        if (adjustPosition) {\n            this.layout(shapes, shapeInfos, this.coordinateBBox);\n        }\n        if (!allowOverlap) {\n            this.adjustOverlap(shapes, this.coordinateBBox);\n        }\n        shapes.forEach(function (label, idx) {\n            if (autoRotate) {\n                _this.rotateLabel(label, getLabelRotate(shapeInfos[idx].angle));\n            }\n        });\n    };\n    PieBaseLabel.prototype.adjustText = function (label, panelBox) {\n        var box = label.getBBox();\n        var width = box.width;\n        var deltaWidth = 0;\n        if (box.maxX > panelBox.maxX) {\n            width = panelBox.maxX - box.minX;\n        }\n        else if (box.minX < panelBox.minX) {\n            width = box.maxX - panelBox.minX;\n        }\n        if (label.attr('textAlign') === 'left') {\n            label.attr('x', Math.max(box.x - deltaWidth, 0));\n        }\n        else if (label.attr('textAlign') === 'right') {\n            label.attr('x', Math.max(box.maxX - deltaWidth, 0));\n        }\n        if (width !== box.width) {\n            var font_1 = {};\n            ['fontSize', 'fontFamily', 'fontWeight'].forEach(function (k) {\n                font_1[k] = label.attr(k);\n            });\n            var ellipsisTexts = label\n                .attr('text')\n                .split('\\n')\n                .map(function (t) { return getEllipsisText(t, width, font_1); });\n            label.attr('text', ellipsisTexts.join('\\n'));\n        }\n    };\n    /** 绘制拉线 */\n    PieBaseLabel.prototype.drawLines = function () {\n        var _this = this;\n        if (this.options.line.visible) {\n            var itemGroups = this.container.get('children');\n            var center_1 = this.getCoordinate().center;\n            itemGroups.forEach(function (labelGroup, idx) {\n                var label = labelGroup.get('children')[0];\n                var anchor = _this.arcPoints[idx];\n                var inLeft = anchor.x < center_1.x;\n                // 拉线 和 label 之间的距离\n                var distance = _this.options.offset > 4 ? 4 : 0;\n                var path = _this.getLinePath(label, anchor, distance);\n                var style = _this.options.line;\n                labelGroup.addShape('path', {\n                    attrs: __assign({ path: path, stroke: anchor.color }, style),\n                });\n                // 由于拉线的存在 label 需要进行偏移\n                label.attr('x', label.attr('x') + (inLeft ? -distance : distance));\n            });\n        }\n    };\n    /** 获取label leader-line, 默认 not smooth */\n    PieBaseLabel.prototype.getLinePath = function (label, anchor, distance) {\n        var smooth = this.options.line ? this.options.line.smooth : false;\n        var angle = anchor.angle;\n        var _a = this.getCoordinate(), center = _a.center, radius = _a.radius;\n        var breakAt = getEndPoint(center, angle, radius + distance);\n        if (distance < 4) {\n            breakAt = anchor;\n        }\n        var inLeft = anchor.x < center.x;\n        var box = label.getBBox();\n        var labelPosition = { x: inLeft ? box.maxX : box.minX, y: box.y + box.height / 2 };\n        var smoothPath = [\n            'C',\n            // 1st control point (of the curve)\n            labelPosition.x +\n                // 4 gives the connector a little horizontal bend\n                (inLeft ? 1 : -1) * (distance < 4 ? distance / 2 : 4),\n            labelPosition.y,\n            2 * breakAt.x - anchor.x,\n            2 * breakAt.y - anchor.y,\n            breakAt.x,\n            breakAt.y,\n        ];\n        var straightPath = ['L', /** pointy break */ breakAt.x, breakAt.y];\n        var linePath = smooth ? smoothPath : straightPath;\n        var path = ['M', labelPosition.x, labelPosition.y].concat(linePath).concat('L', anchor.x, anchor.y);\n        return path.join(',');\n    };\n    PieBaseLabel.prototype.getGeometry = function () {\n        return this.plot.view.geometries[0];\n    };\n    PieBaseLabel.prototype.getCoordinate = function () {\n        var coordinate = this.getGeometry().coordinate;\n        var center = coordinate.getCenter();\n        // @ts-ignore\n        var radius = coordinate.getRadius();\n        var startAngle = coordinate.startAngle;\n        return { center: center, radius: radius, startAngle: startAngle };\n    };\n    PieBaseLabel.prototype.adjustOption = function (options) {\n        var offset = options.offset;\n        var radius = this.getCoordinate().radius;\n        if (isString(offset)) {\n            offset = radius * percent2Number(offset);\n        }\n        options.offset = offset;\n    };\n    PieBaseLabel.prototype.rotateLabel = function (label, angle) {\n        var x = label.attr('x');\n        var y = label.attr('y');\n        var matrix = ext.transform(label.getMatrix(), [\n            ['t', -x, -y],\n            ['r', angle],\n            ['t', x, y],\n        ]);\n        label.setMatrix(matrix);\n    };\n    PieBaseLabel.prototype.getItems = function () {\n        var _this = this;\n        var offset = this.options.offset;\n        var _a = this.getCoordinate(), center = _a.center, radius = _a.radius;\n        var items = this.arcPoints.map(function (anchor) {\n            var point = getEndPoint(center, anchor.angle, radius + offset);\n            var item = __assign(__assign({}, anchor), point);\n            _this.adjustItem(item);\n            return item;\n        });\n        return items;\n    };\n    // 初始化圆弧上锚点\n    PieBaseLabel.prototype.initArcPoints = function () {\n        var _this = this;\n        var angleField = this.plot.options.angleField;\n        var elements = this.getGeometry().elements;\n        var coord = this.getCoordinate();\n        var center = coord.center, radius = coord.radius;\n        var startAngle = this.getCoordinate().startAngle;\n        var scale = this.getGeometry().scales[angleField];\n        var anchors = elements.map(function (ele) {\n            var origin = ele.shape.get('origin');\n            var color = origin.color;\n            var originData = origin.data[0] || origin.data;\n            var endAngle = startAngle + Math.PI * 2 * scale.scale(originData[angleField]);\n            var angle = (startAngle + endAngle) / 2;\n            var point = getEndPoint(center, angle, radius);\n            startAngle = endAngle;\n            var name = scale.getText(originData[angleField]);\n            var textAlign = point.x > center.x ? 'left' : 'right';\n            return {\n                x: point.x,\n                y: point.y,\n                color: color,\n                name: name,\n                origin: originData,\n                // 实际的角度\n                angle: getAngleByPoint(_this.getGeometry().coordinate, point),\n                textAlign: textAlign,\n            };\n        });\n        this.arcPoints = anchors;\n    };\n    return PieBaseLabel;\n}());\nexport default PieBaseLabel;\n//# sourceMappingURL=base-label.js.map"]}]}