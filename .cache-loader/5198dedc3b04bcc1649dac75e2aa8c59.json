{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\shape\\polyline.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\shape\\polyline.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["import { __assign, __extends } from \"tslib\";\r\nimport LineUtil from '@antv/g-math/lib/line';\r\nimport PolylineUtil from '@antv/g-math/lib/polyline';\r\nimport { each, isNil } from '@antv/util';\r\nimport ShapeBase from './base';\r\nimport inPolyline from '../util/in-stroke/polyline';\r\nimport * as ArrowUtil from '../util/arrow';\r\nvar PolyLine = (function (_super) {\r\n    __extends(PolyLine, _super);\r\n    function PolyLine() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    PolyLine.prototype.getDefaultAttrs = function () {\r\n        var attrs = _super.prototype.getDefaultAttrs.call(this);\r\n        return __assign(__assign({}, attrs), { startArrow: false, endArrow: false });\r\n    };\r\n    PolyLine.prototype.initAttrs = function (attrs) {\r\n        this.setArrow();\r\n    };\r\n    PolyLine.prototype.onAttrChange = function (name, value, originValue) {\r\n        _super.prototype.onAttrChange.call(this, name, value, originValue);\r\n        this.setArrow();\r\n        if (['points'].indexOf(name) !== -1) {\r\n            this._resetCache();\r\n        }\r\n    };\r\n    PolyLine.prototype._resetCache = function () {\r\n        this.set('totalLength', null);\r\n        this.set('tCache', null);\r\n    };\r\n    PolyLine.prototype.setArrow = function () {\r\n        var attrs = this.attr();\r\n        var _a = this.attrs, points = _a.points, startArrow = _a.startArrow, endArrow = _a.endArrow;\r\n        var length = points.length;\r\n        var x1 = points[0][0];\r\n        var y1 = points[0][1];\r\n        var x2 = points[length - 1][0];\r\n        var y2 = points[length - 1][1];\r\n        if (startArrow) {\r\n            ArrowUtil.addStartArrow(this, attrs, points[1][0], points[1][1], x1, y1);\r\n        }\r\n        if (endArrow) {\r\n            ArrowUtil.addEndArrow(this, attrs, points[length - 2][0], points[length - 2][1], x2, y2);\r\n        }\r\n    };\r\n    PolyLine.prototype.isFill = function () {\r\n        return false;\r\n    };\r\n    PolyLine.prototype.isInStrokeOrPath = function (x, y, isStroke, isFill, lineWidth) {\r\n        if (!isStroke || !lineWidth) {\r\n            return false;\r\n        }\r\n        var points = this.attr().points;\r\n        return inPolyline(points, lineWidth, x, y, false);\r\n    };\r\n    PolyLine.prototype.isStroke = function () {\r\n        return true;\r\n    };\r\n    PolyLine.prototype.createPath = function (context) {\r\n        var _a = this.attr(), points = _a.points, startArrow = _a.startArrow, endArrow = _a.endArrow;\r\n        var length = points.length;\r\n        if (points.length < 2) {\r\n            return;\r\n        }\r\n        var x1 = points[0][0];\r\n        var y1 = points[0][1];\r\n        var x2 = points[length - 1][0];\r\n        var y2 = points[length - 1][1];\r\n        if (startArrow && startArrow.d) {\r\n            var distance = ArrowUtil.getShortenOffset(x1, y1, points[1][0], points[1][1], startArrow.d);\r\n            x1 += distance.dx;\r\n            y1 += distance.dy;\r\n        }\r\n        if (endArrow && endArrow.d) {\r\n            var distance = ArrowUtil.getShortenOffset(points[length - 2][0], points[length - 2][1], x2, y2, endArrow.d);\r\n            x2 -= distance.dx;\r\n            y2 -= distance.dy;\r\n        }\r\n        context.beginPath();\r\n        context.moveTo(x1, y1);\r\n        for (var i = 0; i < length - 1; i++) {\r\n            var point = points[i];\r\n            context.lineTo(point[0], point[1]);\r\n        }\r\n        context.lineTo(x2, y2);\r\n    };\r\n    PolyLine.prototype.afterDrawPath = function (context) {\r\n        var startArrowShape = this.get('startArrowShape');\r\n        var endArrowShape = this.get('endArrowShape');\r\n        if (startArrowShape) {\r\n            startArrowShape.draw(context);\r\n        }\r\n        if (endArrowShape) {\r\n            endArrowShape.draw(context);\r\n        }\r\n    };\r\n    PolyLine.prototype.getTotalLength = function () {\r\n        var points = this.attr().points;\r\n        var totalLength = this.get('totalLength');\r\n        if (!isNil(totalLength)) {\r\n            return totalLength;\r\n        }\r\n        this.set('totalLength', PolylineUtil.length(points));\r\n        return this.get('totalLength');\r\n    };\r\n    PolyLine.prototype.getPoint = function (ratio) {\r\n        var points = this.attr().points;\r\n        var tCache = this.get('tCache');\r\n        if (!tCache) {\r\n            this._setTcache();\r\n            tCache = this.get('tCache');\r\n        }\r\n        var subt;\r\n        var index;\r\n        each(tCache, function (v, i) {\r\n            if (ratio >= v[0] && ratio <= v[1]) {\r\n                subt = (ratio - v[0]) / (v[1] - v[0]);\r\n                index = i;\r\n            }\r\n        });\r\n        return LineUtil.pointAt(points[index][0], points[index][1], points[index + 1][0], points[index + 1][1], subt);\r\n    };\r\n    PolyLine.prototype._setTcache = function () {\r\n        var points = this.attr().points;\r\n        if (!points || points.length === 0) {\r\n            return;\r\n        }\r\n        var totalLength = this.getTotalLength();\r\n        if (totalLength <= 0) {\r\n            return;\r\n        }\r\n        var tempLength = 0;\r\n        var tCache = [];\r\n        var segmentT;\r\n        var segmentL;\r\n        each(points, function (p, i) {\r\n            if (points[i + 1]) {\r\n                segmentT = [];\r\n                segmentT[0] = tempLength / totalLength;\r\n                segmentL = LineUtil.length(p[0], p[1], points[i + 1][0], points[i + 1][1]);\r\n                tempLength += segmentL;\r\n                segmentT[1] = tempLength / totalLength;\r\n                tCache.push(segmentT);\r\n            }\r\n        });\r\n        this.set('tCache', tCache);\r\n    };\r\n    PolyLine.prototype.getStartTangent = function () {\r\n        var points = this.attr().points;\r\n        var result = [];\r\n        result.push([points[1][0], points[1][1]]);\r\n        result.push([points[0][0], points[0][1]]);\r\n        return result;\r\n    };\r\n    PolyLine.prototype.getEndTangent = function () {\r\n        var points = this.attr().points;\r\n        var l = points.length - 1;\r\n        var result = [];\r\n        result.push([points[l - 1][0], points[l - 1][1]]);\r\n        result.push([points[l][0], points[l][1]]);\r\n        return result;\r\n    };\r\n    return PolyLine;\r\n}(ShapeBase));\r\nexport default PolyLine;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\shape\\polyline.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g-canvas\\esm\\shape\\polyline.js"],"names":[],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport LineUtil from '@antv/g-math/lib/line';\nimport PolylineUtil from '@antv/g-math/lib/polyline';\nimport { each, isNil } from '@antv/util';\nimport ShapeBase from './base';\nimport inPolyline from '../util/in-stroke/polyline';\nimport * as ArrowUtil from '../util/arrow';\nvar PolyLine = /** @class */ (function (_super) {\n    __extends(PolyLine, _super);\n    function PolyLine() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PolyLine.prototype.getDefaultAttrs = function () {\n        var attrs = _super.prototype.getDefaultAttrs.call(this);\n        return __assign(__assign({}, attrs), { startArrow: false, endArrow: false });\n    };\n    PolyLine.prototype.initAttrs = function (attrs) {\n        this.setArrow();\n    };\n    // 更新属性时，检测是否更改了 points\n    PolyLine.prototype.onAttrChange = function (name, value, originValue) {\n        _super.prototype.onAttrChange.call(this, name, value, originValue);\n        this.setArrow();\n        if (['points'].indexOf(name) !== -1) {\n            this._resetCache();\n        }\n    };\n    PolyLine.prototype._resetCache = function () {\n        this.set('totalLength', null);\n        this.set('tCache', null);\n    };\n    PolyLine.prototype.setArrow = function () {\n        var attrs = this.attr();\n        var _a = this.attrs, points = _a.points, startArrow = _a.startArrow, endArrow = _a.endArrow;\n        var length = points.length;\n        var x1 = points[0][0];\n        var y1 = points[0][1];\n        var x2 = points[length - 1][0];\n        var y2 = points[length - 1][1];\n        if (startArrow) {\n            ArrowUtil.addStartArrow(this, attrs, points[1][0], points[1][1], x1, y1);\n        }\n        if (endArrow) {\n            ArrowUtil.addEndArrow(this, attrs, points[length - 2][0], points[length - 2][1], x2, y2);\n        }\n    };\n    // 不允许 fill\n    PolyLine.prototype.isFill = function () {\n        return false;\n    };\n    PolyLine.prototype.isInStrokeOrPath = function (x, y, isStroke, isFill, lineWidth) {\n        // 没有设置 stroke 不能被拾取, 没有线宽不能被拾取\n        if (!isStroke || !lineWidth) {\n            return false;\n        }\n        var points = this.attr().points;\n        return inPolyline(points, lineWidth, x, y, false);\n    };\n    // 始终填充\n    PolyLine.prototype.isStroke = function () {\n        return true;\n    };\n    PolyLine.prototype.createPath = function (context) {\n        var _a = this.attr(), points = _a.points, startArrow = _a.startArrow, endArrow = _a.endArrow;\n        var length = points.length;\n        if (points.length < 2) {\n            return;\n        }\n        var x1 = points[0][0];\n        var y1 = points[0][1];\n        var x2 = points[length - 1][0];\n        var y2 = points[length - 1][1];\n        // 如果定义了箭头，并且是自定义箭头，线条相应缩进\n        if (startArrow && startArrow.d) {\n            var distance = ArrowUtil.getShortenOffset(x1, y1, points[1][0], points[1][1], startArrow.d);\n            x1 += distance.dx;\n            y1 += distance.dy;\n        }\n        if (endArrow && endArrow.d) {\n            var distance = ArrowUtil.getShortenOffset(points[length - 2][0], points[length - 2][1], x2, y2, endArrow.d);\n            x2 -= distance.dx;\n            y2 -= distance.dy;\n        }\n        context.beginPath();\n        context.moveTo(x1, y1);\n        for (var i = 0; i < length - 1; i++) {\n            var point = points[i];\n            context.lineTo(point[0], point[1]);\n        }\n        context.lineTo(x2, y2);\n    };\n    PolyLine.prototype.afterDrawPath = function (context) {\n        var startArrowShape = this.get('startArrowShape');\n        var endArrowShape = this.get('endArrowShape');\n        if (startArrowShape) {\n            startArrowShape.draw(context);\n        }\n        if (endArrowShape) {\n            endArrowShape.draw(context);\n        }\n    };\n    /**\n     * Get length of polyline\n     * @return {number} length\n     */\n    PolyLine.prototype.getTotalLength = function () {\n        var points = this.attr().points;\n        // get totalLength from cache\n        var totalLength = this.get('totalLength');\n        if (!isNil(totalLength)) {\n            return totalLength;\n        }\n        this.set('totalLength', PolylineUtil.length(points));\n        return this.get('totalLength');\n    };\n    /**\n     * Get point according to ratio\n     * @param {number} ratio\n     * @return {Point} point\n     */\n    PolyLine.prototype.getPoint = function (ratio) {\n        var points = this.attr().points;\n        // get tCache from cache\n        var tCache = this.get('tCache');\n        if (!tCache) {\n            this._setTcache();\n            tCache = this.get('tCache');\n        }\n        var subt;\n        var index;\n        each(tCache, function (v, i) {\n            if (ratio >= v[0] && ratio <= v[1]) {\n                subt = (ratio - v[0]) / (v[1] - v[0]);\n                index = i;\n            }\n        });\n        return LineUtil.pointAt(points[index][0], points[index][1], points[index + 1][0], points[index + 1][1], subt);\n    };\n    PolyLine.prototype._setTcache = function () {\n        var points = this.attr().points;\n        if (!points || points.length === 0) {\n            return;\n        }\n        var totalLength = this.getTotalLength();\n        if (totalLength <= 0) {\n            return;\n        }\n        var tempLength = 0;\n        var tCache = [];\n        var segmentT;\n        var segmentL;\n        each(points, function (p, i) {\n            if (points[i + 1]) {\n                segmentT = [];\n                segmentT[0] = tempLength / totalLength;\n                segmentL = LineUtil.length(p[0], p[1], points[i + 1][0], points[i + 1][1]);\n                tempLength += segmentL;\n                segmentT[1] = tempLength / totalLength;\n                tCache.push(segmentT);\n            }\n        });\n        this.set('tCache', tCache);\n    };\n    /**\n     * Get start tangent vector\n     * @return {Array}\n     */\n    PolyLine.prototype.getStartTangent = function () {\n        var points = this.attr().points;\n        var result = [];\n        result.push([points[1][0], points[1][1]]);\n        result.push([points[0][0], points[0][1]]);\n        return result;\n    };\n    /**\n     * Get end tangent vector\n     * @return {Array}\n     */\n    PolyLine.prototype.getEndTangent = function () {\n        var points = this.attr().points;\n        var l = points.length - 1;\n        var result = [];\n        result.push([points[l - 1][0], points[l - 1][1]]);\n        result.push([points[l][0], points[l][1]]);\n        return result;\n    };\n    return PolyLine;\n}(ShapeBase));\nexport default PolyLine;\n//# sourceMappingURL=polyline.js.map"]}]}