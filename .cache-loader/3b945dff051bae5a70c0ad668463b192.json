{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/bin/histogram.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/bin/histogram.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar assign = require('@antv/util/lib/mix');\nvar forIn = require('@antv/util/lib/each');\nvar pick = require('@antv/util/lib/pick');\nvar partition = require('../../util/partition');\nvar registerTransform = require('../../data-set').registerTransform;\nvar getField = require('../../util/option-parser').getField;\nvar DEFAULT_OPTIONS = {\n    as: ['x', 'count'],\n    bins: 30,\n    offset: 0,\n    groupBy: []\n};\nfunction nearestBin(value, scale, offset) {\n    var temp = value - offset;\n    var div = Math.floor(temp / scale);\n    return [div * scale + offset, (div + 1) * scale + offset];\n}\nfunction transform(dataView, options) {\n    options = assign({}, DEFAULT_OPTIONS, options);\n    var field = getField(options);\n    if (dataView.rows.length === 0) {\n        return;\n    }\n    var range = dataView.range(field);\n    var width = range[1] - range[0];\n    var binWidth = options.binWidth;\n    if (!binWidth) {\n        var bins = options.bins;\n        if (bins <= 0) {\n            throw new TypeError('Invalid bins: it must be a positive number!');\n        }\n        binWidth = width / bins;\n    }\n    var offset = options.offset % binWidth;\n    var rows = [];\n    var groupBy = options.groupBy;\n    var groups = partition(dataView.rows, groupBy);\n    forIn(groups, function (group) {\n        var bins = {};\n        var column = group.map(function (row) { return row[field]; });\n        column.forEach(function (value) {\n            var _a = __read(nearestBin(value, binWidth, offset), 2), x0 = _a[0], x1 = _a[1];\n            var binKey = x0 + \"-\" + x1;\n            bins[binKey] = bins[binKey] || {\n                x0: x0,\n                x1: x1,\n                count: 0\n            };\n            bins[binKey].count++;\n        });\n        var _a = __read(options.as, 2), asX = _a[0], asCount = _a[1];\n        if (!asX || !asCount) {\n            throw new TypeError('Invalid as: it must be an array with 2 elements (e.g. [ \"x\", \"count\" ])!');\n        }\n        var meta = pick(group[0], groupBy);\n        forIn(bins, function (bin) {\n            var row = assign({}, meta);\n            row[asX] = [bin.x0, bin.x1];\n            row[asCount] = bin.count;\n            rows.push(row);\n        });\n    });\n    dataView.rows = rows;\n}\nregisterTransform('bin.histogram', transform);\nregisterTransform('bin.dot', transform);\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/bin/histogram.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/data-set/src/transform/bin/histogram.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA,IAAM,MAAM,GAAG,OAAO,CAAC,oBAAoB,CAAC,CAAC;AAC7C,IAAM,KAAK,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAC7C,IAAM,IAAI,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAC5C,IAAM,SAAS,GAAG,OAAO,CAAC,sBAAsB,CAAC,CAAC;AAEhD,IAAA,iBAAiB,GACf,OAAO,CAAC,gBAAgB,CAAC,kBADV,CACW;AAE5B,IAAA,QAAQ,GACN,OAAO,CAAC,0BAA0B,CAAC,SAD7B,CAC8B;AAExC,IAAM,eAAe,GAAG;IACtB,EAAE,EAAE,CAAE,GAAG,EAAE,OAAO,CAAE;IACpB,IAAI,EAAE,EAAE;IACR,MAAM,EAAE,CAAC;IACT,OAAO,EAAE,EAAE;CAGZ,CAAC;AAEF,SAAS,UAAU,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM;IACtC,IAAM,IAAI,GAAG,KAAK,GAAG,MAAM,CAAC;IAC5B,IAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,CAAC;IACrC,OAAO,CAAE,GAAG,GAAG,KAAK,GAAG,MAAM,EAAE,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,MAAM,CAAE,CAAC;AAC9D,CAAC;AAED,SAAS,SAAS,CAAC,QAAQ,EAAE,OAAO;IAClC,OAAO,GAAG,MAAM,CAAC,EAAE,EAAE,eAAe,EAAE,OAAO,CAAC,CAAC;IAC/C,IAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC;IAChC,IAAI,QAAQ,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;QAC9B,OAAO;KACR;IACD,IAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACpC,IAAM,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;IAClC,IAAI,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;IAChC,IAAI,CAAC,QAAQ,EAAE;QACb,IAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC;QAC1B,IAAI,IAAI,IAAI,CAAC,EAAE;YACb,MAAM,IAAI,SAAS,CAAC,6CAA6C,CAAC,CAAC;SACpE;QACD,QAAQ,GAAG,KAAK,GAAG,IAAI,CAAC;KACzB;IACD,IAAM,MAAM,GAAG,OAAO,CAAC,MAAM,GAAG,QAAQ,CAAC;IAGzC,IAAM,IAAI,GAAG,EAAE,CAAC;IAChB,IAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;IAChC,IAAM,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACjD,KAAK,CAAC,MAAM,EAAE,UAAA,KAAK;QACjB,IAAM,IAAI,GAAG,EAAE,CAAC;QAChB,IAAM,MAAM,GAAG,KAAK,CAAC,GAAG,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,KAAK,CAAC,EAAV,CAAU,CAAC,CAAC;QAC5C,MAAM,CAAC,OAAO,CAAC,UAAA,KAAK;YACZ,IAAA,KAAA,OAAa,UAAU,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,CAAC,IAAA,EAA9C,EAAE,QAAA,EAAE,EAAE,QAAwC,CAAC;YACvD,IAAM,MAAM,GAAM,EAAE,SAAI,EAAI,CAAC;YAC7B,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI;gBAC7B,EAAE,IAAA;gBACF,EAAE,IAAA;gBACF,KAAK,EAAE,CAAC;aACT,CAAC;YACF,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAG,CAAC;QACxB,CAAC,CAAC,CAAC;QACG,IAAA,KAAA,OAAmB,OAAO,CAAC,EAAE,IAAA,EAA3B,GAAG,QAAA,EAAE,OAAO,QAAe,CAAC;QACpC,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,EAAE;YACpB,MAAM,IAAI,SAAS,CAAC,0EAA0E,CAAC,CAAC;SACjG;QAED,IAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;QACrC,KAAK,CAAC,IAAI,EAAE,UAAA,GAAG;YACb,IAAM,GAAG,GAAG,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YAC7B,GAAG,CAAC,GAAG,CAAC,GAAG,CAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,EAAE,CAAE,CAAC;YAC9B,GAAG,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC;YACzB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACjB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IACH,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;AACvB,CAAC;AAED,iBAAiB,CAAC,eAAe,EAAE,SAAS,CAAC,CAAC;AAC9C,iBAAiB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC","sourcesContent":["const assign = require('@antv/util/lib/mix');\nconst forIn = require('@antv/util/lib/each');\nconst pick = require('@antv/util/lib/pick');\nconst partition = require('../../util/partition');\nconst {\n  registerTransform\n} = require('../../data-set');\nconst {\n  getField\n} = require('../../util/option-parser');\n\nconst DEFAULT_OPTIONS = {\n  as: [ 'x', 'count' ],\n  bins: 30,\n  offset: 0,\n  groupBy: []\n  // field: '', // required\n  // binWidth: 10, // override bins\n};\n\nfunction nearestBin(value, scale, offset) {\n  const temp = value - offset;\n  const div = Math.floor(temp / scale);\n  return [ div * scale + offset, (div + 1) * scale + offset ];\n}\n\nfunction transform(dataView, options) {\n  options = assign({}, DEFAULT_OPTIONS, options);\n  const field = getField(options);\n  if (dataView.rows.length === 0) {\n    return;\n  }\n  const range = dataView.range(field);\n  const width = range[1] - range[0];\n  let binWidth = options.binWidth;\n  if (!binWidth) {\n    const bins = options.bins;\n    if (bins <= 0) {\n      throw new TypeError('Invalid bins: it must be a positive number!');\n    }\n    binWidth = width / bins;\n  }\n  const offset = options.offset % binWidth;\n\n  // grouping\n  const rows = [];\n  const groupBy = options.groupBy;\n  const groups = partition(dataView.rows, groupBy);\n  forIn(groups, group => {\n    const bins = {};\n    const column = group.map(row => row[field]);\n    column.forEach(value => {\n      const [ x0, x1 ] = nearestBin(value, binWidth, offset);\n      const binKey = `${x0}-${x1}`;\n      bins[binKey] = bins[binKey] || {\n        x0,\n        x1,\n        count: 0\n      };\n      bins[binKey].count ++;\n    });\n    const [ asX, asCount ] = options.as;\n    if (!asX || !asCount) {\n      throw new TypeError('Invalid as: it must be an array with 2 elements (e.g. [ \"x\", \"count\" ])!');\n    }\n\n    const meta = pick(group[0], groupBy);\n    forIn(bins, bin => {\n      const row = assign({}, meta);\n      row[asX] = [ bin.x0, bin.x1 ];\n      row[asCount] = bin.count;\n      rows.push(row);\n    });\n  });\n  dataView.rows = rows;\n}\n\nregisterTransform('bin.histogram', transform);\nregisterTransform('bin.dot', transform);\n"]}]}