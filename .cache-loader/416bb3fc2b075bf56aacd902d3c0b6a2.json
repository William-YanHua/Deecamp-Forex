{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\src\\app\\internationalization\\LocaleStore\\LocaleStore.tsx","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\src\\app\\internationalization\\LocaleStore\\LocaleStore.tsx","mtime":1596379644471},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __values = (this && this.__values) || function (o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n};\r\nimport { LANGUAGE_CONFIG_TOKEN, KnownLanguages } from \"../definitions\";\r\nimport { action, computed, observable, runInAction } from \"mobx\";\r\nimport { Inject, Injectable } from \"react.di\";\r\nimport React from \"react\";\r\nimport { GET_VALUE, Lang } from \"./lang\";\r\nvar idSeparator = \".\";\r\nvar LocaleStore = (function () {\r\n    function LocaleStore(config) {\r\n        this.availableLanguages = new Map();\r\n        this.loadedLanguages = new Map();\r\n        this.config = config.languages;\r\n    }\r\n    Object.defineProperty(LocaleStore.prototype, \"definitions\", {\r\n        get: function () {\r\n            return this.currentLanguage.definitions;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(LocaleStore.prototype, \"allLanguages\", {\r\n        get: function () {\r\n            return Array.from(this.availableLanguages.values());\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LocaleStore.prototype.loadLanguage = function (id) {\r\n        return __awaiter(this, void 0, Promise, function () {\r\n            var language, definitions, loaded;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.availableLanguages.has(id)) {\r\n                            return [2, this.fallbackLanguage];\r\n                        }\r\n                        if (this.loadedLanguages.has(id)) {\r\n                            return [2, this.loadedLanguages.get(id)];\r\n                        }\r\n                        language = this.availableLanguages.get(id);\r\n                        return [4, language.getDefinition];\r\n                    case 1:\r\n                        definitions = (_a.sent()).default;\r\n                        loaded = __assign({}, language, { definitions: definitions });\r\n                        this.loadedLanguages.set(language.id, loaded);\r\n                        return [2, loaded];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocaleStore.prototype.init = function (defaultLanguageId) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1, _a, fallbackId, _b, _c, l, _d, _e;\r\n            return __generator(this, function (_f) {\r\n                switch (_f.label) {\r\n                    case 0:\r\n                        fallbackId = null;\r\n                        try {\r\n                            for (_b = __values(this.config), _c = _b.next(); !_c.done; _c = _b.next()) {\r\n                                l = _c.value;\r\n                                this.availableLanguages.set(l.id, l);\r\n                                if (l.fallback) {\r\n                                    fallbackId = l.id;\r\n                                }\r\n                            }\r\n                        }\r\n                        catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n                        finally {\r\n                            try {\r\n                                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\r\n                            }\r\n                            finally { if (e_1) throw e_1.error; }\r\n                        }\r\n                        _d = this;\r\n                        return [4, this.loadLanguage(defaultLanguageId || fallbackId)];\r\n                    case 1:\r\n                        _d.currentLanguage = _f.sent();\r\n                        _e = this;\r\n                        return [4, this.loadLanguage(fallbackId)];\r\n                    case 2:\r\n                        _e.fallbackLanguage = _f.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LocaleStore.prototype.get = function (id, replacements) {\r\n        var trueId = id instanceof Lang ? id[GET_VALUE] : id;\r\n        var definition = this.retrieveDefinition(trueId);\r\n        return this.replace(definition, replacements);\r\n    };\r\n    LocaleStore.prototype.replace = function (format, replacements) {\r\n        var splitter = /({[0-9a-zA-Z]+})/;\r\n        var array = format.split(splitter);\r\n        var newArray = array;\r\n        var elementReplaced = false;\r\n        if (replacements) {\r\n            for (var i = 1; i < array.length; i += 2) {\r\n                var tag = array[i].substr(1, array[i].length - 2);\r\n                var replacement = replacements[tag];\r\n                if (replacement) {\r\n                    if (React.isValidElement(replacement)) {\r\n                        elementReplaced = true;\r\n                        newArray[i] = React.createElement(React.Fragment, { key: i }, replacement);\r\n                    }\r\n                    else {\r\n                        newArray[i] = replacement;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (elementReplaced) {\r\n            return newArray;\r\n        }\r\n        else {\r\n            return newArray.join(\"\");\r\n        }\r\n    };\r\n    LocaleStore.prototype.retrieveDefinition = function (id) {\r\n        var e_2, _a;\r\n        var content = this.definitions;\r\n        var fallbackContent = this.fallbackLanguage.definitions;\r\n        var onFallback = false;\r\n        try {\r\n            for (var _b = __values(id.split(idSeparator)), _c = _b.next(); !_c.done; _c = _b.next()) {\r\n                var key = _c.value;\r\n                if (typeof content === \"undefined\") {\r\n                    throw new RangeError(\"unidentified id \" + id);\r\n                }\r\n                if (key in content) {\r\n                    if (!onFallback) {\r\n                        fallbackContent = fallbackContent[key];\r\n                    }\r\n                    content = content[key];\r\n                }\r\n                else {\r\n                    content = fallbackContent[key];\r\n                    onFallback = true;\r\n                }\r\n            }\r\n        }\r\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\r\n        finally {\r\n            try {\r\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\r\n            }\r\n            finally { if (e_2) throw e_2.error; }\r\n        }\r\n        if (typeof content !== \"string\") {\r\n            throw new RangeError(\"id \" + id + \" does not refer to a string. actual value: \" + content);\r\n        }\r\n        return content;\r\n    };\r\n    LocaleStore.prototype.changeLanguage = function (id) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var newLanguage;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.loadLanguage(id)];\r\n                    case 1:\r\n                        newLanguage = _a.sent();\r\n                        runInAction(\"Language \" + newLanguage.name + \" selected and loaded.\", function () {\r\n                            _this.currentLanguage = newLanguage;\r\n                        });\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    var _a;\r\n    __decorate([\r\n        observable.ref,\r\n        __metadata(\"design:type\", Object)\r\n    ], LocaleStore.prototype, \"currentLanguage\", void 0);\r\n    __decorate([\r\n        computed,\r\n        __metadata(\"design:type\", Object),\r\n        __metadata(\"design:paramtypes\", [])\r\n    ], LocaleStore.prototype, \"definitions\", null);\r\n    __decorate([\r\n        computed,\r\n        __metadata(\"design:type\", Array),\r\n        __metadata(\"design:paramtypes\", [])\r\n    ], LocaleStore.prototype, \"allLanguages\", null);\r\n    __decorate([\r\n        action,\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", [String]),\r\n        __metadata(\"design:returntype\", Promise)\r\n    ], LocaleStore.prototype, \"init\", null);\r\n    __decorate([\r\n        action,\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", [String]),\r\n        __metadata(\"design:returntype\", Promise)\r\n    ], LocaleStore.prototype, \"changeLanguage\", null);\r\n    LocaleStore = __decorate([\r\n        Injectable,\r\n        __param(0, Inject(LANGUAGE_CONFIG_TOKEN)),\r\n        __metadata(\"design:paramtypes\", [typeof (_a = typeof KnownLanguages !== \"undefined\" && KnownLanguages) === \"function\" ? _a : Object])\r\n    ], LocaleStore);\r\n    return LocaleStore;\r\n}());\r\nexport { LocaleStore };\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\src\\app\\internationalization\\LocaleStore\\LocaleStore.tsx","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\src\\app\\internationalization\\LocaleStore\\LocaleStore.tsx"],"names":[],"mappings":"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","sourcesContent":["import { LANGUAGE_CONFIG_TOKEN, Definition, KnownLanguages, Language } from \"../definitions\";\r\nimport { action, computed, observable, runInAction } from \"mobx\";\r\nimport { Inject, Injectable } from \"react.di\";\r\nimport React from \"react\";\r\nimport { GET_VALUE, Lang } from \"./lang\";\r\n\r\nexport interface ReplacementMap {[key: string]: React.ReactNode; }\r\n\r\nconst idSeparator = \".\";\r\n\r\ntype LoadedLanguage = Language & { definitions: Definition };\r\n\r\n@Injectable\r\nexport class LocaleStore {\r\n  private availableLanguages: Map<string, Language> = new Map();\r\n  private loadedLanguages: Map<string, LoadedLanguage> = new Map();\r\n\r\n  @observable.ref currentLanguage: LoadedLanguage;\r\n\r\n  fallbackLanguage: LoadedLanguage;\r\n\r\n  config: Language[];\r\n\r\n  constructor(@Inject(LANGUAGE_CONFIG_TOKEN) config: KnownLanguages) {\r\n    this.config = config.languages; // avoid multi inject\r\n  }\r\n\r\n  @computed get definitions() {\r\n    return this.currentLanguage.definitions;\r\n  }\r\n\r\n  @computed get allLanguages(): Language[] {\r\n    return Array.from(this.availableLanguages.values());\r\n  }\r\n\r\n  async loadLanguage(id: string): Promise<LoadedLanguage> {\r\n\r\n    if (!this.availableLanguages.has(id)) {\r\n      return this.fallbackLanguage;\r\n    }\r\n    if (this.loadedLanguages.has(id)) {\r\n      return this.loadedLanguages.get(id);\r\n    }\r\n    const language = this.availableLanguages.get(id);\r\n    const definitions = ((await language.getDefinition) as any).default;\r\n\r\n    const loaded = { ...language, definitions};\r\n    this.loadedLanguages.set(language.id, loaded);\r\n    return loaded;\r\n  }\r\n\r\n  @action async init(defaultLanguageId: string) {\r\n    let fallbackId = null;\r\n    for (const l of this.config) {\r\n      this.availableLanguages.set(l.id, l);\r\n      if (l.fallback) {\r\n        fallbackId = l.id;\r\n      }\r\n    }\r\n\r\n    this.currentLanguage = await this.loadLanguage(defaultLanguageId || fallbackId);\r\n    this.fallbackLanguage = await this.loadLanguage(fallbackId);\r\n\r\n  }\r\n\r\n  get(id: string | Lang, replacements?: ReplacementMap): React.ReactNode[] | string {\r\n    const trueId = id instanceof Lang ? id[GET_VALUE] : id;\r\n    const definition = this.retrieveDefinition(trueId);\r\n    return this.replace(definition, replacements);\r\n  }\r\n\r\n  replace(format: string, replacements?: ReplacementMap): React.ReactNode[] | string {\r\n    const splitter = /({[0-9a-zA-Z]+})/;\r\n    const array = format.split(splitter);\r\n    const newArray = array as React.ReactNode[];\r\n    let elementReplaced = false;\r\n    if (replacements) {\r\n      for (let i = 1; i < array.length; i += 2) {\r\n        const tag = array[i].substr(1, array[i].length - 2);\r\n        const replacement = replacements[tag];\r\n        if (replacement) {\r\n          if (React.isValidElement(replacement)) {\r\n            elementReplaced = true;\r\n            newArray[i] = <React.Fragment key={i}>{replacement}</React.Fragment>;\r\n          } else {\r\n            newArray[i] = replacement;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (elementReplaced) {\r\n      return newArray;\r\n    } else {\r\n      return newArray.join(\"\");\r\n    }\r\n  }\r\n\r\n  private retrieveDefinition(id: string) {\r\n    let content = this.definitions;\r\n    let fallbackContent = this.fallbackLanguage.definitions;\r\n    let onFallback = false;\r\n    for (const key of id.split(idSeparator)) {\r\n      if (typeof content === \"undefined\") {\r\n        throw new RangeError(`unidentified id ${id}`);\r\n      }\r\n      if (key in content) {\r\n        if (!onFallback) {\r\n          fallbackContent = fallbackContent[key];\r\n        }\r\n        content = content[key];\r\n      } else {\r\n        // fallback occurs.\r\n        // redirect the content to fallback\r\n        content = fallbackContent[key];\r\n        onFallback = true;\r\n      }\r\n    }\r\n    if (typeof content !== \"string\") {\r\n      throw new RangeError(`id ${id} does not refer to a string. actual value: ${content}`);\r\n    }\r\n    return content;\r\n  }\r\n\r\n  @action async changeLanguage(id: string) {\r\n    const newLanguage = await this.loadLanguage(id);\r\n    runInAction(`Language ${newLanguage.name} selected and loaded.`, () => {\r\n      this.currentLanguage = newLanguage;\r\n    });\r\n\r\n  }\r\n}\r\n"]}]}