{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/mixin/active.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/mixin/active.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var Util = require('../../util');\nvar FIELD_ORIGIN = '_origin';\nvar ZIndexUtil = require('./zindex-util');\nvar ATTRS_ORIGIN_ACTIVE = '_originActiveAttrs';\nfunction isSameShape(shape1, shape2) {\n    if (Util.isNil(shape1) || Util.isNil(shape2)) {\n        return false;\n    }\n    var shape1Origin = shape1.get('origin');\n    var shape2Origin = shape2.get('origin');\n    return Util.isEqual(shape1Origin, shape2Origin);\n}\nfunction isChange(preShapes, shapes) {\n    if (!preShapes) {\n        return true;\n    }\n    if (preShapes.length !== shapes.length) {\n        return true;\n    }\n    var rst = false;\n    Util.each(shapes, function (shape, index) {\n        if (!isSameShape(shape, preShapes[index])) {\n            rst = true;\n            return false;\n        }\n    });\n    return rst;\n}\nfunction getOriginAttrs(activeCfg, shape) {\n    var originAttrs = {};\n    Util.each(activeCfg, function (v, k) {\n        var originValue = shape.attr(k);\n        if (Util.isArray(originValue)) {\n            originValue = Util.cloneDeep(originValue);\n        }\n        originAttrs[k] = originValue;\n    });\n    return originAttrs;\n}\nvar ActiveMixin = {\n    _isAllowActive: function _isAllowActive() {\n        var allowActive = this.get('allowActive');\n        if (Util.isNil(allowActive)) {\n            var view = this.get('view');\n            var isShareTooltip = this.isShareTooltip();\n            var options = view.get('options');\n            if (options.tooltip === false || !isShareTooltip) {\n                return true;\n            }\n        }\n        else {\n            return allowActive;\n        }\n        return false;\n    },\n    _onMouseenter: function _onMouseenter(ev) {\n        var self = this;\n        var shape = ev.shape;\n        var shapeContainer = self.get('shapeContainer');\n        if (shape && shapeContainer.contain(shape) && self._isAllowActive()) {\n            self.setShapesActived(shape);\n        }\n    },\n    _onMouseleave: function _onMouseleave() {\n        var self = this;\n        var view = self.get('view');\n        var canvas = view.get('canvas');\n        if (self.get('activeShapes')) {\n            self.clearActivedShapes();\n            canvas.draw();\n        }\n    },\n    _bindActiveAction: function _bindActiveAction() {\n        var self = this;\n        var view = self.get('view');\n        var type = self.get('type');\n        view.on(type + ':mouseenter', Util.wrapBehavior(self, '_onMouseenter'));\n        view.on(type + ':mouseleave', Util.wrapBehavior(self, '_onMouseleave'));\n    },\n    _offActiveAction: function _offActiveAction() {\n        var self = this;\n        var view = self.get('view');\n        var type = self.get('type');\n        view.off(type + ':mouseenter', Util.getWrapBehavior(self, '_onMouseenter'));\n        view.off(type + ':mouseleave', Util.getWrapBehavior(self, '_onMouseleave'));\n    },\n    _setActiveShape: function _setActiveShape(shape) {\n        var self = this;\n        var activedOptions = self.get('activedOptions') || {};\n        var shapeData = shape.get('origin');\n        var shapeName = shapeData.shape || self.getDefaultValue('shape');\n        if (Util.isArray(shapeName)) {\n            shapeName = shapeName[0];\n        }\n        var shapeFactory = self.get('shapeFactory');\n        var shapeCfg = Util.mix({}, shape.attr(), {\n            origin: shapeData\n        });\n        var activeCfg = shapeFactory.getActiveCfg(shapeName, shapeCfg);\n        if (activedOptions.style) {\n            Util.mix(activeCfg, activedOptions.style);\n        }\n        var originAttrs = getOriginAttrs(activeCfg, shape);\n        shape.setSilent(ATTRS_ORIGIN_ACTIVE, originAttrs);\n        if (activedOptions.animate) {\n            shape.animate(activeCfg, 300);\n        }\n        else {\n            shape.attr(activeCfg);\n        }\n        ZIndexUtil.toFront(shape);\n    },\n    setShapesActived: function setShapesActived(shapes) {\n        var self = this;\n        if (!Util.isArray(shapes)) {\n            shapes = [shapes];\n        }\n        var preShapes = self.get('activeShapes');\n        if (!isChange(preShapes, shapes)) {\n            return;\n        }\n        var view = self.get('view');\n        var canvas = view.get('canvas');\n        var activedOptions = self.get('activedOptions');\n        if (activedOptions && activedOptions.highlight) {\n            Util.each(shapes, function (shape) {\n                if (shape.get('animating')) {\n                    shape.stopAnimate();\n                }\n            });\n            self.highlightShapes(shapes);\n        }\n        else {\n            if (preShapes) {\n                self.clearActivedShapes();\n            }\n            Util.each(shapes, function (shape) {\n                if (shape.get('animating')) {\n                    shape.stopAnimate();\n                }\n                if (shape.get('visible')) {\n                    self._setActiveShape(shape);\n                }\n            });\n        }\n        self.set('activeShapes', shapes);\n        canvas.draw();\n    },\n    clearActivedShapes: function clearActivedShapes() {\n        var self = this;\n        var shapeContainer = self.get('shapeContainer');\n        var activedOptions = self.get('activedOptions');\n        var activeAnimate = activedOptions && activedOptions.animate;\n        if (shapeContainer && !shapeContainer.get('destroyed')) {\n            var activeShapes = self.get('activeShapes');\n            Util.each(activeShapes, function (activeShape) {\n                var originAttrs = activeShape.get(ATTRS_ORIGIN_ACTIVE);\n                if (activeAnimate) {\n                    activeShape.stopAnimate();\n                    activeShape.animate(originAttrs, 300);\n                }\n                else {\n                    activeShape.attr(originAttrs);\n                }\n                ZIndexUtil.resetZIndex(activeShape);\n                activeShape.setSilent(ATTRS_ORIGIN_ACTIVE, null);\n            });\n            var preHighlightShapes = self.get('preHighlightShapes');\n            if (preHighlightShapes) {\n                var shapes = shapeContainer.get('children');\n                Util.each(shapes, function (shape) {\n                    var originAttrs = shape.get(ATTRS_ORIGIN_ACTIVE);\n                    if (originAttrs) {\n                        if (activeAnimate) {\n                            shape.stopAnimate();\n                            shape.animate(originAttrs, 300);\n                        }\n                        else {\n                            shape.attr(originAttrs);\n                        }\n                        ZIndexUtil.resetZIndex(shape);\n                        shape.setSilent(ATTRS_ORIGIN_ACTIVE, null);\n                    }\n                });\n            }\n            self.set('activeShapes', null);\n            self.set('preHighlightShapes', null);\n        }\n    },\n    getGroupShapesByPoint: function getGroupShapesByPoint(point) {\n        var self = this;\n        var shapeContainer = self.get('shapeContainer');\n        var activeShapes = [];\n        if (shapeContainer) {\n            var xField = self.getXScale().field;\n            var shapes = self.getShapes();\n            var originObj = self._getOriginByPoint(point);\n            Util.each(shapes, function (shape) {\n                var origin = shape.get('origin');\n                if (shape.get('visible') && origin) {\n                    var shapeXValue = origin[FIELD_ORIGIN][xField];\n                    if (shapeXValue === originObj[xField]) {\n                        activeShapes.push(shape);\n                    }\n                }\n            });\n        }\n        return activeShapes;\n    },\n    getSingleShapeByPoint: function getSingleShapeByPoint(point) {\n        var self = this;\n        var shapeContainer = self.get('shapeContainer');\n        var canvas = shapeContainer.get('canvas');\n        var pixelRatio = canvas.get('pixelRatio');\n        var result;\n        if (shapeContainer) {\n            result = shapeContainer.getShape(point.x * pixelRatio, point.y * pixelRatio);\n        }\n        if (result && result.get('origin')) {\n            return result;\n        }\n    },\n    highlightShapes: function highlightShapes(_highlightShapes, highlightCfg) {\n        var self = this;\n        if (!Util.isArray(_highlightShapes)) {\n            _highlightShapes = [_highlightShapes];\n        }\n        var preHighlightShapes = self.get('activeShapes');\n        if (!isChange(preHighlightShapes, _highlightShapes)) {\n            return;\n        }\n        if (preHighlightShapes) {\n            self.clearActivedShapes();\n        }\n        var shapes = self.getShapes();\n        var activedOptions = self.get('activedOptions');\n        var activeAnimate = activedOptions && activedOptions.animate;\n        var activeStyle = activedOptions && activedOptions.style;\n        Util.each(shapes, function (shape) {\n            var changeAttrs = {};\n            shape.stopAnimate();\n            if (Util.indexOf(_highlightShapes, shape) !== -1) {\n                Util.mix(changeAttrs, activeStyle, highlightCfg);\n                ZIndexUtil.toFront(shape);\n            }\n            else {\n                Util.mix(changeAttrs, {\n                    fillOpacity: 0.3,\n                    opacity: 0.3\n                });\n                ZIndexUtil.resetZIndex(shape);\n            }\n            var originAttrs = getOriginAttrs(changeAttrs, shape);\n            shape.setSilent(ATTRS_ORIGIN_ACTIVE, originAttrs);\n            if (activeAnimate) {\n                shape.animate(changeAttrs, 300);\n            }\n            else {\n                shape.attr(changeAttrs);\n            }\n        });\n        self.set('preHighlightShapes', _highlightShapes);\n        self.set('activeShapes', _highlightShapes);\n    }\n};\nmodule.exports = ActiveMixin;\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/mixin/active.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/geom/mixin/active.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * @fileOverview the interaction when geom was actived\n * @author sima.zhang\n */\nvar Util = require('../../util');\n\nvar FIELD_ORIGIN = '_origin';\n\nvar ZIndexUtil = require('./zindex-util');\n\nvar ATTRS_ORIGIN_ACTIVE = '_originActiveAttrs';\n\nfunction isSameShape(shape1, shape2) {\n  if (Util.isNil(shape1) || Util.isNil(shape2)) {\n    return false;\n  }\n\n  var shape1Origin = shape1.get('origin');\n  var shape2Origin = shape2.get('origin');\n  return Util.isEqual(shape1Origin, shape2Origin);\n}\n\nfunction isChange(preShapes, shapes) {\n  if (!preShapes) {\n    return true;\n  }\n\n  if (preShapes.length !== shapes.length) {\n    return true;\n  }\n\n  var rst = false;\n  Util.each(shapes, function (shape, index) {\n    if (!isSameShape(shape, preShapes[index])) {\n      rst = true;\n      return false;\n    }\n  });\n  return rst;\n}\n\nfunction getOriginAttrs(activeCfg, shape) {\n  var originAttrs = {};\n  Util.each(activeCfg, function (v, k) {\n    var originValue = shape.attr(k);\n\n    if (Util.isArray(originValue)) {\n      originValue = Util.cloneDeep(originValue); // 缓存原来的属性，由于 .attr('matrix') 是数组，所以此处需要深度复制\n    }\n\n    originAttrs[k] = originValue;\n  });\n  return originAttrs;\n}\n\nvar ActiveMixin = {\n  _isAllowActive: function _isAllowActive() {\n    var allowActive = this.get('allowActive');\n\n    if (Util.isNil(allowActive)) {\n      // 用户未设置，使用默认的策略\n      var view = this.get('view');\n      var isShareTooltip = this.isShareTooltip();\n      var options = view.get('options'); // 默认情况下，tooltip 关闭或者 tooltip 模式为 shared === false 的时候允许 active\n\n      if (options.tooltip === false || !isShareTooltip) {\n        return true;\n      }\n    } else {\n      return allowActive;\n    }\n\n    return false;\n  },\n  _onMouseenter: function _onMouseenter(ev) {\n    var self = this;\n    var shape = ev.shape;\n    var shapeContainer = self.get('shapeContainer');\n\n    if (shape && shapeContainer.contain(shape) && self._isAllowActive()) {\n      // shape.get('animating')\n      self.setShapesActived(shape);\n    }\n  },\n  _onMouseleave: function _onMouseleave() {\n    var self = this;\n    var view = self.get('view');\n    var canvas = view.get('canvas');\n\n    if (self.get('activeShapes')) {\n      self.clearActivedShapes();\n      canvas.draw();\n    }\n  },\n  _bindActiveAction: function _bindActiveAction() {\n    var self = this;\n    var view = self.get('view');\n    var type = self.get('type');\n    view.on(type + ':mouseenter', Util.wrapBehavior(self, '_onMouseenter'));\n    view.on(type + ':mouseleave', Util.wrapBehavior(self, '_onMouseleave'));\n  },\n  _offActiveAction: function _offActiveAction() {\n    var self = this;\n    var view = self.get('view');\n    var type = self.get('type');\n    view.off(type + ':mouseenter', Util.getWrapBehavior(self, '_onMouseenter'));\n    view.off(type + ':mouseleave', Util.getWrapBehavior(self, '_onMouseleave'));\n  },\n  _setActiveShape: function _setActiveShape(shape) {\n    var self = this;\n    var activedOptions = self.get('activedOptions') || {};\n    var shapeData = shape.get('origin');\n    var shapeName = shapeData.shape || self.getDefaultValue('shape');\n\n    if (Util.isArray(shapeName)) {\n      shapeName = shapeName[0];\n    }\n\n    var shapeFactory = self.get('shapeFactory');\n    var shapeCfg = Util.mix({}, shape.attr(), {\n      origin: shapeData\n    });\n    var activeCfg = shapeFactory.getActiveCfg(shapeName, shapeCfg);\n\n    if (activedOptions.style) {\n      Util.mix(activeCfg, activedOptions.style);\n    }\n\n    var originAttrs = getOriginAttrs(activeCfg, shape);\n    shape.setSilent(ATTRS_ORIGIN_ACTIVE, originAttrs);\n\n    if (activedOptions.animate) {\n      shape.animate(activeCfg, 300);\n    } else {\n      shape.attr(activeCfg);\n    }\n\n    ZIndexUtil.toFront(shape); // 提前\n  },\n  setShapesActived: function setShapesActived(shapes) {\n    var self = this;\n\n    if (!Util.isArray(shapes)) {\n      shapes = [shapes];\n    }\n\n    var preShapes = self.get('activeShapes'); // 获取上次被激活的 shapes\n\n    if (!isChange(preShapes, shapes)) {\n      return;\n    }\n\n    var view = self.get('view');\n    var canvas = view.get('canvas');\n    var activedOptions = self.get('activedOptions');\n\n    if (activedOptions && activedOptions.highlight) {\n      // 上次的动画未完成，所以要停止掉动画\n      Util.each(shapes, function (shape) {\n        if (shape.get('animating')) {\n          shape.stopAnimate();\n        }\n      });\n      self.highlightShapes(shapes);\n    } else {\n      if (preShapes) {\n        self.clearActivedShapes(); // 先清除激活元素\n      }\n\n      Util.each(shapes, function (shape) {\n        if (shape.get('animating')) {\n          shape.stopAnimate();\n        }\n\n        if (shape.get('visible')) {\n          // && !shape.get('selected')\n          self._setActiveShape(shape);\n        }\n      });\n    }\n\n    self.set('activeShapes', shapes); // shapeContainer.sort(); // toFront, resetZIndex 不需要再排序\n\n    canvas.draw();\n  },\n  clearActivedShapes: function clearActivedShapes() {\n    var self = this;\n    var shapeContainer = self.get('shapeContainer');\n    var activedOptions = self.get('activedOptions');\n    var activeAnimate = activedOptions && activedOptions.animate;\n\n    if (shapeContainer && !shapeContainer.get('destroyed')) {\n      var activeShapes = self.get('activeShapes');\n      Util.each(activeShapes, function (activeShape) {\n        // if (!activeShape.get('selected')) {\n        var originAttrs = activeShape.get(ATTRS_ORIGIN_ACTIVE);\n\n        if (activeAnimate) {\n          activeShape.stopAnimate();\n          activeShape.animate(originAttrs, 300);\n        } else {\n          activeShape.attr(originAttrs);\n        }\n\n        ZIndexUtil.resetZIndex(activeShape);\n        activeShape.setSilent(ATTRS_ORIGIN_ACTIVE, null); // }\n      });\n      var preHighlightShapes = self.get('preHighlightShapes');\n\n      if (preHighlightShapes) {\n        var shapes = shapeContainer.get('children');\n        Util.each(shapes, function (shape) {\n          // if (!shape.get('selected')) {\n          var originAttrs = shape.get(ATTRS_ORIGIN_ACTIVE);\n\n          if (originAttrs) {\n            if (activeAnimate) {\n              shape.stopAnimate();\n              shape.animate(originAttrs, 300);\n            } else {\n              shape.attr(originAttrs);\n            }\n\n            ZIndexUtil.resetZIndex(shape);\n            shape.setSilent(ATTRS_ORIGIN_ACTIVE, null);\n          } // }\n\n        });\n      } // 恢复原来排序\n      // const children = shapeContainer.get('children');\n      // children.sort((obj1, obj2) => {\n      //   return obj1._INDEX - obj2._INDEX;\n      // });\n\n\n      self.set('activeShapes', null);\n      self.set('preHighlightShapes', null);\n    }\n  },\n  getGroupShapesByPoint: function getGroupShapesByPoint(point) {\n    var self = this;\n    var shapeContainer = self.get('shapeContainer');\n    var activeShapes = [];\n\n    if (shapeContainer) {\n      var xField = self.getXScale().field;\n      var shapes = self.getShapes();\n\n      var originObj = self._getOriginByPoint(point);\n\n      Util.each(shapes, function (shape) {\n        var origin = shape.get('origin');\n\n        if (shape.get('visible') && origin) {\n          // 有可能不是图形，而是label文本，所以判断一下\n          var shapeXValue = origin[FIELD_ORIGIN][xField];\n\n          if (shapeXValue === originObj[xField]) {\n            activeShapes.push(shape);\n          }\n        }\n      });\n    }\n\n    return activeShapes;\n  },\n  getSingleShapeByPoint: function getSingleShapeByPoint(point) {\n    var self = this;\n    var shapeContainer = self.get('shapeContainer');\n    var canvas = shapeContainer.get('canvas');\n    var pixelRatio = canvas.get('pixelRatio');\n    var result;\n\n    if (shapeContainer) {\n      result = shapeContainer.getShape(point.x * pixelRatio, point.y * pixelRatio);\n    }\n\n    if (result && result.get('origin')) {\n      return result;\n    }\n  },\n  highlightShapes: function highlightShapes(_highlightShapes, highlightCfg) {\n    var self = this;\n\n    if (!Util.isArray(_highlightShapes)) {\n      _highlightShapes = [_highlightShapes];\n    }\n\n    var preHighlightShapes = self.get('activeShapes'); // 获取上次被激活的 shapes\n\n    if (!isChange(preHighlightShapes, _highlightShapes)) {\n      return;\n    }\n\n    if (preHighlightShapes) {\n      self.clearActivedShapes();\n    }\n\n    var shapes = self.getShapes();\n    var activedOptions = self.get('activedOptions');\n    var activeAnimate = activedOptions && activedOptions.animate;\n    var activeStyle = activedOptions && activedOptions.style;\n    Util.each(shapes, function (shape) {\n      var changeAttrs = {};\n      shape.stopAnimate();\n\n      if (Util.indexOf(_highlightShapes, shape) !== -1) {\n        Util.mix(changeAttrs, activeStyle, highlightCfg); // shape.setZIndex(1); // 提前\n\n        ZIndexUtil.toFront(shape);\n      } else {\n        Util.mix(changeAttrs, {\n          fillOpacity: 0.3,\n          // @2018-07-11 by blue.lb 由于线图只有stoke，fillOpacity不生效，最好还是直接改成整个图形透明度opacity\n          opacity: 0.3\n        });\n        ZIndexUtil.resetZIndex(shape);\n      }\n\n      var originAttrs = getOriginAttrs(changeAttrs, shape);\n      shape.setSilent(ATTRS_ORIGIN_ACTIVE, originAttrs);\n\n      if (activeAnimate) {\n        shape.animate(changeAttrs, 300);\n      } else {\n        shape.attr(changeAttrs);\n      }\n    });\n    self.set('preHighlightShapes', _highlightShapes);\n    self.set('activeShapes', _highlightShapes);\n  }\n};\nmodule.exports = ActiveMixin;"]}]}