{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\QuotationPage\\Overview\\MarketOverview.tsx","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\QuotationPage\\Overview\\MarketOverview.tsx","mtime":1596379644591},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport React from \"react\";\r\nimport { Line } from '@antv/g2plot';\r\nimport moment from 'moment';\r\nimport { Inject } from \"react.di\";\r\nimport Slider from \"antd/lib/slider\";\r\nimport \"antd/lib/slider/style/index.js\";\r\nimport message from \"antd/lib/message\";\r\nimport \"antd/lib/message/style/index.js\";\r\nimport { QuotationService } from '../../../api/QuotationService';\r\nimport DatePicker from \"antd/lib/date-picker\";\r\nimport \"antd/lib/date-picker/style/index.js\";\r\nvar RangePicker = DatePicker.RangePicker;\r\nvar dateFormat = 'YYYY-MM-DD';\r\nvar MarketOverview = (function (_super) {\r\n    __extends(MarketOverview, _super);\r\n    function MarketOverview(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.state = {\r\n            data: null,\r\n            lookingYear: 2001,\r\n            lookingTime: [moment('2001-01-01', dateFormat), moment('2001-03-01', dateFormat)],\r\n            linePlot: null,\r\n        };\r\n        _this.filterData = function (data) {\r\n            var temp_data = [];\r\n            var lookingTime = _this.state.lookingTime;\r\n            if (!lookingTime) {\r\n                return data;\r\n            }\r\n            var startTime = lookingTime[0];\r\n            var endTime = lookingTime[1];\r\n            var max_value = -10, min_value = 100;\r\n            data.forEach(function (item) {\r\n                if (startTime <= moment(item.time) && moment(item.time) <= endTime) {\r\n                    temp_data.push(item);\r\n                    if (item.bid > max_value) {\r\n                        max_value = item.bid;\r\n                    }\r\n                    if (item.bid < min_value) {\r\n                        min_value = item.bid;\r\n                    }\r\n                }\r\n            });\r\n            return [temp_data, max_value, min_value];\r\n        };\r\n        _this.showLine = function () {\r\n            var data = _this.state.data;\r\n            var filterResult = _this.filterData(data);\r\n            var temp_data = filterResult[0];\r\n            var max_value = filterResult[1];\r\n            var min_value = filterResult[2];\r\n            var config = {\r\n                title: {\r\n                    visible: true,\r\n                    text: '预测与实际趋势图'\r\n                },\r\n                padding: 'auto',\r\n                forceFit: true,\r\n                data: temp_data,\r\n                xField: 'time',\r\n                yField: 'bid',\r\n                yAxis: {\r\n                    min: min_value,\r\n                    max: max_value\r\n                },\r\n                legend: {\r\n                    position: 'right-top',\r\n                },\r\n                seriesField: 'type',\r\n                responsive: true,\r\n                animation: {\r\n                    appear: {\r\n                        animation: 'clipingWithData',\r\n                    },\r\n                },\r\n                smooth: true,\r\n            };\r\n            var linePlot = new Line(document.getElementById('graph-container'), config);\r\n            _this.setState({ linePlot: linePlot });\r\n            linePlot.render();\r\n        };\r\n        _this.getData = function (year) { return __awaiter(_this, void 0, void 0, function () {\r\n            var responce;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(year !== this.state.lookingYear)) return [3, 3];\r\n                        return [4, this.quotationService.getData(year, year + 1)];\r\n                    case 1:\r\n                        responce = _a.sent();\r\n                        return [4, this.setState({ data: responce.data, lookingYear: year })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3: return [2, this.state.data];\r\n                }\r\n            });\r\n        }); };\r\n        _this.onRangeChange = function (v) { return __awaiter(_this, void 0, void 0, function () {\r\n            var data, responce, linePlot, filterResult, temp_data, max_value, min_value;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.setState({ lookingTime: [v[0], v[1]] })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        data = null;\r\n                        if (!(v[1].year() - v[0].year() > 1)) return [3, 2];\r\n                        return [2, (message.warning('对不起，您选择的时间范围过长！请选择较短的预测时间查看。', 5))];\r\n                    case 2:\r\n                        if (!(v[1].year() === v[0].year())) return [3, 4];\r\n                        return [4, this.getData(v[1].year())];\r\n                    case 3:\r\n                        data = _a.sent();\r\n                        return [3, 7];\r\n                    case 4:\r\n                        if (!(v[1].year() - v[0].year() === 1)) return [3, 7];\r\n                        return [4, this.quotationService.getData(v[0].year(), v[1].year() + 1)];\r\n                    case 5:\r\n                        responce = _a.sent();\r\n                        return [4, this.setState({ data: responce.data })];\r\n                    case 6:\r\n                        _a.sent();\r\n                        data = this.state.data;\r\n                        _a.label = 7;\r\n                    case 7:\r\n                        linePlot = this.state.linePlot;\r\n                        filterResult = this.filterData(data);\r\n                        temp_data = filterResult[0];\r\n                        max_value = filterResult[1];\r\n                        min_value = filterResult[2];\r\n                        linePlot.updateConfig({\r\n                            data: temp_data,\r\n                            yAxis: {\r\n                                min: min_value,\r\n                                max: max_value\r\n                            }\r\n                        });\r\n                        linePlot.render();\r\n                        return [2];\r\n                }\r\n            });\r\n        }); };\r\n        return _this;\r\n    }\r\n    MarketOverview.prototype.componentWillMount = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    MarketOverview.prototype.componentDidMount = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var data, length, endTime, startTime;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        console.log(this.state.data === null ? 1 : this.state.data);\r\n                        if (!!this.state.data) return [3, 2];\r\n                        return [4, this.quotationService.getData(2001, null)];\r\n                    case 1:\r\n                        data = _a.sent();\r\n                        data = data.data;\r\n                        length = data.length;\r\n                        endTime = moment(data[length - 1]['time']).format('YYYY-MM-DD');\r\n                        startTime = moment(endTime).subtract(100, 'days').format('YYYY-MM-DD');\r\n                        console.log(endTime, startTime);\r\n                        this.setState({ data: data, startTime: startTime, endTime: endTime });\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.showLine();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    MarketOverview.prototype.onAfterChange = function (value) {\r\n        var startPoint = value[0];\r\n        var endPoint = value[1];\r\n        this.setState({ startPoint: startPoint, endPoint: endPoint });\r\n        var _a = this.state, data = _a.data, linePlot = _a.linePlot;\r\n        var temp_data = this.filterData(data);\r\n        linePlot.changeData(temp_data);\r\n    };\r\n    MarketOverview.prototype.sliderChange = function (value, quotationService) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var data, lookingTime, filterResult, temp_data, max_value, min_value, linePlot;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        value = 2001 + value * 19 / 100;\r\n                        return [4, quotationService.getData(value)];\r\n                    case 1:\r\n                        data = _a.sent();\r\n                        lookingTime = [moment(value + \"-01-01\", dateFormat), moment(value + \"-03-01\", dateFormat)];\r\n                        return [4, this.setState({ data: data.data, lookingTime: lookingTime })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        filterResult = this.filterData(data.data);\r\n                        temp_data = filterResult[0];\r\n                        max_value = filterResult[1];\r\n                        min_value = filterResult[2];\r\n                        linePlot = this.state.linePlot;\r\n                        linePlot.updateConfig({\r\n                            data: temp_data,\r\n                            yAxis: {\r\n                                min: min_value,\r\n                                max: max_value\r\n                            }\r\n                        });\r\n                        linePlot.render();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    MarketOverview.prototype.render = function () {\r\n        var marks = {\r\n            0: 2001,\r\n            100: 2020\r\n        };\r\n        return (React.createElement(\"div\", null,\r\n            React.createElement(\"div\", null,\r\n                React.createElement(\"strong\", null, \"\\u9009\\u62E9\\u67E5\\u770B\\u7684\\u65F6\\u95F4\\u6BB5\")),\r\n            React.createElement(RangePicker, { defaultValue: this.state.lookingTime, onChange: this.onRangeChange, renderExtraFooter: function () { return '请选择最长半年的时间查看！'; } }),\r\n            React.createElement(\"div\", { id: 'graph-container' })));\r\n    };\r\n    var _a;\r\n    __decorate([\r\n        Inject,\r\n        __metadata(\"design:type\", typeof (_a = typeof QuotationService !== \"undefined\" && QuotationService) === \"function\" ? _a : Object)\r\n    ], MarketOverview.prototype, \"quotationService\", void 0);\r\n    return MarketOverview;\r\n}(React.Component));\r\nexport default MarketOverview;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\QuotationPage\\Overview\\MarketOverview.tsx","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\src\\app\\pages\\QuotationPage\\Overview\\MarketOverview.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { Line } from '@antv/g2plot';\r\nimport moment from 'moment';\r\nimport { Inject, Injectable } from \"react.di\";\r\nimport { Slider, message } from \"antd\";\r\nimport {QuotationService} from '../../../api/QuotationService';\r\nimport _ from 'lodash';\r\nimport {DatePicker} from 'antd';\r\nconst {RangePicker} = DatePicker; \r\nconst dateFormat = 'YYYY-MM-DD';\r\nexport default class MarketOverview extends React.Component {\r\n  @Inject quotationService: QuotationService;\r\n\r\n  state = {\r\n    data: null,\r\n    lookingYear: 2001,\r\n    lookingTime: [moment('2001-01-01', dateFormat), moment('2001-03-01', dateFormat)],\r\n    linePlot: null,\r\n  }\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  async componentWillMount() {\r\n  }\r\n  filterData = (data) => {\r\n    const temp_data = [];\r\n    const {lookingTime} = this.state;\r\n    if (!lookingTime) {\r\n      return data;\r\n    }\r\n    // console.log(lookingTime);\r\n    // const {startTime, endTime} = lookingTime;\r\n    const startTime = lookingTime[0];\r\n    const endTime = lookingTime[1];\r\n    let max_value = -10, min_value = 100;\r\n    data.forEach(item => {\r\n      if (startTime <= moment(item.time) && moment(item.time) <= endTime) {\r\n        temp_data.push(item);\r\n        if (item.bid > max_value) {\r\n          max_value = item.bid;\r\n        }\r\n        if (item.bid < min_value) {\r\n          min_value = item.bid;\r\n        }\r\n      }\r\n    });\r\n    return [temp_data, max_value, min_value];\r\n  }\r\n  showLine = () => {\r\n    const {data} = this.state;\r\n    const filterResult = this.filterData(data);\r\n    const temp_data = filterResult[0];\r\n    const max_value = filterResult[1];\r\n    const min_value = filterResult[2];\r\n    \r\n    const config = {\r\n      title: {\r\n        visible: true,\r\n        text:'预测与实际趋势图'\r\n      },\r\n      padding: 'auto',\r\n      forceFit: true,\r\n      data: temp_data,\r\n      xField: 'time',\r\n      yField: 'bid',\r\n      yAxis: {\r\n        min: min_value,\r\n        max: max_value\r\n      },\r\n      legend: {\r\n        position: 'right-top',\r\n      },\r\n      seriesField: 'type',\r\n      responsive: true,\r\n      animation: {\r\n        appear: {\r\n          animation: 'clipingWithData',\r\n        },\r\n      },\r\n      smooth: true,\r\n    };\r\n    const linePlot = new Line(document.getElementById('graph-container'), config);\r\n    this.setState({linePlot});\r\n    linePlot.render();\r\n  }\r\n  async componentDidMount() {\r\n    console.log(this.state.data === null ? 1 : this.state.data)\r\n    if (!this.state.data) {\r\n      let data = await this.quotationService.getData(2001, null);\r\n      data = data.data;\r\n      const length = data.length;\r\n      let endTime = moment(data[length - 1]['time']).format('YYYY-MM-DD');\r\n      let startTime = moment(endTime).subtract(100, 'days').format('YYYY-MM-DD');\r\n      console.log(endTime, startTime);\r\n      this.setState({data: data, startTime: startTime, endTime: endTime});\r\n    }\r\n    this.showLine()\r\n  }\r\n\r\n  onAfterChange (value) {\r\n    const startPoint = value[0];\r\n    const endPoint = value[1];\r\n    this.setState({startPoint, endPoint});\r\n    const {data, linePlot} = this.state;\r\n    const temp_data = this.filterData(data);\r\n    linePlot.changeData(temp_data);\r\n  }\r\n  async sliderChange(value, quotationService) {\r\n    value = 2001 + value * 19 /100;\r\n    let data = await quotationService.getData(value);\r\n    const lookingTime = [moment(`${value}-01-01`, dateFormat), moment(`${value}-03-01`, dateFormat)]\r\n    await this.setState({data: data.data, lookingTime});\r\n    const filterResult = this.filterData(data.data);\r\n    const temp_data = filterResult[0];\r\n    const max_value = filterResult[1];\r\n    const min_value = filterResult[2];\r\n    const {linePlot} = this.state;\r\n    linePlot.updateConfig({\r\n      data: temp_data,\r\n      yAxis: {\r\n        min: min_value,\r\n        max: max_value\r\n      }\r\n    });\r\n    linePlot.render();\r\n  }\r\n  getData = async (year) => {\r\n    if (year !== this.state.lookingYear) {\r\n      const responce = await this.quotationService.getData(year, year+1);\r\n      await this.setState({data: responce.data, lookingYear: year});\r\n    } \r\n    return this.state.data;\r\n  }\r\n  onRangeChange = async (v) => {\r\n    await this.setState({lookingTime: [v[0], v[1]]})\r\n    let data = null;\r\n    if (v[1].year() - v[0].year() > 1) {\r\n      return (message.warning('对不起，您选择的时间范围过长！请选择较短的预测时间查看。', 5));\r\n    } else if (v[1].year() === v[0].year() ) {\r\n      data = await this.getData(v[1].year());\r\n    } \r\n    else if (v[1].year() - v[0].year() === 1) {\r\n      const responce = await this.quotationService.getData(v[0].year(), v[1].year() + 1);\r\n      await this.setState({data: responce.data});\r\n      data = this.state.data;\r\n    }\r\n    const {linePlot} = this.state;\r\n    const filterResult = this.filterData(data)\r\n    const temp_data = filterResult[0];\r\n    const max_value = filterResult[1];\r\n    const min_value = filterResult[2];\r\n    linePlot.updateConfig({\r\n      data: temp_data,\r\n      yAxis: {\r\n        min: min_value,\r\n        max: max_value\r\n      }});\r\n    linePlot.render();\r\n    return;\r\n  }\r\n\r\n  render() {\r\n    const marks = {\r\n      0: 2001,\r\n      100: 2020\r\n    };\r\n    return (\r\n    <div>\r\n    {/* <div><strong>选择查看的年份</strong></div>\r\n    <Slider\r\n      defaultValue={0}\r\n      marks={marks} \r\n      step={100/19} \r\n      tipFormatter= {(v) => `${2001 + v * 19 / 100}`} \r\n      onAfterChange={(v) => this.sliderChange(v, this.quotationService)}\r\n    /> */}\r\n    <div><strong>选择查看的时间段</strong></div>\r\n    <RangePicker \r\n      defaultValue={this.state.lookingTime}\r\n      onChange={this.onRangeChange}\r\n      renderExtraFooter={() => '请选择最长半年的时间查看！'}\r\n    />\r\n    <div id='graph-container' />\r\n    </div>\r\n  ); \r\n  }\r\n}\r\n\r\n"]}]}