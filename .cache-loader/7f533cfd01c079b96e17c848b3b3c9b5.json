{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g\\lib\\core\\mixin\\timeline.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g\\lib\\core\\mixin\\timeline.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var Util = require('../../util/index');\r\nvar PathUtil = require('../../util/path');\r\nvar d3Timer = require('d3-timer');\r\nvar d3Ease = require('d3-ease');\r\nvar _require = require('d3-interpolate'), interpolate = _require.interpolate, interpolateArray = _require.interpolateArray;\r\nvar Timeline = function Timeline(canvas) {\r\n    this._animators = [];\r\n    this._current = 0;\r\n    this._timer = null;\r\n    this.canvas = canvas;\r\n};\r\nfunction _update(self, animator, ratio) {\r\n    var cProps = {};\r\n    var toAttrs = animator.toAttrs;\r\n    var fromAttrs = animator.fromAttrs;\r\n    var toMatrix = animator.toMatrix;\r\n    if (self.get('destroyed')) {\r\n        return;\r\n    }\r\n    var interf;\r\n    for (var k in toAttrs) {\r\n        if (!Util.isEqual(fromAttrs[k], toAttrs[k])) {\r\n            if (k === 'path') {\r\n                var toPath = toAttrs[k];\r\n                var fromPath = fromAttrs[k];\r\n                if (toPath.length > fromPath.length) {\r\n                    toPath = PathUtil.parsePathString(toAttrs[k]);\r\n                    fromPath = PathUtil.parsePathString(fromAttrs[k]);\r\n                    fromPath = PathUtil.fillPathByDiff(fromPath, toPath);\r\n                    fromPath = PathUtil.formatPath(fromPath, toPath);\r\n                    animator.fromAttrs.path = fromPath;\r\n                    animator.toAttrs.path = toPath;\r\n                }\r\n                else if (!animator.pathFormatted) {\r\n                    toPath = PathUtil.parsePathString(toAttrs[k]);\r\n                    fromPath = PathUtil.parsePathString(fromAttrs[k]);\r\n                    fromPath = PathUtil.formatPath(fromPath, toPath);\r\n                    animator.fromAttrs.path = fromPath;\r\n                    animator.toAttrs.path = toPath;\r\n                    animator.pathFormatted = true;\r\n                }\r\n                cProps[k] = [];\r\n                for (var i = 0; i < toPath.length; i++) {\r\n                    var toPathPoint = toPath[i];\r\n                    var fromPathPoint = fromPath[i];\r\n                    var cPathPoint = [];\r\n                    for (var j = 0; j < toPathPoint.length; j++) {\r\n                        if (Util.isNumber(toPathPoint[j]) && fromPathPoint && Util.isNumber(fromPathPoint[j])) {\r\n                            interf = interpolate(fromPathPoint[j], toPathPoint[j]);\r\n                            cPathPoint.push(interf(ratio));\r\n                        }\r\n                        else {\r\n                            cPathPoint.push(toPathPoint[j]);\r\n                        }\r\n                    }\r\n                    cProps[k].push(cPathPoint);\r\n                }\r\n            }\r\n            else {\r\n                interf = interpolate(fromAttrs[k], toAttrs[k]);\r\n                cProps[k] = interf(ratio);\r\n            }\r\n        }\r\n    }\r\n    if (toMatrix) {\r\n        var mf = interpolateArray(animator.fromMatrix, toMatrix);\r\n        var cM = mf(ratio);\r\n        self.setMatrix(cM);\r\n    }\r\n    self.attr(cProps);\r\n}\r\nfunction update(shape, animator, elapsed) {\r\n    var startTime = animator.startTime;\r\n    if (elapsed < startTime + animator.delay || animator.isPaused) {\r\n        return false;\r\n    }\r\n    var ratio;\r\n    var duration = animator.duration;\r\n    var easing = animator.easing;\r\n    elapsed = elapsed - startTime - animator.delay;\r\n    if (animator.toAttrs.repeat) {\r\n        ratio = elapsed % duration / duration;\r\n        ratio = d3Ease[easing](ratio);\r\n    }\r\n    else {\r\n        ratio = elapsed / duration;\r\n        if (ratio < 1) {\r\n            ratio = d3Ease[easing](ratio);\r\n        }\r\n        else {\r\n            shape.attr(animator.toAttrs);\r\n            if (animator.toMatrix) {\r\n                shape.setMatrix(animator.toMatrix);\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n    _update(shape, animator, ratio);\r\n    return false;\r\n}\r\nUtil.augment(Timeline, {\r\n    initTimer: function initTimer() {\r\n        var _this = this;\r\n        var self = this;\r\n        var isFinished = false;\r\n        var shape, animators, animator;\r\n        self._timer = d3Timer.timer(function (elapsed) {\r\n            self._current = elapsed;\r\n            if (_this._animators.length > 0) {\r\n                for (var i = _this._animators.length - 1; i >= 0; i--) {\r\n                    shape = _this._animators[i];\r\n                    if (shape.get('destroyed')) {\r\n                        self.removeAnimator(i);\r\n                        continue;\r\n                    }\r\n                    if (!shape.get('pause').isPaused) {\r\n                        animators = shape.get('animators');\r\n                        for (var j = animators.length - 1; j >= 0; j--) {\r\n                            animator = animators[j];\r\n                            isFinished = update(shape, animator, elapsed);\r\n                            if (isFinished) {\r\n                                animators.splice(j, 1);\r\n                                isFinished = false;\r\n                                if (animator.callback) {\r\n                                    animator.callback();\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (animators.length === 0) {\r\n                        self.removeAnimator(i);\r\n                    }\r\n                }\r\n                _this.canvas.draw();\r\n            }\r\n        });\r\n    },\r\n    addAnimator: function addAnimator(shape) {\r\n        this._animators.push(shape);\r\n    },\r\n    removeAnimator: function removeAnimator(index) {\r\n        this._animators.splice(index, 1);\r\n    },\r\n    isAnimating: function isAnimating() {\r\n        return !!this._animators.length;\r\n    },\r\n    stop: function stop() {\r\n        if (this._timer) {\r\n            this._timer.stop();\r\n        }\r\n    },\r\n    stopAllAnimations: function stopAllAnimations() {\r\n        this._animators.forEach(function (animator) {\r\n            animator.stopAnimate();\r\n        });\r\n        this._animators = [];\r\n        this.canvas.draw();\r\n    },\r\n    getTime: function getTime() {\r\n        return this._current;\r\n    }\r\n});\r\nmodule.exports = Timeline;\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g\\lib\\core\\mixin\\timeline.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g\\lib\\core\\mixin\\timeline.js"],"names":[],"mappings":"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","sourcesContent":["var Util = require('../../util/index');\n\nvar PathUtil = require('../../util/path');\n\nvar d3Timer = require('d3-timer');\n\nvar d3Ease = require('d3-ease');\n\nvar _require = require('d3-interpolate'),\n    interpolate = _require.interpolate,\n    interpolateArray = _require.interpolateArray; // 目前整体动画只需要数值和数组的差值计算\n\n\nvar Timeline = function Timeline(canvas) {\n  // 待执行动画的队列\n  this._animators = []; // 当前时间\n\n  this._current = 0; // 计时器实例\n\n  this._timer = null; // 画布\n\n  this.canvas = canvas;\n};\n\nfunction _update(self, animator, ratio) {\n  var cProps = {}; // 此刻属性\n\n  var toAttrs = animator.toAttrs;\n  var fromAttrs = animator.fromAttrs;\n  var toMatrix = animator.toMatrix;\n\n  if (self.get('destroyed')) {\n    return;\n  }\n\n  var interf; //  差值函数\n\n  for (var k in toAttrs) {\n    if (!Util.isEqual(fromAttrs[k], toAttrs[k])) {\n      if (k === 'path') {\n        var toPath = toAttrs[k];\n        var fromPath = fromAttrs[k];\n\n        if (toPath.length > fromPath.length) {\n          toPath = PathUtil.parsePathString(toAttrs[k]); // 终点状态\n\n          fromPath = PathUtil.parsePathString(fromAttrs[k]); // 起始状态\n\n          fromPath = PathUtil.fillPathByDiff(fromPath, toPath);\n          fromPath = PathUtil.formatPath(fromPath, toPath);\n          animator.fromAttrs.path = fromPath;\n          animator.toAttrs.path = toPath;\n        } else if (!animator.pathFormatted) {\n          toPath = PathUtil.parsePathString(toAttrs[k]);\n          fromPath = PathUtil.parsePathString(fromAttrs[k]);\n          fromPath = PathUtil.formatPath(fromPath, toPath);\n          animator.fromAttrs.path = fromPath;\n          animator.toAttrs.path = toPath;\n          animator.pathFormatted = true;\n        }\n\n        cProps[k] = [];\n\n        for (var i = 0; i < toPath.length; i++) {\n          var toPathPoint = toPath[i];\n          var fromPathPoint = fromPath[i];\n          var cPathPoint = [];\n\n          for (var j = 0; j < toPathPoint.length; j++) {\n            if (Util.isNumber(toPathPoint[j]) && fromPathPoint && Util.isNumber(fromPathPoint[j])) {\n              interf = interpolate(fromPathPoint[j], toPathPoint[j]);\n              cPathPoint.push(interf(ratio));\n            } else {\n              cPathPoint.push(toPathPoint[j]);\n            }\n          }\n\n          cProps[k].push(cPathPoint);\n        }\n      } else {\n        interf = interpolate(fromAttrs[k], toAttrs[k]);\n        cProps[k] = interf(ratio);\n      }\n    }\n  }\n\n  if (toMatrix) {\n    var mf = interpolateArray(animator.fromMatrix, toMatrix);\n    var cM = mf(ratio);\n    self.setMatrix(cM);\n  }\n\n  self.attr(cProps);\n}\n\nfunction update(shape, animator, elapsed) {\n  var startTime = animator.startTime; // 如果还没有开始执行或暂停，先不更新\n\n  if (elapsed < startTime + animator.delay || animator.isPaused) {\n    return false;\n  }\n\n  var ratio;\n  var duration = animator.duration;\n  var easing = animator.easing; // 已执行时间\n\n  elapsed = elapsed - startTime - animator.delay;\n\n  if (animator.toAttrs.repeat) {\n    ratio = elapsed % duration / duration;\n    ratio = d3Ease[easing](ratio);\n  } else {\n    ratio = elapsed / duration;\n\n    if (ratio < 1) {\n      ratio = d3Ease[easing](ratio);\n    } else {\n      shape.attr(animator.toAttrs);\n\n      if (animator.toMatrix) {\n        shape.setMatrix(animator.toMatrix);\n      }\n\n      return true;\n    }\n  }\n\n  _update(shape, animator, ratio);\n\n  return false;\n}\n\nUtil.augment(Timeline, {\n  initTimer: function initTimer() {\n    var _this = this;\n\n    var self = this;\n    var isFinished = false;\n    var shape, animators, animator;\n    self._timer = d3Timer.timer(function (elapsed) {\n      self._current = elapsed;\n\n      if (_this._animators.length > 0) {\n        for (var i = _this._animators.length - 1; i >= 0; i--) {\n          shape = _this._animators[i];\n\n          if (shape.get('destroyed')) {\n            // 如果已经被销毁，直接移出队列\n            self.removeAnimator(i);\n            continue;\n          }\n\n          if (!shape.get('pause').isPaused) {\n            animators = shape.get('animators');\n\n            for (var j = animators.length - 1; j >= 0; j--) {\n              animator = animators[j];\n              isFinished = update(shape, animator, elapsed);\n\n              if (isFinished) {\n                animators.splice(j, 1);\n                isFinished = false;\n\n                if (animator.callback) {\n                  animator.callback();\n                }\n              }\n            }\n          }\n\n          if (animators.length === 0) {\n            self.removeAnimator(i);\n          }\n        }\n\n        _this.canvas.draw();\n      }\n    });\n  },\n  addAnimator: function addAnimator(shape) {\n    this._animators.push(shape);\n  },\n  removeAnimator: function removeAnimator(index) {\n    this._animators.splice(index, 1);\n  },\n  isAnimating: function isAnimating() {\n    return !!this._animators.length;\n  },\n  stop: function stop() {\n    if (this._timer) {\n      this._timer.stop();\n    }\n  },\n  stopAllAnimations: function stopAllAnimations() {\n    this._animators.forEach(function (animator) {\n      animator.stopAnimate();\n    });\n\n    this._animators = [];\n    this.canvas.draw();\n  },\n  getTime: function getTime() {\n    return this._current;\n  }\n});\nmodule.exports = Timeline;"]}]}