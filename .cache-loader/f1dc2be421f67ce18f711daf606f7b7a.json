{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/chart/controller/tooltip.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/chart/controller/tooltip.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n            target[key] = source[key];\n        }\n    }\n} return target; }; return _extends.apply(this, arguments); }\nvar Util = require('../../util');\nvar Shape = require('../../geom/shape/shape');\nvar _require = require('@antv/component/lib'), Tooltip = _require.Tooltip;\nvar MatrixUtil = Util.MatrixUtil;\nvar Vector2 = MatrixUtil.vec2;\nvar TYPE_SHOW_MARKERS = ['line', 'area', 'path', 'areaStack'];\nvar TYPE_SHOW_CROSSHAIRS = ['line', 'area', 'point'];\nvar IGNORE_TOOLTIP_ITEM_PROPERTIES = ['marker', 'showMarker'];\nfunction _indexOfArray(items, item) {\n    var rst = -1;\n    Util.each(items, function (sub, index) {\n        var isEqual = true;\n        for (var key in item) {\n            if (item.hasOwnProperty(key) && !IGNORE_TOOLTIP_ITEM_PROPERTIES.includes(key)) {\n                if (!Util.isObject(item[key]) && item[key] !== sub[key]) {\n                    isEqual = false;\n                    break;\n                }\n            }\n        }\n        if (isEqual) {\n            rst = index;\n            return false;\n        }\n    });\n    return rst;\n}\nfunction _hasClass(dom, className) {\n    if (!dom) {\n        return false;\n    }\n    var cls = '';\n    if (!dom.className)\n        return false;\n    if (!Util.isNil(dom.className.baseVal)) {\n        cls = dom.className.baseVal;\n    }\n    else {\n        cls = dom.className;\n    }\n    return cls.includes(className);\n}\nfunction _isParent(dom, cls) {\n    var parent = dom.parentNode;\n    var rst = false;\n    while (parent && parent !== document.body) {\n        if (_hasClass(parent, cls)) {\n            rst = true;\n            break;\n        }\n        parent = parent.parentNode;\n    }\n    return rst;\n}\nfunction _uniqItems(items) {\n    var tmp = [];\n    Util.each(items, function (item) {\n        var index = _indexOfArray(tmp, item);\n        if (index === -1) {\n            tmp.push(item);\n        }\n        else {\n            tmp[index] = item;\n        }\n    });\n    return tmp;\n}\nvar TooltipController = function () {\n    function TooltipController(cfg) {\n        Util.assign(this, cfg);\n        this.timeStamp = 0;\n        this.locked = false;\n    }\n    var _proto = TooltipController.prototype;\n    _proto._normalizeEvent = function _normalizeEvent(event) {\n        var chart = this.chart;\n        var canvas = this._getCanvas();\n        var point = canvas.getPointByClient(event.clientX, event.clientY);\n        var pixelRatio = canvas.get('pixelRatio');\n        point.x = point.x / pixelRatio;\n        point.y = point.y / pixelRatio;\n        var views = chart.getViewsByPoint(point);\n        point.views = views;\n        return point;\n    };\n    _proto._getCanvas = function _getCanvas() {\n        return this.chart.get('canvas');\n    };\n    _proto._getTriggerEvent = function _getTriggerEvent() {\n        var options = this.options;\n        var triggerOn = options.triggerOn;\n        var eventName;\n        if (!triggerOn || triggerOn === 'mousemove') {\n            eventName = 'plotmove';\n        }\n        else if (triggerOn === 'click') {\n            eventName = 'plotclick';\n        }\n        else if (triggerOn === 'none') {\n            eventName = null;\n        }\n        return eventName;\n    };\n    _proto._getDefaultTooltipCfg = function _getDefaultTooltipCfg() {\n        var self = this;\n        var chart = self.chart;\n        var viewTheme = self.viewTheme;\n        var options = self.options;\n        var defaultCfg = Util.mix({}, viewTheme.tooltip);\n        var geoms = chart.getAllGeoms().filter(function (geom) {\n            return geom.get('visible');\n        });\n        var shapes = [];\n        Util.each(geoms, function (geom) {\n            var type = geom.get('type');\n            var adjusts = geom.get('adjusts');\n            var isSymmetric = false;\n            if (adjusts) {\n                Util.each(adjusts, function (adjust) {\n                    if (adjust.type === 'symmetric' || adjust.type === 'Symmetric') {\n                        isSymmetric = true;\n                        return false;\n                    }\n                });\n            }\n            if (Util.indexOf(shapes, type) === -1 && !isSymmetric) {\n                shapes.push(type);\n            }\n        });\n        var isTransposed = geoms.length && geoms[0].get('coord') ? geoms[0].get('coord').isTransposed : false;\n        var crosshairsCfg;\n        if (geoms.length && geoms[0].get('coord') && geoms[0].get('coord').type === 'cartesian') {\n            if (shapes[0] === 'interval' && options.shared !== false) {\n                var crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsRect);\n                crosshairs.isTransposed = isTransposed;\n                crosshairsCfg = {\n                    zIndex: 0,\n                    crosshairs: crosshairs\n                };\n            }\n            else if (Util.indexOf(TYPE_SHOW_CROSSHAIRS, shapes[0]) > -1) {\n                var _crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsLine);\n                _crosshairs.isTransposed = isTransposed;\n                crosshairsCfg = {\n                    crosshairs: _crosshairs\n                };\n            }\n        }\n        return Util.mix(defaultCfg, crosshairsCfg, {});\n    };\n    _proto._bindEvent = function _bindEvent() {\n        var chart = this.chart;\n        var triggerEvent = this._getTriggerEvent();\n        if (triggerEvent) {\n            chart.on(triggerEvent, Util.wrapBehavior(this, 'onMouseMove'));\n            chart.on('plotleave', Util.wrapBehavior(this, 'onMouseOut'));\n        }\n    };\n    _proto._offEvent = function _offEvent() {\n        var chart = this.chart;\n        var triggerEvent = this._getTriggerEvent();\n        if (triggerEvent) {\n            chart.off(triggerEvent, Util.getWrapBehavior(this, 'onMouseMove'));\n            chart.off('plotleave', Util.getWrapBehavior(this, 'onMouseOut'));\n        }\n    };\n    _proto._setTooltip = function _setTooltip(point, items, markersItems, target) {\n        var self = this;\n        var tooltip = self.tooltip;\n        var prePoint = self.prePoint;\n        if (!prePoint || prePoint.x !== point.x || prePoint.y !== point.y) {\n            items = _uniqItems(items);\n            self.prePoint = point;\n            var chart = self.chart;\n            var viewTheme = self.viewTheme;\n            var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n            var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n            if (!tooltip.get('visible')) {\n                chart.emit('tooltip:show', {\n                    x: x,\n                    y: y,\n                    tooltip: tooltip\n                });\n            }\n            var first = items[0];\n            var title = first.title || first.name;\n            if (tooltip.isContentChange(title, items)) {\n                chart.emit('tooltip:change', {\n                    tooltip: tooltip,\n                    x: x,\n                    y: y,\n                    items: items\n                });\n                title = items[0].title || items[0].name;\n                tooltip.setContent(title, items);\n                if (!Util.isEmpty(markersItems)) {\n                    if (self.options.hideMarkers === true) {\n                        tooltip.set('markerItems', markersItems);\n                    }\n                    else {\n                        tooltip.setMarkers(markersItems, viewTheme.tooltipMarker);\n                    }\n                }\n                else {\n                    tooltip.clearMarkers();\n                    tooltip.set('markerItems', []);\n                }\n            }\n            var canvas = this._getCanvas();\n            if (target === canvas && tooltip.get('type') === 'mini') {\n                tooltip.hide();\n            }\n            else {\n                tooltip.setPosition(x, y, target);\n                tooltip.show();\n            }\n        }\n    };\n    _proto.hideTooltip = function hideTooltip() {\n        var tooltip = this.tooltip;\n        var chart = this.chart;\n        var canvas = this._getCanvas();\n        this.prePoint = null;\n        tooltip.hide();\n        chart.emit('tooltip:hide', {\n            tooltip: tooltip\n        });\n        canvas.draw();\n    };\n    _proto.onMouseMove = function onMouseMove(ev) {\n        if (Util.isEmpty(ev.views) || this.locked) {\n            return;\n        }\n        var lastTimeStamp = this.timeStamp;\n        var timeStamp = +new Date();\n        var point = {\n            x: ev.x,\n            y: ev.y\n        };\n        if (timeStamp - lastTimeStamp > 16 && !this.chart.get('stopTooltip')) {\n            this.showTooltip(point, ev.views, ev.shape);\n            this.timeStamp = timeStamp;\n        }\n    };\n    _proto.onMouseOut = function onMouseOut(ev) {\n        var tooltip = this.tooltip;\n        if (!tooltip.get('visible') || !tooltip.get('follow') || this.locked) {\n            return;\n        }\n        if (ev && ev.toElement && (_hasClass(ev.toElement, 'g2-tooltip') || _isParent(ev.toElement, 'g2-tooltip'))) {\n            return;\n        }\n        this.hideTooltip();\n    };\n    _proto.renderTooltip = function renderTooltip() {\n        var self = this;\n        if (self.tooltip) {\n            return;\n        }\n        var chart = self.chart;\n        var viewTheme = self.viewTheme;\n        var canvas = self._getCanvas();\n        var defaultCfg = self._getDefaultTooltipCfg();\n        var options = self.options;\n        options = Util.deepMix({\n            plotRange: chart.get('plotRange'),\n            capture: false,\n            canvas: canvas,\n            frontPlot: chart.get('frontPlot'),\n            viewTheme: viewTheme.tooltip,\n            backPlot: chart.get('backPlot')\n        }, defaultCfg, options);\n        if (options.crosshairs && options.crosshairs.type === 'rect') {\n            options.zIndex = 0;\n        }\n        options.visible = false;\n        var tooltip;\n        if (options.type === 'mini') {\n            options.crosshairs = false;\n            options.position = 'top';\n            tooltip = new Tooltip.Mini(options);\n        }\n        else if (options.useHtml) {\n            tooltip = new Tooltip.Html(options);\n        }\n        else {\n            tooltip = new Tooltip.Canvas(options);\n        }\n        self.tooltip = tooltip;\n        var triggerEvent = self._getTriggerEvent();\n        var tooltipContainer = tooltip.get('container');\n        if (!tooltip.get('enterable') && triggerEvent === 'plotmove') {\n            if (tooltipContainer) {\n                tooltipContainer.onmousemove = function (e) {\n                    var eventObj = self._normalizeEvent(e);\n                    chart.emit(triggerEvent, eventObj);\n                };\n            }\n        }\n        if (tooltipContainer) {\n            tooltipContainer.onmouseleave = function () {\n                if (!self.locked) {\n                    self.hideTooltip();\n                }\n            };\n        }\n        self._bindEvent();\n    };\n    _proto._formatMarkerOfItem = function _formatMarkerOfItem(coord, geom, item) {\n        var self = this;\n        var options = self.options;\n        var point = item.point;\n        if (point && point.x && point.y) {\n            var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n            var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n            point = coord.applyMatrix(x, y, 1);\n            item.x = point[0];\n            item.y = point[1];\n            item.showMarker = true;\n            if (item.color.substring(0, 2) === 'l(' && (!options.hasOwnProperty('useHtml') || options.useHtml)) {\n                item.color = item.color.split(' ')[1].substring(2);\n            }\n            var itemMarker = self._getItemMarker(geom, item);\n            item.marker = itemMarker;\n            if (Util.indexOf(TYPE_SHOW_MARKERS, geom.get('type')) !== -1) {\n                return item;\n            }\n        }\n        return null;\n    };\n    _proto.lockTooltip = function lockTooltip() {\n        this.locked = true;\n    };\n    _proto.unlockTooltip = function unlockTooltip() {\n        this.locked = false;\n    };\n    _proto.showTooltip = function showTooltip(point, views, target) {\n        var _this = this;\n        var self = this;\n        if (Util.isEmpty(views) || !point) {\n            return;\n        }\n        if (!this.tooltip) {\n            this.renderTooltip();\n        }\n        var options = self.options;\n        var markersItems = [];\n        var items = [];\n        Util.each(views, function (view) {\n            if (!view.get('tooltipEnable')) {\n                return true;\n            }\n            var geoms = view.get('geoms');\n            var coord = view.get('coord');\n            Util.each(geoms, function (geom) {\n                var type = geom.get('type');\n                if (geom.get('visible') && geom.get('tooltipCfg') !== false) {\n                    var dataArray = geom.get('dataArray');\n                    if (geom.isShareTooltip() || options.shared === false && Util.inArray(['area', 'line', 'path', 'polygon'], type)) {\n                        var xScale = geom.getXScale();\n                        var colorAttr = geom.getAttr('color');\n                        var colorField = colorAttr ? colorAttr.field : undefined;\n                        if (type === 'interval' && xScale.field === colorField && geom.hasAdjust('dodge')) {\n                            var points = Util.find(dataArray, function (obj) {\n                                return !!geom.findPoint(point, obj);\n                            });\n                            Util.each(points, function (tmpPoint) {\n                                var subItems = geom.getTipItems(tmpPoint, options.title);\n                                Util.each(subItems, function (v) {\n                                    var markerItem = self._formatMarkerOfItem(coord, geom, v);\n                                    if (markerItem) {\n                                        markersItems.push(markerItem);\n                                    }\n                                });\n                                items = items.concat(subItems);\n                            });\n                        }\n                        else {\n                            Util.each(dataArray, function (obj) {\n                                var tmpPoint = geom.findPoint(point, obj);\n                                if (tmpPoint) {\n                                    var subItems = geom.getTipItems(tmpPoint, options.title);\n                                    Util.each(subItems, function (v) {\n                                        var markerItem = self._formatMarkerOfItem(coord, geom, v);\n                                        if (markerItem) {\n                                            markersItems.push(markerItem);\n                                        }\n                                    });\n                                    items = items.concat(subItems);\n                                }\n                            });\n                        }\n                    }\n                    else {\n                        var geomContainer = geom.get('shapeContainer');\n                        var canvas = geomContainer.get('canvas');\n                        var pixelRatio = canvas.get('pixelRatio');\n                        var shape = geomContainer.getShape(point.x * pixelRatio, point.y * pixelRatio);\n                        if (shape && shape.get('visible') && shape.get('origin')) {\n                            items = geom.getTipItems(shape.get('origin'), options.title);\n                        }\n                        Util.each(items, function (v) {\n                            var markerItem = _this._formatMarkerOfItem(coord, geom, v);\n                            if (markerItem) {\n                                markersItems.push(markerItem);\n                            }\n                        });\n                    }\n                }\n            });\n            Util.each(items, function (item) {\n                var point = item.point;\n                var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n                var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n                point = coord.applyMatrix(x, y, 1);\n                item.x = point[0];\n                item.y = point[1];\n            });\n        });\n        if (items.length) {\n            var first = items[0];\n            if (!items.every(function (item) {\n                return item.title === first.title;\n            })) {\n                var nearestItem = first;\n                var nearestDistance = Infinity;\n                items.forEach(function (item) {\n                    var distance = Vector2.distance([point.x, point.y], [item.x, item.y]);\n                    if (distance < nearestDistance) {\n                        nearestDistance = distance;\n                        nearestItem = item;\n                    }\n                });\n                items = items.filter(function (item) {\n                    return item.title === nearestItem.title;\n                });\n                markersItems = markersItems.filter(function (item) {\n                    return item.title === nearestItem.title;\n                });\n            }\n            if (options.shared === false && items.length > 1) {\n                var snapItem = items[0];\n                var min = Math.abs(point.y - snapItem.y);\n                Util.each(items, function (aItem) {\n                    if (Math.abs(point.y - aItem.y) <= min) {\n                        snapItem = aItem;\n                        min = Math.abs(point.y - aItem.y);\n                    }\n                });\n                if (snapItem && snapItem.x && snapItem.y) {\n                    markersItems = [snapItem];\n                }\n                items = [snapItem];\n            }\n            self._setTooltip(point, items, markersItems, target);\n        }\n        else {\n            self.hideTooltip();\n        }\n    };\n    _proto.clear = function clear() {\n        var tooltip = this.tooltip;\n        tooltip && tooltip.destroy();\n        this.tooltip = null;\n        this.prePoint = null;\n        this._offEvent();\n    };\n    _proto._getItemMarker = function _getItemMarker(geom, item) {\n        var options = this.options;\n        var markerOption = options.marker || this.viewTheme.tooltip.marker;\n        if (Util.isFunction(markerOption)) {\n            var shapeType = geom.get('shapeType') || 'point';\n            var shape = geom.getDefaultValue('shape') || 'circle';\n            var shapeObject = Shape.getShapeFactory(shapeType);\n            var cfg = {\n                color: item.color\n            };\n            var marker = shapeObject.getMarkerCfg(shape, cfg);\n            return markerOption(marker, item);\n        }\n        return _extends({\n            fill: item.color\n        }, markerOption);\n    };\n    return TooltipController;\n}();\nmodule.exports = TooltipController;\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/chart/controller/tooltip.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/bizcharts/node_modules/@antv/g2/lib/chart/controller/tooltip.js"],"names":[],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\n/**\n * @fileOverview The controller of tooltip\n * @author sima.zhang\n */\nvar Util = require('../../util');\n\nvar Shape = require('../../geom/shape/shape');\n\nvar _require = require('@antv/component/lib'),\n    Tooltip = _require.Tooltip;\n\nvar MatrixUtil = Util.MatrixUtil;\nvar Vector2 = MatrixUtil.vec2;\nvar TYPE_SHOW_MARKERS = ['line', 'area', 'path', 'areaStack']; // 默认展示 tooltip marker 的几何图形\n\nvar TYPE_SHOW_CROSSHAIRS = ['line', 'area', 'point']; // 默认展示十字瞄准线的几何图形\n// TODO FIXME this is HARD CODING\n\nvar IGNORE_TOOLTIP_ITEM_PROPERTIES = ['marker', 'showMarker'];\n\nfunction _indexOfArray(items, item) {\n  var rst = -1;\n  Util.each(items, function (sub, index) {\n    var isEqual = true;\n\n    for (var key in item) {\n      if (item.hasOwnProperty(key) && !IGNORE_TOOLTIP_ITEM_PROPERTIES.includes(key)) {\n        if (!Util.isObject(item[key]) && item[key] !== sub[key]) {\n          isEqual = false;\n          break;\n        }\n      }\n    }\n\n    if (isEqual) {\n      rst = index;\n      return false;\n    }\n  });\n  return rst;\n} // 判断是否有样式\n\n\nfunction _hasClass(dom, className) {\n  if (!dom) {\n    return false;\n  }\n\n  var cls = '';\n  if (!dom.className) return false;\n\n  if (!Util.isNil(dom.className.baseVal)) {\n    cls = dom.className.baseVal;\n  } else {\n    cls = dom.className;\n  }\n\n  return cls.includes(className);\n}\n\nfunction _isParent(dom, cls) {\n  var parent = dom.parentNode;\n  var rst = false;\n\n  while (parent && parent !== document.body) {\n    if (_hasClass(parent, cls)) {\n      rst = true;\n      break;\n    }\n\n    parent = parent.parentNode;\n  }\n\n  return rst;\n} // 去除重复的值, 去除不同图形相同数据，只展示一份即可\n\n\nfunction _uniqItems(items) {\n  var tmp = [];\n  Util.each(items, function (item) {\n    var index = _indexOfArray(tmp, item);\n\n    if (index === -1) {\n      tmp.push(item);\n    } else {\n      tmp[index] = item;\n    }\n  });\n  return tmp;\n}\n\nvar TooltipController = /*#__PURE__*/function () {\n  function TooltipController(cfg) {\n    Util.assign(this, cfg);\n    this.timeStamp = 0; // tooltip 锁定不能移动\n\n    this.locked = false;\n  }\n\n  var _proto = TooltipController.prototype;\n\n  _proto._normalizeEvent = function _normalizeEvent(event) {\n    var chart = this.chart;\n\n    var canvas = this._getCanvas();\n\n    var point = canvas.getPointByClient(event.clientX, event.clientY);\n    var pixelRatio = canvas.get('pixelRatio');\n    point.x = point.x / pixelRatio;\n    point.y = point.y / pixelRatio;\n    var views = chart.getViewsByPoint(point);\n    point.views = views;\n    return point;\n  };\n\n  _proto._getCanvas = function _getCanvas() {\n    return this.chart.get('canvas');\n  };\n\n  _proto._getTriggerEvent = function _getTriggerEvent() {\n    var options = this.options;\n    var triggerOn = options.triggerOn;\n    var eventName;\n\n    if (!triggerOn || triggerOn === 'mousemove') {\n      eventName = 'plotmove';\n    } else if (triggerOn === 'click') {\n      eventName = 'plotclick';\n    } else if (triggerOn === 'none') {\n      eventName = null;\n    }\n\n    return eventName;\n  };\n\n  _proto._getDefaultTooltipCfg = function _getDefaultTooltipCfg() {\n    var self = this;\n    var chart = self.chart;\n    var viewTheme = self.viewTheme;\n    var options = self.options;\n    var defaultCfg = Util.mix({}, viewTheme.tooltip);\n    var geoms = chart.getAllGeoms().filter(function (geom) {\n      return geom.get('visible');\n    });\n    var shapes = [];\n    Util.each(geoms, function (geom) {\n      var type = geom.get('type');\n      var adjusts = geom.get('adjusts');\n      var isSymmetric = false;\n\n      if (adjusts) {\n        Util.each(adjusts, function (adjust) {\n          if (adjust.type === 'symmetric' || adjust.type === 'Symmetric') {\n            isSymmetric = true;\n            return false;\n          }\n        });\n      }\n\n      if (Util.indexOf(shapes, type) === -1 && !isSymmetric) {\n        shapes.push(type);\n      }\n    });\n    var isTransposed = geoms.length && geoms[0].get('coord') ? geoms[0].get('coord').isTransposed : false;\n    var crosshairsCfg;\n\n    if (geoms.length && geoms[0].get('coord') && geoms[0].get('coord').type === 'cartesian') {\n      if (shapes[0] === 'interval' && options.shared !== false) {\n        // 直角坐标系下 interval 的 crosshair 为矩形背景框\n        var crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsRect);\n        crosshairs.isTransposed = isTransposed;\n        crosshairsCfg = {\n          zIndex: 0,\n          // 矩形背景框不可覆盖 geom\n          crosshairs: crosshairs\n        };\n      } else if (Util.indexOf(TYPE_SHOW_CROSSHAIRS, shapes[0]) > -1) {\n        var _crosshairs = Util.mix({}, viewTheme.tooltipCrosshairsLine);\n\n        _crosshairs.isTransposed = isTransposed;\n        crosshairsCfg = {\n          crosshairs: _crosshairs\n        };\n      }\n    }\n\n    return Util.mix(defaultCfg, crosshairsCfg, {});\n  };\n\n  _proto._bindEvent = function _bindEvent() {\n    var chart = this.chart;\n\n    var triggerEvent = this._getTriggerEvent();\n\n    if (triggerEvent) {\n      chart.on(triggerEvent, Util.wrapBehavior(this, 'onMouseMove'));\n      chart.on('plotleave', Util.wrapBehavior(this, 'onMouseOut'));\n    }\n  };\n\n  _proto._offEvent = function _offEvent() {\n    var chart = this.chart;\n\n    var triggerEvent = this._getTriggerEvent();\n\n    if (triggerEvent) {\n      chart.off(triggerEvent, Util.getWrapBehavior(this, 'onMouseMove'));\n      chart.off('plotleave', Util.getWrapBehavior(this, 'onMouseOut'));\n    }\n  };\n\n  _proto._setTooltip = function _setTooltip(point, items, markersItems, target) {\n    var self = this;\n    var tooltip = self.tooltip;\n    var prePoint = self.prePoint;\n\n    if (!prePoint || prePoint.x !== point.x || prePoint.y !== point.y) {\n      items = _uniqItems(items);\n      self.prePoint = point;\n      var chart = self.chart;\n      var viewTheme = self.viewTheme;\n      var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n      var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n\n      if (!tooltip.get('visible')) {\n        chart.emit('tooltip:show', {\n          x: x,\n          y: y,\n          tooltip: tooltip\n        });\n      }\n\n      var first = items[0];\n      var title = first.title || first.name;\n\n      if (tooltip.isContentChange(title, items)) {\n        chart.emit('tooltip:change', {\n          tooltip: tooltip,\n          x: x,\n          y: y,\n          items: items\n        }); // bugfix: when set the title in the tooltip:change event does not take effect.\n\n        title = items[0].title || items[0].name;\n        tooltip.setContent(title, items);\n\n        if (!Util.isEmpty(markersItems)) {\n          if (self.options.hideMarkers === true) {\n            // 不展示 tooltip marker\n            tooltip.set('markerItems', markersItems); // 用于 tooltip 辅助线的定位\n          } else {\n            tooltip.setMarkers(markersItems, viewTheme.tooltipMarker);\n          }\n        } else {\n          tooltip.clearMarkers(); // clearMarkers 只会将 markerItems 从 markerGroup 中移除\n          // 所以我们还要将 markerItems 从 tooltip 中移除\n          // 这么做是为了防止上一次设置 marker 时的 markerItems 影响此次 tooltip 辅助线的定位\n\n          tooltip.set('markerItems', []);\n        }\n      }\n\n      var canvas = this._getCanvas();\n\n      if (target === canvas && tooltip.get('type') === 'mini') {\n        // filter mini tooltip\n        tooltip.hide();\n      } else {\n        tooltip.setPosition(x, y, target);\n        tooltip.show();\n      }\n    }\n  };\n\n  _proto.hideTooltip = function hideTooltip() {\n    var tooltip = this.tooltip;\n    var chart = this.chart;\n\n    var canvas = this._getCanvas();\n\n    this.prePoint = null;\n    tooltip.hide();\n    chart.emit('tooltip:hide', {\n      tooltip: tooltip\n    });\n    canvas.draw();\n  };\n\n  _proto.onMouseMove = function onMouseMove(ev) {\n    // 锁定时不移动 tooltip\n    if (Util.isEmpty(ev.views) || this.locked) {\n      return;\n    }\n\n    var lastTimeStamp = this.timeStamp;\n    var timeStamp = +new Date();\n    var point = {\n      x: ev.x,\n      y: ev.y\n    };\n\n    if (timeStamp - lastTimeStamp > 16 && !this.chart.get('stopTooltip')) {\n      this.showTooltip(point, ev.views, ev.shape);\n      this.timeStamp = timeStamp;\n    }\n  };\n\n  _proto.onMouseOut = function onMouseOut(ev) {\n    var tooltip = this.tooltip; // 锁定 tooltip 时不隐藏\n\n    if (!tooltip.get('visible') || !tooltip.get('follow') || this.locked) {\n      return;\n    } // 除非离开 plot 时鼠标依然在图形上，这段逻辑没有意义\n    // if (ev && ev.target !== canvas) {\n    //   return;\n    // }\n\n\n    if (ev && ev.toElement && (_hasClass(ev.toElement, 'g2-tooltip') || _isParent(ev.toElement, 'g2-tooltip'))) {\n      return;\n    }\n\n    this.hideTooltip();\n  };\n\n  _proto.renderTooltip = function renderTooltip() {\n    var self = this;\n\n    if (self.tooltip) {\n      // tooltip 对象已经创建\n      return;\n    }\n\n    var chart = self.chart;\n    var viewTheme = self.viewTheme;\n\n    var canvas = self._getCanvas();\n\n    var defaultCfg = self._getDefaultTooltipCfg();\n\n    var options = self.options;\n    options = Util.deepMix({\n      plotRange: chart.get('plotRange'),\n      capture: false,\n      canvas: canvas,\n      frontPlot: chart.get('frontPlot'),\n      viewTheme: viewTheme.tooltip,\n      backPlot: chart.get('backPlot')\n    }, defaultCfg, options);\n\n    if (options.crosshairs && options.crosshairs.type === 'rect') {\n      options.zIndex = 0; // toolip 背景框不可遮盖住 geom，防止用户配置了 crosshairs\n    }\n\n    options.visible = false; // @2018-09-13 by blue.lb 如果设置shared为false不需要指定position\n    // if (options.shared === false && Util.isNil(options.position)) {\n    //   options.position = 'top';\n    // }\n\n    var tooltip;\n\n    if (options.type === 'mini') {\n      options.crosshairs = false; // this.options.shared = false;\n\n      options.position = 'top';\n      tooltip = new Tooltip.Mini(options);\n    } else if (options.useHtml) {\n      tooltip = new Tooltip.Html(options);\n    } else {\n      tooltip = new Tooltip.Canvas(options);\n    }\n\n    self.tooltip = tooltip;\n\n    var triggerEvent = self._getTriggerEvent();\n\n    var tooltipContainer = tooltip.get('container');\n\n    if (!tooltip.get('enterable') && triggerEvent === 'plotmove') {\n      // 鼠标不允许进入 tooltip 容器\n      if (tooltipContainer) {\n        tooltipContainer.onmousemove = function (e) {\n          // 避免 tooltip 频繁闪烁\n          var eventObj = self._normalizeEvent(e);\n\n          chart.emit(triggerEvent, eventObj);\n        };\n      }\n    } // 优化：鼠标移入 tooltipContainer 然后再移出时，需要隐藏 tooltip\n\n\n    if (tooltipContainer) {\n      tooltipContainer.onmouseleave = function () {\n        if (!self.locked) {\n          self.hideTooltip();\n        }\n      };\n    }\n\n    self._bindEvent();\n  };\n\n  _proto._formatMarkerOfItem = function _formatMarkerOfItem(coord, geom, item) {\n    var self = this;\n    var options = self.options;\n    var point = item.point;\n\n    if (point && point.x && point.y) {\n      // hotfix: make sure there is no null value\n      var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n      var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n      point = coord.applyMatrix(x, y, 1);\n      item.x = point[0];\n      item.y = point[1];\n      item.showMarker = true; // bugfix\n      // 由于tooltip是DOM而不是Canvas，设置渐变色时，marker无法正常显示\n      // 如果，设置的颜色是渐变色并且设置了tooltip使用html方式渲染，则取渐变色的起始颜色作为marker的颜色，暂时解决这个问题\n\n      if (item.color.substring(0, 2) === 'l(' && (!options.hasOwnProperty('useHtml') || options.useHtml)) {\n        item.color = item.color.split(' ')[1].substring(2);\n      }\n\n      var itemMarker = self._getItemMarker(geom, item);\n\n      item.marker = itemMarker;\n\n      if (Util.indexOf(TYPE_SHOW_MARKERS, geom.get('type')) !== -1) {\n        return item;\n      }\n    }\n\n    return null;\n  };\n\n  _proto.lockTooltip = function lockTooltip() {\n    this.locked = true;\n  };\n\n  _proto.unlockTooltip = function unlockTooltip() {\n    this.locked = false;\n  };\n\n  _proto.showTooltip = function showTooltip(point, views, target) {\n    var _this = this;\n\n    var self = this;\n\n    if (Util.isEmpty(views) || !point) {\n      return;\n    }\n\n    if (!this.tooltip) {\n      this.renderTooltip(); // 如果一开始 tooltip 关闭，用户重新调用的时候需要先生成 tooltip\n    }\n\n    var options = self.options;\n    var markersItems = [];\n    var items = [];\n    Util.each(views, function (view) {\n      if (!view.get('tooltipEnable')) {\n        // 如果不显示tooltip，则跳过\n        return true;\n      }\n\n      var geoms = view.get('geoms');\n      var coord = view.get('coord');\n      Util.each(geoms, function (geom) {\n        var type = geom.get('type');\n\n        if (geom.get('visible') && geom.get('tooltipCfg') !== false) {\n          var dataArray = geom.get('dataArray');\n\n          if (geom.isShareTooltip() || options.shared === false && Util.inArray(['area', 'line', 'path', 'polygon'], type)) {\n            // 打补丁解决 bug: https://github.com/antvis/g2/issues/1248\n            // 当 interval 对应的 color 和 x 字段相同的时候，并且包含 dodge，items 取值逻辑不一样\n            // 这种情况下，每一个 x 字段分成一组\n            var xScale = geom.getXScale();\n            var colorAttr = geom.getAttr('color');\n            var colorField = colorAttr ? colorAttr.field : undefined;\n\n            if (type === 'interval' && xScale.field === colorField && geom.hasAdjust('dodge')) {\n              // 找不到不为空的\n              var points = Util.find(dataArray, function (obj) {\n                return !!geom.findPoint(point, obj);\n              }); // 转为 tooltip items\n\n              Util.each(points, function (tmpPoint) {\n                var subItems = geom.getTipItems(tmpPoint, options.title);\n                Util.each(subItems, function (v) {\n                  var markerItem = self._formatMarkerOfItem(coord, geom, v);\n\n                  if (markerItem) {\n                    markersItems.push(markerItem);\n                  }\n                });\n                items = items.concat(subItems);\n              });\n            } else {\n              Util.each(dataArray, function (obj) {\n                var tmpPoint = geom.findPoint(point, obj);\n\n                if (tmpPoint) {\n                  var subItems = geom.getTipItems(tmpPoint, options.title);\n                  Util.each(subItems, function (v) {\n                    var markerItem = self._formatMarkerOfItem(coord, geom, v);\n\n                    if (markerItem) {\n                      markersItems.push(markerItem);\n                    }\n                  });\n                  items = items.concat(subItems);\n                }\n              });\n            }\n          } else {\n            var geomContainer = geom.get('shapeContainer');\n            var canvas = geomContainer.get('canvas');\n            var pixelRatio = canvas.get('pixelRatio');\n            var shape = geomContainer.getShape(point.x * pixelRatio, point.y * pixelRatio);\n\n            if (shape && shape.get('visible') && shape.get('origin')) {\n              items = geom.getTipItems(shape.get('origin'), options.title);\n            }\n\n            Util.each(items, function (v) {\n              var markerItem = _this._formatMarkerOfItem(coord, geom, v);\n\n              if (markerItem) {\n                markersItems.push(markerItem);\n              }\n            });\n          }\n        }\n      });\n      Util.each(items, function (item) {\n        var point = item.point;\n        var x = Util.isArray(point.x) ? point.x[point.x.length - 1] : point.x;\n        var y = Util.isArray(point.y) ? point.y[point.y.length - 1] : point.y;\n        point = coord.applyMatrix(x, y, 1);\n        item.x = point[0];\n        item.y = point[1];\n      });\n    });\n\n    if (items.length) {\n      var first = items[0]; // bugfix: multiple tooltip items with different titles\n\n      if (!items.every(function (item) {\n        return item.title === first.title;\n      })) {\n        var nearestItem = first;\n        var nearestDistance = Infinity;\n        items.forEach(function (item) {\n          var distance = Vector2.distance([point.x, point.y], [item.x, item.y]);\n\n          if (distance < nearestDistance) {\n            nearestDistance = distance;\n            nearestItem = item;\n          }\n        });\n        items = items.filter(function (item) {\n          return item.title === nearestItem.title;\n        });\n        markersItems = markersItems.filter(function (item) {\n          return item.title === nearestItem.title;\n        });\n      }\n\n      if (options.shared === false && items.length > 1) {\n        var snapItem = items[0];\n        var min = Math.abs(point.y - snapItem.y);\n        Util.each(items, function (aItem) {\n          if (Math.abs(point.y - aItem.y) <= min) {\n            snapItem = aItem;\n            min = Math.abs(point.y - aItem.y);\n          }\n        });\n\n        if (snapItem && snapItem.x && snapItem.y) {\n          markersItems = [snapItem];\n        }\n\n        items = [snapItem];\n      } // 3.0 采用当前鼠标位置作为 tooltip 的参考点\n      // if (!Util.isEmpty(markersItems)) {\n      //   point = markersItems[0];\n      // }\n\n\n      self._setTooltip(point, items, markersItems, target);\n    } else {\n      self.hideTooltip();\n    }\n  };\n\n  _proto.clear = function clear() {\n    var tooltip = this.tooltip;\n    tooltip && tooltip.destroy();\n    this.tooltip = null;\n    this.prePoint = null;\n\n    this._offEvent();\n  };\n\n  _proto._getItemMarker = function _getItemMarker(geom, item) {\n    var options = this.options;\n    var markerOption = options.marker || this.viewTheme.tooltip.marker;\n\n    if (Util.isFunction(markerOption)) {\n      var shapeType = geom.get('shapeType') || 'point';\n      var shape = geom.getDefaultValue('shape') || 'circle';\n      var shapeObject = Shape.getShapeFactory(shapeType);\n      var cfg = {\n        color: item.color\n      };\n      var marker = shapeObject.getMarkerCfg(shape, cfg);\n      return markerOption(marker, item);\n    }\n\n    return _extends({\n      fill: item.color\n    }, markerOption);\n  };\n\n  return TooltipController;\n}();\n\nmodule.exports = TooltipController;"]}]}