{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/interaction/tooltip-indicator.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/interaction/tooltip-indicator.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { __assign, __extends } from \"tslib\";\nimport { isEqual, last } from '@antv/util';\nimport BaseInteraction from './base';\nimport { InteractionAction, registerAction, registerInteraction, VIEW_LIFE_CIRCLE, InteractionUtils, } from '../dependents';\nimport TooltipIndicator, { EVENTS as TOOLTIP_COMPONENTS_EVENTS } from '../components/tooltip-indicator';\nimport { forEachElement } from '../util/view';\nimport BBox from '../util/bbox';\nvar DEFAULT_PADDING = 8;\nvar getValidTooltipIndicatorConfig = function (cfg) {\n    if (cfg === void 0) {\n        cfg = {};\n    }\n    var newCfg = __assign({ showTotal: false, showPercent: false, padding: [DEFAULT_PADDING, 24, DEFAULT_PADDING, 24], height: cfg.showPercent ? 72 : 54 }, cfg);\n    return newCfg;\n};\nexport var TOOLTIP_INDICATOR_EVENTS;\n(function (TOOLTIP_INDICATOR_EVENTS) {\n    TOOLTIP_INDICATOR_EVENTS[\"ACTIVE_ELEMENT\"] = \"tooltip_indicator_active_element\";\n    TOOLTIP_INDICATOR_EVENTS[\"ACTIVE_ELEMENT_BY_X\"] = \"tooltip_indicator_active_element_by_x\";\n})(TOOLTIP_INDICATOR_EVENTS || (TOOLTIP_INDICATOR_EVENTS = {}));\nvar TooltipIndicationAction = (function (_super) {\n    __extends(TooltipIndicationAction, _super);\n    function TooltipIndicationAction() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = 'selected';\n        _this.isSingle = false;\n        return _this;\n    }\n    TooltipIndicationAction.prototype.active = function () {\n        var element = InteractionUtils.getCurrentElement(this.context);\n        if (element.hasState('selected')) {\n            if (this.isSingle) {\n                this.setStateByX(element);\n            }\n            else {\n                this.setState(element);\n            }\n        }\n        else {\n            this.setStateByX(element);\n        }\n    };\n    TooltipIndicationAction.prototype.setState = function (element) {\n        var _this = this;\n        forEachElement(this.getView(), function (item) {\n            if (item === element) {\n                if (!item.hasState(_this.state)) {\n                    item.setState(_this.state, true);\n                }\n            }\n            else {\n                item.setState(_this.state, false);\n            }\n        });\n        this.isSingle = true;\n        this.getView().emit(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT, { element: element, isSingle: true });\n    };\n    TooltipIndicationAction.prototype.setStateByX = function (element) {\n        var _this = this;\n        var xField = this.getXField();\n        var xValue = element.getData()[xField];\n        forEachElement(this.getView(), function (item) {\n            if (item.getData()[xField] === xValue) {\n                if (!item.hasState(_this.state)) {\n                    item.setState(_this.state, true);\n                }\n            }\n            else {\n                item.setState(_this.state, false);\n            }\n        });\n        this.isSingle = false;\n        this.getView().emit(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT_BY_X, { element: element, isSingle: false });\n    };\n    TooltipIndicationAction.prototype.setStateByField = function (xFieldValue, groupFieldValue) {\n        var _this = this;\n        var xField = this.getView().getXScale().field;\n        var groupField = this.getView().getGroupScales()[0].field;\n        forEachElement(this.getView(), function (element) {\n            var data = element.getData();\n            element.setState(_this.state, data[xField] === xFieldValue && (groupFieldValue === undefined || data[groupField] === groupFieldValue));\n        });\n    };\n    TooltipIndicationAction.prototype.getView = function () {\n        return this.context.view;\n    };\n    TooltipIndicationAction.prototype.getXField = function () {\n        var view = this.context.view;\n        return view.getXScale().field;\n    };\n    return TooltipIndicationAction;\n}(InteractionAction));\nexport { TooltipIndicationAction };\nregisterAction('tooltip-indicator', TooltipIndicationAction);\nregisterInteraction('element-tooltip-indicator', {\n    start: [\n        {\n            trigger: 'element:mousemove',\n            action: 'tooltip-indicator:active',\n            throttle: { wait: 50, leading: true, trailing: false },\n        },\n        {\n            trigger: 'element:touchmove',\n            action: 'tooltip-indicator:active',\n            throttle: { wait: 50, leading: true, trailing: false },\n        },\n    ],\n});\nvar TooltipIndicatorInteraction = (function (_super) {\n    __extends(TooltipIndicatorInteraction, _super);\n    function TooltipIndicatorInteraction() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.onElementActive = function (_a) {\n            var element = _a.element, isSingle = _a.isSingle;\n            var xScale = _this.view.getXScale();\n            var xField = _this.view.getXScale().field;\n            var groupField = _this.view.getGroupScales()[0].field;\n            var data = element.getData();\n            var xValue = data[xField];\n            var items = _this.getLegendItems(xValue);\n            _this.component.update({ items: items, title: { text: xScale.getText(xValue) } });\n            _this.component.render();\n            if (isSingle) {\n                _this.component.selectItem(data[groupField]);\n            }\n            _this.curX = xValue;\n        };\n        _this.onSelectTooltipIndicatorItem = function (itemId) {\n            if (_this.component && itemId) {\n                _this.getInteractionAction().setStateByField(_this.curX, itemId);\n            }\n        };\n        return _this;\n    }\n    TooltipIndicatorInteraction.getInteractionRange = function (layerRange, interaction) {\n        var config = getValidTooltipIndicatorConfig(interaction);\n        var _a = config.padding, paddingTop = _a[0], paddingBottom = _a[2];\n        return new BBox(layerRange.minX, layerRange.minY, layerRange.width, config.height + paddingTop + paddingBottom);\n    };\n    TooltipIndicatorInteraction.prototype.clear = function () {\n        if (this.component) {\n            this.component.destroy();\n        }\n        if (this.container) {\n            this.container.remove(true);\n        }\n        this.component = null;\n        this.container = null;\n    };\n    TooltipIndicatorInteraction.prototype.render = function () {\n        var _this = this;\n        var view = this.view;\n        var callback = function () {\n            var xScale = _this.view.getXScale();\n            var lastX = last(xScale.getTicks()).tickValue;\n            var padding = _this.view.padding;\n            if (!isEqual([0, 0, 0, 0], padding)) {\n                if (_this.component) {\n                    _this.updateComponent();\n                }\n                else {\n                    _this.createComponent();\n                    _this.component.on(TOOLTIP_COMPONENTS_EVENTS.ON_SELECT_ITEM, _this.onSelectTooltipIndicatorItem);\n                }\n                _this.curX = lastX;\n                _this.component.update({\n                    title: { text: xScale.getText(_this.curX) },\n                });\n                _this.component.render();\n                _this.getInteractionAction().setStateByField(lastX);\n            }\n        };\n        view.legend(false);\n        view.removeInteraction('active-region');\n        view.removeInteraction('tooltip');\n        view.interaction('element-tooltip-indicator');\n        view.on(VIEW_LIFE_CIRCLE.AFTER_PAINT, callback);\n        view.on(VIEW_LIFE_CIRCLE.AFTER_RENDER, callback);\n        view.on(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT, this.onElementActive);\n        view.on(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT_BY_X, this.onElementActive);\n    };\n    TooltipIndicatorInteraction.prototype.getInteractionAction = function () {\n        var interaction = this.view.interactions['element-tooltip-indicator'];\n        return interaction && interaction.context.getAction('tooltip-indicator');\n    };\n    TooltipIndicatorInteraction.prototype.createComponent = function () {\n        var padding = getValidTooltipIndicatorConfig(this.getInteractionConfig()).padding;\n        var paddingTop = padding[0], paddingRight = padding[1], paddingBottom = padding[2], paddingLeft = padding[3];\n        var items = this.getLegendItems();\n        var range = this.getRange();\n        var xScale = this.view.getXScale();\n        var lastX = last(xScale.getTicks()).tickValue;\n        this.container = this.canvas.addGroup();\n        this.component = new TooltipIndicator({\n            container: this.container,\n            x: range.x + paddingLeft,\n            y: range.y + paddingTop,\n            width: range.width - paddingLeft - paddingRight,\n            height: range.height - paddingTop - paddingBottom,\n            theme: this.getViewLayer().getPlotTheme(),\n            items: items,\n        });\n        this.component.init();\n        this.getInteractionAction().setStateByField(lastX);\n    };\n    TooltipIndicatorInteraction.prototype.updateComponent = function () {\n        var items = this.getLegendItems();\n        this.component.update({\n            items: items,\n        });\n    };\n    TooltipIndicatorInteraction.prototype.getLegendItems = function (xValue) {\n        var view = this.view;\n        var data = view.getData();\n        var defaultColor = view.getTheme().defaultColor;\n        var xScale = view.getXScale();\n        var yScale = view.getYScales()[0];\n        var curX = xValue || last(xScale.getTicks()).tickValue;\n        var groupAttrs = view.getLegendAttributes();\n        var colorAttr = groupAttrs.find(function (attr) { return attr.type === 'color'; });\n        var items = [];\n        var groupScale = view.getGroupScales()[0];\n        var groupField = groupScale.field;\n        if (groupScale && groupScale.isCategory) {\n            groupScale.getTicks().forEach(function (tick) {\n                var name = tick.text, value = tick.tickValue;\n                var color = colorAttr.mapping(value).join('') || defaultColor;\n                items.push({\n                    id: value,\n                    title: name,\n                    color: color,\n                    values: [],\n                });\n            });\n        }\n        var selectedData = (data === null || data === void 0 ? void 0 : data.filter(function (datum) { return datum[xScale.field] === curX; })) || [];\n        items.forEach(function (item) {\n            var datum = selectedData.find(function (curDatum) { return curDatum[groupField] === item.id; });\n            item.values.push({\n                value: yScale.formatter ? yScale.formatter(datum[yScale.field]) : datum[yScale.field],\n            });\n        });\n        return items;\n    };\n    return TooltipIndicatorInteraction;\n}(BaseInteraction));\nexport default TooltipIndicatorInteraction;\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/interaction/tooltip-indicator.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/interaction/tooltip-indicator.js"],"names":[],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport { isEqual, last } from '@antv/util';\nimport BaseInteraction from './base';\nimport { InteractionAction, registerAction, registerInteraction, VIEW_LIFE_CIRCLE, InteractionUtils, } from '../dependents';\nimport TooltipIndicator, { EVENTS as TOOLTIP_COMPONENTS_EVENTS } from '../components/tooltip-indicator';\nimport { forEachElement } from '../util/view';\nimport BBox from '../util/bbox';\nvar DEFAULT_PADDING = 8;\nvar getValidTooltipIndicatorConfig = function (cfg) {\n    if (cfg === void 0) { cfg = {}; }\n    var newCfg = __assign({ showTotal: false, showPercent: false, padding: [DEFAULT_PADDING, 24, DEFAULT_PADDING, 24], height: cfg.showPercent ? 72 : 54 }, cfg);\n    return newCfg;\n};\nexport var TOOLTIP_INDICATOR_EVENTS;\n(function (TOOLTIP_INDICATOR_EVENTS) {\n    TOOLTIP_INDICATOR_EVENTS[\"ACTIVE_ELEMENT\"] = \"tooltip_indicator_active_element\";\n    TOOLTIP_INDICATOR_EVENTS[\"ACTIVE_ELEMENT_BY_X\"] = \"tooltip_indicator_active_element_by_x\";\n})(TOOLTIP_INDICATOR_EVENTS || (TOOLTIP_INDICATOR_EVENTS = {}));\n/**\n * Tooltip Indicator Action 实现\n */\nvar TooltipIndicationAction = /** @class */ (function (_super) {\n    __extends(TooltipIndicationAction, _super);\n    function TooltipIndicationAction() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = 'selected';\n        _this.isSingle = false;\n        return _this;\n    }\n    /** 交互语法触发点 */\n    TooltipIndicationAction.prototype.active = function () {\n        var element = InteractionUtils.getCurrentElement(this.context);\n        if (element.hasState('selected')) {\n            if (this.isSingle) {\n                this.setStateByX(element);\n            }\n            else {\n                this.setState(element);\n            }\n        }\n        else {\n            this.setStateByX(element);\n        }\n    };\n    /** 单个元素的 enable */\n    TooltipIndicationAction.prototype.setState = function (element) {\n        var _this = this;\n        forEachElement(this.getView(), function (item) {\n            if (item === element) {\n                if (!item.hasState(_this.state)) {\n                    item.setState(_this.state, true);\n                }\n            }\n            else {\n                item.setState(_this.state, false);\n            }\n        });\n        this.isSingle = true;\n        this.getView().emit(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT, { element: element, isSingle: true });\n    };\n    /** 同 X 的元素的 enable */\n    TooltipIndicationAction.prototype.setStateByX = function (element) {\n        var _this = this;\n        var xField = this.getXField();\n        var xValue = element.getData()[xField];\n        forEachElement(this.getView(), function (item) {\n            if (item.getData()[xField] === xValue) {\n                if (!item.hasState(_this.state)) {\n                    item.setState(_this.state, true);\n                }\n            }\n            else {\n                item.setState(_this.state, false);\n            }\n        });\n        this.isSingle = false;\n        this.getView().emit(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT_BY_X, { element: element, isSingle: false });\n    };\n    /** 通过字段值来 enable */\n    TooltipIndicationAction.prototype.setStateByField = function (xFieldValue, groupFieldValue) {\n        var _this = this;\n        var xField = this.getView().getXScale().field;\n        var groupField = this.getView().getGroupScales()[0].field;\n        forEachElement(this.getView(), function (element) {\n            var data = element.getData();\n            element.setState(_this.state, data[xField] === xFieldValue && (groupFieldValue === undefined || data[groupField] === groupFieldValue));\n        });\n    };\n    TooltipIndicationAction.prototype.getView = function () {\n        return this.context.view;\n    };\n    TooltipIndicationAction.prototype.getXField = function () {\n        var view = this.context.view;\n        return view.getXScale().field;\n    };\n    return TooltipIndicationAction;\n}(InteractionAction));\nexport { TooltipIndicationAction };\nregisterAction('tooltip-indicator', TooltipIndicationAction);\nregisterInteraction('element-tooltip-indicator', {\n    start: [\n        {\n            trigger: 'element:mousemove',\n            action: 'tooltip-indicator:active',\n            throttle: { wait: 50, leading: true, trailing: false },\n        },\n        {\n            trigger: 'element:touchmove',\n            action: 'tooltip-indicator:active',\n            throttle: { wait: 50, leading: true, trailing: false },\n        },\n    ],\n});\n/**\n * 组件 Interaction 实现\n */\nvar TooltipIndicatorInteraction = /** @class */ (function (_super) {\n    __extends(TooltipIndicatorInteraction, _super);\n    function TooltipIndicatorInteraction() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.onElementActive = function (_a) {\n            var element = _a.element, isSingle = _a.isSingle;\n            var xScale = _this.view.getXScale();\n            var xField = _this.view.getXScale().field;\n            var groupField = _this.view.getGroupScales()[0].field;\n            var data = element.getData();\n            var xValue = data[xField];\n            var items = _this.getLegendItems(xValue);\n            _this.component.update({ items: items, title: { text: xScale.getText(xValue) } });\n            _this.component.render();\n            if (isSingle) {\n                _this.component.selectItem(data[groupField]);\n            }\n            _this.curX = xValue;\n        };\n        _this.onSelectTooltipIndicatorItem = function (itemId) {\n            if (_this.component && itemId) {\n                _this.getInteractionAction().setStateByField(_this.curX, itemId);\n            }\n        };\n        return _this;\n    }\n    TooltipIndicatorInteraction.getInteractionRange = function (layerRange, interaction) {\n        var config = getValidTooltipIndicatorConfig(interaction);\n        var _a = config.padding, paddingTop = _a[0], paddingBottom = _a[2];\n        return new BBox(layerRange.minX, layerRange.minY, layerRange.width, config.height + paddingTop + paddingBottom);\n    };\n    TooltipIndicatorInteraction.prototype.clear = function () {\n        if (this.component) {\n            this.component.destroy();\n        }\n        if (this.container) {\n            this.container.remove(true);\n        }\n        this.component = null;\n        this.container = null;\n    };\n    TooltipIndicatorInteraction.prototype.render = function () {\n        var _this = this;\n        var view = this.view;\n        var callback = function () {\n            var xScale = _this.view.getXScale();\n            var lastX = last(xScale.getTicks()).tickValue;\n            var padding = _this.view.padding;\n            if (!isEqual([0, 0, 0, 0], padding)) {\n                if (_this.component) {\n                    _this.updateComponent();\n                }\n                else {\n                    _this.createComponent();\n                    _this.component.on(TOOLTIP_COMPONENTS_EVENTS.ON_SELECT_ITEM, _this.onSelectTooltipIndicatorItem);\n                }\n                // 默认选中最后的 X\n                _this.curX = lastX;\n                _this.component.update({\n                    title: { text: xScale.getText(_this.curX) },\n                });\n                _this.component.render();\n                _this.getInteractionAction().setStateByField(lastX);\n            }\n        };\n        // 移除冲突/重复的组件和交互\n        view.legend(false);\n        view.removeInteraction('active-region');\n        view.removeInteraction('tooltip');\n        view.interaction('element-tooltip-indicator');\n        // 监听 View， 创建/更新组件\n        view.on(VIEW_LIFE_CIRCLE.AFTER_PAINT, callback);\n        view.on(VIEW_LIFE_CIRCLE.AFTER_RENDER, callback);\n        // 监听组件事件，更新 action\n        view.on(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT, this.onElementActive);\n        view.on(TOOLTIP_INDICATOR_EVENTS.ACTIVE_ELEMENT_BY_X, this.onElementActive);\n    };\n    TooltipIndicatorInteraction.prototype.getInteractionAction = function () {\n        var interaction = this.view.interactions['element-tooltip-indicator'];\n        return interaction && interaction.context.getAction('tooltip-indicator');\n    };\n    TooltipIndicatorInteraction.prototype.createComponent = function () {\n        var padding = getValidTooltipIndicatorConfig(this.getInteractionConfig()).padding;\n        var paddingTop = padding[0], paddingRight = padding[1], paddingBottom = padding[2], paddingLeft = padding[3];\n        var items = this.getLegendItems();\n        var range = this.getRange();\n        var xScale = this.view.getXScale();\n        var lastX = last(xScale.getTicks()).tickValue;\n        this.container = this.canvas.addGroup();\n        this.component = new TooltipIndicator({\n            container: this.container,\n            x: range.x + paddingLeft,\n            y: range.y + paddingTop,\n            width: range.width - paddingLeft - paddingRight,\n            height: range.height - paddingTop - paddingBottom,\n            theme: this.getViewLayer().getPlotTheme(),\n            items: items,\n        });\n        this.component.init();\n        this.getInteractionAction().setStateByField(lastX);\n    };\n    TooltipIndicatorInteraction.prototype.updateComponent = function () {\n        var items = this.getLegendItems();\n        this.component.update({\n            items: items,\n        });\n    };\n    TooltipIndicatorInteraction.prototype.getLegendItems = function (xValue) {\n        var view = this.view;\n        var data = view.getData();\n        var defaultColor = view.getTheme().defaultColor;\n        var xScale = view.getXScale();\n        var yScale = view.getYScales()[0];\n        var curX = xValue || last(xScale.getTicks()).tickValue;\n        var groupAttrs = view.getLegendAttributes();\n        var colorAttr = groupAttrs.find(function (attr) { return attr.type === 'color'; });\n        var items = [];\n        // 取第一个分组scale，暂不考虑多个分组情况\n        var groupScale = view.getGroupScales()[0];\n        var groupField = groupScale.field;\n        if (groupScale && groupScale.isCategory) {\n            // 只处理离散情况\n            groupScale.getTicks().forEach(function (tick) {\n                var name = tick.text, value = tick.tickValue;\n                var color = colorAttr.mapping(value).join('') || defaultColor;\n                items.push({\n                    id: value,\n                    title: name,\n                    color: color,\n                    values: [],\n                });\n            });\n        }\n        var selectedData = (data === null || data === void 0 ? void 0 : data.filter(function (datum) { return datum[xScale.field] === curX; })) || [];\n        items.forEach(function (item) {\n            var datum = selectedData.find(function (curDatum) { return curDatum[groupField] === item.id; });\n            item.values.push({\n                value: yScale.formatter ? yScale.formatter(datum[yScale.field]) : datum[yScale.field],\n            });\n        });\n        return items;\n    };\n    return TooltipIndicatorInteraction;\n}(BaseInteraction));\nexport default TooltipIndicatorInteraction;\n//# sourceMappingURL=tooltip-indicator.js.map"]}]}