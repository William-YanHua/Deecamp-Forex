{"remainingRequest":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js??ref--4-1!/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/funnel/layer.js","dependencies":[{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/funnel/layer.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/ts-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import { __assign, __extends } from \"tslib\";\nimport { deepMix, contains, isFunction, get, findIndex, isEqual, each, set, isArray, assign } from '@antv/util';\nimport { createDom, modifyCSS } from '@antv/dom-util';\nimport { HtmlTooltipTheme, TooltipCssConst, DEFAULT_ANIMATE_CFG, _ORIGIN, } from '../../dependents';\nimport { registerPlotType } from '../../base/global';\nimport ViewLayer from '../../base/view-layer';\nimport { getGeom } from '../../geoms/factory';\nimport './theme';\nimport './geometry/shape/funnel-basic-rect';\nimport './geometry/shape/funnel-dynamic-rect';\nimport './animation/funnel-scale-in-x';\nimport './animation/funnel-scale-in-y';\nimport { mappingColor, rgb2arr } from '../../util/color';\nfunction lerp(a, b, factor) {\n    return (1 - factor) * a + factor * b;\n}\nvar G2_GEOM_MAP = {\n    column: 'interval',\n};\nvar PLOT_GEOM_MAP = {\n    interval: 'funnel',\n};\nvar FunnelLayer = (function (_super) {\n    __extends(FunnelLayer, _super);\n    function FunnelLayer(props) {\n        var _this = _super.call(this, props) || this;\n        _this.type = 'funnel';\n        _this._shouldResetPercentages = true;\n        _this._shouldResetLabels = true;\n        _this._shouldResetCompareTexts = true;\n        _this._legendsListenerAttached = false;\n        _this._onLegendContainerMouseDown = function (e) {\n            var props = _this.options;\n            var targetName = e.target.get('name');\n            if (targetName.startsWith('legend-item')) {\n                var legendItem = e.target.get('parent');\n                legendItem.set('unchecked', !legendItem.get('unchecked'));\n                _this.refreshPercentages();\n                _this.refreshLabels();\n                if (props.dynamicHeight) {\n                    var data = _this._findCheckedDataByMouseDownLegendItem(legendItem);\n                    _this._genCustomFieldForDynamicHeight(data);\n                }\n                if (props.compareField) {\n                    var data = _this._findCheckedDataByMouseDownLegendItem(legendItem);\n                    _this._updateDataForCompare(data);\n                    _this.refreshCompareTexts();\n                }\n            }\n        };\n        _this.adjustProps(_this.options);\n        if (props.dynamicHeight) {\n            _this._genCustomFieldForDynamicHeight(_this.getData());\n        }\n        if (props.compareField) {\n            _this.options.data = _this._reduceDataForCompare(_this.getData());\n        }\n        return _this;\n    }\n    FunnelLayer.getDefaultOptions = function (props) {\n        var cfg = {\n            label: {\n                visible: true,\n                adjustColor: true,\n            },\n            percentage: {\n                visible: true,\n                offsetX: props.transpose ? 0 : 40,\n                offsetY: props.transpose ? 40 : 0,\n                spacing: 4,\n                line: {\n                    visible: true,\n                    style: {\n                        lineWidth: 1,\n                        stroke: 'rgba(0, 0, 0, 0.15)',\n                    },\n                },\n                text: {\n                    content: '转化率',\n                    style: {\n                        fill: 'rgba(0, 0, 0, 0.65)',\n                    },\n                },\n                value: {\n                    visible: true,\n                    style: {\n                        fill: 'black',\n                    },\n                    formatter: function (yValueUpper, yValueLower) { return ((100 * yValueLower) / yValueUpper).toFixed(2) + \"%\"; },\n                },\n            },\n            tooltip: {\n                visible: true,\n                shared: true,\n                showTitle: false,\n                showCrosshairs: false,\n                showMarkers: false,\n            },\n            animation: deepMix({}, DEFAULT_ANIMATE_CFG, {\n                appear: {\n                    duration: 800,\n                },\n            }),\n            dynamicHeight: false,\n            compareText: {\n                visible: true,\n                offsetX: -16,\n                offsetY: -16,\n                style: {\n                    fill: 'black',\n                },\n            },\n            legend: {\n                position: 'bottom-center',\n            },\n            interactions: [{ type: 'tooltip' }, { type: 'legend-filter' }],\n        };\n        return deepMix({}, _super.getDefaultOptions.call(this), cfg);\n    };\n    FunnelLayer.prototype.getColorScale = function () {\n        var xField = this.options.xField;\n        if (xField) {\n            return this.view.getScaleByField(xField);\n        }\n    };\n    FunnelLayer.prototype.coord = function () {\n        var props = this.options;\n        var coordConfig = {\n            type: 'rect',\n            actions: props.transpose\n                ? props.dynamicHeight\n                    ? [['transpose'], ['scale', 1, -1]]\n                    : [['scale', 1, -1]]\n                : props.dynamicHeight\n                    ? []\n                    : [['transpose'], ['scale', 1, -1]],\n        };\n        this.setConfig('coordinate', coordConfig);\n    };\n    FunnelLayer.prototype.axis = function () {\n        this.setConfig('axes', false);\n    };\n    FunnelLayer.prototype.adjustFunnel = function (funnel) {\n        var props = this.options;\n        funnel.shape = props.dynamicHeight ? 'funnel-dynamic-rect' : 'funnel-basic-rect';\n        funnel.color = {\n            fields: [props.xField],\n            values: props.color && (Array.isArray(props.color) ? props.color : [props.color]),\n        };\n        if (isFunction(props.funnelStyle)) {\n            funnel.style = { callback: props.funnelStyle };\n        }\n        else {\n            funnel.style = { cfg: props.funnelStyle };\n        }\n        funnel.adjust = [\n            {\n                type: props.dynamicHeight ? 'stack' : 'symmetric',\n            },\n        ];\n    };\n    FunnelLayer.prototype.tooltip = function () {\n        var props = this.options;\n        if (props.compareField) {\n            deepMix(props.tooltip, {\n                htmlContent: function (title, items) {\n                    var clss, el, color, elMarker;\n                    clss = TooltipCssConst.CONTAINER_CLASS;\n                    el = createDom(\"<div class=\\\"\" + clss + \"\\\"></div>\");\n                    modifyCSS(el, HtmlTooltipTheme[clss]);\n                    var elRoot = el;\n                    if (title) {\n                        clss = TooltipCssConst.TITLE_CLASS;\n                        el = createDom(\"<div class=\\\"\" + clss + \"\\\"></div>\");\n                        modifyCSS(el, HtmlTooltipTheme[clss]);\n                        elRoot.appendChild(el);\n                        var elTitle = el;\n                        clss = TooltipCssConst.MARKER_CLASS;\n                        el = createDom(\"<span class=\\\"\" + clss + \"\\\"></span>\");\n                        modifyCSS(el, HtmlTooltipTheme[clss]);\n                        modifyCSS(el, { width: '10px', height: '10px' });\n                        elTitle.appendChild(el);\n                        elMarker = el;\n                        el = createDom(\"<span>\" + title + \"</span>\");\n                        elTitle.appendChild(el);\n                    }\n                    if (items) {\n                        clss = TooltipCssConst.LIST_CLASS;\n                        el = createDom(\"<ul class=\\\"\" + clss + \"\\\"></ul>\");\n                        modifyCSS(el, HtmlTooltipTheme[clss]);\n                        elRoot.appendChild(el);\n                        var elList_1 = el;\n                        items\n                            .reduce(function (pairs, item) {\n                            if (!color) {\n                                color = item.color;\n                            }\n                            var compareValues = get(item, 'point._origin.__compare__.compareValues');\n                            var yValues = get(item, 'point._origin.__compare__.yValues');\n                            yValues.forEach(function (yValue, i) { return pairs.push([compareValues[i], yValue]); });\n                            return pairs;\n                        }, [])\n                            .forEach(function (_a, index) {\n                            var compareValue = _a[0], yValue = _a[1];\n                            clss = TooltipCssConst.LIST_ITEM_CLASS;\n                            el = createDom(\"<li class=\\\"\" + clss + \"\\\" data-index=\" + index + \"></li>\");\n                            modifyCSS(el, HtmlTooltipTheme[clss]);\n                            elList_1.appendChild(el);\n                            var elListItem = el;\n                            clss = TooltipCssConst.NAME_CLASS;\n                            el = createDom(\"<span class=\\\"\" + clss + \"\\\">\" + compareValue + \"</span>\");\n                            modifyCSS(el, HtmlTooltipTheme[clss]);\n                            elListItem.appendChild(el);\n                            clss = TooltipCssConst.VALUE_CLASS;\n                            el = createDom(\"<span class=\\\"\" + clss + \"\\\">\" + yValue + \"</span>\");\n                            modifyCSS(el, HtmlTooltipTheme[clss]);\n                            elListItem.appendChild(el);\n                        });\n                    }\n                    if (color && elMarker) {\n                        modifyCSS(elMarker, { backgroundColor: color });\n                    }\n                    return elRoot;\n                },\n            });\n        }\n        _super.prototype.tooltip.call(this);\n    };\n    FunnelLayer.prototype.addGeometry = function () {\n        var props = this.options;\n        var funnel = getGeom('interval', 'main', {\n            positionFields: [props.dynamicHeight ? '_' : props.xField, props.yField],\n            plot: this,\n        });\n        this.adjustFunnel(funnel);\n        this.funnel = funnel;\n        this.setConfig('geometry', funnel);\n    };\n    FunnelLayer.prototype.animation = function () {\n        var _this = this;\n        _super.prototype.animation.call(this);\n        var props = this.options;\n        if (props.animation === false) {\n            this.funnel.animate = false;\n        }\n        else {\n            var data_1 = this.getData();\n            var appearDuration = get(props, 'animation.appear.duration');\n            var appearDurationEach_1 = appearDuration / (data_1.length || 1);\n            if (this._animationAppearTimeoutHandler) {\n                clearTimeout(this._animationAppearTimeoutHandler);\n                delete this._animationAppearTimeoutHandler;\n            }\n            this._animationAppearTimeoutHandler = setTimeout(function () {\n                _this.fadeInPercentages(appearDurationEach_1);\n                if (props.compareField) {\n                    _this.fadeInCompareTexts(appearDurationEach_1);\n                }\n                delete _this._animationAppearTimeoutHandler;\n            }, appearDuration);\n            this.funnel.animate = deepMix({}, props.animation, {\n                appear: {\n                    animation: props.transpose ? 'funnelScaleInX' : 'funnelScaleInY',\n                    duration: appearDurationEach_1,\n                    delay: function (datum) { return findIndex(data_1, function (o) { return isEqual(o, datum); }) * appearDurationEach_1; },\n                    callback: function (shape) {\n                        _this.fadeInLabels(shape, 0.5 * appearDurationEach_1);\n                    },\n                },\n                enter: {\n                    animation: 'fade-in',\n                },\n            });\n        }\n    };\n    FunnelLayer.prototype.afterRender = function () {\n        var props = this.options;\n        this.resetLabels();\n        this.resetPercentages();\n        if (props.compareField) {\n            this.resetCompareTexts();\n        }\n        if (props.padding == 'auto') {\n            var percentageContainer = this._findPercentageContainer();\n            if (percentageContainer) {\n                this.paddingController.registerPadding(percentageContainer, 'inner', true);\n            }\n            var compareTextContainer = this._findCompareTextContainer();\n            if (compareTextContainer) {\n                this.paddingController.registerPadding(compareTextContainer, 'inner', true);\n            }\n        }\n        _super.prototype.afterRender.call(this);\n        if (props.animation === false) {\n            this.fadeInLabels();\n            this.fadeInPercentages();\n            if (props.compareField) {\n                this.fadeInCompareTexts();\n            }\n        }\n        if (!this._legendsListenerAttached) {\n            this._legendsListenerAttached = true;\n            var legendContainer = this.view.getController('legend').container;\n            legendContainer.on('mousedown', this._onLegendContainerMouseDown);\n        }\n    };\n    FunnelLayer.prototype.updateConfig = function (cfg) {\n        cfg = this.adjustProps(cfg);\n        _super.prototype.updateConfig.call(this, cfg);\n        this._legendsListenerAttached = false;\n    };\n    FunnelLayer.prototype.changeData = function (data) {\n        var props = this.options;\n        if (props.animation !== false) {\n            this._shouldResetPercentages = false;\n            this._shouldResetLabels = false;\n        }\n        if (props.dynamicHeight) {\n            var checkedData = this._findCheckedDataInNewData(data);\n            this._genCustomFieldForDynamicHeight(checkedData);\n        }\n        if (props.compareField) {\n            data = this._reduceDataForCompare(data);\n            var checkedData = this._findCheckedDataInNewData(data);\n            this._updateDataForCompare(checkedData);\n        }\n        _super.prototype.changeData.call(this, data);\n        this.refreshPercentages();\n        this.refreshLabels();\n        if (props.compareField) {\n            this.fadeInCompareTexts();\n        }\n    };\n    FunnelLayer.prototype.geometryParser = function (dim, type) {\n        if (dim === 'g2') {\n            return G2_GEOM_MAP[type];\n        }\n        return PLOT_GEOM_MAP[type];\n    };\n    FunnelLayer.prototype.adjustProps = function (props) {\n        if (props.compareField) {\n            props.dynamicHeight = false;\n        }\n        if (props.dynamicHeight) {\n            set(props, \"meta.\" + props.yField + \".nice\", false);\n            set(props, 'tooltip.shared', false);\n        }\n        return props;\n    };\n    FunnelLayer.prototype.resetPercentages = function () {\n        var _this = this;\n        if (!this._shouldResetPercentages)\n            return;\n        var props = this.options;\n        var _a = props.percentage || {}, offsetX = _a.offsetX, offsetY = _a.offsetY, spacing = _a.spacing, _b = _a.line, percentageLine = _b === void 0 ? {} : _b, _c = _a.text, percentageText = _c === void 0 ? {} : _c, _d = _a.value, percentageValue = _d === void 0 ? {} : _d;\n        var adjustTimestamp = Date.now();\n        var container = this._findPercentageContainer(true);\n        this._eachShape(function (shape, index, datumLower, datumUpper) {\n            if (index > 0) {\n                var _a = shape.getBBox(), minX = _a.minX, maxX = _a.maxX, maxY = _a.maxY, minY = _a.minY;\n                var x1 = props.transpose ? minX : maxX;\n                var y1 = props.transpose ? (props.compareField ? maxY : minY) : minY;\n                var _b = _this._findPercentageMembersInContainerByIndex(container, index, true), line_1 = _b.line, text_1 = _b.text, value_1 = _b.value;\n                var eachProcs_1 = [\n                    function (x, y, line, text, value) {\n                        if (line) {\n                            line.attr(deepMix({}, percentageLine.style, {\n                                x1: x,\n                                y1: y,\n                                x2: props.transpose ? x + offsetX : x - offsetX,\n                                y2: props.transpose ? y - offsetY : y + offsetY,\n                                opacity: 0,\n                            }));\n                            line.set('adjustTimestamp', adjustTimestamp);\n                        }\n                        var textWidth = 0;\n                        var valueWidth = 0;\n                        var textProc = function () {\n                            if (text) {\n                                text.attr(deepMix({}, percentageText.style, {\n                                    x: props.transpose ? x + offsetX : x - offsetX - spacing - valueWidth - spacing,\n                                    y: props.transpose ? y - offsetY - spacing : y + offsetY,\n                                    opacity: 0,\n                                    text: percentageText.content,\n                                    textAlign: props.transpose ? 'left' : 'right',\n                                    textBaseline: props.transpose ? 'bottom' : 'middle',\n                                }));\n                                text.set('adjustTimestamp', adjustTimestamp);\n                                textWidth = text.getBBox().width;\n                            }\n                        };\n                        var valueProc = function () {\n                            if (value) {\n                                value.attr(deepMix({}, percentageValue.style, {\n                                    x: props.transpose ? x + offsetX + textWidth + spacing : x - offsetX - spacing,\n                                    y: props.transpose ? y - offsetY - spacing : y + offsetY,\n                                    opacity: 0,\n                                    text: isFunction(percentageValue.formatter)\n                                        ? props.compareField\n                                            ? percentageValue.formatter(get(datumUpper, '__compare__.yValues.0'), get(datumLower, '__compare__.yValues.0'))\n                                            : percentageValue.formatter(datumUpper[props.yField], datumLower[props.yField])\n                                        : '',\n                                    textAlign: props.transpose ? 'left' : 'right',\n                                    textBaseline: props.transpose ? 'bottom' : 'middle',\n                                }));\n                                value.set('adjustTimestamp', adjustTimestamp);\n                                valueWidth = value.getBBox().width;\n                            }\n                        };\n                        if (props.transpose) {\n                            textProc();\n                            valueProc();\n                        }\n                        else {\n                            valueProc();\n                            textProc();\n                        }\n                    },\n                    function (x, y, line, text, value) {\n                        if (line) {\n                            line.attr(deepMix({}, percentageLine.style, {\n                                x1: x,\n                                y1: y,\n                                x2: x + offsetX,\n                                y2: props.transpose ? (props.compareField ? y + offsetY : y - offsetY) : y + offsetY,\n                                opacity: 0,\n                            }));\n                            line.set('adjustTimestamp', adjustTimestamp);\n                        }\n                        var textWidth = 0;\n                        if (text) {\n                            text.attr(deepMix({}, percentageText.style, {\n                                x: props.transpose ? x + offsetX : x + offsetX + spacing,\n                                y: props.transpose\n                                    ? props.compareField\n                                        ? y + offsetY + spacing\n                                        : y - offsetY - spacing\n                                    : y + offsetY,\n                                opacity: 0,\n                                text: percentageText.content,\n                                textAlign: 'left',\n                                textBaseline: props.transpose ? (props.compareField ? 'top' : 'bottom') : 'middle',\n                            }));\n                            text.set('adjustTimestamp', adjustTimestamp);\n                            textWidth = text.getBBox().width;\n                        }\n                        if (value) {\n                            value.attr(deepMix({}, percentageValue.style, {\n                                x: props.transpose ? x + offsetX + textWidth + spacing : x + offsetX + spacing + textWidth + spacing,\n                                y: props.transpose\n                                    ? props.compareField\n                                        ? y + offsetY + spacing\n                                        : y - offsetY - spacing\n                                    : y + offsetY,\n                                opacity: 0,\n                                text: isFunction(percentageValue.formatter)\n                                    ? props.compareField\n                                        ? percentageValue.formatter(get(datumUpper, \"__compare__.yValues.1\"), get(datumLower, \"__compare__.yValues.1\"))\n                                        : percentageValue.formatter(datumUpper[props.yField], datumLower[props.yField])\n                                    : '',\n                                textAlign: 'left',\n                                textBaseline: props.transpose ? (props.compareField ? 'top' : 'bottom') : 'middle',\n                            }));\n                            value.set('adjustTimestamp', adjustTimestamp);\n                        }\n                    },\n                ];\n                if (props.compareField) {\n                    var _c = [minX, minY], x0 = _c[0], y0 = _c[1];\n                    [\n                        [x0, y0],\n                        [x1, y1],\n                    ].forEach(function (_a, i) {\n                        var x = _a[0], y = _a[1];\n                        return eachProcs_1[i](x, y, line_1 && line_1[i], text_1 && text_1[i], value_1 && value_1[i]);\n                    });\n                }\n                else {\n                    eachProcs_1[1](x1, y1, line_1, text_1, value_1);\n                }\n            }\n            datumUpper = datumLower;\n            index++;\n        });\n        container.get('children').forEach(function (child) {\n            if (child.get('adjustTimestamp') != adjustTimestamp) {\n                child.attr({ opacity: 0 });\n                container.set(child.get('id'), null);\n                setTimeout(function () { return child.remove(); }, 0);\n            }\n        });\n    };\n    FunnelLayer.prototype.fadeInPercentages = function (duration, callback) {\n        var _this = this;\n        var props = this.options;\n        var container = this._findPercentageContainer();\n        var eachProc = function (i) {\n            var lastBBox = { minX: Infinity, maxX: -Infinity, minY: Infinity, maxY: -Infinity };\n            _this._eachShape(function (shape, index) {\n                var members = _this._findPercentageMembersInContainerByIndex(container, index);\n                var currBBox = { minX: Infinity, maxX: -Infinity, minY: Infinity, maxY: -Infinity };\n                var eachCalc = function (member) {\n                    if (member && member.get('type') == 'text') {\n                        var _a = member.getBBox(), minX = _a.minX, maxX = _a.maxX, minY = _a.minY, maxY = _a.maxY;\n                        if (minX < currBBox.minX)\n                            currBBox.minX = minX;\n                        if (maxX > currBBox.maxX)\n                            currBBox.maxX = maxX;\n                        if (minY < currBBox.minY)\n                            currBBox.minY = minY;\n                        if (maxY > currBBox.maxY)\n                            currBBox.maxY = maxY;\n                    }\n                };\n                each(members, function (member) { return (isArray(member) ? eachCalc(member[i]) : eachCalc(member)); });\n                if (currBBox.minX > lastBBox.maxX ||\n                    currBBox.maxX < lastBBox.minX ||\n                    currBBox.minY > lastBBox.maxY ||\n                    currBBox.maxY < lastBBox.minY) {\n                    var eachShow_1 = function (member) {\n                        if (member) {\n                            var attrs = {\n                                opacity: 1,\n                            };\n                            duration ? member.animate(attrs, duration) : member.attr(attrs);\n                        }\n                    };\n                    each(members, function (member) { return (isArray(member) ? eachShow_1(member[i]) : eachShow_1(member)); });\n                    assign(lastBBox, currBBox);\n                }\n            });\n        };\n        props.compareField ? [0, 1].forEach(eachProc) : eachProc();\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.fadeOutPercentages = function (duration, callback) {\n        var _this = this;\n        var container = this._findPercentageContainer();\n        this._eachShape(function (shape, index) {\n            var members = _this._findPercentageMembersInContainerByIndex(container, index);\n            var eachProc = function (member) {\n                if (member) {\n                    var attrs = {\n                        opacity: 0,\n                    };\n                    duration ? member.animate(attrs, duration) : member.attr(attrs);\n                }\n            };\n            each(members, function (member) { return (isArray(member) ? member.forEach(eachProc) : eachProc(member)); });\n        });\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.refreshPercentages = function (callback) {\n        var _this = this;\n        var props = this.options;\n        if (props.animation !== false) {\n            var _a = this._calcRefreshFadeDurations(), fadeOutDuration = _a.fadeOutDuration, fadeInDuration_1 = _a.fadeInDuration;\n            this._shouldResetPercentages = false;\n            this.fadeOutPercentages(fadeOutDuration, function () {\n                _this._shouldResetPercentages = true;\n                _this.resetPercentages();\n                _this.fadeInPercentages(fadeInDuration_1, callback);\n            });\n        }\n    };\n    FunnelLayer.prototype._findPercentageContainer = function (createIfNotFound) {\n        if (createIfNotFound === void 0) {\n            createIfNotFound = false;\n        }\n        var middleGroup = this.view.middleGroup;\n        var percentageContainer = middleGroup.get('percentageContainer');\n        if (!percentageContainer && createIfNotFound) {\n            percentageContainer = middleGroup.addGroup();\n            middleGroup.set('percentageContainer', percentageContainer);\n        }\n        return percentageContainer;\n    };\n    FunnelLayer.prototype._findPercentageMembersInContainerByIndex = function (container, index, createIfNotFound) {\n        if (createIfNotFound === void 0) {\n            createIfNotFound = false;\n        }\n        var props = this.options;\n        var _a = props.percentage || {}, visible = _a.visible, _b = _a.line, percentageLine = _b === void 0 ? {} : _b, _c = _a.text, percentageText = _c === void 0 ? {} : _c, _d = _a.value, percentageValue = _d === void 0 ? {} : _d;\n        var members = {\n            line: undefined,\n            text: undefined,\n            value: undefined,\n        };\n        if (visible === false || !container) {\n            return members;\n        }\n        if (percentageLine.visible !== false) {\n            var find = function (i) {\n                var lineId = \"_percentage-line-\" + index + \"-\" + i;\n                var line = container.get(lineId);\n                if (!line && createIfNotFound) {\n                    line = container.addShape({ id: lineId, type: 'line', attrs: {} });\n                    container.set(lineId, line);\n                }\n                return line;\n            };\n            var line = props.compareField ? [0, 1].map(find) : find(0);\n            members.line = line;\n        }\n        if (percentageText.visible !== false) {\n            var find = function (i) {\n                var textId = \"_percentage-text-\" + index + \"-\" + i;\n                var text = container.get(textId);\n                if (!text && createIfNotFound) {\n                    text = container.addShape({ id: textId, type: 'text', attrs: {} });\n                    container.set(textId, text);\n                }\n                return text;\n            };\n            var text = props.compareField ? [0, 1].map(find) : find(0);\n            members.text = text;\n        }\n        if (percentageValue.visible !== false) {\n            var find = function (i) {\n                var valueId = \"_percentage-value-\" + index + \"-\" + i;\n                var value = container.get(valueId);\n                if (!value && createIfNotFound) {\n                    value = container.addShape({ id: valueId, type: 'text', attrs: {} });\n                    container.set(valueId, value);\n                }\n                return value;\n            };\n            var value = props.compareField ? [0, 1].map(find) : find(0);\n            members.value = value;\n        }\n        return members;\n    };\n    FunnelLayer.prototype._calcRefreshFadeDurations = function () {\n        var props = this.options;\n        var updateDuration = get(props, 'animation.update.duration');\n        var enterDuration = get(props, 'animation.enter.duration');\n        var fadeInDuration = Math.min(enterDuration, updateDuration) * 0.6;\n        var fadeOutDuration = Math.max(enterDuration, updateDuration) * 1.2;\n        return { fadeInDuration: fadeInDuration, fadeOutDuration: fadeOutDuration };\n    };\n    FunnelLayer.prototype.resetLabels = function () {\n        var _this = this;\n        if (!this._shouldResetLabels)\n            return;\n        var props = this.options;\n        var xField = props.xField, yField = props.yField;\n        var adjustTimestamp = Date.now();\n        var labelsContainer = this._getGeometry().labelsContainer;\n        var labelProps = props.label || {};\n        var labelStyle = deepMix(__assign({}, this.theme.label), props.label.style, {\n            opacity: 0,\n            textAlign: 'center',\n            textBaseline: 'middle',\n        });\n        var datumTop;\n        this._eachShape(function (shape, index, datum, elementIndex) {\n            var _a;\n            var element = shape.get('element');\n            if (index == 0) {\n                datumTop = datum;\n            }\n            var _b = shape.getBBox(), minX = _b.minX, maxX = _b.maxX, minY = _b.minY, maxY = _b.maxY;\n            var xValue = datum[xField];\n            var yValue = datum[yField];\n            if (labelProps.adjustColor) {\n                labelStyle.fill = _this._getAdjustedTextFillByShape(shape);\n            }\n            var compare = datum.__compare__;\n            var content;\n            var formatArgs = (_a = {},\n                _a[_ORIGIN] = datum,\n                _a.element = element,\n                _a.elementIndex = elementIndex,\n                _a.mappingDatum = [].concat(element.getModel().mappingData)[0],\n                _a.mappingDatumIndex = 0,\n                _a);\n            if (labelProps.formatter) {\n                content = labelProps.formatter(xValue, formatArgs, index, yValue, datumTop[yField]);\n            }\n            else {\n                if (compare) {\n                    content = [0, 1].map(function () { return \"\" + yValue; }).join(props.transpose ? '\\n\\n' : '    ');\n                }\n                else {\n                    content = xValue + \" \" + yValue;\n                }\n            }\n            var label = _this._findLabelInContainerByIndex(labelsContainer, index, true);\n            var ratio = compare ? compare.yValues[0] / (compare.yValues[0] + compare.yValues[1]) : 0.5;\n            label.attr(__assign(__assign({}, labelStyle), { x: lerp(minX, maxX, !props.transpose ? ratio : 0.5), y: lerp(minY, maxY, props.transpose ? ratio : 0.5), text: content }));\n            label.set('adjustTimestamp', adjustTimestamp);\n        });\n        labelsContainer.get('children').forEach(function (label) {\n            if (label.get('adjustTimestamp') != adjustTimestamp) {\n                label.attr({ opacity: 0 });\n                labelsContainer.set(label.get('id'), null);\n                setTimeout(function () { return label.remove(); });\n            }\n        });\n    };\n    FunnelLayer.prototype.fadeInLabels = function (targetShape, duration, callback) {\n        var _this = this;\n        var labelsContainer = this._getGeometry().labelsContainer;\n        this._eachShape(function (shape, index) {\n            if (!targetShape || targetShape == shape) {\n                var label = _this._findLabelInContainerByIndex(labelsContainer, index);\n                if (label) {\n                    var shapeBBox = shape.getBBox();\n                    var labelBBox = label.getBBox();\n                    if (labelBBox.minX >= shapeBBox.minX &&\n                        labelBBox.maxX <= shapeBBox.maxX &&\n                        labelBBox.minY >= shapeBBox.minY &&\n                        labelBBox.maxY <= shapeBBox.maxY) {\n                        var attrs = {\n                            opacity: 1,\n                        };\n                        duration ? label.animate(attrs, duration) : label.attr(attrs);\n                    }\n                }\n            }\n        });\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.fadeOutLabels = function (targetShape, duration, callback) {\n        var _this = this;\n        var labelsContainer = this._getGeometry().labelsContainer;\n        this._eachShape(function (shape, index) {\n            if (!targetShape || targetShape == shape) {\n                var label = _this._findLabelInContainerByIndex(labelsContainer, index);\n                if (label) {\n                    var attrs = {\n                        opacity: 0,\n                    };\n                    duration ? label.animate(attrs, duration) : label.attr(attrs);\n                }\n            }\n        });\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.refreshLabels = function (callback) {\n        var _this = this;\n        var props = this.options;\n        if (props.animation !== false) {\n            var _a = this._calcRefreshFadeDurations(), fadeOutDuration = _a.fadeOutDuration, fadeInDuration_2 = _a.fadeInDuration;\n            this._shouldResetLabels = false;\n            this.fadeOutLabels(null, fadeOutDuration, function () {\n                _this._shouldResetLabels = true;\n                _this.resetLabels();\n                _this.fadeInLabels(null, fadeInDuration_2, callback);\n            });\n        }\n    };\n    FunnelLayer.prototype._findLabelInContainerByIndex = function (container, index, createIfNotFound) {\n        var _a;\n        if (createIfNotFound === void 0) {\n            createIfNotFound = false;\n        }\n        var props = this.options;\n        var label;\n        if (((_a = props.label) === null || _a === void 0 ? void 0 : _a.visible) === false) {\n            return label;\n        }\n        var labelId = \"_label-\" + index;\n        label = container.get(labelId);\n        if (!label && createIfNotFound) {\n            label = container.addShape({\n                id: labelId,\n                type: 'text',\n                attrs: {},\n            });\n            container.set(labelId, label);\n        }\n        return label;\n    };\n    FunnelLayer.prototype.resetCompareTexts = function () {\n        if (!this._shouldResetCompareTexts)\n            return;\n        var props = this.options;\n        var shapeParentBBox;\n        var compare;\n        this._eachShape(function (shape, index, datum) {\n            if (index == 0) {\n                shapeParentBBox = shape.get('parent').getBBox();\n                compare = get(datum, '__compare__');\n            }\n        });\n        if (shapeParentBBox && compare && get(props, 'compareText.visible') !== false) {\n            var container_1 = this._findCompareTextContainer(true);\n            var yValuesMax_1 = compare.yValuesMax, compareValues_1 = compare.compareValues;\n            var minX_1 = shapeParentBBox.minX, maxX_1 = shapeParentBBox.maxX, minY_1 = shapeParentBBox.minY, maxY_1 = shapeParentBBox.maxY;\n            var compareTexts_1 = container_1.get('children');\n            [0, 1].forEach(function (i) {\n                var compareText = compareTexts_1[i];\n                if (!compareText) {\n                    compareText = container_1.addShape({ type: 'text' });\n                }\n                compareText.attr(deepMix({}, get(props, 'compareText.style'), {\n                    text: props.transpose ? compareValues_1[i] : i ? \"  \" + compareValues_1[i] : compareValues_1[i] + \"  \",\n                    x: props.transpose\n                        ? minX_1 + get(props, 'compareText.offsetX')\n                        : lerp(minX_1, maxX_1, yValuesMax_1[0] / (yValuesMax_1[0] + yValuesMax_1[1])),\n                    y: props.transpose\n                        ? lerp(minY_1, maxY_1, yValuesMax_1[0] / (yValuesMax_1[0] + yValuesMax_1[1])) + (i ? 8 : -8)\n                        : minY_1 + get(props, 'compareText.offsetY'),\n                    opacity: 0,\n                    textAlign: props.transpose ? 'right' : i ? 'left' : 'right',\n                    textBaseline: props.transpose ? (i ? 'top' : 'bottom') : 'bottom',\n                }));\n            });\n        }\n    };\n    FunnelLayer.prototype.fadeInCompareTexts = function (duration, callback) {\n        var container = this._findCompareTextContainer();\n        if (container) {\n            var compareTexts_2 = container.get('children');\n            [0, 1].forEach(function (i) {\n                var compareText = compareTexts_2[i];\n                if (compareText) {\n                    var attrs = {\n                        opacity: 1,\n                    };\n                    duration ? compareText.animate(attrs, duration) : compareText.attr(attrs);\n                }\n            });\n        }\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.fadeOutCompareTexts = function (duration, callback) {\n        var container = this._findCompareTextContainer();\n        if (container) {\n            var compareTexts_3 = container.get('children');\n            [0, 1].forEach(function (i) {\n                var compareText = compareTexts_3[i];\n                if (compareText) {\n                    var attrs = {\n                        opacity: 0,\n                    };\n                    duration ? compareText.animate(attrs, duration) : compareText.attr(attrs);\n                }\n            });\n        }\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.refreshCompareTexts = function (callback) {\n        var _this = this;\n        var props = this.options;\n        if (props.animation !== false) {\n            var _a = this._calcRefreshFadeDurations(), fadeInDuration_3 = _a.fadeInDuration, fadeOutDuration = _a.fadeOutDuration;\n            this._shouldResetCompareTexts = false;\n            this.fadeOutCompareTexts(fadeOutDuration, function () {\n                _this._shouldResetCompareTexts = true;\n                _this.resetCompareTexts();\n                _this.fadeInCompareTexts(fadeInDuration_3, callback);\n            });\n        }\n    };\n    FunnelLayer.prototype._findCompareTextContainer = function (createIfNotFound) {\n        if (createIfNotFound === void 0) {\n            createIfNotFound = false;\n        }\n        var middleGroup = this.view.middleGroup;\n        var compareTextContainer = middleGroup.get('compareTextContainer');\n        if (!compareTextContainer && createIfNotFound) {\n            compareTextContainer = middleGroup.addGroup();\n            middleGroup.set('compareTextContainer', compareTextContainer);\n        }\n        return compareTextContainer;\n    };\n    FunnelLayer.prototype._eachShape = function (fn) {\n        var _a;\n        var data = this._findCheckedData(this.getData());\n        var dataLen = data.length;\n        var index = 0;\n        var datumUpper;\n        (_a = this._getGeometry()) === null || _a === void 0 ? void 0 : _a.elements.forEach(function (element, elementIndex) {\n            var shape = element.shape;\n            var datumLower = data[index];\n            if (index < dataLen) {\n                fn(shape, index, datumLower, datumUpper, elementIndex);\n            }\n            datumUpper = datumLower;\n            index++;\n        });\n    };\n    FunnelLayer.prototype._getGeometry = function () {\n        return this.view.geometries[0];\n    };\n    FunnelLayer.prototype._getAdjustedTextFillByShape = function (shape) {\n        var shapeColor = shape.attr('fill');\n        var shapeOpacity = shape.attr('opacity') ? shape.attr('opacity') : 1;\n        var rgb = rgb2arr(shapeColor);\n        var gray = Math.round(rgb[0] * 0.299 + rgb[1] * 0.587 + rgb[2] * 0.114) / shapeOpacity;\n        var colorBand = [\n            { from: 0, to: 85, color: 'white' },\n            { from: 85, to: 170, color: '#F6F6F6' },\n            { from: 170, to: 255, color: 'black' },\n        ];\n        var reflect = mappingColor(colorBand, gray);\n        return reflect;\n    };\n    FunnelLayer.prototype._genCustomFieldForDynamicHeight = function (data) {\n        var props = this.options;\n        var total = data.reduce(function (total, datum) { return total + datum[props.yField]; }, 0);\n        var ratioUpper = 1;\n        data.forEach(function (datum, index) {\n            var value = datum[props.yField];\n            var share = value / total;\n            var ratioLower = ratioUpper - share;\n            datum['__custom__'] = {\n                datumIndex: index,\n                dataLength: data.length,\n                ratioUpper: ratioUpper,\n                ratioLower: ratioLower,\n                reverse: props.transpose,\n            };\n            ratioUpper = ratioLower;\n        });\n    };\n    FunnelLayer.prototype._findCheckedDataByMouseDownLegendItem = function (legendItem) {\n        var flags = legendItem\n            .get('parent')\n            .get('children')\n            .map(function (legendItem) { return !legendItem.get('unchecked'); });\n        var data = this.getData().filter(function (datum, index) { return flags[index]; });\n        return data;\n    };\n    FunnelLayer.prototype._findCheckedDataInNewData = function (newData) {\n        var props = this.options;\n        var legendContainer = this.view.getController('legend').container;\n        var uncheckedXValues = legendContainer\n            .findAll(function (shape) { return shape.get('name') == 'legend-item'; })\n            .filter(function (legendItem) { return legendItem.get('unchecked'); })\n            .map(function (legendItem) { return legendItem.get('id').replace('-legend-item-', ''); });\n        var checkedData = newData.filter(function (datum) { return !contains(uncheckedXValues, datum[props.xField]); });\n        return checkedData;\n    };\n    FunnelLayer.prototype._findCheckedData = function (data) {\n        var _a;\n        var props = this.options;\n        if ((_a = props.legend) === null || _a === void 0 ? void 0 : _a.visible) {\n            var legendContainer = this.view.getController('legend').container;\n            var checkedXValues_1 = legendContainer\n                .findAll(function (shape) { return shape.get('name') == 'legend-item'; })\n                .filter(function (legendItem) { return !legendItem.get('unchecked'); })\n                .map(function (legendItem) { return legendItem.get('id').replace('-legend-item-', ''); });\n            var checkedData = data.filter(function (datum) { return contains(checkedXValues_1, datum[props.xField]); });\n            return checkedData;\n        }\n        else {\n            return this.processData(props.data);\n        }\n    };\n    FunnelLayer.prototype._reduceDataForCompare = function (data) {\n        var props = this.options;\n        var compareValueFirstVisited;\n        var yValuesMax = [-Infinity, -Infinity];\n        data = data.reduce(function (newData, datum) {\n            var _a;\n            var xValue = datum[props.xField];\n            var yValue = datum[props.yField];\n            var compareValue = datum[props.compareField];\n            if (!compareValueFirstVisited)\n                compareValueFirstVisited = compareValue;\n            var newDatum = newData.find(function (newDatum) { return newDatum[props.xField] == xValue; });\n            if (!newDatum) {\n                newDatum = (_a = {},\n                    _a[props.xField] = xValue,\n                    _a[props.yField] = 0,\n                    _a['__compare__'] = {\n                        compareValues: [],\n                        yValues: [],\n                        yValuesMax: [],\n                        yValuesNext: undefined,\n                        transpose: props.transpose,\n                    },\n                    _a);\n                newData.push(newDatum);\n            }\n            var idx = compareValue == compareValueFirstVisited ? 0 : 1;\n            newDatum['__compare__'].yValues[idx] = yValue;\n            if (yValuesMax[idx] < yValue) {\n                yValuesMax[idx] = yValue;\n            }\n            newDatum['__compare__'].compareValues[idx] = compareValue;\n            return newData;\n        }, []);\n        data.forEach(function (datum, index) {\n            datum[props.yField] = get(datum, '__compare__.yValues', []).reduce(function (yTotal, yValue) { return (yTotal += yValue); }, 0);\n            set(datum, '__compare__.yValuesMax', yValuesMax);\n            set(datum, '__compare__.yValuesNext', get(data, index + 1 + \".__compare__.yValues\"));\n        });\n        return data;\n    };\n    FunnelLayer.prototype._updateDataForCompare = function (data) {\n        var yValuesMax = [-Infinity, -Infinity];\n        data.forEach(function (datum) {\n            var yValues = get(datum, '__compare__.yValues');\n            [0, 1].forEach(function (i) {\n                if (yValues[i] > yValuesMax[i]) {\n                    yValuesMax[i] = yValues[i];\n                }\n            });\n        });\n        data.forEach(function (datum, index) {\n            set(datum, '__compare__.yValuesMax', yValuesMax);\n            set(datum, '__compare__.yValuesNext', get(data, index + 1 + \".__compare__.yValues\"));\n        });\n    };\n    return FunnelLayer;\n}(ViewLayer));\nexport default FunnelLayer;\nregisterPlotType('funnel', FunnelLayer);\n",{"version":3,"file":"/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/funnel/layer.js","sourceRoot":"","sources":["/run/media/williamyh/新加卷/project/Deecamp-project/system/Web/node_modules/@antv/g2plot/esm/plots/funnel/layer.js"],"names":[],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport { deepMix, contains, isFunction, get, findIndex, isEqual, each, set, isArray, assign } from '@antv/util';\nimport { createDom, modifyCSS } from '@antv/dom-util';\nimport { HtmlTooltipTheme, TooltipCssConst, DEFAULT_ANIMATE_CFG, _ORIGIN, } from '../../dependents';\nimport { registerPlotType } from '../../base/global';\nimport ViewLayer from '../../base/view-layer';\nimport { getGeom } from '../../geoms/factory';\nimport './theme';\nimport './geometry/shape/funnel-basic-rect';\nimport './geometry/shape/funnel-dynamic-rect';\nimport './animation/funnel-scale-in-x';\nimport './animation/funnel-scale-in-y';\nimport { mappingColor, rgb2arr } from '../../util/color';\nfunction lerp(a, b, factor) {\n    return (1 - factor) * a + factor * b;\n}\nvar G2_GEOM_MAP = {\n    column: 'interval',\n};\nvar PLOT_GEOM_MAP = {\n    interval: 'funnel',\n};\nvar FunnelLayer = /** @class */ (function (_super) {\n    __extends(FunnelLayer, _super);\n    function FunnelLayer(props) {\n        var _this = _super.call(this, props) || this;\n        _this.type = 'funnel';\n        _this._shouldResetPercentages = true;\n        _this._shouldResetLabels = true;\n        _this._shouldResetCompareTexts = true;\n        _this._legendsListenerAttached = false;\n        _this._onLegendContainerMouseDown = function (e) {\n            var props = _this.options;\n            var targetName = e.target.get('name');\n            if (targetName.startsWith('legend-item')) {\n                var legendItem = e.target.get('parent');\n                legendItem.set('unchecked', !legendItem.get('unchecked'));\n                _this.refreshPercentages();\n                _this.refreshLabels();\n                if (props.dynamicHeight) {\n                    var data = _this._findCheckedDataByMouseDownLegendItem(legendItem);\n                    _this._genCustomFieldForDynamicHeight(data);\n                }\n                if (props.compareField) {\n                    var data = _this._findCheckedDataByMouseDownLegendItem(legendItem);\n                    _this._updateDataForCompare(data);\n                    _this.refreshCompareTexts();\n                }\n            }\n        };\n        _this.adjustProps(_this.options);\n        if (props.dynamicHeight) {\n            _this._genCustomFieldForDynamicHeight(_this.getData());\n        }\n        if (props.compareField) {\n            _this.options.data = _this._reduceDataForCompare(_this.getData());\n        }\n        return _this;\n    }\n    FunnelLayer.getDefaultOptions = function (props) {\n        var cfg = {\n            label: {\n                visible: true,\n                adjustColor: true,\n            },\n            percentage: {\n                visible: true,\n                offsetX: props.transpose ? 0 : 40,\n                offsetY: props.transpose ? 40 : 0,\n                spacing: 4,\n                line: {\n                    visible: true,\n                    style: {\n                        lineWidth: 1,\n                        stroke: 'rgba(0, 0, 0, 0.15)',\n                    },\n                },\n                text: {\n                    content: '转化率',\n                    style: {\n                        fill: 'rgba(0, 0, 0, 0.65)',\n                    },\n                },\n                value: {\n                    visible: true,\n                    style: {\n                        fill: 'black',\n                    },\n                    formatter: function (yValueUpper, yValueLower) { return ((100 * yValueLower) / yValueUpper).toFixed(2) + \"%\"; },\n                },\n            },\n            tooltip: {\n                visible: true,\n                shared: true,\n                showTitle: false,\n                showCrosshairs: false,\n                showMarkers: false,\n            },\n            animation: deepMix({}, DEFAULT_ANIMATE_CFG, {\n                appear: {\n                    duration: 800,\n                },\n            }),\n            dynamicHeight: false,\n            compareText: {\n                visible: true,\n                offsetX: -16,\n                offsetY: -16,\n                style: {\n                    fill: 'black',\n                },\n            },\n            legend: {\n                position: 'bottom-center',\n            },\n            interactions: [{ type: 'tooltip' }, { type: 'legend-filter' }],\n        };\n        return deepMix({}, _super.getDefaultOptions.call(this), cfg);\n    };\n    FunnelLayer.prototype.getColorScale = function () {\n        var xField = this.options.xField;\n        if (xField) {\n            return this.view.getScaleByField(xField);\n        }\n    };\n    FunnelLayer.prototype.coord = function () {\n        var props = this.options;\n        var coordConfig = {\n            type: 'rect',\n            actions: props.transpose\n                ? props.dynamicHeight\n                    ? [['transpose'], ['scale', 1, -1]]\n                    : [['scale', 1, -1]]\n                : props.dynamicHeight\n                    ? []\n                    : [['transpose'], ['scale', 1, -1]],\n        };\n        // @ts-ignore\n        this.setConfig('coordinate', coordConfig);\n    };\n    FunnelLayer.prototype.axis = function () {\n        this.setConfig('axes', false);\n    };\n    FunnelLayer.prototype.adjustFunnel = function (funnel) {\n        var props = this.options;\n        // @ts-ignore\n        funnel.shape = props.dynamicHeight ? 'funnel-dynamic-rect' : 'funnel-basic-rect';\n        funnel.color = {\n            fields: [props.xField],\n            values: props.color && (Array.isArray(props.color) ? props.color : [props.color]),\n        };\n        if (isFunction(props.funnelStyle)) {\n            // @ts-ignore\n            funnel.style = { callback: props.funnelStyle };\n        }\n        else {\n            // @ts-ignore\n            funnel.style = { cfg: props.funnelStyle };\n        }\n        funnel.adjust = [\n            {\n                type: props.dynamicHeight ? 'stack' : 'symmetric',\n            },\n        ];\n    };\n    FunnelLayer.prototype.tooltip = function () {\n        var props = this.options;\n        if (props.compareField) {\n            deepMix(props.tooltip, {\n                htmlContent: function (title, items) {\n                    var clss, el, color, elMarker;\n                    clss = TooltipCssConst.CONTAINER_CLASS;\n                    el = createDom(\"<div class=\\\"\" + clss + \"\\\"></div>\");\n                    modifyCSS(el, HtmlTooltipTheme[clss]);\n                    var elRoot = el;\n                    if (title) {\n                        clss = TooltipCssConst.TITLE_CLASS;\n                        el = createDom(\"<div class=\\\"\" + clss + \"\\\"></div>\");\n                        modifyCSS(el, HtmlTooltipTheme[clss]);\n                        elRoot.appendChild(el);\n                        var elTitle = el;\n                        clss = TooltipCssConst.MARKER_CLASS;\n                        el = createDom(\"<span class=\\\"\" + clss + \"\\\"></span>\");\n                        modifyCSS(el, HtmlTooltipTheme[clss]);\n                        modifyCSS(el, { width: '10px', height: '10px' });\n                        elTitle.appendChild(el);\n                        elMarker = el;\n                        el = createDom(\"<span>\" + title + \"</span>\");\n                        elTitle.appendChild(el);\n                    }\n                    if (items) {\n                        clss = TooltipCssConst.LIST_CLASS;\n                        el = createDom(\"<ul class=\\\"\" + clss + \"\\\"></ul>\");\n                        modifyCSS(el, HtmlTooltipTheme[clss]);\n                        elRoot.appendChild(el);\n                        var elList_1 = el;\n                        items\n                            .reduce(function (pairs, item) {\n                            if (!color) {\n                                color = item.color;\n                            }\n                            var compareValues = get(item, 'point._origin.__compare__.compareValues');\n                            var yValues = get(item, 'point._origin.__compare__.yValues');\n                            yValues.forEach(function (yValue, i) { return pairs.push([compareValues[i], yValue]); });\n                            return pairs;\n                        }, [])\n                            .forEach(function (_a, index) {\n                            var compareValue = _a[0], yValue = _a[1];\n                            clss = TooltipCssConst.LIST_ITEM_CLASS;\n                            el = createDom(\"<li class=\\\"\" + clss + \"\\\" data-index=\" + index + \"></li>\");\n                            modifyCSS(el, HtmlTooltipTheme[clss]);\n                            elList_1.appendChild(el);\n                            var elListItem = el;\n                            clss = TooltipCssConst.NAME_CLASS;\n                            el = createDom(\"<span class=\\\"\" + clss + \"\\\">\" + compareValue + \"</span>\");\n                            modifyCSS(el, HtmlTooltipTheme[clss]);\n                            elListItem.appendChild(el);\n                            clss = TooltipCssConst.VALUE_CLASS;\n                            el = createDom(\"<span class=\\\"\" + clss + \"\\\">\" + yValue + \"</span>\");\n                            modifyCSS(el, HtmlTooltipTheme[clss]);\n                            elListItem.appendChild(el);\n                        });\n                    }\n                    if (color && elMarker) {\n                        modifyCSS(elMarker, { backgroundColor: color });\n                    }\n                    return elRoot;\n                },\n            });\n        }\n        _super.prototype.tooltip.call(this);\n    };\n    FunnelLayer.prototype.addGeometry = function () {\n        var props = this.options;\n        var funnel = getGeom('interval', 'main', {\n            positionFields: [props.dynamicHeight ? '_' : props.xField, props.yField],\n            plot: this,\n        });\n        this.adjustFunnel(funnel);\n        this.funnel = funnel;\n        this.setConfig('geometry', funnel);\n    };\n    FunnelLayer.prototype.animation = function () {\n        var _this = this;\n        _super.prototype.animation.call(this);\n        var props = this.options;\n        if (props.animation === false) {\n            /** 关闭动画 */\n            this.funnel.animate = false;\n        }\n        else {\n            var data_1 = this.getData();\n            var appearDuration = get(props, 'animation.appear.duration');\n            var appearDurationEach_1 = appearDuration / (data_1.length || 1);\n            if (this._animationAppearTimeoutHandler) {\n                clearTimeout(this._animationAppearTimeoutHandler);\n                delete this._animationAppearTimeoutHandler;\n            }\n            this._animationAppearTimeoutHandler = setTimeout(function () {\n                _this.fadeInPercentages(appearDurationEach_1);\n                if (props.compareField) {\n                    _this.fadeInCompareTexts(appearDurationEach_1);\n                }\n                delete _this._animationAppearTimeoutHandler;\n            }, appearDuration);\n            this.funnel.animate = deepMix({}, props.animation, {\n                appear: {\n                    animation: props.transpose ? 'funnelScaleInX' : 'funnelScaleInY',\n                    duration: appearDurationEach_1,\n                    delay: function (datum) { return findIndex(data_1, function (o) { return isEqual(o, datum); }) * appearDurationEach_1; },\n                    callback: function (shape) {\n                        _this.fadeInLabels(shape, 0.5 * appearDurationEach_1);\n                    },\n                },\n                enter: {\n                    animation: 'fade-in',\n                },\n            });\n        }\n    };\n    FunnelLayer.prototype.afterRender = function () {\n        var props = this.options;\n        this.resetLabels();\n        this.resetPercentages();\n        if (props.compareField) {\n            this.resetCompareTexts();\n        }\n        if (props.padding == 'auto') {\n            var percentageContainer = this._findPercentageContainer();\n            if (percentageContainer) {\n                this.paddingController.registerPadding(percentageContainer, 'inner', true);\n            }\n            var compareTextContainer = this._findCompareTextContainer();\n            if (compareTextContainer) {\n                this.paddingController.registerPadding(compareTextContainer, 'inner', true);\n            }\n        }\n        _super.prototype.afterRender.call(this);\n        if (props.animation === false) {\n            this.fadeInLabels();\n            this.fadeInPercentages();\n            if (props.compareField) {\n                this.fadeInCompareTexts();\n            }\n        }\n        if (!this._legendsListenerAttached) {\n            this._legendsListenerAttached = true;\n            // @ts-ignore\n            var legendContainer = this.view.getController('legend').container;\n            legendContainer.on('mousedown', this._onLegendContainerMouseDown);\n        }\n    };\n    FunnelLayer.prototype.updateConfig = function (cfg) {\n        cfg = this.adjustProps(cfg);\n        _super.prototype.updateConfig.call(this, cfg);\n        this._legendsListenerAttached = false;\n    };\n    FunnelLayer.prototype.changeData = function (data) {\n        var props = this.options;\n        if (props.animation !== false) {\n            this._shouldResetPercentages = false;\n            this._shouldResetLabels = false;\n        }\n        if (props.dynamicHeight) {\n            var checkedData = this._findCheckedDataInNewData(data);\n            this._genCustomFieldForDynamicHeight(checkedData);\n        }\n        if (props.compareField) {\n            data = this._reduceDataForCompare(data);\n            var checkedData = this._findCheckedDataInNewData(data);\n            this._updateDataForCompare(checkedData);\n        }\n        _super.prototype.changeData.call(this, data);\n        this.refreshPercentages();\n        this.refreshLabels();\n        if (props.compareField) {\n            this.fadeInCompareTexts();\n        }\n    };\n    FunnelLayer.prototype.geometryParser = function (dim, type) {\n        if (dim === 'g2') {\n            return G2_GEOM_MAP[type];\n        }\n        return PLOT_GEOM_MAP[type];\n    };\n    FunnelLayer.prototype.adjustProps = function (props) {\n        if (props.compareField) {\n            props.dynamicHeight = false;\n        }\n        if (props.dynamicHeight) {\n            set(props, \"meta.\" + props.yField + \".nice\", false);\n            set(props, 'tooltip.shared', false);\n        }\n        return props;\n    };\n    FunnelLayer.prototype.resetPercentages = function () {\n        var _this = this;\n        if (!this._shouldResetPercentages)\n            return;\n        var props = this.options;\n        var _a = props.percentage || {}, offsetX = _a.offsetX, offsetY = _a.offsetY, spacing = _a.spacing, _b = _a.line, percentageLine = _b === void 0 ? {} : _b, _c = _a.text, percentageText = _c === void 0 ? {} : _c, _d = _a.value, percentageValue = _d === void 0 ? {} : _d;\n        var adjustTimestamp = Date.now();\n        var container = this._findPercentageContainer(true);\n        this._eachShape(function (shape, index, datumLower, datumUpper) {\n            if (index > 0) {\n                var _a = shape.getBBox(), minX = _a.minX, maxX = _a.maxX, maxY = _a.maxY, minY = _a.minY;\n                var x1 = props.transpose ? minX : maxX;\n                var y1 = props.transpose ? (props.compareField ? maxY : minY) : minY;\n                var _b = _this._findPercentageMembersInContainerByIndex(container, index, true), line_1 = _b.line, text_1 = _b.text, value_1 = _b.value;\n                var eachProcs_1 = [\n                    function (x, y, line, text, value) {\n                        if (line) {\n                            line.attr(deepMix({}, percentageLine.style, {\n                                x1: x,\n                                y1: y,\n                                x2: props.transpose ? x + offsetX : x - offsetX,\n                                y2: props.transpose ? y - offsetY : y + offsetY,\n                                opacity: 0,\n                            }));\n                            line.set('adjustTimestamp', adjustTimestamp);\n                        }\n                        var textWidth = 0;\n                        var valueWidth = 0;\n                        var textProc = function () {\n                            if (text) {\n                                text.attr(deepMix({}, percentageText.style, {\n                                    x: props.transpose ? x + offsetX : x - offsetX - spacing - valueWidth - spacing,\n                                    y: props.transpose ? y - offsetY - spacing : y + offsetY,\n                                    opacity: 0,\n                                    text: percentageText.content,\n                                    textAlign: props.transpose ? 'left' : 'right',\n                                    textBaseline: props.transpose ? 'bottom' : 'middle',\n                                }));\n                                text.set('adjustTimestamp', adjustTimestamp);\n                                textWidth = text.getBBox().width;\n                            }\n                        };\n                        var valueProc = function () {\n                            if (value) {\n                                value.attr(deepMix({}, percentageValue.style, {\n                                    x: props.transpose ? x + offsetX + textWidth + spacing : x - offsetX - spacing,\n                                    y: props.transpose ? y - offsetY - spacing : y + offsetY,\n                                    opacity: 0,\n                                    text: isFunction(percentageValue.formatter)\n                                        ? props.compareField\n                                            ? percentageValue.formatter(get(datumUpper, '__compare__.yValues.0'), get(datumLower, '__compare__.yValues.0'))\n                                            : percentageValue.formatter(datumUpper[props.yField], datumLower[props.yField])\n                                        : '',\n                                    textAlign: props.transpose ? 'left' : 'right',\n                                    textBaseline: props.transpose ? 'bottom' : 'middle',\n                                }));\n                                value.set('adjustTimestamp', adjustTimestamp);\n                                valueWidth = value.getBBox().width;\n                            }\n                        };\n                        if (props.transpose) {\n                            textProc();\n                            valueProc();\n                        }\n                        else {\n                            valueProc();\n                            textProc();\n                        }\n                    },\n                    function (x, y, line, text, value) {\n                        if (line) {\n                            line.attr(deepMix({}, percentageLine.style, {\n                                x1: x,\n                                y1: y,\n                                x2: x + offsetX,\n                                y2: props.transpose ? (props.compareField ? y + offsetY : y - offsetY) : y + offsetY,\n                                opacity: 0,\n                            }));\n                            line.set('adjustTimestamp', adjustTimestamp);\n                        }\n                        var textWidth = 0;\n                        if (text) {\n                            text.attr(deepMix({}, percentageText.style, {\n                                x: props.transpose ? x + offsetX : x + offsetX + spacing,\n                                y: props.transpose\n                                    ? props.compareField\n                                        ? y + offsetY + spacing\n                                        : y - offsetY - spacing\n                                    : y + offsetY,\n                                opacity: 0,\n                                text: percentageText.content,\n                                textAlign: 'left',\n                                textBaseline: props.transpose ? (props.compareField ? 'top' : 'bottom') : 'middle',\n                            }));\n                            text.set('adjustTimestamp', adjustTimestamp);\n                            textWidth = text.getBBox().width;\n                        }\n                        if (value) {\n                            value.attr(deepMix({}, percentageValue.style, {\n                                x: props.transpose ? x + offsetX + textWidth + spacing : x + offsetX + spacing + textWidth + spacing,\n                                y: props.transpose\n                                    ? props.compareField\n                                        ? y + offsetY + spacing\n                                        : y - offsetY - spacing\n                                    : y + offsetY,\n                                opacity: 0,\n                                text: isFunction(percentageValue.formatter)\n                                    ? props.compareField\n                                        ? percentageValue.formatter(get(datumUpper, \"__compare__.yValues.1\"), get(datumLower, \"__compare__.yValues.1\"))\n                                        : percentageValue.formatter(datumUpper[props.yField], datumLower[props.yField])\n                                    : '',\n                                textAlign: 'left',\n                                textBaseline: props.transpose ? (props.compareField ? 'top' : 'bottom') : 'middle',\n                            }));\n                            value.set('adjustTimestamp', adjustTimestamp);\n                        }\n                    },\n                ];\n                if (props.compareField) {\n                    var _c = [minX, minY], x0 = _c[0], y0 = _c[1];\n                    [\n                        [x0, y0],\n                        [x1, y1],\n                    ].forEach(function (_a, i) {\n                        var x = _a[0], y = _a[1];\n                        return eachProcs_1[i](x, y, line_1 && line_1[i], text_1 && text_1[i], value_1 && value_1[i]);\n                    });\n                }\n                else {\n                    eachProcs_1[1](x1, y1, line_1, text_1, value_1);\n                }\n            }\n            datumUpper = datumLower;\n            index++;\n        });\n        container.get('children').forEach(function (child) {\n            if (child.get('adjustTimestamp') != adjustTimestamp) {\n                child.attr({ opacity: 0 });\n                container.set(child.get('id'), null);\n                setTimeout(function () { return child.remove(); }, 0);\n            }\n        });\n    };\n    FunnelLayer.prototype.fadeInPercentages = function (duration, callback) {\n        var _this = this;\n        var props = this.options;\n        var container = this._findPercentageContainer();\n        var eachProc = function (i) {\n            var lastBBox = { minX: Infinity, maxX: -Infinity, minY: Infinity, maxY: -Infinity };\n            _this._eachShape(function (shape, index) {\n                var members = _this._findPercentageMembersInContainerByIndex(container, index);\n                var currBBox = { minX: Infinity, maxX: -Infinity, minY: Infinity, maxY: -Infinity };\n                var eachCalc = function (member) {\n                    if (member && member.get('type') == 'text') {\n                        var _a = member.getBBox(), minX = _a.minX, maxX = _a.maxX, minY = _a.minY, maxY = _a.maxY;\n                        if (minX < currBBox.minX)\n                            currBBox.minX = minX;\n                        if (maxX > currBBox.maxX)\n                            currBBox.maxX = maxX;\n                        if (minY < currBBox.minY)\n                            currBBox.minY = minY;\n                        if (maxY > currBBox.maxY)\n                            currBBox.maxY = maxY;\n                    }\n                };\n                each(members, function (member) { return (isArray(member) ? eachCalc(member[i]) : eachCalc(member)); });\n                if (currBBox.minX > lastBBox.maxX ||\n                    currBBox.maxX < lastBBox.minX ||\n                    currBBox.minY > lastBBox.maxY ||\n                    currBBox.maxY < lastBBox.minY) {\n                    var eachShow_1 = function (member) {\n                        if (member) {\n                            var attrs = {\n                                opacity: 1,\n                            };\n                            duration ? member.animate(attrs, duration) : member.attr(attrs);\n                        }\n                    };\n                    each(members, function (member) { return (isArray(member) ? eachShow_1(member[i]) : eachShow_1(member)); });\n                    assign(lastBBox, currBBox);\n                }\n            });\n        };\n        props.compareField ? [0, 1].forEach(eachProc) : eachProc();\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.fadeOutPercentages = function (duration, callback) {\n        var _this = this;\n        var container = this._findPercentageContainer();\n        this._eachShape(function (shape, index) {\n            var members = _this._findPercentageMembersInContainerByIndex(container, index);\n            var eachProc = function (member) {\n                if (member) {\n                    var attrs = {\n                        opacity: 0,\n                    };\n                    duration ? member.animate(attrs, duration) : member.attr(attrs);\n                }\n            };\n            each(members, function (member) { return (isArray(member) ? member.forEach(eachProc) : eachProc(member)); });\n        });\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.refreshPercentages = function (callback) {\n        var _this = this;\n        var props = this.options;\n        if (props.animation !== false) {\n            var _a = this._calcRefreshFadeDurations(), fadeOutDuration = _a.fadeOutDuration, fadeInDuration_1 = _a.fadeInDuration;\n            this._shouldResetPercentages = false;\n            this.fadeOutPercentages(fadeOutDuration, function () {\n                _this._shouldResetPercentages = true;\n                _this.resetPercentages();\n                _this.fadeInPercentages(fadeInDuration_1, callback);\n            });\n        }\n    };\n    FunnelLayer.prototype._findPercentageContainer = function (createIfNotFound) {\n        if (createIfNotFound === void 0) { createIfNotFound = false; }\n        var middleGroup = this.view.middleGroup;\n        var percentageContainer = middleGroup.get('percentageContainer');\n        if (!percentageContainer && createIfNotFound) {\n            percentageContainer = middleGroup.addGroup();\n            middleGroup.set('percentageContainer', percentageContainer);\n        }\n        return percentageContainer;\n    };\n    FunnelLayer.prototype._findPercentageMembersInContainerByIndex = function (container, index, createIfNotFound) {\n        if (createIfNotFound === void 0) { createIfNotFound = false; }\n        var props = this.options;\n        var _a = props.percentage || {}, visible = _a.visible, _b = _a.line, percentageLine = _b === void 0 ? {} : _b, _c = _a.text, percentageText = _c === void 0 ? {} : _c, _d = _a.value, percentageValue = _d === void 0 ? {} : _d;\n        var members = {\n            line: undefined,\n            text: undefined,\n            value: undefined,\n        };\n        if (visible === false || !container) {\n            return members;\n        }\n        if (percentageLine.visible !== false) {\n            var find = function (i) {\n                var lineId = \"_percentage-line-\" + index + \"-\" + i;\n                var line = container.get(lineId);\n                if (!line && createIfNotFound) {\n                    line = container.addShape({ id: lineId, type: 'line', attrs: {} });\n                    container.set(lineId, line);\n                }\n                return line;\n            };\n            var line = props.compareField ? [0, 1].map(find) : find(0);\n            members.line = line;\n        }\n        if (percentageText.visible !== false) {\n            var find = function (i) {\n                var textId = \"_percentage-text-\" + index + \"-\" + i;\n                var text = container.get(textId);\n                if (!text && createIfNotFound) {\n                    text = container.addShape({ id: textId, type: 'text', attrs: {} });\n                    container.set(textId, text);\n                }\n                return text;\n            };\n            var text = props.compareField ? [0, 1].map(find) : find(0);\n            members.text = text;\n        }\n        if (percentageValue.visible !== false) {\n            var find = function (i) {\n                var valueId = \"_percentage-value-\" + index + \"-\" + i;\n                var value = container.get(valueId);\n                if (!value && createIfNotFound) {\n                    value = container.addShape({ id: valueId, type: 'text', attrs: {} });\n                    container.set(valueId, value);\n                }\n                return value;\n            };\n            var value = props.compareField ? [0, 1].map(find) : find(0);\n            members.value = value;\n        }\n        return members;\n    };\n    FunnelLayer.prototype._calcRefreshFadeDurations = function () {\n        var props = this.options;\n        var updateDuration = get(props, 'animation.update.duration');\n        var enterDuration = get(props, 'animation.enter.duration');\n        var fadeInDuration = Math.min(enterDuration, updateDuration) * 0.6;\n        var fadeOutDuration = Math.max(enterDuration, updateDuration) * 1.2;\n        return { fadeInDuration: fadeInDuration, fadeOutDuration: fadeOutDuration };\n    };\n    FunnelLayer.prototype.resetLabels = function () {\n        var _this = this;\n        if (!this._shouldResetLabels)\n            return;\n        var props = this.options;\n        var xField = props.xField, yField = props.yField;\n        var adjustTimestamp = Date.now();\n        var labelsContainer = this._getGeometry().labelsContainer;\n        var labelProps = props.label || {};\n        var labelStyle = deepMix(__assign({}, this.theme.label), props.label.style, {\n            opacity: 0,\n            textAlign: 'center',\n            textBaseline: 'middle',\n        });\n        var datumTop;\n        this._eachShape(function (shape, index, datum, elementIndex) {\n            var _a;\n            var element = shape.get('element');\n            if (index == 0) {\n                datumTop = datum;\n            }\n            var _b = shape.getBBox(), minX = _b.minX, maxX = _b.maxX, minY = _b.minY, maxY = _b.maxY;\n            var xValue = datum[xField];\n            var yValue = datum[yField];\n            if (labelProps.adjustColor) {\n                labelStyle.fill = _this._getAdjustedTextFillByShape(shape);\n            }\n            var compare = datum.__compare__;\n            var content;\n            var formatArgs = (_a = {},\n                _a[_ORIGIN] = datum,\n                _a.element = element,\n                _a.elementIndex = elementIndex,\n                _a.mappingDatum = [].concat(element.getModel().mappingData)[0],\n                _a.mappingDatumIndex = 0,\n                _a);\n            if (labelProps.formatter) {\n                content = labelProps.formatter(xValue, formatArgs, index, yValue, datumTop[yField]);\n            }\n            else {\n                if (compare) {\n                    content = [0, 1].map(function () { return \"\" + yValue; }).join(props.transpose ? '\\n\\n' : '    ');\n                }\n                else {\n                    content = xValue + \" \" + yValue;\n                }\n            }\n            var label = _this._findLabelInContainerByIndex(labelsContainer, index, true);\n            var ratio = compare ? compare.yValues[0] / (compare.yValues[0] + compare.yValues[1]) : 0.5;\n            label.attr(__assign(__assign({}, labelStyle), { x: lerp(minX, maxX, !props.transpose ? ratio : 0.5), y: lerp(minY, maxY, props.transpose ? ratio : 0.5), text: content }));\n            label.set('adjustTimestamp', adjustTimestamp);\n        });\n        labelsContainer.get('children').forEach(function (label) {\n            if (label.get('adjustTimestamp') != adjustTimestamp) {\n                label.attr({ opacity: 0 });\n                labelsContainer.set(label.get('id'), null);\n                setTimeout(function () { return label.remove(); });\n            }\n        });\n    };\n    FunnelLayer.prototype.fadeInLabels = function (targetShape, duration, callback) {\n        var _this = this;\n        var labelsContainer = this._getGeometry().labelsContainer;\n        this._eachShape(function (shape, index) {\n            if (!targetShape || targetShape == shape) {\n                var label = _this._findLabelInContainerByIndex(labelsContainer, index);\n                if (label) {\n                    var shapeBBox = shape.getBBox();\n                    var labelBBox = label.getBBox();\n                    if (labelBBox.minX >= shapeBBox.minX &&\n                        labelBBox.maxX <= shapeBBox.maxX &&\n                        labelBBox.minY >= shapeBBox.minY &&\n                        labelBBox.maxY <= shapeBBox.maxY) {\n                        var attrs = {\n                            opacity: 1,\n                        };\n                        duration ? label.animate(attrs, duration) : label.attr(attrs);\n                    }\n                }\n            }\n        });\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.fadeOutLabels = function (targetShape, duration, callback) {\n        var _this = this;\n        var labelsContainer = this._getGeometry().labelsContainer;\n        this._eachShape(function (shape, index) {\n            if (!targetShape || targetShape == shape) {\n                var label = _this._findLabelInContainerByIndex(labelsContainer, index);\n                if (label) {\n                    var attrs = {\n                        opacity: 0,\n                    };\n                    duration ? label.animate(attrs, duration) : label.attr(attrs);\n                }\n            }\n        });\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.refreshLabels = function (callback) {\n        var _this = this;\n        var props = this.options;\n        if (props.animation !== false) {\n            var _a = this._calcRefreshFadeDurations(), fadeOutDuration = _a.fadeOutDuration, fadeInDuration_2 = _a.fadeInDuration;\n            this._shouldResetLabels = false;\n            this.fadeOutLabels(null, fadeOutDuration, function () {\n                _this._shouldResetLabels = true;\n                _this.resetLabels();\n                _this.fadeInLabels(null, fadeInDuration_2, callback);\n            });\n        }\n    };\n    FunnelLayer.prototype._findLabelInContainerByIndex = function (container, index, createIfNotFound) {\n        var _a;\n        if (createIfNotFound === void 0) { createIfNotFound = false; }\n        var props = this.options;\n        var label;\n        if (((_a = props.label) === null || _a === void 0 ? void 0 : _a.visible) === false) {\n            return label;\n        }\n        var labelId = \"_label-\" + index;\n        label = container.get(labelId);\n        if (!label && createIfNotFound) {\n            label = container.addShape({\n                id: labelId,\n                type: 'text',\n                attrs: {},\n            });\n            container.set(labelId, label);\n        }\n        return label;\n    };\n    FunnelLayer.prototype.resetCompareTexts = function () {\n        if (!this._shouldResetCompareTexts)\n            return;\n        var props = this.options;\n        var shapeParentBBox;\n        var compare;\n        this._eachShape(function (shape, index, datum) {\n            if (index == 0) {\n                shapeParentBBox = shape.get('parent').getBBox();\n                compare = get(datum, '__compare__');\n            }\n        });\n        if (shapeParentBBox && compare && get(props, 'compareText.visible') !== false) {\n            var container_1 = this._findCompareTextContainer(true);\n            var yValuesMax_1 = compare.yValuesMax, compareValues_1 = compare.compareValues;\n            var minX_1 = shapeParentBBox.minX, maxX_1 = shapeParentBBox.maxX, minY_1 = shapeParentBBox.minY, maxY_1 = shapeParentBBox.maxY;\n            var compareTexts_1 = container_1.get('children');\n            [0, 1].forEach(function (i) {\n                var compareText = compareTexts_1[i];\n                if (!compareText) {\n                    compareText = container_1.addShape({ type: 'text' });\n                }\n                compareText.attr(deepMix({}, get(props, 'compareText.style'), {\n                    text: props.transpose ? compareValues_1[i] : i ? \"  \" + compareValues_1[i] : compareValues_1[i] + \"  \",\n                    x: props.transpose\n                        ? minX_1 + get(props, 'compareText.offsetX')\n                        : lerp(minX_1, maxX_1, yValuesMax_1[0] / (yValuesMax_1[0] + yValuesMax_1[1])),\n                    y: props.transpose\n                        ? lerp(minY_1, maxY_1, yValuesMax_1[0] / (yValuesMax_1[0] + yValuesMax_1[1])) + (i ? 8 : -8)\n                        : minY_1 + get(props, 'compareText.offsetY'),\n                    opacity: 0,\n                    textAlign: props.transpose ? 'right' : i ? 'left' : 'right',\n                    textBaseline: props.transpose ? (i ? 'top' : 'bottom') : 'bottom',\n                }));\n            });\n        }\n    };\n    FunnelLayer.prototype.fadeInCompareTexts = function (duration, callback) {\n        var container = this._findCompareTextContainer();\n        if (container) {\n            var compareTexts_2 = container.get('children');\n            [0, 1].forEach(function (i) {\n                var compareText = compareTexts_2[i];\n                if (compareText) {\n                    var attrs = {\n                        opacity: 1,\n                    };\n                    duration ? compareText.animate(attrs, duration) : compareText.attr(attrs);\n                }\n            });\n        }\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.fadeOutCompareTexts = function (duration, callback) {\n        var container = this._findCompareTextContainer();\n        if (container) {\n            var compareTexts_3 = container.get('children');\n            [0, 1].forEach(function (i) {\n                var compareText = compareTexts_3[i];\n                if (compareText) {\n                    var attrs = {\n                        opacity: 0,\n                    };\n                    duration ? compareText.animate(attrs, duration) : compareText.attr(attrs);\n                }\n            });\n        }\n        duration && callback && setTimeout(callback, duration);\n    };\n    FunnelLayer.prototype.refreshCompareTexts = function (callback) {\n        var _this = this;\n        var props = this.options;\n        if (props.animation !== false) {\n            var _a = this._calcRefreshFadeDurations(), fadeInDuration_3 = _a.fadeInDuration, fadeOutDuration = _a.fadeOutDuration;\n            this._shouldResetCompareTexts = false;\n            this.fadeOutCompareTexts(fadeOutDuration, function () {\n                _this._shouldResetCompareTexts = true;\n                _this.resetCompareTexts();\n                _this.fadeInCompareTexts(fadeInDuration_3, callback);\n            });\n        }\n    };\n    FunnelLayer.prototype._findCompareTextContainer = function (createIfNotFound) {\n        if (createIfNotFound === void 0) { createIfNotFound = false; }\n        var middleGroup = this.view.middleGroup;\n        var compareTextContainer = middleGroup.get('compareTextContainer');\n        if (!compareTextContainer && createIfNotFound) {\n            compareTextContainer = middleGroup.addGroup();\n            middleGroup.set('compareTextContainer', compareTextContainer);\n        }\n        return compareTextContainer;\n    };\n    FunnelLayer.prototype._eachShape = function (fn) {\n        var _a;\n        var data = this._findCheckedData(this.getData());\n        var dataLen = data.length;\n        var index = 0;\n        var datumUpper;\n        (_a = this._getGeometry()) === null || _a === void 0 ? void 0 : _a.elements.forEach(function (element, elementIndex) {\n            var shape = element.shape;\n            var datumLower = data[index];\n            if (index < dataLen) {\n                fn(shape, index, datumLower, datumUpper, elementIndex);\n            }\n            datumUpper = datumLower;\n            index++;\n        });\n    };\n    FunnelLayer.prototype._getGeometry = function () {\n        return this.view.geometries[0];\n    };\n    FunnelLayer.prototype._getAdjustedTextFillByShape = function (shape) {\n        var shapeColor = shape.attr('fill');\n        var shapeOpacity = shape.attr('opacity') ? shape.attr('opacity') : 1;\n        var rgb = rgb2arr(shapeColor);\n        var gray = Math.round(rgb[0] * 0.299 + rgb[1] * 0.587 + rgb[2] * 0.114) / shapeOpacity;\n        var colorBand = [\n            { from: 0, to: 85, color: 'white' },\n            { from: 85, to: 170, color: '#F6F6F6' },\n            { from: 170, to: 255, color: 'black' },\n        ];\n        var reflect = mappingColor(colorBand, gray);\n        return reflect;\n    };\n    FunnelLayer.prototype._genCustomFieldForDynamicHeight = function (data) {\n        var props = this.options;\n        var total = data.reduce(function (total, datum) { return total + datum[props.yField]; }, 0);\n        var ratioUpper = 1;\n        data.forEach(function (datum, index) {\n            var value = datum[props.yField];\n            var share = value / total;\n            var ratioLower = ratioUpper - share;\n            datum['__custom__'] = {\n                datumIndex: index,\n                dataLength: data.length,\n                ratioUpper: ratioUpper,\n                ratioLower: ratioLower,\n                reverse: props.transpose,\n            };\n            ratioUpper = ratioLower;\n        });\n    };\n    FunnelLayer.prototype._findCheckedDataByMouseDownLegendItem = function (legendItem) {\n        var flags = legendItem\n            .get('parent')\n            .get('children')\n            .map(function (legendItem) { return !legendItem.get('unchecked'); });\n        var data = this.getData().filter(function (datum, index) { return flags[index]; });\n        return data;\n    };\n    FunnelLayer.prototype._findCheckedDataInNewData = function (newData) {\n        var props = this.options;\n        // @ts-ignore\n        var legendContainer = this.view.getController('legend').container;\n        var uncheckedXValues = legendContainer\n            .findAll(function (shape) { return shape.get('name') == 'legend-item'; })\n            .filter(function (legendItem) { return legendItem.get('unchecked'); })\n            .map(function (legendItem) { return legendItem.get('id').replace('-legend-item-', ''); });\n        var checkedData = newData.filter(function (datum) { return !contains(uncheckedXValues, datum[props.xField]); });\n        return checkedData;\n    };\n    FunnelLayer.prototype._findCheckedData = function (data) {\n        var _a;\n        var props = this.options;\n        if ((_a = props.legend) === null || _a === void 0 ? void 0 : _a.visible) {\n            // @ts-ignore\n            var legendContainer = this.view.getController('legend').container;\n            var checkedXValues_1 = legendContainer\n                .findAll(function (shape) { return shape.get('name') == 'legend-item'; })\n                .filter(function (legendItem) { return !legendItem.get('unchecked'); })\n                .map(function (legendItem) { return legendItem.get('id').replace('-legend-item-', ''); });\n            var checkedData = data.filter(function (datum) { return contains(checkedXValues_1, datum[props.xField]); });\n            return checkedData;\n        }\n        else {\n            return this.processData(props.data);\n        }\n    };\n    FunnelLayer.prototype._reduceDataForCompare = function (data) {\n        var props = this.options;\n        var compareValueFirstVisited;\n        var yValuesMax = [-Infinity, -Infinity];\n        data = data.reduce(function (newData, datum) {\n            var _a;\n            var xValue = datum[props.xField];\n            var yValue = datum[props.yField];\n            var compareValue = datum[props.compareField];\n            if (!compareValueFirstVisited)\n                compareValueFirstVisited = compareValue;\n            var newDatum = newData.find(function (newDatum) { return newDatum[props.xField] == xValue; });\n            if (!newDatum) {\n                newDatum = (_a = {},\n                    _a[props.xField] = xValue,\n                    _a[props.yField] = 0,\n                    _a['__compare__'] = {\n                        compareValues: [],\n                        yValues: [],\n                        yValuesMax: [],\n                        yValuesNext: undefined,\n                        transpose: props.transpose,\n                    },\n                    _a);\n                newData.push(newDatum);\n            }\n            var idx = compareValue == compareValueFirstVisited ? 0 : 1;\n            newDatum['__compare__'].yValues[idx] = yValue;\n            if (yValuesMax[idx] < yValue) {\n                yValuesMax[idx] = yValue;\n            }\n            newDatum['__compare__'].compareValues[idx] = compareValue;\n            return newData;\n        }, []);\n        data.forEach(function (datum, index) {\n            datum[props.yField] = get(datum, '__compare__.yValues', []).reduce(function (yTotal, yValue) { return (yTotal += yValue); }, 0);\n            set(datum, '__compare__.yValuesMax', yValuesMax);\n            set(datum, '__compare__.yValuesNext', get(data, index + 1 + \".__compare__.yValues\"));\n        });\n        return data;\n    };\n    FunnelLayer.prototype._updateDataForCompare = function (data) {\n        var yValuesMax = [-Infinity, -Infinity];\n        data.forEach(function (datum) {\n            var yValues = get(datum, '__compare__.yValues');\n            [0, 1].forEach(function (i) {\n                if (yValues[i] > yValuesMax[i]) {\n                    yValuesMax[i] = yValues[i];\n                }\n            });\n        });\n        data.forEach(function (datum, index) {\n            set(datum, '__compare__.yValuesMax', yValuesMax);\n            set(datum, '__compare__.yValuesNext', get(data, index + 1 + \".__compare__.yValues\"));\n        });\n    };\n    return FunnelLayer;\n}(ViewLayer));\nexport default FunnelLayer;\nregisterPlotType('funnel', FunnelLayer);\n//# sourceMappingURL=layer.js.map"]}]}