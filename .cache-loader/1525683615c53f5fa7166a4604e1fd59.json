{"remainingRequest":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js??ref--4-1!D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\animate\\index.js","dependencies":[{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\animate\\index.js","mtime":499162500000},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1595520254649},{"path":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\ts-loader\\index.js","mtime":1537906253000}],"contextDependencies":[],"result":["var Util = require('../util');\r\nvar Animate = require('./animate');\r\nvar MatrixUtil = Util.MatrixUtil;\r\nvar mat3 = MatrixUtil.mat3;\r\nfunction getShapes(container, viewId) {\r\n    var shapes = [];\r\n    if (container.get('animate') === false) {\r\n        return [];\r\n    }\r\n    var children = container.get('children');\r\n    Util.each(children, function (child) {\r\n        if (child.isGroup) {\r\n            shapes = shapes.concat(getShapes(child, viewId));\r\n        }\r\n        else if (child.isShape && child._id) {\r\n            var id = child._id;\r\n            id = id.split('-')[0];\r\n            if (id === viewId) {\r\n                shapes.push(child);\r\n            }\r\n        }\r\n    });\r\n    return shapes;\r\n}\r\nfunction cache(shapes) {\r\n    var rst = {};\r\n    Util.each(shapes, function (shape) {\r\n        if (!shape._id || shape.isClip)\r\n            return;\r\n        var id = shape._id;\r\n        rst[id] = {\r\n            _id: id,\r\n            type: shape.get('type'),\r\n            attrs: Util.cloneDeep(shape.attr()),\r\n            name: shape.name,\r\n            index: shape.get('index'),\r\n            animateCfg: shape.get('animateCfg'),\r\n            coord: shape.get('coord')\r\n        };\r\n    });\r\n    return rst;\r\n}\r\nfunction getAnimate(geomType, coord, animationType, animationName) {\r\n    var result;\r\n    if (animationName) {\r\n        result = Animate.Action[animationType][animationName];\r\n    }\r\n    else {\r\n        result = Animate.getAnimation(geomType, coord, animationType);\r\n    }\r\n    return result;\r\n}\r\nfunction getAnimateCfg(geomType, animationType, animateCfg) {\r\n    var defaultCfg = Animate.getAnimateCfg(geomType, animationType);\r\n    if (animateCfg && animateCfg[animationType]) {\r\n        return Util.deepMix({}, defaultCfg, animateCfg[animationType]);\r\n    }\r\n    return defaultCfg;\r\n}\r\nfunction addAnimate(cache, shapes, canvas, isUpdate) {\r\n    var animate;\r\n    var animateCfg;\r\n    var canvasDrawn = false;\r\n    if (isUpdate) {\r\n        var updateShapes = [];\r\n        var newShapes = [];\r\n        Util.each(shapes, function (shape) {\r\n            var result = cache[shape._id];\r\n            if (!result) {\r\n                newShapes.push(shape);\r\n            }\r\n            else {\r\n                shape.setSilent('cacheShape', result);\r\n                updateShapes.push(shape);\r\n                delete cache[shape._id];\r\n            }\r\n        });\r\n        Util.each(cache, function (deletedShape) {\r\n            var name = deletedShape.name, coord = deletedShape.coord, _id = deletedShape._id, attrs = deletedShape.attrs, index = deletedShape.index, type = deletedShape.type;\r\n            animateCfg = getAnimateCfg(name, 'leave', deletedShape.animateCfg);\r\n            animate = getAnimate(name, coord, 'leave', animateCfg.animation);\r\n            if (Util.isFunction(animate)) {\r\n                var tempShape = canvas.addShape(type, {\r\n                    attrs: attrs,\r\n                    index: index\r\n                });\r\n                tempShape._id = _id;\r\n                tempShape.name = name;\r\n                if (coord && name !== 'label') {\r\n                    var tempShapeMatrix = tempShape.getMatrix();\r\n                    var finalMatrix = mat3.multiply([], tempShapeMatrix, coord.matrix);\r\n                    tempShape.setMatrix(finalMatrix);\r\n                }\r\n                canvasDrawn = true;\r\n                animate(tempShape, animateCfg, coord);\r\n            }\r\n        });\r\n        Util.each(updateShapes, function (updateShape) {\r\n            var name = updateShape.name;\r\n            var coord = updateShape.get('coord');\r\n            var cacheAttrs = updateShape.get('cacheShape').attrs;\r\n            if (!Util.isEqual(cacheAttrs, updateShape.attr())) {\r\n                animateCfg = getAnimateCfg(name, 'update', updateShape.get('animateCfg'));\r\n                animate = getAnimate(name, coord, 'update', animateCfg.animation);\r\n                if (Util.isFunction(animate)) {\r\n                    animate(updateShape, animateCfg, coord);\r\n                }\r\n                else {\r\n                    var endState = Util.cloneDeep(updateShape.attr());\r\n                    updateShape.attr(cacheAttrs);\r\n                    updateShape.animate(endState, animateCfg.duration, animateCfg.easing, function () {\r\n                        updateShape.setSilent('cacheShape', null);\r\n                    });\r\n                }\r\n                canvasDrawn = true;\r\n            }\r\n        });\r\n        Util.each(newShapes, function (newShape) {\r\n            var name = newShape.name;\r\n            var coord = newShape.get('coord');\r\n            animateCfg = getAnimateCfg(name, 'enter', newShape.get('animateCfg'));\r\n            animate = getAnimate(name, coord, 'enter', animateCfg.animation);\r\n            if (Util.isFunction(animate)) {\r\n                animate(newShape, animateCfg, coord);\r\n                canvasDrawn = true;\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        Util.each(shapes, function (shape) {\r\n            var name = shape.name;\r\n            var coord = shape.get('coord');\r\n            animateCfg = getAnimateCfg(name, 'appear', shape.get('animateCfg'));\r\n            animate = getAnimate(name, coord, 'appear', animateCfg.animation);\r\n            if (Util.isFunction(animate)) {\r\n                animate(shape, animateCfg, coord);\r\n                canvasDrawn = true;\r\n            }\r\n        });\r\n    }\r\n    return canvasDrawn;\r\n}\r\nmodule.exports = {\r\n    execAnimation: function execAnimation(view, isUpdate) {\r\n        var viewContainer = view.get('middlePlot');\r\n        var axisContainer = view.get('backPlot');\r\n        var viewId = view.get('_id');\r\n        var canvas = view.get('canvas');\r\n        var caches = canvas.get(viewId + 'caches') || [];\r\n        if (caches.length === 0) {\r\n            isUpdate = false;\r\n        }\r\n        var shapes = getShapes(viewContainer, viewId);\r\n        var axisShapes = getShapes(axisContainer, viewId);\r\n        var cacheShapes = shapes.concat(axisShapes);\r\n        canvas.setSilent(viewId + 'caches', cache(cacheShapes));\r\n        var drawn;\r\n        if (isUpdate) {\r\n            drawn = addAnimate(caches, cacheShapes, canvas, isUpdate);\r\n        }\r\n        else {\r\n            drawn = addAnimate(caches, shapes, canvas, isUpdate);\r\n        }\r\n        if (!drawn) {\r\n            canvas.draw();\r\n        }\r\n    }\r\n};\r\n",{"version":3,"file":"D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\animate\\index.js","sourceRoot":"","sources":["D:\\project\\Deecamp-project\\system\\Web\\node_modules\\@antv\\g2\\lib\\animate\\index.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * @fileOverview The entry of chart's animation\n * @author sima.zhang\n */\nvar Util = require('../util');\n\nvar Animate = require('./animate');\n\nvar MatrixUtil = Util.MatrixUtil;\nvar mat3 = MatrixUtil.mat3; // 获取图组内所有的shapes\n\nfunction getShapes(container, viewId) {\n  var shapes = [];\n\n  if (container.get('animate') === false) {\n    return [];\n  }\n\n  var children = container.get('children');\n  Util.each(children, function (child) {\n    if (child.isGroup) {\n      shapes = shapes.concat(getShapes(child, viewId));\n    } else if (child.isShape && child._id) {\n      var id = child._id;\n      id = id.split('-')[0];\n\n      if (id === viewId) {\n        shapes.push(child);\n      }\n    }\n  });\n  return shapes;\n}\n\nfunction cache(shapes) {\n  var rst = {};\n  Util.each(shapes, function (shape) {\n    if (!shape._id || shape.isClip) return;\n    var id = shape._id;\n    rst[id] = {\n      _id: id,\n      type: shape.get('type'),\n      attrs: Util.cloneDeep(shape.attr()),\n      // 原始属性\n      name: shape.name,\n      index: shape.get('index'),\n      animateCfg: shape.get('animateCfg'),\n      coord: shape.get('coord')\n    };\n  });\n  return rst;\n}\n\nfunction getAnimate(geomType, coord, animationType, animationName) {\n  var result;\n\n  if (animationName) {\n    result = Animate.Action[animationType][animationName];\n  } else {\n    result = Animate.getAnimation(geomType, coord, animationType);\n  }\n\n  return result;\n}\n\nfunction getAnimateCfg(geomType, animationType, animateCfg) {\n  var defaultCfg = Animate.getAnimateCfg(geomType, animationType);\n\n  if (animateCfg && animateCfg[animationType]) {\n    return Util.deepMix({}, defaultCfg, animateCfg[animationType]);\n  }\n\n  return defaultCfg;\n}\n\nfunction addAnimate(cache, shapes, canvas, isUpdate) {\n  var animate;\n  var animateCfg;\n  var canvasDrawn = false;\n\n  if (isUpdate) {\n    // Step: leave -> update -> enter\n    var updateShapes = []; // 存储的是 shapes\n\n    var newShapes = []; // 存储的是 shapes\n\n    Util.each(shapes, function (shape) {\n      var result = cache[shape._id];\n\n      if (!result) {\n        newShapes.push(shape);\n      } else {\n        shape.setSilent('cacheShape', result);\n        updateShapes.push(shape);\n        delete cache[shape._id];\n      }\n    });\n    Util.each(cache, function (deletedShape) {\n      var name = deletedShape.name,\n          coord = deletedShape.coord,\n          _id = deletedShape._id,\n          attrs = deletedShape.attrs,\n          index = deletedShape.index,\n          type = deletedShape.type;\n      animateCfg = getAnimateCfg(name, 'leave', deletedShape.animateCfg);\n      animate = getAnimate(name, coord, 'leave', animateCfg.animation);\n\n      if (Util.isFunction(animate)) {\n        var tempShape = canvas.addShape(type, {\n          attrs: attrs,\n          index: index\n        });\n        tempShape._id = _id;\n        tempShape.name = name;\n\n        if (coord && name !== 'label') {\n          var tempShapeMatrix = tempShape.getMatrix();\n          var finalMatrix = mat3.multiply([], tempShapeMatrix, coord.matrix);\n          tempShape.setMatrix(finalMatrix);\n        }\n\n        canvasDrawn = true;\n        animate(tempShape, animateCfg, coord);\n      }\n    });\n    Util.each(updateShapes, function (updateShape) {\n      var name = updateShape.name;\n      var coord = updateShape.get('coord');\n      var cacheAttrs = updateShape.get('cacheShape').attrs; // 判断如果属性相同的话就不进行变换\n\n      if (!Util.isEqual(cacheAttrs, updateShape.attr())) {\n        animateCfg = getAnimateCfg(name, 'update', updateShape.get('animateCfg'));\n        animate = getAnimate(name, coord, 'update', animateCfg.animation);\n\n        if (Util.isFunction(animate)) {\n          animate(updateShape, animateCfg, coord);\n        } else {\n          var endState = Util.cloneDeep(updateShape.attr());\n          updateShape.attr(cacheAttrs);\n          updateShape.animate(endState, animateCfg.duration, animateCfg.easing, function () {\n            updateShape.setSilent('cacheShape', null);\n          });\n        }\n\n        canvasDrawn = true;\n      }\n    });\n    Util.each(newShapes, function (newShape) {\n      var name = newShape.name;\n      var coord = newShape.get('coord');\n      animateCfg = getAnimateCfg(name, 'enter', newShape.get('animateCfg'));\n      animate = getAnimate(name, coord, 'enter', animateCfg.animation);\n\n      if (Util.isFunction(animate)) {\n        animate(newShape, animateCfg, coord);\n        canvasDrawn = true;\n      }\n    });\n  } else {\n    Util.each(shapes, function (shape) {\n      var name = shape.name;\n      var coord = shape.get('coord');\n      animateCfg = getAnimateCfg(name, 'appear', shape.get('animateCfg'));\n      animate = getAnimate(name, coord, 'appear', animateCfg.animation);\n\n      if (Util.isFunction(animate)) {\n        animate(shape, animateCfg, coord);\n        canvasDrawn = true;\n      }\n    });\n  }\n\n  return canvasDrawn;\n}\n\nmodule.exports = {\n  execAnimation: function execAnimation(view, isUpdate) {\n    var viewContainer = view.get('middlePlot');\n    var axisContainer = view.get('backPlot');\n    var viewId = view.get('_id');\n    var canvas = view.get('canvas');\n    var caches = canvas.get(viewId + 'caches') || [];\n\n    if (caches.length === 0) {\n      isUpdate = false;\n    }\n\n    var shapes = getShapes(viewContainer, viewId);\n    var axisShapes = getShapes(axisContainer, viewId);\n    var cacheShapes = shapes.concat(axisShapes);\n    canvas.setSilent(viewId + 'caches', cache(cacheShapes));\n    var drawn;\n\n    if (isUpdate) {\n      drawn = addAnimate(caches, cacheShapes, canvas, isUpdate);\n    } else {\n      drawn = addAnimate(caches, shapes, canvas, isUpdate);\n    }\n\n    if (!drawn) {\n      canvas.draw();\n    }\n  }\n};"]}]}